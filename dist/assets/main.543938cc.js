var EC=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Gee=EC((oe,ur)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var Hi="top",dr="bottom",pr="right",Vi="left",tp="auto",Il=[Hi,dr,pr,Vi],$a="start",xl="end",DS="clippingParents",Mv="viewport",Vo="popper",PS="reference",Km=Il.reduce(function(e,t){return e.concat([t+"-"+$a,t+"-"+xl])},[]),Cv=[].concat(Il,[tp]).reduce(function(e,t){return e.concat([t,t+"-"+$a,t+"-"+xl])},[]),LS="beforeRead",OS="read",RS="afterRead",IS="beforeMain",BS="main",NS="afterMain",kS="beforeWrite",US="write",FS="afterWrite",zS=[LS,OS,RS,IS,BS,NS,kS,US,FS];function Hn(e){return e?(e.nodeName||"").toLowerCase():null}function kr(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function eo(e){var t=kr(e).Element;return e instanceof t||e instanceof Element}function Or(e){var t=kr(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function Dv(e){if(typeof ShadowRoot>"u")return!1;var t=kr(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}function TC(e){var t=e.state;Object.keys(t.elements).forEach(function(i){var r=t.styles[i]||{},n=t.attributes[i]||{},s=t.elements[i];!Or(s)||!Hn(s)||(Object.assign(s.style,r),Object.keys(n).forEach(function(a){var o=n[a];o===!1?s.removeAttribute(a):s.setAttribute(a,o===!0?"":o)}))})}function MC(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach(function(r){var n=t.elements[r],s=t.attributes[r]||{},a=Object.keys(t.styles.hasOwnProperty(r)?t.styles[r]:i[r]),o=a.reduce(function(l,h){return l[h]="",l},{});!Or(n)||!Hn(n)||(Object.assign(n.style,o),Object.keys(s).forEach(function(l){n.removeAttribute(l)}))})}}const Pv={name:"applyStyles",enabled:!0,phase:"write",fn:TC,effect:MC,requires:["computeStyles"]};function Bn(e){return e.split("-")[0]}var Wa=Math.max,md=Math.min,bl=Math.round;function Zm(){var e=navigator.userAgentData;return e!=null&&e.brands?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function GS(){return!/^((?!chrome|android).)*safari/i.test(Zm())}function wl(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!1);var r=e.getBoundingClientRect(),n=1,s=1;t&&Or(e)&&(n=e.offsetWidth>0&&bl(r.width)/e.offsetWidth||1,s=e.offsetHeight>0&&bl(r.height)/e.offsetHeight||1);var a=eo(e)?kr(e):window,o=a.visualViewport,l=!GS()&&i,h=(r.left+(l&&o?o.offsetLeft:0))/n,c=(r.top+(l&&o?o.offsetTop:0))/s,u=r.width/n,d=r.height/s;return{width:u,height:d,top:c,right:h+u,bottom:c+d,left:h,x:h,y:c}}function Lv(e){var t=wl(e),i=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:r}}function HS(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&Dv(i)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function vs(e){return kr(e).getComputedStyle(e)}function CC(e){return["table","td","th"].indexOf(Hn(e))>=0}function ma(e){return((eo(e)?e.ownerDocument:e.document)||window.document).documentElement}function ip(e){return Hn(e)==="html"?e:e.assignedSlot||e.parentNode||(Dv(e)?e.host:null)||ma(e)}function wy(e){return!Or(e)||vs(e).position==="fixed"?null:e.offsetParent}function DC(e){var t=/firefox/i.test(Zm()),i=/Trident/i.test(Zm());if(i&&Or(e)){var r=vs(e);if(r.position==="fixed")return null}var n=ip(e);for(Dv(n)&&(n=n.host);Or(n)&&["html","body"].indexOf(Hn(n))<0;){var s=vs(n);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||t&&s.willChange==="filter"||t&&s.filter&&s.filter!=="none")return n;n=n.parentNode}return null}function yu(e){for(var t=kr(e),i=wy(e);i&&CC(i)&&vs(i).position==="static";)i=wy(i);return i&&(Hn(i)==="html"||Hn(i)==="body"&&vs(i).position==="static")?t:i||DC(e)||t}function Ov(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Nh(e,t,i){return Wa(e,md(t,i))}function PC(e,t,i){var r=Nh(e,t,i);return r>i?i:r}function VS(){return{top:0,right:0,bottom:0,left:0}}function jS(e){return Object.assign({},VS(),e)}function WS(e,t){return t.reduce(function(i,r){return i[r]=e,i},{})}var LC=function(t,i){return t=typeof t=="function"?t(Object.assign({},i.rects,{placement:i.placement})):t,jS(typeof t!="number"?t:WS(t,Il))};function OC(e){var t,i=e.state,r=e.name,n=e.options,s=i.elements.arrow,a=i.modifiersData.popperOffsets,o=Bn(i.placement),l=Ov(o),h=[Vi,pr].indexOf(o)>=0,c=h?"height":"width";if(!(!s||!a)){var u=LC(n.padding,i),d=Lv(s),p=l==="y"?Hi:Vi,m=l==="y"?dr:pr,g=i.rects.reference[c]+i.rects.reference[l]-a[l]-i.rects.popper[c],f=a[l]-i.rects.reference[l],v=yu(s),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,x=g/2-f/2,b=u[p],S=y-d[c]-u[m],_=y/2-d[c]/2+x,A=Nh(b,_,S),w=l;i.modifiersData[r]=(t={},t[w]=A,t.centerOffset=A-_,t)}}function RC(e){var t=e.state,i=e.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=t.elements.popper.querySelector(n),!n)||!HS(t.elements.popper,n)||(t.elements.arrow=n))}const qS={name:"arrow",enabled:!0,phase:"main",fn:OC,effect:RC,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function _l(e){return e.split("-")[1]}var IC={top:"auto",right:"auto",bottom:"auto",left:"auto"};function BC(e){var t=e.x,i=e.y,r=window,n=r.devicePixelRatio||1;return{x:bl(t*n)/n||0,y:bl(i*n)/n||0}}function _y(e){var t,i=e.popper,r=e.popperRect,n=e.placement,s=e.variation,a=e.offsets,o=e.position,l=e.gpuAcceleration,h=e.adaptive,c=e.roundOffsets,u=e.isFixed,d=a.x,p=d===void 0?0:d,m=a.y,g=m===void 0?0:m,f=typeof c=="function"?c({x:p,y:g}):{x:p,y:g};p=f.x,g=f.y;var v=a.hasOwnProperty("x"),y=a.hasOwnProperty("y"),x=Vi,b=Hi,S=window;if(h){var _=yu(i),A="clientHeight",w="clientWidth";if(_===kr(i)&&(_=ma(i),vs(_).position!=="static"&&o==="absolute"&&(A="scrollHeight",w="scrollWidth")),_=_,n===Hi||(n===Vi||n===pr)&&s===xl){b=dr;var E=u&&_===S&&S.visualViewport?S.visualViewport.height:_[A];g-=E-r.height,g*=l?1:-1}if(n===Vi||(n===Hi||n===dr)&&s===xl){x=pr;var T=u&&_===S&&S.visualViewport?S.visualViewport.width:_[w];p-=T-r.width,p*=l?1:-1}}var C=Object.assign({position:o},h&&IC),P=c===!0?BC({x:p,y:g}):{x:p,y:g};if(p=P.x,g=P.y,l){var k;return Object.assign({},C,(k={},k[b]=y?"0":"",k[x]=v?"0":"",k.transform=(S.devicePixelRatio||1)<=1?"translate("+p+"px, "+g+"px)":"translate3d("+p+"px, "+g+"px, 0)",k))}return Object.assign({},C,(t={},t[b]=y?g+"px":"",t[x]=v?p+"px":"",t.transform="",t))}function NC(e){var t=e.state,i=e.options,r=i.gpuAcceleration,n=r===void 0?!0:r,s=i.adaptive,a=s===void 0?!0:s,o=i.roundOffsets,l=o===void 0?!0:o,h={placement:Bn(t.placement),variation:_l(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:n,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,_y(Object.assign({},h,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:l})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,_y(Object.assign({},h,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const Rv={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:NC,data:{}};var Vu={passive:!0};function kC(e){var t=e.state,i=e.instance,r=e.options,n=r.scroll,s=n===void 0?!0:n,a=r.resize,o=a===void 0?!0:a,l=kr(t.elements.popper),h=[].concat(t.scrollParents.reference,t.scrollParents.popper);return s&&h.forEach(function(c){c.addEventListener("scroll",i.update,Vu)}),o&&l.addEventListener("resize",i.update,Vu),function(){s&&h.forEach(function(c){c.removeEventListener("scroll",i.update,Vu)}),o&&l.removeEventListener("resize",i.update,Vu)}}const Iv={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:kC,data:{}};var UC={left:"right",right:"left",bottom:"top",top:"bottom"};function $c(e){return e.replace(/left|right|bottom|top/g,function(t){return UC[t]})}var FC={start:"end",end:"start"};function Sy(e){return e.replace(/start|end/g,function(t){return FC[t]})}function Bv(e){var t=kr(e),i=t.pageXOffset,r=t.pageYOffset;return{scrollLeft:i,scrollTop:r}}function Nv(e){return wl(ma(e)).left+Bv(e).scrollLeft}function zC(e,t){var i=kr(e),r=ma(e),n=i.visualViewport,s=r.clientWidth,a=r.clientHeight,o=0,l=0;if(n){s=n.width,a=n.height;var h=GS();(h||!h&&t==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:s,height:a,x:o+Nv(e),y:l}}function GC(e){var t,i=ma(e),r=Bv(e),n=(t=e.ownerDocument)==null?void 0:t.body,s=Wa(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),a=Wa(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-r.scrollLeft+Nv(e),l=-r.scrollTop;return vs(n||i).direction==="rtl"&&(o+=Wa(i.clientWidth,n?n.clientWidth:0)-s),{width:s,height:a,x:o,y:l}}function kv(e){var t=vs(e),i=t.overflow,r=t.overflowX,n=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function YS(e){return["html","body","#document"].indexOf(Hn(e))>=0?e.ownerDocument.body:Or(e)&&kv(e)?e:YS(ip(e))}function kh(e,t){var i;t===void 0&&(t=[]);var r=YS(e),n=r===((i=e.ownerDocument)==null?void 0:i.body),s=kr(r),a=n?[s].concat(s.visualViewport||[],kv(r)?r:[]):r,o=t.concat(a);return n?o:o.concat(kh(ip(a)))}function Jm(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function HC(e,t){var i=wl(e,!1,t==="fixed");return i.top=i.top+e.clientTop,i.left=i.left+e.clientLeft,i.bottom=i.top+e.clientHeight,i.right=i.left+e.clientWidth,i.width=e.clientWidth,i.height=e.clientHeight,i.x=i.left,i.y=i.top,i}function Ay(e,t,i){return t===Mv?Jm(zC(e,i)):eo(t)?HC(t,i):Jm(GC(ma(e)))}function VC(e){var t=kh(ip(e)),i=["absolute","fixed"].indexOf(vs(e).position)>=0,r=i&&Or(e)?yu(e):e;return eo(r)?t.filter(function(n){return eo(n)&&HS(n,r)&&Hn(n)!=="body"}):[]}function jC(e,t,i,r){var n=t==="clippingParents"?VC(e):[].concat(t),s=[].concat(n,[i]),a=s[0],o=s.reduce(function(l,h){var c=Ay(e,h,r);return l.top=Wa(c.top,l.top),l.right=md(c.right,l.right),l.bottom=md(c.bottom,l.bottom),l.left=Wa(c.left,l.left),l},Ay(e,a,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function XS(e){var t=e.reference,i=e.element,r=e.placement,n=r?Bn(r):null,s=r?_l(r):null,a=t.x+t.width/2-i.width/2,o=t.y+t.height/2-i.height/2,l;switch(n){case Hi:l={x:a,y:t.y-i.height};break;case dr:l={x:a,y:t.y+t.height};break;case pr:l={x:t.x+t.width,y:o};break;case Vi:l={x:t.x-i.width,y:o};break;default:l={x:t.x,y:t.y}}var h=n?Ov(n):null;if(h!=null){var c=h==="y"?"height":"width";switch(s){case $a:l[h]=l[h]-(t[c]/2-i[c]/2);break;case xl:l[h]=l[h]+(t[c]/2-i[c]/2);break}}return l}function Sl(e,t){t===void 0&&(t={});var i=t,r=i.placement,n=r===void 0?e.placement:r,s=i.strategy,a=s===void 0?e.strategy:s,o=i.boundary,l=o===void 0?DS:o,h=i.rootBoundary,c=h===void 0?Mv:h,u=i.elementContext,d=u===void 0?Vo:u,p=i.altBoundary,m=p===void 0?!1:p,g=i.padding,f=g===void 0?0:g,v=jS(typeof f!="number"?f:WS(f,Il)),y=d===Vo?PS:Vo,x=e.rects.popper,b=e.elements[m?y:d],S=jC(eo(b)?b:b.contextElement||ma(e.elements.popper),l,c,a),_=wl(e.elements.reference),A=XS({reference:_,element:x,strategy:"absolute",placement:n}),w=Jm(Object.assign({},x,A)),E=d===Vo?w:_,T={top:S.top-E.top+v.top,bottom:E.bottom-S.bottom+v.bottom,left:S.left-E.left+v.left,right:E.right-S.right+v.right},C=e.modifiersData.offset;if(d===Vo&&C){var P=C[n];Object.keys(T).forEach(function(k){var D=[pr,dr].indexOf(k)>=0?1:-1,R=[Hi,dr].indexOf(k)>=0?"y":"x";T[k]+=P[R]*D})}return T}function WC(e,t){t===void 0&&(t={});var i=t,r=i.placement,n=i.boundary,s=i.rootBoundary,a=i.padding,o=i.flipVariations,l=i.allowedAutoPlacements,h=l===void 0?Cv:l,c=_l(r),u=c?o?Km:Km.filter(function(m){return _l(m)===c}):Il,d=u.filter(function(m){return h.indexOf(m)>=0});d.length===0&&(d=u);var p=d.reduce(function(m,g){return m[g]=Sl(e,{placement:g,boundary:n,rootBoundary:s,padding:a})[Bn(g)],m},{});return Object.keys(p).sort(function(m,g){return p[m]-p[g]})}function qC(e){if(Bn(e)===tp)return[];var t=$c(e);return[Sy(e),t,Sy(t)]}function YC(e){var t=e.state,i=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var n=i.mainAxis,s=n===void 0?!0:n,a=i.altAxis,o=a===void 0?!0:a,l=i.fallbackPlacements,h=i.padding,c=i.boundary,u=i.rootBoundary,d=i.altBoundary,p=i.flipVariations,m=p===void 0?!0:p,g=i.allowedAutoPlacements,f=t.options.placement,v=Bn(f),y=v===f,x=l||(y||!m?[$c(f)]:qC(f)),b=[f].concat(x).reduce(function(Y,K){return Y.concat(Bn(K)===tp?WC(t,{placement:K,boundary:c,rootBoundary:u,padding:h,flipVariations:m,allowedAutoPlacements:g}):K)},[]),S=t.rects.reference,_=t.rects.popper,A=new Map,w=!0,E=b[0],T=0;T<b.length;T++){var C=b[T],P=Bn(C),k=_l(C)===$a,D=[Hi,dr].indexOf(P)>=0,R=D?"width":"height",G=Sl(t,{placement:C,boundary:c,rootBoundary:u,altBoundary:d,padding:h}),N=D?k?pr:Vi:k?dr:Hi;S[R]>_[R]&&(N=$c(N));var L=$c(N),H=[];if(s&&H.push(G[P]<=0),o&&H.push(G[N]<=0,G[L]<=0),H.every(function(Y){return Y})){E=C,w=!1;break}A.set(C,H)}if(w)for(var F=m?3:1,z=function(K){var V=b.find(function(ie){var Q=A.get(ie);if(Q)return Q.slice(0,K).every(function(J){return J})});if(V)return E=V,"break"},U=F;U>0;U--){var W=z(U);if(W==="break")break}t.placement!==E&&(t.modifiersData[r]._skip=!0,t.placement=E,t.reset=!0)}}const QS={name:"flip",enabled:!0,phase:"main",fn:YC,requiresIfExists:["offset"],data:{_skip:!1}};function Ey(e,t,i){return i===void 0&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function Ty(e){return[Hi,pr,dr,Vi].some(function(t){return e[t]>=0})}function XC(e){var t=e.state,i=e.name,r=t.rects.reference,n=t.rects.popper,s=t.modifiersData.preventOverflow,a=Sl(t,{elementContext:"reference"}),o=Sl(t,{altBoundary:!0}),l=Ey(a,r),h=Ey(o,n,s),c=Ty(l),u=Ty(h);t.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:h,isReferenceHidden:c,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":u})}const KS={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:XC};function QC(e,t,i){var r=Bn(e),n=[Vi,Hi].indexOf(r)>=0?-1:1,s=typeof i=="function"?i(Object.assign({},t,{placement:e})):i,a=s[0],o=s[1];return a=a||0,o=(o||0)*n,[Vi,pr].indexOf(r)>=0?{x:o,y:a}:{x:a,y:o}}function KC(e){var t=e.state,i=e.options,r=e.name,n=i.offset,s=n===void 0?[0,0]:n,a=Cv.reduce(function(c,u){return c[u]=QC(u,t.rects,s),c},{}),o=a[t.placement],l=o.x,h=o.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=h),t.modifiersData[r]=a}const ZS={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:KC};function ZC(e){var t=e.state,i=e.name;t.modifiersData[i]=XS({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}const Uv={name:"popperOffsets",enabled:!0,phase:"read",fn:ZC,data:{}};function JC(e){return e==="x"?"y":"x"}function $C(e){var t=e.state,i=e.options,r=e.name,n=i.mainAxis,s=n===void 0?!0:n,a=i.altAxis,o=a===void 0?!1:a,l=i.boundary,h=i.rootBoundary,c=i.altBoundary,u=i.padding,d=i.tether,p=d===void 0?!0:d,m=i.tetherOffset,g=m===void 0?0:m,f=Sl(t,{boundary:l,rootBoundary:h,padding:u,altBoundary:c}),v=Bn(t.placement),y=_l(t.placement),x=!y,b=Ov(v),S=JC(b),_=t.modifiersData.popperOffsets,A=t.rects.reference,w=t.rects.popper,E=typeof g=="function"?g(Object.assign({},t.rects,{placement:t.placement})):g,T=typeof E=="number"?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),C=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,P={x:0,y:0};if(!!_){if(s){var k,D=b==="y"?Hi:Vi,R=b==="y"?dr:pr,G=b==="y"?"height":"width",N=_[b],L=N+f[D],H=N-f[R],F=p?-w[G]/2:0,z=y===$a?A[G]:w[G],U=y===$a?-w[G]:-A[G],W=t.elements.arrow,Y=p&&W?Lv(W):{width:0,height:0},K=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:VS(),V=K[D],ie=K[R],Q=Nh(0,A[G],Y[G]),J=x?A[G]/2-F-Q-V-T.mainAxis:z-Q-V-T.mainAxis,Z=x?-A[G]/2+F+Q+ie+T.mainAxis:U+Q+ie+T.mainAxis,ue=t.elements.arrow&&yu(t.elements.arrow),de=ue?b==="y"?ue.clientTop||0:ue.clientLeft||0:0,he=(k=C==null?void 0:C[b])!=null?k:0,ge=N+J-he-de,pe=N+Z-he,ve=Nh(p?md(L,ge):L,N,p?Wa(H,pe):H);_[b]=ve,P[b]=ve-N}if(o){var Re,Te=b==="x"?Hi:Vi,Me=b==="x"?dr:pr,yt=_[S],Ge=S==="y"?"height":"width",B=yt+f[Te],O=yt-f[Me],ne=[Hi,Vi].indexOf(v)!==-1,fe=(Re=C==null?void 0:C[S])!=null?Re:0,ye=ne?B:yt-A[Ge]-w[Ge]-fe+T.altAxis,Ae=ne?yt+A[Ge]+w[Ge]-fe-T.altAxis:O,Xe=p&&ne?PC(ye,yt,Ae):Nh(p?ye:B,yt,p?Ae:O);_[S]=Xe,P[S]=Xe-yt}t.modifiersData[r]=P}}const JS={name:"preventOverflow",enabled:!0,phase:"main",fn:$C,requiresIfExists:["offset"]};function eD(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function tD(e){return e===kr(e)||!Or(e)?Bv(e):eD(e)}function iD(e){var t=e.getBoundingClientRect(),i=bl(t.width)/e.offsetWidth||1,r=bl(t.height)/e.offsetHeight||1;return i!==1||r!==1}function rD(e,t,i){i===void 0&&(i=!1);var r=Or(t),n=Or(t)&&iD(t),s=ma(t),a=wl(e,n,i),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((Hn(t)!=="body"||kv(s))&&(o=tD(t)),Or(t)?(l=wl(t,!0),l.x+=t.clientLeft,l.y+=t.clientTop):s&&(l.x=Nv(s))),{x:a.left+o.scrollLeft-l.x,y:a.top+o.scrollTop-l.y,width:a.width,height:a.height}}function nD(e){var t=new Map,i=new Set,r=[];e.forEach(function(s){t.set(s.name,s)});function n(s){i.add(s.name);var a=[].concat(s.requires||[],s.requiresIfExists||[]);a.forEach(function(o){if(!i.has(o)){var l=t.get(o);l&&n(l)}}),r.push(s)}return e.forEach(function(s){i.has(s.name)||n(s)}),r}function sD(e){var t=nD(e);return zS.reduce(function(i,r){return i.concat(t.filter(function(n){return n.phase===r}))},[])}function aD(e){var t;return function(){return t||(t=new Promise(function(i){Promise.resolve().then(function(){t=void 0,i(e())})})),t}}function oD(e){var t=e.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(t).map(function(i){return t[i]})}var My={placement:"bottom",modifiers:[],strategy:"absolute"};function Cy(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function rp(e){e===void 0&&(e={});var t=e,i=t.defaultModifiers,r=i===void 0?[]:i,n=t.defaultOptions,s=n===void 0?My:n;return function(o,l,h){h===void 0&&(h=s);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},My,s),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},u=[],d=!1,p={state:c,setOptions:function(v){var y=typeof v=="function"?v(c.options):v;g(),c.options=Object.assign({},s,c.options,y),c.scrollParents={reference:eo(o)?kh(o):o.contextElement?kh(o.contextElement):[],popper:kh(l)};var x=sD(oD([].concat(r,c.options.modifiers)));return c.orderedModifiers=x.filter(function(b){return b.enabled}),m(),p.update()},forceUpdate:function(){if(!d){var v=c.elements,y=v.reference,x=v.popper;if(!!Cy(y,x)){c.rects={reference:rD(y,yu(x),c.options.strategy==="fixed"),popper:Lv(x)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(T){return c.modifiersData[T.name]=Object.assign({},T.data)});for(var b=0;b<c.orderedModifiers.length;b++){if(c.reset===!0){c.reset=!1,b=-1;continue}var S=c.orderedModifiers[b],_=S.fn,A=S.options,w=A===void 0?{}:A,E=S.name;typeof _=="function"&&(c=_({state:c,options:w,name:E,instance:p})||c)}}}},update:aD(function(){return new Promise(function(f){p.forceUpdate(),f(c)})}),destroy:function(){g(),d=!0}};if(!Cy(o,l))return p;p.setOptions(h).then(function(f){!d&&h.onFirstUpdate&&h.onFirstUpdate(f)});function m(){c.orderedModifiers.forEach(function(f){var v=f.name,y=f.options,x=y===void 0?{}:y,b=f.effect;if(typeof b=="function"){var S=b({state:c,name:v,instance:p,options:x}),_=function(){};u.push(S||_)}})}function g(){u.forEach(function(f){return f()}),u=[]}return p}}var lD=rp(),hD=[Iv,Uv,Rv,Pv],uD=rp({defaultModifiers:hD}),cD=[Iv,Uv,Rv,Pv,ZS,QS,JS,qS,KS],Fv=rp({defaultModifiers:cD});const $S=Object.freeze(Object.defineProperty({__proto__:null,popperGenerator:rp,detectOverflow:Sl,createPopperBase:lD,createPopper:Fv,createPopperLite:uD,top:Hi,bottom:dr,right:pr,left:Vi,auto:tp,basePlacements:Il,start:$a,end:xl,clippingParents:DS,viewport:Mv,popper:Vo,reference:PS,variationPlacements:Km,placements:Cv,beforeRead:LS,read:OS,afterRead:RS,beforeMain:IS,main:BS,afterMain:NS,beforeWrite:kS,write:US,afterWrite:FS,modifierPhases:zS,applyStyles:Pv,arrow:qS,computeStyles:Rv,eventListeners:Iv,flip:QS,hide:KS,offset:ZS,popperOffsets:Uv,preventOverflow:JS},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.2.2 (https://getbootstrap.com/)
  * Copyright 2011-2022 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const dD=1e6,pD=1e3,$m="transitionend",fD=e=>e==null?`${e}`:Object.prototype.toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase(),mD=e=>{do e+=Math.floor(Math.random()*dD);while(document.getElementById(e));return e},eA=e=>{let t=e.getAttribute("data-bs-target");if(!t||t==="#"){let i=e.getAttribute("href");if(!i||!i.includes("#")&&!i.startsWith("."))return null;i.includes("#")&&!i.startsWith("#")&&(i=`#${i.split("#")[1]}`),t=i&&i!=="#"?i.trim():null}return t},tA=e=>{const t=eA(e);return t&&document.querySelector(t)?t:null},hs=e=>{const t=eA(e);return t?document.querySelector(t):null},gD=e=>{if(!e)return 0;let{transitionDuration:t,transitionDelay:i}=window.getComputedStyle(e);const r=Number.parseFloat(t),n=Number.parseFloat(i);return!r&&!n?0:(t=t.split(",")[0],i=i.split(",")[0],(Number.parseFloat(t)+Number.parseFloat(i))*pD)},iA=e=>{e.dispatchEvent(new Event($m))},us=e=>!e||typeof e!="object"?!1:(typeof e.jquery<"u"&&(e=e[0]),typeof e.nodeType<"u"),sa=e=>us(e)?e.jquery?e[0]:e:typeof e=="string"&&e.length>0?document.querySelector(e):null,Bl=e=>{if(!us(e)||e.getClientRects().length===0)return!1;const t=getComputedStyle(e).getPropertyValue("visibility")==="visible",i=e.closest("details:not([open])");if(!i)return t;if(i!==e){const r=e.closest("summary");if(r&&r.parentNode!==i||r===null)return!1}return t},aa=e=>!e||e.nodeType!==Node.ELEMENT_NODE||e.classList.contains("disabled")?!0:typeof e.disabled<"u"?e.disabled:e.hasAttribute("disabled")&&e.getAttribute("disabled")!=="false",rA=e=>{if(!document.documentElement.attachShadow)return null;if(typeof e.getRootNode=="function"){const t=e.getRootNode();return t instanceof ShadowRoot?t:null}return e instanceof ShadowRoot?e:e.parentNode?rA(e.parentNode):null},gd=()=>{},xu=e=>{e.offsetHeight},nA=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Fp=[],vD=e=>{document.readyState==="loading"?(Fp.length||document.addEventListener("DOMContentLoaded",()=>{for(const t of Fp)t()}),Fp.push(e)):e()},Nr=()=>document.documentElement.dir==="rtl",Ur=e=>{vD(()=>{const t=nA();if(t){const i=e.NAME,r=t.fn[i];t.fn[i]=e.jQueryInterface,t.fn[i].Constructor=e,t.fn[i].noConflict=()=>(t.fn[i]=r,e.jQueryInterface)}})},as=e=>{typeof e=="function"&&e()},sA=(e,t,i=!0)=>{if(!i){as(e);return}const r=5,n=gD(t)+r;let s=!1;const a=({target:o})=>{o===t&&(s=!0,t.removeEventListener($m,a),as(e))};t.addEventListener($m,a),setTimeout(()=>{s||iA(t)},n)},zv=(e,t,i,r)=>{const n=e.length;let s=e.indexOf(t);return s===-1?!i&&r?e[n-1]:e[0]:(s+=i?1:-1,r&&(s=(s+n)%n),e[Math.max(0,Math.min(s,n-1))])},yD=/[^.]*(?=\..*)\.|.*/,xD=/\..*/,bD=/::\d+$/,zp={};let Dy=1;const aA={mouseenter:"mouseover",mouseleave:"mouseout"},wD=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function oA(e,t){return t&&`${t}::${Dy++}`||e.uidEvent||Dy++}function lA(e){const t=oA(e);return e.uidEvent=t,zp[t]=zp[t]||{},zp[t]}function _D(e,t){return function i(r){return Gv(r,{delegateTarget:e}),i.oneOff&&me.off(e,r.type,t),t.apply(e,[r])}}function SD(e,t,i){return function r(n){const s=e.querySelectorAll(t);for(let{target:a}=n;a&&a!==this;a=a.parentNode)for(const o of s)if(o===a)return Gv(n,{delegateTarget:a}),r.oneOff&&me.off(e,n.type,t,i),i.apply(a,[n])}}function hA(e,t,i=null){return Object.values(e).find(r=>r.callable===t&&r.delegationSelector===i)}function uA(e,t,i){const r=typeof t=="string",n=r?i:t||i;let s=cA(e);return wD.has(s)||(s=e),[r,n,s]}function Py(e,t,i,r,n){if(typeof t!="string"||!e)return;let[s,a,o]=uA(t,i,r);t in aA&&(a=(m=>function(g){if(!g.relatedTarget||g.relatedTarget!==g.delegateTarget&&!g.delegateTarget.contains(g.relatedTarget))return m.call(this,g)})(a));const l=lA(e),h=l[o]||(l[o]={}),c=hA(h,a,s?i:null);if(c){c.oneOff=c.oneOff&&n;return}const u=oA(a,t.replace(yD,"")),d=s?SD(e,i,a):_D(e,a);d.delegationSelector=s?i:null,d.callable=a,d.oneOff=n,d.uidEvent=u,h[u]=d,e.addEventListener(o,d,s)}function eg(e,t,i,r,n){const s=hA(t[i],r,n);!s||(e.removeEventListener(i,s,Boolean(n)),delete t[i][s.uidEvent])}function AD(e,t,i,r){const n=t[i]||{};for(const s of Object.keys(n))if(s.includes(r)){const a=n[s];eg(e,t,i,a.callable,a.delegationSelector)}}function cA(e){return e=e.replace(xD,""),aA[e]||e}const me={on(e,t,i,r){Py(e,t,i,r,!1)},one(e,t,i,r){Py(e,t,i,r,!0)},off(e,t,i,r){if(typeof t!="string"||!e)return;const[n,s,a]=uA(t,i,r),o=a!==t,l=lA(e),h=l[a]||{},c=t.startsWith(".");if(typeof s<"u"){if(!Object.keys(h).length)return;eg(e,l,a,s,n?i:null);return}if(c)for(const u of Object.keys(l))AD(e,l,u,t.slice(1));for(const u of Object.keys(h)){const d=u.replace(bD,"");if(!o||t.includes(d)){const p=h[u];eg(e,l,a,p.callable,p.delegationSelector)}}},trigger(e,t,i){if(typeof t!="string"||!e)return null;const r=nA(),n=cA(t),s=t!==n;let a=null,o=!0,l=!0,h=!1;s&&r&&(a=r.Event(t,i),r(e).trigger(a),o=!a.isPropagationStopped(),l=!a.isImmediatePropagationStopped(),h=a.isDefaultPrevented());let c=new Event(t,{bubbles:o,cancelable:!0});return c=Gv(c,i),h&&c.preventDefault(),l&&e.dispatchEvent(c),c.defaultPrevented&&a&&a.preventDefault(),c}};function Gv(e,t){for(const[i,r]of Object.entries(t||{}))try{e[i]=r}catch{Object.defineProperty(e,i,{configurable:!0,get(){return r}})}return e}const Ts=new Map,Gp={set(e,t,i){Ts.has(e)||Ts.set(e,new Map);const r=Ts.get(e);if(!r.has(t)&&r.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(r.keys())[0]}.`);return}r.set(t,i)},get(e,t){return Ts.has(e)&&Ts.get(e).get(t)||null},remove(e,t){if(!Ts.has(e))return;const i=Ts.get(e);i.delete(t),i.size===0&&Ts.delete(e)}};function Ly(e){if(e==="true")return!0;if(e==="false")return!1;if(e===Number(e).toString())return Number(e);if(e===""||e==="null")return null;if(typeof e!="string")return e;try{return JSON.parse(decodeURIComponent(e))}catch{return e}}function Hp(e){return e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}const cs={setDataAttribute(e,t,i){e.setAttribute(`data-bs-${Hp(t)}`,i)},removeDataAttribute(e,t){e.removeAttribute(`data-bs-${Hp(t)}`)},getDataAttributes(e){if(!e)return{};const t={},i=Object.keys(e.dataset).filter(r=>r.startsWith("bs")&&!r.startsWith("bsConfig"));for(const r of i){let n=r.replace(/^bs/,"");n=n.charAt(0).toLowerCase()+n.slice(1,n.length),t[n]=Ly(e.dataset[r])}return t},getDataAttribute(e,t){return Ly(e.getAttribute(`data-bs-${Hp(t)}`))}};class bu{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,i){const r=us(i)?cs.getDataAttribute(i,"config"):{};return{...this.constructor.Default,...typeof r=="object"?r:{},...us(i)?cs.getDataAttributes(i):{},...typeof t=="object"?t:{}}}_typeCheckConfig(t,i=this.constructor.DefaultType){for(const r of Object.keys(i)){const n=i[r],s=t[r],a=us(s)?"element":fD(s);if(!new RegExp(n).test(a))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${r}" provided type "${a}" but expected type "${n}".`)}}}const ED="5.2.2";class on extends bu{constructor(t,i){super(),t=sa(t),t&&(this._element=t,this._config=this._getConfig(i),Gp.set(this._element,this.constructor.DATA_KEY,this))}dispose(){Gp.remove(this._element,this.constructor.DATA_KEY),me.off(this._element,this.constructor.EVENT_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_queueCallback(t,i,r=!0){sA(t,i,r)}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return Gp.get(sa(t),this.DATA_KEY)}static getOrCreateInstance(t,i={}){return this.getInstance(t)||new this(t,typeof i=="object"?i:null)}static get VERSION(){return ED}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(t){return`${t}${this.EVENT_KEY}`}}const np=(e,t="hide")=>{const i=`click.dismiss${e.EVENT_KEY}`,r=e.NAME;me.on(document,i,`[data-bs-dismiss="${r}"]`,function(n){if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),aa(this))return;const s=hs(this)||this.closest(`.${r}`);e.getOrCreateInstance(s)[t]()})},TD="alert",MD="bs.alert",dA=`.${MD}`,CD=`close${dA}`,DD=`closed${dA}`,PD="fade",LD="show";class sp extends on{static get NAME(){return TD}close(){if(me.trigger(this._element,CD).defaultPrevented)return;this._element.classList.remove(LD);const i=this._element.classList.contains(PD);this._queueCallback(()=>this._destroyElement(),this._element,i)}_destroyElement(){this._element.remove(),me.trigger(this._element,DD),this.dispose()}static jQueryInterface(t){return this.each(function(){const i=sp.getOrCreateInstance(this);if(typeof t=="string"){if(i[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);i[t](this)}})}}np(sp,"close");Ur(sp);const OD="button",RD="bs.button",ID=`.${RD}`,BD=".data-api",ND="active",Oy='[data-bs-toggle="button"]',kD=`click${ID}${BD}`;class ap extends on{static get NAME(){return OD}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(ND))}static jQueryInterface(t){return this.each(function(){const i=ap.getOrCreateInstance(this);t==="toggle"&&i[t]()})}}me.on(document,kD,Oy,e=>{e.preventDefault();const t=e.target.closest(Oy);ap.getOrCreateInstance(t).toggle()});Ur(ap);const ft={find(e,t=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(t,e))},findOne(e,t=document.documentElement){return Element.prototype.querySelector.call(t,e)},children(e,t){return[].concat(...e.children).filter(i=>i.matches(t))},parents(e,t){const i=[];let r=e.parentNode.closest(t);for(;r;)i.push(r),r=r.parentNode.closest(t);return i},prev(e,t){let i=e.previousElementSibling;for(;i;){if(i.matches(t))return[i];i=i.previousElementSibling}return[]},next(e,t){let i=e.nextElementSibling;for(;i;){if(i.matches(t))return[i];i=i.nextElementSibling}return[]},focusableChildren(e){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(i=>`${i}:not([tabindex^="-"])`).join(",");return this.find(t,e).filter(i=>!aa(i)&&Bl(i))}},UD="swipe",Nl=".bs.swipe",FD=`touchstart${Nl}`,zD=`touchmove${Nl}`,GD=`touchend${Nl}`,HD=`pointerdown${Nl}`,VD=`pointerup${Nl}`,jD="touch",WD="pen",qD="pointer-event",YD=40,XD={endCallback:null,leftCallback:null,rightCallback:null},QD={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class vd extends bu{constructor(t,i){super(),this._element=t,!(!t||!vd.isSupported())&&(this._config=this._getConfig(i),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return XD}static get DefaultType(){return QD}static get NAME(){return UD}dispose(){me.off(this._element,Nl)}_start(t){if(!this._supportPointerEvents){this._deltaX=t.touches[0].clientX;return}this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX)}_end(t){this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX-this._deltaX),this._handleSwipe(),as(this._config.endCallback)}_move(t){this._deltaX=t.touches&&t.touches.length>1?0:t.touches[0].clientX-this._deltaX}_handleSwipe(){const t=Math.abs(this._deltaX);if(t<=YD)return;const i=t/this._deltaX;this._deltaX=0,i&&as(i>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(me.on(this._element,HD,t=>this._start(t)),me.on(this._element,VD,t=>this._end(t)),this._element.classList.add(qD)):(me.on(this._element,FD,t=>this._start(t)),me.on(this._element,zD,t=>this._move(t)),me.on(this._element,GD,t=>this._end(t)))}_eventIsPointerPenTouch(t){return this._supportPointerEvents&&(t.pointerType===WD||t.pointerType===jD)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const KD="carousel",ZD="bs.carousel",ga=`.${ZD}`,pA=".data-api",JD="ArrowLeft",$D="ArrowRight",e3=500,nh="next",yo="prev",jo="left",ed="right",t3=`slide${ga}`,Vp=`slid${ga}`,i3=`keydown${ga}`,r3=`mouseenter${ga}`,n3=`mouseleave${ga}`,s3=`dragstart${ga}`,a3=`load${ga}${pA}`,o3=`click${ga}${pA}`,fA="carousel",ju="active",l3="slide",h3="carousel-item-end",u3="carousel-item-start",c3="carousel-item-next",d3="carousel-item-prev",mA=".active",gA=".carousel-item",p3=mA+gA,f3=".carousel-item img",m3=".carousel-indicators",g3="[data-bs-slide], [data-bs-slide-to]",v3='[data-bs-ride="carousel"]',y3={[JD]:ed,[$D]:jo},x3={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},b3={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class wu extends on{constructor(t,i){super(t,i),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=ft.findOne(m3,this._element),this._addEventListeners(),this._config.ride===fA&&this.cycle()}static get Default(){return x3}static get DefaultType(){return b3}static get NAME(){return KD}next(){this._slide(nh)}nextWhenVisible(){!document.hidden&&Bl(this._element)&&this.next()}prev(){this._slide(yo)}pause(){this._isSliding&&iA(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(!!this._config.ride){if(this._isSliding){me.one(this._element,Vp,()=>this.cycle());return}this.cycle()}}to(t){const i=this._getItems();if(t>i.length-1||t<0)return;if(this._isSliding){me.one(this._element,Vp,()=>this.to(t));return}const r=this._getItemIndex(this._getActive());if(r===t)return;const n=t>r?nh:yo;this._slide(n,i[t])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(t){return t.defaultInterval=t.interval,t}_addEventListeners(){this._config.keyboard&&me.on(this._element,i3,t=>this._keydown(t)),this._config.pause==="hover"&&(me.on(this._element,r3,()=>this.pause()),me.on(this._element,n3,()=>this._maybeEnableCycle())),this._config.touch&&vd.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const r of ft.find(f3,this._element))me.on(r,s3,n=>n.preventDefault());const i={leftCallback:()=>this._slide(this._directionToOrder(jo)),rightCallback:()=>this._slide(this._directionToOrder(ed)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),e3+this._config.interval))}};this._swipeHelper=new vd(this._element,i)}_keydown(t){if(/input|textarea/i.test(t.target.tagName))return;const i=y3[t.key];i&&(t.preventDefault(),this._slide(this._directionToOrder(i)))}_getItemIndex(t){return this._getItems().indexOf(t)}_setActiveIndicatorElement(t){if(!this._indicatorsElement)return;const i=ft.findOne(mA,this._indicatorsElement);i.classList.remove(ju),i.removeAttribute("aria-current");const r=ft.findOne(`[data-bs-slide-to="${t}"]`,this._indicatorsElement);r&&(r.classList.add(ju),r.setAttribute("aria-current","true"))}_updateInterval(){const t=this._activeElement||this._getActive();if(!t)return;const i=Number.parseInt(t.getAttribute("data-bs-interval"),10);this._config.interval=i||this._config.defaultInterval}_slide(t,i=null){if(this._isSliding)return;const r=this._getActive(),n=t===nh,s=i||zv(this._getItems(),r,n,this._config.wrap);if(s===r)return;const a=this._getItemIndex(s),o=p=>me.trigger(this._element,p,{relatedTarget:s,direction:this._orderToDirection(t),from:this._getItemIndex(r),to:a});if(o(t3).defaultPrevented||!r||!s)return;const h=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(a),this._activeElement=s;const c=n?u3:h3,u=n?c3:d3;s.classList.add(u),xu(s),r.classList.add(c),s.classList.add(c);const d=()=>{s.classList.remove(c,u),s.classList.add(ju),r.classList.remove(ju,u,c),this._isSliding=!1,o(Vp)};this._queueCallback(d,r,this._isAnimated()),h&&this.cycle()}_isAnimated(){return this._element.classList.contains(l3)}_getActive(){return ft.findOne(p3,this._element)}_getItems(){return ft.find(gA,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(t){return Nr()?t===jo?yo:nh:t===jo?nh:yo}_orderToDirection(t){return Nr()?t===yo?jo:ed:t===yo?ed:jo}static jQueryInterface(t){return this.each(function(){const i=wu.getOrCreateInstance(this,t);if(typeof t=="number"){i.to(t);return}if(typeof t=="string"){if(i[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);i[t]()}})}}me.on(document,o3,g3,function(e){const t=hs(this);if(!t||!t.classList.contains(fA))return;e.preventDefault();const i=wu.getOrCreateInstance(t),r=this.getAttribute("data-bs-slide-to");if(r){i.to(r),i._maybeEnableCycle();return}if(cs.getDataAttribute(this,"slide")==="next"){i.next(),i._maybeEnableCycle();return}i.prev(),i._maybeEnableCycle()});me.on(window,a3,()=>{const e=ft.find(v3);for(const t of e)wu.getOrCreateInstance(t)});Ur(wu);const w3="collapse",_3="bs.collapse",_u=`.${_3}`,S3=".data-api",A3=`show${_u}`,E3=`shown${_u}`,T3=`hide${_u}`,M3=`hidden${_u}`,C3=`click${_u}${S3}`,jp="show",Jo="collapse",Wu="collapsing",D3="collapsed",P3=`:scope .${Jo} .${Jo}`,L3="collapse-horizontal",O3="width",R3="height",I3=".collapse.show, .collapse.collapsing",tg='[data-bs-toggle="collapse"]',B3={parent:null,toggle:!0},N3={parent:"(null|element)",toggle:"boolean"};class Qh extends on{constructor(t,i){super(t,i),this._isTransitioning=!1,this._triggerArray=[];const r=ft.find(tg);for(const n of r){const s=tA(n),a=ft.find(s).filter(o=>o===this._element);s!==null&&a.length&&this._triggerArray.push(n)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return B3}static get DefaultType(){return N3}static get NAME(){return w3}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let t=[];if(this._config.parent&&(t=this._getFirstLevelChildren(I3).filter(o=>o!==this._element).map(o=>Qh.getOrCreateInstance(o,{toggle:!1}))),t.length&&t[0]._isTransitioning||me.trigger(this._element,A3).defaultPrevented)return;for(const o of t)o.hide();const r=this._getDimension();this._element.classList.remove(Jo),this._element.classList.add(Wu),this._element.style[r]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const n=()=>{this._isTransitioning=!1,this._element.classList.remove(Wu),this._element.classList.add(Jo,jp),this._element.style[r]="",me.trigger(this._element,E3)},a=`scroll${r[0].toUpperCase()+r.slice(1)}`;this._queueCallback(n,this._element,!0),this._element.style[r]=`${this._element[a]}px`}hide(){if(this._isTransitioning||!this._isShown()||me.trigger(this._element,T3).defaultPrevented)return;const i=this._getDimension();this._element.style[i]=`${this._element.getBoundingClientRect()[i]}px`,xu(this._element),this._element.classList.add(Wu),this._element.classList.remove(Jo,jp);for(const n of this._triggerArray){const s=hs(n);s&&!this._isShown(s)&&this._addAriaAndCollapsedClass([n],!1)}this._isTransitioning=!0;const r=()=>{this._isTransitioning=!1,this._element.classList.remove(Wu),this._element.classList.add(Jo),me.trigger(this._element,M3)};this._element.style[i]="",this._queueCallback(r,this._element,!0)}_isShown(t=this._element){return t.classList.contains(jp)}_configAfterMerge(t){return t.toggle=Boolean(t.toggle),t.parent=sa(t.parent),t}_getDimension(){return this._element.classList.contains(L3)?O3:R3}_initializeChildren(){if(!this._config.parent)return;const t=this._getFirstLevelChildren(tg);for(const i of t){const r=hs(i);r&&this._addAriaAndCollapsedClass([i],this._isShown(r))}}_getFirstLevelChildren(t){const i=ft.find(P3,this._config.parent);return ft.find(t,this._config.parent).filter(r=>!i.includes(r))}_addAriaAndCollapsedClass(t,i){if(!!t.length)for(const r of t)r.classList.toggle(D3,!i),r.setAttribute("aria-expanded",i)}static jQueryInterface(t){const i={};return typeof t=="string"&&/show|hide/.test(t)&&(i.toggle=!1),this.each(function(){const r=Qh.getOrCreateInstance(this,i);if(typeof t=="string"){if(typeof r[t]>"u")throw new TypeError(`No method named "${t}"`);r[t]()}})}}me.on(document,C3,tg,function(e){(e.target.tagName==="A"||e.delegateTarget&&e.delegateTarget.tagName==="A")&&e.preventDefault();const t=tA(this),i=ft.find(t);for(const r of i)Qh.getOrCreateInstance(r,{toggle:!1}).toggle()});Ur(Qh);const Ry="dropdown",k3="bs.dropdown",oo=`.${k3}`,Hv=".data-api",U3="Escape",Iy="Tab",F3="ArrowUp",By="ArrowDown",z3=2,G3=`hide${oo}`,H3=`hidden${oo}`,V3=`show${oo}`,j3=`shown${oo}`,vA=`click${oo}${Hv}`,yA=`keydown${oo}${Hv}`,W3=`keyup${oo}${Hv}`,Wo="show",q3="dropup",Y3="dropend",X3="dropstart",Q3="dropup-center",K3="dropdown-center",Ga='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Z3=`${Ga}.${Wo}`,td=".dropdown-menu",J3=".navbar",$3=".navbar-nav",eP=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",tP=Nr()?"top-end":"top-start",iP=Nr()?"top-start":"top-end",rP=Nr()?"bottom-end":"bottom-start",nP=Nr()?"bottom-start":"bottom-end",sP=Nr()?"left-start":"right-start",aP=Nr()?"right-start":"left-start",oP="top",lP="bottom",hP={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},uP={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Nn extends on{constructor(t,i){super(t,i),this._popper=null,this._parent=this._element.parentNode,this._menu=ft.next(this._element,td)[0]||ft.prev(this._element,td)[0]||ft.findOne(td,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return hP}static get DefaultType(){return uP}static get NAME(){return Ry}toggle(){return this._isShown()?this.hide():this.show()}show(){if(aa(this._element)||this._isShown())return;const t={relatedTarget:this._element};if(!me.trigger(this._element,V3,t).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest($3))for(const r of[].concat(...document.body.children))me.on(r,"mouseover",gd);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Wo),this._element.classList.add(Wo),me.trigger(this._element,j3,t)}}hide(){if(aa(this._element)||!this._isShown())return;const t={relatedTarget:this._element};this._completeHide(t)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(t){if(!me.trigger(this._element,G3,t).defaultPrevented){if("ontouchstart"in document.documentElement)for(const r of[].concat(...document.body.children))me.off(r,"mouseover",gd);this._popper&&this._popper.destroy(),this._menu.classList.remove(Wo),this._element.classList.remove(Wo),this._element.setAttribute("aria-expanded","false"),cs.removeDataAttribute(this._menu,"popper"),me.trigger(this._element,H3,t)}}_getConfig(t){if(t=super._getConfig(t),typeof t.reference=="object"&&!us(t.reference)&&typeof t.reference.getBoundingClientRect!="function")throw new TypeError(`${Ry.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return t}_createPopper(){if(typeof $S>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let t=this._element;this._config.reference==="parent"?t=this._parent:us(this._config.reference)?t=sa(this._config.reference):typeof this._config.reference=="object"&&(t=this._config.reference);const i=this._getPopperConfig();this._popper=Fv(t,this._menu,i)}_isShown(){return this._menu.classList.contains(Wo)}_getPlacement(){const t=this._parent;if(t.classList.contains(Y3))return sP;if(t.classList.contains(X3))return aP;if(t.classList.contains(Q3))return oP;if(t.classList.contains(K3))return lP;const i=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return t.classList.contains(q3)?i?iP:tP:i?nP:rP}_detectNavbar(){return this._element.closest(J3)!==null}_getOffset(){const{offset:t}=this._config;return typeof t=="string"?t.split(",").map(i=>Number.parseInt(i,10)):typeof t=="function"?i=>t(i,this._element):t}_getPopperConfig(){const t={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(cs.setDataAttribute(this._menu,"popper","static"),t.modifiers=[{name:"applyStyles",enabled:!1}]),{...t,...typeof this._config.popperConfig=="function"?this._config.popperConfig(t):this._config.popperConfig}}_selectMenuItem({key:t,target:i}){const r=ft.find(eP,this._menu).filter(n=>Bl(n));!r.length||zv(r,i,t===By,!r.includes(i)).focus()}static jQueryInterface(t){return this.each(function(){const i=Nn.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof i[t]>"u")throw new TypeError(`No method named "${t}"`);i[t]()}})}static clearMenus(t){if(t.button===z3||t.type==="keyup"&&t.key!==Iy)return;const i=ft.find(Z3);for(const r of i){const n=Nn.getInstance(r);if(!n||n._config.autoClose===!1)continue;const s=t.composedPath(),a=s.includes(n._menu);if(s.includes(n._element)||n._config.autoClose==="inside"&&!a||n._config.autoClose==="outside"&&a||n._menu.contains(t.target)&&(t.type==="keyup"&&t.key===Iy||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;const o={relatedTarget:n._element};t.type==="click"&&(o.clickEvent=t),n._completeHide(o)}}static dataApiKeydownHandler(t){const i=/input|textarea/i.test(t.target.tagName),r=t.key===U3,n=[F3,By].includes(t.key);if(!n&&!r||i&&!r)return;t.preventDefault();const s=this.matches(Ga)?this:ft.prev(this,Ga)[0]||ft.next(this,Ga)[0]||ft.findOne(Ga,t.delegateTarget.parentNode),a=Nn.getOrCreateInstance(s);if(n){t.stopPropagation(),a.show(),a._selectMenuItem(t);return}a._isShown()&&(t.stopPropagation(),a.hide(),s.focus())}}me.on(document,yA,Ga,Nn.dataApiKeydownHandler);me.on(document,yA,td,Nn.dataApiKeydownHandler);me.on(document,vA,Nn.clearMenus);me.on(document,W3,Nn.clearMenus);me.on(document,vA,Ga,function(e){e.preventDefault(),Nn.getOrCreateInstance(this).toggle()});Ur(Nn);const Ny=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",ky=".sticky-top",qu="padding-right",Uy="margin-right";class ig{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,qu,i=>i+t),this._setElementAttributes(Ny,qu,i=>i+t),this._setElementAttributes(ky,Uy,i=>i-t)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,qu),this._resetElementAttributes(Ny,qu),this._resetElementAttributes(ky,Uy)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,i,r){const n=this.getWidth(),s=a=>{if(a!==this._element&&window.innerWidth>a.clientWidth+n)return;this._saveInitialAttribute(a,i);const o=window.getComputedStyle(a).getPropertyValue(i);a.style.setProperty(i,`${r(Number.parseFloat(o))}px`)};this._applyManipulationCallback(t,s)}_saveInitialAttribute(t,i){const r=t.style.getPropertyValue(i);r&&cs.setDataAttribute(t,i,r)}_resetElementAttributes(t,i){const r=n=>{const s=cs.getDataAttribute(n,i);if(s===null){n.style.removeProperty(i);return}cs.removeDataAttribute(n,i),n.style.setProperty(i,s)};this._applyManipulationCallback(t,r)}_applyManipulationCallback(t,i){if(us(t)){i(t);return}for(const r of ft.find(t,this._element))i(r)}}const xA="backdrop",cP="fade",Fy="show",zy=`mousedown.bs.${xA}`,dP={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},pP={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class bA extends bu{constructor(t){super(),this._config=this._getConfig(t),this._isAppended=!1,this._element=null}static get Default(){return dP}static get DefaultType(){return pP}static get NAME(){return xA}show(t){if(!this._config.isVisible){as(t);return}this._append();const i=this._getElement();this._config.isAnimated&&xu(i),i.classList.add(Fy),this._emulateAnimation(()=>{as(t)})}hide(t){if(!this._config.isVisible){as(t);return}this._getElement().classList.remove(Fy),this._emulateAnimation(()=>{this.dispose(),as(t)})}dispose(){!this._isAppended||(me.off(this._element,zy),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add(cP),this._element=t}return this._element}_configAfterMerge(t){return t.rootElement=sa(t.rootElement),t}_append(){if(this._isAppended)return;const t=this._getElement();this._config.rootElement.append(t),me.on(t,zy,()=>{as(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(t){sA(t,this._getElement(),this._config.isAnimated)}}const fP="focustrap",mP="bs.focustrap",yd=`.${mP}`,gP=`focusin${yd}`,vP=`keydown.tab${yd}`,yP="Tab",xP="forward",Gy="backward",bP={autofocus:!0,trapElement:null},wP={autofocus:"boolean",trapElement:"element"};class wA extends bu{constructor(t){super(),this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return bP}static get DefaultType(){return wP}static get NAME(){return fP}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),me.off(document,yd),me.on(document,gP,t=>this._handleFocusin(t)),me.on(document,vP,t=>this._handleKeydown(t)),this._isActive=!0)}deactivate(){!this._isActive||(this._isActive=!1,me.off(document,yd))}_handleFocusin(t){const{trapElement:i}=this._config;if(t.target===document||t.target===i||i.contains(t.target))return;const r=ft.focusableChildren(i);r.length===0?i.focus():this._lastTabNavDirection===Gy?r[r.length-1].focus():r[0].focus()}_handleKeydown(t){t.key===yP&&(this._lastTabNavDirection=t.shiftKey?Gy:xP)}}const _P="modal",SP="bs.modal",ln=`.${SP}`,AP=".data-api",EP="Escape",TP=`hide${ln}`,MP=`hidePrevented${ln}`,_A=`hidden${ln}`,SA=`show${ln}`,CP=`shown${ln}`,DP=`resize${ln}`,PP=`click.dismiss${ln}`,LP=`mousedown.dismiss${ln}`,OP=`keydown.dismiss${ln}`,RP=`click${ln}${AP}`,Hy="modal-open",IP="fade",Vy="show",Wp="modal-static",BP=".modal.show",NP=".modal-dialog",kP=".modal-body",UP='[data-bs-toggle="modal"]',FP={backdrop:!0,focus:!0,keyboard:!0},zP={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Al extends on{constructor(t,i){super(t,i),this._dialog=ft.findOne(NP,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new ig,this._addEventListeners()}static get Default(){return FP}static get DefaultType(){return zP}static get NAME(){return _P}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){this._isShown||this._isTransitioning||me.trigger(this._element,SA,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Hy),this._adjustDialog(),this._backdrop.show(()=>this._showElement(t)))}hide(){!this._isShown||this._isTransitioning||me.trigger(this._element,TP).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Vy),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){for(const t of[window,this._dialog])me.off(t,ln);this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new bA({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new wA({trapElement:this._element})}_showElement(t){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const i=ft.findOne(kP,this._dialog);i&&(i.scrollTop=0),xu(this._element),this._element.classList.add(Vy);const r=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,me.trigger(this._element,CP,{relatedTarget:t})};this._queueCallback(r,this._dialog,this._isAnimated())}_addEventListeners(){me.on(this._element,OP,t=>{if(t.key===EP){if(this._config.keyboard){t.preventDefault(),this.hide();return}this._triggerBackdropTransition()}}),me.on(window,DP,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),me.on(this._element,LP,t=>{me.one(this._element,PP,i=>{if(!(this._element!==t.target||this._element!==i.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Hy),this._resetAdjustments(),this._scrollBar.reset(),me.trigger(this._element,_A)})}_isAnimated(){return this._element.classList.contains(IP)}_triggerBackdropTransition(){if(me.trigger(this._element,MP).defaultPrevented)return;const i=this._element.scrollHeight>document.documentElement.clientHeight,r=this._element.style.overflowY;r==="hidden"||this._element.classList.contains(Wp)||(i||(this._element.style.overflowY="hidden"),this._element.classList.add(Wp),this._queueCallback(()=>{this._element.classList.remove(Wp),this._queueCallback(()=>{this._element.style.overflowY=r},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,i=this._scrollBar.getWidth(),r=i>0;if(r&&!t){const n=Nr()?"paddingLeft":"paddingRight";this._element.style[n]=`${i}px`}if(!r&&t){const n=Nr()?"paddingRight":"paddingLeft";this._element.style[n]=`${i}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,i){return this.each(function(){const r=Al.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof r[t]>"u")throw new TypeError(`No method named "${t}"`);r[t](i)}})}}me.on(document,RP,UP,function(e){const t=hs(this);["A","AREA"].includes(this.tagName)&&e.preventDefault(),me.one(t,SA,n=>{n.defaultPrevented||me.one(t,_A,()=>{Bl(this)&&this.focus()})});const i=ft.findOne(BP);i&&Al.getInstance(i).hide(),Al.getOrCreateInstance(t).toggle(this)});np(Al);Ur(Al);const GP="offcanvas",HP="bs.offcanvas",_s=`.${HP}`,AA=".data-api",VP=`load${_s}${AA}`,jP="Escape",jy="show",Wy="showing",qy="hiding",WP="offcanvas-backdrop",EA=".offcanvas.show",qP=`show${_s}`,YP=`shown${_s}`,XP=`hide${_s}`,Yy=`hidePrevented${_s}`,TA=`hidden${_s}`,QP=`resize${_s}`,KP=`click${_s}${AA}`,ZP=`keydown.dismiss${_s}`,JP='[data-bs-toggle="offcanvas"]',$P={backdrop:!0,keyboard:!0,scroll:!1},eL={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class oa extends on{constructor(t,i){super(t,i),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return $P}static get DefaultType(){return eL}static get NAME(){return GP}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown||me.trigger(this._element,qP,{relatedTarget:t}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new ig().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Wy);const r=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(jy),this._element.classList.remove(Wy),me.trigger(this._element,YP,{relatedTarget:t})};this._queueCallback(r,this._element,!0)}hide(){if(!this._isShown||me.trigger(this._element,XP).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(qy),this._backdrop.hide();const i=()=>{this._element.classList.remove(jy,qy),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new ig().reset(),me.trigger(this._element,TA)};this._queueCallback(i,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=()=>{if(this._config.backdrop==="static"){me.trigger(this._element,Yy);return}this.hide()},i=Boolean(this._config.backdrop);return new bA({className:WP,isVisible:i,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:i?t:null})}_initializeFocusTrap(){return new wA({trapElement:this._element})}_addEventListeners(){me.on(this._element,ZP,t=>{if(t.key===jP){if(!this._config.keyboard){me.trigger(this._element,Yy);return}this.hide()}})}static jQueryInterface(t){return this.each(function(){const i=oa.getOrCreateInstance(this,t);if(typeof t=="string"){if(i[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);i[t](this)}})}}me.on(document,KP,JP,function(e){const t=hs(this);if(["A","AREA"].includes(this.tagName)&&e.preventDefault(),aa(this))return;me.one(t,TA,()=>{Bl(this)&&this.focus()});const i=ft.findOne(EA);i&&i!==t&&oa.getInstance(i).hide(),oa.getOrCreateInstance(t).toggle(this)});me.on(window,VP,()=>{for(const e of ft.find(EA))oa.getOrCreateInstance(e).show()});me.on(window,QP,()=>{for(const e of ft.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(e).position!=="fixed"&&oa.getOrCreateInstance(e).hide()});np(oa);Ur(oa);const tL=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),iL=/^aria-[\w-]*$/i,rL=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^#&/:?]*(?:[#/?]|$))/i,nL=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i,sL=(e,t)=>{const i=e.nodeName.toLowerCase();return t.includes(i)?tL.has(i)?Boolean(rL.test(e.nodeValue)||nL.test(e.nodeValue)):!0:t.filter(r=>r instanceof RegExp).some(r=>r.test(i))},MA={"*":["class","dir","id","lang","role",iL],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]};function aL(e,t,i){if(!e.length)return e;if(i&&typeof i=="function")return i(e);const n=new window.DOMParser().parseFromString(e,"text/html"),s=[].concat(...n.body.querySelectorAll("*"));for(const a of s){const o=a.nodeName.toLowerCase();if(!Object.keys(t).includes(o)){a.remove();continue}const l=[].concat(...a.attributes),h=[].concat(t["*"]||[],t[o]||[]);for(const c of l)sL(c,h)||a.removeAttribute(c.nodeName)}return n.body.innerHTML}const oL="TemplateFactory",lL={allowList:MA,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},hL={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},uL={entry:"(string|element|function|null)",selector:"(string|element)"};class cL extends bu{constructor(t){super(),this._config=this._getConfig(t)}static get Default(){return lL}static get DefaultType(){return hL}static get NAME(){return oL}getContent(){return Object.values(this._config.content).map(t=>this._resolvePossibleFunction(t)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(t){return this._checkContent(t),this._config.content={...this._config.content,...t},this}toHtml(){const t=document.createElement("div");t.innerHTML=this._maybeSanitize(this._config.template);for(const[n,s]of Object.entries(this._config.content))this._setContent(t,s,n);const i=t.children[0],r=this._resolvePossibleFunction(this._config.extraClass);return r&&i.classList.add(...r.split(" ")),i}_typeCheckConfig(t){super._typeCheckConfig(t),this._checkContent(t.content)}_checkContent(t){for(const[i,r]of Object.entries(t))super._typeCheckConfig({selector:i,entry:r},uL)}_setContent(t,i,r){const n=ft.findOne(r,t);if(!!n){if(i=this._resolvePossibleFunction(i),!i){n.remove();return}if(us(i)){this._putElementInTemplate(sa(i),n);return}if(this._config.html){n.innerHTML=this._maybeSanitize(i);return}n.textContent=i}}_maybeSanitize(t){return this._config.sanitize?aL(t,this._config.allowList,this._config.sanitizeFn):t}_resolvePossibleFunction(t){return typeof t=="function"?t(this):t}_putElementInTemplate(t,i){if(this._config.html){i.innerHTML="",i.append(t);return}i.textContent=t.textContent}}const dL="tooltip",pL=new Set(["sanitize","allowList","sanitizeFn"]),qp="fade",fL="modal",Yu="show",mL=".tooltip-inner",Xy=`.${fL}`,Qy="hide.bs.modal",sh="hover",Yp="focus",gL="click",vL="manual",yL="hide",xL="hidden",bL="show",wL="shown",_L="inserted",SL="click",AL="focusin",EL="focusout",TL="mouseenter",ML="mouseleave",CL={AUTO:"auto",TOP:"top",RIGHT:Nr()?"left":"right",BOTTOM:"bottom",LEFT:Nr()?"right":"left"},DL={allowList:MA,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,0],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},PL={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class kl extends on{constructor(t,i){if(typeof $S>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(t,i),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return DL}static get DefaultType(){return PL}static get NAME(){return dL}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(!!this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),me.off(this._element.closest(Xy),Qy,this._hideModalHandler),this.tip&&this.tip.remove(),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const t=me.trigger(this._element,this.constructor.eventName(bL)),r=(rA(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(t.defaultPrevented||!r)return;this.tip&&(this.tip.remove(),this.tip=null);const n=this._getTipElement();this._element.setAttribute("aria-describedby",n.getAttribute("id"));const{container:s}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(s.append(n),me.trigger(this._element,this.constructor.eventName(_L))),this._popper?this._popper.update():this._popper=this._createPopper(n),n.classList.add(Yu),"ontouchstart"in document.documentElement)for(const o of[].concat(...document.body.children))me.on(o,"mouseover",gd);const a=()=>{me.trigger(this._element,this.constructor.eventName(wL)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(a,this.tip,this._isAnimated())}hide(){if(!this._isShown()||me.trigger(this._element,this.constructor.eventName(yL)).defaultPrevented)return;const i=this._getTipElement();if(i.classList.remove(Yu),"ontouchstart"in document.documentElement)for(const n of[].concat(...document.body.children))me.off(n,"mouseover",gd);this._activeTrigger[gL]=!1,this._activeTrigger[Yp]=!1,this._activeTrigger[sh]=!1,this._isHovered=null;const r=()=>{this._isWithActiveTrigger()||(this._isHovered||i.remove(),this._element.removeAttribute("aria-describedby"),me.trigger(this._element,this.constructor.eventName(xL)),this._disposePopper())};this._queueCallback(r,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(t){const i=this._getTemplateFactory(t).toHtml();if(!i)return null;i.classList.remove(qp,Yu),i.classList.add(`bs-${this.constructor.NAME}-auto`);const r=mD(this.constructor.NAME).toString();return i.setAttribute("id",r),this._isAnimated()&&i.classList.add(qp),i}setContent(t){this._newContent=t,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(t){return this._templateFactory?this._templateFactory.changeContent(t):this._templateFactory=new cL({...this._config,content:t,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[mL]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(t){return this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(qp)}_isShown(){return this.tip&&this.tip.classList.contains(Yu)}_createPopper(t){const i=typeof this._config.placement=="function"?this._config.placement.call(this,t,this._element):this._config.placement,r=CL[i.toUpperCase()];return Fv(this._element,t,this._getPopperConfig(r))}_getOffset(){const{offset:t}=this._config;return typeof t=="string"?t.split(",").map(i=>Number.parseInt(i,10)):typeof t=="function"?i=>t(i,this._element):t}_resolvePossibleFunction(t){return typeof t=="function"?t.call(this._element):t}_getPopperConfig(t){const i={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:r=>{this._getTipElement().setAttribute("data-popper-placement",r.state.placement)}}]};return{...i,...typeof this._config.popperConfig=="function"?this._config.popperConfig(i):this._config.popperConfig}}_setListeners(){const t=this._config.trigger.split(" ");for(const i of t)if(i==="click")me.on(this._element,this.constructor.eventName(SL),this._config.selector,r=>{this._initializeOnDelegatedTarget(r).toggle()});else if(i!==vL){const r=i===sh?this.constructor.eventName(TL):this.constructor.eventName(AL),n=i===sh?this.constructor.eventName(ML):this.constructor.eventName(EL);me.on(this._element,r,this._config.selector,s=>{const a=this._initializeOnDelegatedTarget(s);a._activeTrigger[s.type==="focusin"?Yp:sh]=!0,a._enter()}),me.on(this._element,n,this._config.selector,s=>{const a=this._initializeOnDelegatedTarget(s);a._activeTrigger[s.type==="focusout"?Yp:sh]=a._element.contains(s.relatedTarget),a._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},me.on(this._element.closest(Xy),Qy,this._hideModalHandler)}_fixTitle(){const t=this._element.getAttribute("title");!t||(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",t),this._element.setAttribute("data-bs-original-title",t),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(t,i){clearTimeout(this._timeout),this._timeout=setTimeout(t,i)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(t){const i=cs.getDataAttributes(this._element);for(const r of Object.keys(i))pL.has(r)&&delete i[r];return t={...i,...typeof t=="object"&&t?t:{}},t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t.container=t.container===!1?document.body:sa(t.container),typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),typeof t.title=="number"&&(t.title=t.title.toString()),typeof t.content=="number"&&(t.content=t.content.toString()),t}_getDelegateConfig(){const t={};for(const i in this._config)this.constructor.Default[i]!==this._config[i]&&(t[i]=this._config[i]);return t.selector=!1,t.trigger="manual",t}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null)}static jQueryInterface(t){return this.each(function(){const i=kl.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof i[t]>"u")throw new TypeError(`No method named "${t}"`);i[t]()}})}}Ur(kl);const LL="popover",OL=".popover-header",RL=".popover-body",IL={...kl.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},BL={...kl.DefaultType,content:"(null|string|element|function)"};class Vv extends kl{static get Default(){return IL}static get DefaultType(){return BL}static get NAME(){return LL}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[OL]:this._getTitle(),[RL]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(t){return this.each(function(){const i=Vv.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof i[t]>"u")throw new TypeError(`No method named "${t}"`);i[t]()}})}}Ur(Vv);const NL="scrollspy",kL="bs.scrollspy",jv=`.${kL}`,UL=".data-api",FL=`activate${jv}`,Ky=`click${jv}`,zL=`load${jv}${UL}`,GL="dropdown-item",xo="active",HL='[data-bs-spy="scroll"]',Xp="[href]",VL=".nav, .list-group",Zy=".nav-link",jL=".nav-item",WL=".list-group-item",qL=`${Zy}, ${jL} > ${Zy}, ${WL}`,YL=".dropdown",XL=".dropdown-toggle",QL={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},KL={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class op extends on{constructor(t,i){super(t,i),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return QL}static get DefaultType(){return KL}static get NAME(){return NL}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const t of this._observableSections.values())this._observer.observe(t)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(t){return t.target=sa(t.target)||document.body,t.rootMargin=t.offset?`${t.offset}px 0px -30%`:t.rootMargin,typeof t.threshold=="string"&&(t.threshold=t.threshold.split(",").map(i=>Number.parseFloat(i))),t}_maybeEnableSmoothScroll(){!this._config.smoothScroll||(me.off(this._config.target,Ky),me.on(this._config.target,Ky,Xp,t=>{const i=this._observableSections.get(t.target.hash);if(i){t.preventDefault();const r=this._rootElement||window,n=i.offsetTop-this._element.offsetTop;if(r.scrollTo){r.scrollTo({top:n,behavior:"smooth"});return}r.scrollTop=n}}))}_getNewObserver(){const t={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(i=>this._observerCallback(i),t)}_observerCallback(t){const i=a=>this._targetLinks.get(`#${a.target.id}`),r=a=>{this._previousScrollData.visibleEntryTop=a.target.offsetTop,this._process(i(a))},n=(this._rootElement||document.documentElement).scrollTop,s=n>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=n;for(const a of t){if(!a.isIntersecting){this._activeTarget=null,this._clearActiveClass(i(a));continue}const o=a.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(s&&o){if(r(a),!n)return;continue}!s&&!o&&r(a)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const t=ft.find(Xp,this._config.target);for(const i of t){if(!i.hash||aa(i))continue;const r=ft.findOne(i.hash,this._element);Bl(r)&&(this._targetLinks.set(i.hash,i),this._observableSections.set(i.hash,r))}}_process(t){this._activeTarget!==t&&(this._clearActiveClass(this._config.target),this._activeTarget=t,t.classList.add(xo),this._activateParents(t),me.trigger(this._element,FL,{relatedTarget:t}))}_activateParents(t){if(t.classList.contains(GL)){ft.findOne(XL,t.closest(YL)).classList.add(xo);return}for(const i of ft.parents(t,VL))for(const r of ft.prev(i,qL))r.classList.add(xo)}_clearActiveClass(t){t.classList.remove(xo);const i=ft.find(`${Xp}.${xo}`,t);for(const r of i)r.classList.remove(xo)}static jQueryInterface(t){return this.each(function(){const i=op.getOrCreateInstance(this,t);if(typeof t=="string"){if(i[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);i[t]()}})}}me.on(window,zL,()=>{for(const e of ft.find(HL))op.getOrCreateInstance(e)});Ur(op);const ZL="tab",JL="bs.tab",lo=`.${JL}`,$L=`hide${lo}`,eO=`hidden${lo}`,tO=`show${lo}`,iO=`shown${lo}`,rO=`click${lo}`,nO=`keydown${lo}`,sO=`load${lo}`,aO="ArrowLeft",Jy="ArrowRight",oO="ArrowUp",$y="ArrowDown",Ha="active",e1="fade",Qp="show",lO="dropdown",hO=".dropdown-toggle",uO=".dropdown-menu",Kp=":not(.dropdown-toggle)",cO='.list-group, .nav, [role="tablist"]',dO=".nav-item, .list-group-item",pO=`.nav-link${Kp}, .list-group-item${Kp}, [role="tab"]${Kp}`,CA='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Zp=`${pO}, ${CA}`,fO=`.${Ha}[data-bs-toggle="tab"], .${Ha}[data-bs-toggle="pill"], .${Ha}[data-bs-toggle="list"]`;class El extends on{constructor(t){super(t),this._parent=this._element.closest(cO),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),me.on(this._element,nO,i=>this._keydown(i)))}static get NAME(){return ZL}show(){const t=this._element;if(this._elemIsActive(t))return;const i=this._getActiveElem(),r=i?me.trigger(i,$L,{relatedTarget:t}):null;me.trigger(t,tO,{relatedTarget:i}).defaultPrevented||r&&r.defaultPrevented||(this._deactivate(i,t),this._activate(t,i))}_activate(t,i){if(!t)return;t.classList.add(Ha),this._activate(hs(t));const r=()=>{if(t.getAttribute("role")!=="tab"){t.classList.add(Qp);return}t.removeAttribute("tabindex"),t.setAttribute("aria-selected",!0),this._toggleDropDown(t,!0),me.trigger(t,iO,{relatedTarget:i})};this._queueCallback(r,t,t.classList.contains(e1))}_deactivate(t,i){if(!t)return;t.classList.remove(Ha),t.blur(),this._deactivate(hs(t));const r=()=>{if(t.getAttribute("role")!=="tab"){t.classList.remove(Qp);return}t.setAttribute("aria-selected",!1),t.setAttribute("tabindex","-1"),this._toggleDropDown(t,!1),me.trigger(t,eO,{relatedTarget:i})};this._queueCallback(r,t,t.classList.contains(e1))}_keydown(t){if(![aO,Jy,oO,$y].includes(t.key))return;t.stopPropagation(),t.preventDefault();const i=[Jy,$y].includes(t.key),r=zv(this._getChildren().filter(n=>!aa(n)),t.target,i,!0);r&&(r.focus({preventScroll:!0}),El.getOrCreateInstance(r).show())}_getChildren(){return ft.find(Zp,this._parent)}_getActiveElem(){return this._getChildren().find(t=>this._elemIsActive(t))||null}_setInitialAttributes(t,i){this._setAttributeIfNotExists(t,"role","tablist");for(const r of i)this._setInitialAttributesOnChild(r)}_setInitialAttributesOnChild(t){t=this._getInnerElement(t);const i=this._elemIsActive(t),r=this._getOuterElement(t);t.setAttribute("aria-selected",i),r!==t&&this._setAttributeIfNotExists(r,"role","presentation"),i||t.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(t,"role","tab"),this._setInitialAttributesOnTargetPanel(t)}_setInitialAttributesOnTargetPanel(t){const i=hs(t);!i||(this._setAttributeIfNotExists(i,"role","tabpanel"),t.id&&this._setAttributeIfNotExists(i,"aria-labelledby",`#${t.id}`))}_toggleDropDown(t,i){const r=this._getOuterElement(t);if(!r.classList.contains(lO))return;const n=(s,a)=>{const o=ft.findOne(s,r);o&&o.classList.toggle(a,i)};n(hO,Ha),n(uO,Qp),r.setAttribute("aria-expanded",i)}_setAttributeIfNotExists(t,i,r){t.hasAttribute(i)||t.setAttribute(i,r)}_elemIsActive(t){return t.classList.contains(Ha)}_getInnerElement(t){return t.matches(Zp)?t:ft.findOne(Zp,t)}_getOuterElement(t){return t.closest(dO)||t}static jQueryInterface(t){return this.each(function(){const i=El.getOrCreateInstance(this);if(typeof t=="string"){if(i[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);i[t]()}})}}me.on(document,rO,CA,function(e){["A","AREA"].includes(this.tagName)&&e.preventDefault(),!aa(this)&&El.getOrCreateInstance(this).show()});me.on(window,sO,()=>{for(const e of ft.find(fO))El.getOrCreateInstance(e)});Ur(El);const mO="toast",gO="bs.toast",va=`.${gO}`,vO=`mouseover${va}`,yO=`mouseout${va}`,xO=`focusin${va}`,bO=`focusout${va}`,wO=`hide${va}`,_O=`hidden${va}`,SO=`show${va}`,AO=`shown${va}`,EO="fade",t1="hide",Xu="show",Qu="showing",TO={animation:"boolean",autohide:"boolean",delay:"number"},MO={animation:!0,autohide:!0,delay:5e3};class lp extends on{constructor(t,i){super(t,i),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return MO}static get DefaultType(){return TO}static get NAME(){return mO}show(){if(me.trigger(this._element,SO).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(EO);const i=()=>{this._element.classList.remove(Qu),me.trigger(this._element,AO),this._maybeScheduleHide()};this._element.classList.remove(t1),xu(this._element),this._element.classList.add(Xu,Qu),this._queueCallback(i,this._element,this._config.animation)}hide(){if(!this.isShown()||me.trigger(this._element,wO).defaultPrevented)return;const i=()=>{this._element.classList.add(t1),this._element.classList.remove(Qu,Xu),me.trigger(this._element,_O)};this._element.classList.add(Qu),this._queueCallback(i,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Xu),super.dispose()}isShown(){return this._element.classList.contains(Xu)}_maybeScheduleHide(){!this._config.autohide||this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay))}_onInteraction(t,i){switch(t.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=i;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=i;break}}if(i){this._clearTimeout();return}const r=t.relatedTarget;this._element===r||this._element.contains(r)||this._maybeScheduleHide()}_setListeners(){me.on(this._element,vO,t=>this._onInteraction(t,!0)),me.on(this._element,yO,t=>this._onInteraction(t,!1)),me.on(this._element,xO,t=>this._onInteraction(t,!0)),me.on(this._element,bO,t=>this._onInteraction(t,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(t){return this.each(function(){const i=lp.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof i[t]>"u")throw new TypeError(`No method named "${t}"`);i[t](this)}})}}np(lp);Ur(lp);const CO="modulepreload",DO=function(e){return"/"+e},i1={},Wv=function(t,i,r){return!i||i.length===0?t():Promise.all(i.map(n=>{if(n=DO(n),n in i1)return;i1[n]=!0;const s=n.endsWith(".css"),a=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${a}`))return;const o=document.createElement("link");if(o.rel=s?"stylesheet":CO,s||(o.as="script",o.crossOrigin=""),o.href=n,document.head.appendChild(o),s)return new Promise((l,h)=>{o.addEventListener("load",l),o.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t())};var PO=Object.create,qv=Object.defineProperty,LO=Object.getOwnPropertyDescriptor,OO=Object.getOwnPropertyNames,RO=Object.getPrototypeOf,IO=Object.prototype.hasOwnProperty,Yv=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),BO=(e,t)=>{for(var i in t)qv(e,i,{get:t[i],enumerable:!0})},NO=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of OO(t))!IO.call(e,n)&&n!==i&&qv(e,n,{get:()=>t[n],enumerable:!(r=LO(t,n))||r.enumerable});return e},DA=(e,t,i)=>(i=e!=null?PO(RO(e)):{},NO(t||!e||!e.__esModule?qv(i,"default",{value:e,enumerable:!0}):i,e)),PA=Yv(()=>{}),kO=Yv((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,h,c,u,d,p,m,g,f,v,y,x,b=r[0].length,S=r.length;if(S<b)throw new TypeError("Invalid matrix: m < n");for(var _=[],A=[],w=[],E=n==="f"?S:b,T=v=m=0;T<S;T++)A[T]=new Array(E).fill(0);for(T=0;T<b;T++)w[T]=new Array(b).fill(0);var C,P=new Array(b).fill(0);for(T=0;T<S;T++)for(l=0;l<b;l++)A[T][l]=r[T][l];for(T=0;T<b;T++){for(_[T]=m,f=0,c=T+1,l=T;l<S;l++)f+=Math.pow(A[l][T],2);if(f<o)m=0;else for(g=(p=A[T][T])*(m=p<0?Math.sqrt(f):-Math.sqrt(f))-f,A[T][T]=p-m,l=c;l<b;l++){for(f=0,h=T;h<S;h++)f+=A[h][T]*A[h][l];for(p=f/g,h=T;h<S;h++)A[h][l]=A[h][l]+p*A[h][T]}for(P[T]=m,f=0,l=c;l<b;l++)f+=Math.pow(A[T][l],2);if(f<o)m=0;else{for(g=(p=A[T][T+1])*(m=p<0?Math.sqrt(f):-Math.sqrt(f))-f,A[T][T+1]=p-m,l=c;l<b;l++)_[l]=A[T][l]/g;for(l=c;l<S;l++){for(f=0,h=c;h<b;h++)f+=A[l][h]*A[T][h];for(h=c;h<b;h++)A[l][h]=A[l][h]+f*_[h]}}v<(y=Math.abs(P[T])+Math.abs(_[T]))&&(v=y)}if(s)for(T=b-1;0<=T;T--){if(m!==0){for(g=A[T][T+1]*m,l=c;l<b;l++)w[l][T]=A[T][l]/g;for(l=c;l<b;l++){for(f=0,h=c;h<b;h++)f+=A[T][h]*w[h][l];for(h=c;h<b;h++)w[h][l]=w[h][l]+f*w[h][T]}}for(l=c;l<b;l++)w[T][l]=0,w[l][T]=0;w[T][T]=1,m=_[T],c=T}if(n){if(n==="f")for(T=b;T<S;T++){for(l=b;l<S;l++)A[T][l]=0;A[T][T]=1}for(T=b-1;0<=T;T--){for(c=T+1,m=P[T],l=c;l<E;l++)A[T][l]=0;if(m!==0){for(g=A[T][T]*m,l=c;l<E;l++){for(f=0,h=c;h<S;h++)f+=A[h][T]*A[h][l];for(p=f/g,h=T;h<S;h++)A[h][l]=A[h][l]+p*A[h][T]}for(l=T;l<S;l++)A[l][T]=A[l][T]/m}else for(l=T;l<S;l++)A[l][T]=0;A[T][T]=A[T][T]+1}}for(a*=v,h=b-1;0<=h;h--)for(var k=0;k<50;k++){for(C=!1,c=h;0<=c;c--){if(Math.abs(_[c])<=a){C=!0;break}if(Math.abs(P[c-1])<=a)break}if(!C){for(d=0,u=c-(f=1),T=c;T<h+1&&(p=f*_[T],_[T]=d*_[T],!(Math.abs(p)<=a));T++)if(m=P[T],P[T]=Math.sqrt(p*p+m*m),d=m/(g=P[T]),f=-p/g,n)for(l=0;l<S;l++)y=A[l][u],x=A[l][T],A[l][u]=y*d+x*f,A[l][T]=-y*f+x*d}if(x=P[h],c===h){if(x<0&&(P[h]=-x,s))for(l=0;l<b;l++)w[l][h]=-w[l][h];break}for(v=P[c],p=(((y=P[h-1])-x)*(y+x)+((m=_[h-1])-(g=_[h]))*(m+g))/(2*g*y),m=Math.sqrt(p*p+1),p=((v-x)*(v+x)+g*(y/(p<0?p-m:p+m)-g))/v,T=c+(f=d=1);T<h+1;T++){if(m=_[T],y=P[T],g=f*m,m*=d,x=Math.sqrt(p*p+g*g),p=v*(d=p/(_[T-1]=x))+m*(f=g/x),m=-v*f+m*d,g=y*f,y*=d,s)for(l=0;l<b;l++)v=w[l][T-1],x=w[l][T],w[l][T-1]=v*d+x*f,w[l][T]=-v*f+x*d;if(x=Math.sqrt(p*p+g*g),p=(d=p/(P[T-1]=x))*m+(f=g/x)*y,v=-f*m+d*y,n)for(l=0;l<S;l++)y=A[l][T-1],x=A[l][T],A[l][T-1]=y*d+x*f,A[l][T]=-y*f+x*d}_[c]=0,_[h]=p,P[h]=v}for(T=0;T<b;T++)P[T]<a&&(P[T]=0);return{u:A,q:P,v:w}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),UO=Yv(e=>{(function(){var t=function(){this.init()};t.prototype={init:function(){var u=this||i;return u._counter=1e3,u._html5AudioPool=[],u.html5PoolSize=10,u._codecs={},u._howls=[],u._muted=!1,u._volume=1,u._canPlayEvent="canplaythrough",u._navigator=typeof window<"u"&&window.navigator?window.navigator:null,u.masterGain=null,u.noAudio=!1,u.usingWebAudio=!0,u.autoSuspend=!0,u.ctx=null,u.autoUnlock=!0,u._setup(),u},volume:function(u){var d=this||i;if(u=parseFloat(u),d.ctx||c(),typeof u<"u"&&u>=0&&u<=1){if(d._volume=u,d._muted)return d;d.usingWebAudio&&d.masterGain.gain.setValueAtTime(u,i.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var m=d._howls[p]._getSoundIds(),g=0;g<m.length;g++){var f=d._howls[p]._soundById(m[g]);f&&f._node&&(f._node.volume=f._volume*u)}return d}return d._volume},mute:function(u){var d=this||i;d.ctx||c(),d._muted=u,d.usingWebAudio&&d.masterGain.gain.setValueAtTime(u?0:d._volume,i.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var m=d._howls[p]._getSoundIds(),g=0;g<m.length;g++){var f=d._howls[p]._soundById(m[g]);f&&f._node&&(f._node.muted=u?!0:f._muted)}return d},stop:function(){for(var u=this||i,d=0;d<u._howls.length;d++)u._howls[d].stop();return u},unload:function(){for(var u=this||i,d=u._howls.length-1;d>=0;d--)u._howls[d].unload();return u.usingWebAudio&&u.ctx&&typeof u.ctx.close<"u"&&(u.ctx.close(),u.ctx=null,c()),u},codecs:function(u){return(this||i)._codecs[u.replace(/^x-/,"")]},_setup:function(){var u=this||i;if(u.state=u.ctx&&u.ctx.state||"suspended",u._autoSuspend(),!u.usingWebAudio)if(typeof Audio<"u")try{var d=new Audio;typeof d.oncanplaythrough>"u"&&(u._canPlayEvent="canplay")}catch{u.noAudio=!0}else u.noAudio=!0;try{var d=new Audio;d.muted&&(u.noAudio=!0)}catch{}return u.noAudio||u._setupCodecs(),u},_setupCodecs:function(){var u=this||i,d=null;try{d=typeof Audio<"u"?new Audio:null}catch{return u}if(!d||typeof d.canPlayType!="function")return u;var p=d.canPlayType("audio/mpeg;").replace(/^no$/,""),m=u._navigator?u._navigator.userAgent:"",g=m.match(/OPR\/([0-6].)/g),f=g&&parseInt(g[0].split("/")[1],10)<33,v=m.indexOf("Safari")!==-1&&m.indexOf("Chrome")===-1,y=m.match(/Version\/(.*?) /),x=v&&y&&parseInt(y[1],10)<15;return u._codecs={mp3:!!(!f&&(p||d.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(d.canPlayType('audio/wav; codecs="1"')||d.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!d.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(d.canPlayType("audio/x-m4b;")||d.canPlayType("audio/m4b;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!x&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!x&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(d.canPlayType("audio/x-flac;")||d.canPlayType("audio/flac;")).replace(/^no$/,"")},u},_unlockAudio:function(){var u=this||i;if(!(u._audioUnlocked||!u.ctx)){u._audioUnlocked=!1,u.autoUnlock=!1,!u._mobileUnloaded&&u.ctx.sampleRate!==44100&&(u._mobileUnloaded=!0,u.unload()),u._scratchBuffer=u.ctx.createBuffer(1,1,22050);var d=function(p){for(;u._html5AudioPool.length<u.html5PoolSize;)try{var m=new Audio;m._unlocked=!0,u._releaseHtml5Audio(m)}catch{u.noAudio=!0;break}for(var g=0;g<u._howls.length;g++)if(!u._howls[g]._webAudio)for(var f=u._howls[g]._getSoundIds(),v=0;v<f.length;v++){var y=u._howls[g]._soundById(f[v]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}u._autoResume();var x=u.ctx.createBufferSource();x.buffer=u._scratchBuffer,x.connect(u.ctx.destination),typeof x.start>"u"?x.noteOn(0):x.start(0),typeof u.ctx.resume=="function"&&u.ctx.resume(),x.onended=function(){x.disconnect(0),u._audioUnlocked=!0,document.removeEventListener("touchstart",d,!0),document.removeEventListener("touchend",d,!0),document.removeEventListener("click",d,!0),document.removeEventListener("keydown",d,!0);for(var b=0;b<u._howls.length;b++)u._howls[b]._emit("unlock")}};return document.addEventListener("touchstart",d,!0),document.addEventListener("touchend",d,!0),document.addEventListener("click",d,!0),document.addEventListener("keydown",d,!0),u}},_obtainHtml5Audio:function(){var u=this||i;if(u._html5AudioPool.length)return u._html5AudioPool.pop();var d=new Audio().play();return d&&typeof Promise<"u"&&(d instanceof Promise||typeof d.then=="function")&&d.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(u){var d=this||i;return u._unlocked&&d._html5AudioPool.push(u),d},_autoSuspend:function(){var u=this;if(!(!u.autoSuspend||!u.ctx||typeof u.ctx.suspend>"u"||!i.usingWebAudio)){for(var d=0;d<u._howls.length;d++)if(u._howls[d]._webAudio){for(var p=0;p<u._howls[d]._sounds.length;p++)if(!u._howls[d]._sounds[p]._paused)return u}return u._suspendTimer&&clearTimeout(u._suspendTimer),u._suspendTimer=setTimeout(function(){if(u.autoSuspend){u._suspendTimer=null,u.state="suspending";var m=function(){u.state="suspended",u._resumeAfterSuspend&&(delete u._resumeAfterSuspend,u._autoResume())};u.ctx.suspend().then(m,m)}},3e4),u}},_autoResume:function(){var u=this;if(!(!u.ctx||typeof u.ctx.resume>"u"||!i.usingWebAudio))return u.state==="running"&&u.ctx.state!=="interrupted"&&u._suspendTimer?(clearTimeout(u._suspendTimer),u._suspendTimer=null):u.state==="suspended"||u.state==="running"&&u.ctx.state==="interrupted"?(u.ctx.resume().then(function(){u.state="running";for(var d=0;d<u._howls.length;d++)u._howls[d]._emit("resume")}),u._suspendTimer&&(clearTimeout(u._suspendTimer),u._suspendTimer=null)):u.state==="suspending"&&(u._resumeAfterSuspend=!0),u}};var i=new t,r=function(u){var d=this;if(!u.src||u.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}d.init(u)};r.prototype={init:function(u){var d=this;return i.ctx||c(),d._autoplay=u.autoplay||!1,d._format=typeof u.format!="string"?u.format:[u.format],d._html5=u.html5||!1,d._muted=u.mute||!1,d._loop=u.loop||!1,d._pool=u.pool||5,d._preload=typeof u.preload=="boolean"||u.preload==="metadata"?u.preload:!0,d._rate=u.rate||1,d._sprite=u.sprite||{},d._src=typeof u.src!="string"?u.src:[u.src],d._volume=u.volume!==void 0?u.volume:1,d._xhr={method:u.xhr&&u.xhr.method?u.xhr.method:"GET",headers:u.xhr&&u.xhr.headers?u.xhr.headers:null,withCredentials:u.xhr&&u.xhr.withCredentials?u.xhr.withCredentials:!1},d._duration=0,d._state="unloaded",d._sounds=[],d._endTimers={},d._queue=[],d._playLock=!1,d._onend=u.onend?[{fn:u.onend}]:[],d._onfade=u.onfade?[{fn:u.onfade}]:[],d._onload=u.onload?[{fn:u.onload}]:[],d._onloaderror=u.onloaderror?[{fn:u.onloaderror}]:[],d._onplayerror=u.onplayerror?[{fn:u.onplayerror}]:[],d._onpause=u.onpause?[{fn:u.onpause}]:[],d._onplay=u.onplay?[{fn:u.onplay}]:[],d._onstop=u.onstop?[{fn:u.onstop}]:[],d._onmute=u.onmute?[{fn:u.onmute}]:[],d._onvolume=u.onvolume?[{fn:u.onvolume}]:[],d._onrate=u.onrate?[{fn:u.onrate}]:[],d._onseek=u.onseek?[{fn:u.onseek}]:[],d._onunlock=u.onunlock?[{fn:u.onunlock}]:[],d._onresume=[],d._webAudio=i.usingWebAudio&&!d._html5,typeof i.ctx<"u"&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(d),d._autoplay&&d._queue.push({event:"play",action:function(){d.play()}}),d._preload&&d._preload!=="none"&&d.load(),d},load:function(){var u=this,d=null;if(i.noAudio){u._emit("loaderror",null,"No audio support.");return}typeof u._src=="string"&&(u._src=[u._src]);for(var p=0;p<u._src.length;p++){var m,g;if(u._format&&u._format[p])m=u._format[p];else{if(g=u._src[p],typeof g!="string"){u._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}m=/^data:audio\/([^;,]+);/i.exec(g),m||(m=/\.([^.]+)$/.exec(g.split("?",1)[0])),m&&(m=m[1].toLowerCase())}if(m||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),m&&i.codecs(m)){d=u._src[p];break}}if(!d){u._emit("loaderror",null,"No codec support for selected audio sources.");return}return u._src=d,u._state="loading",window.location.protocol==="https:"&&d.slice(0,5)==="http:"&&(u._html5=!0,u._webAudio=!1),new n(u),u._webAudio&&a(u),u},play:function(u,d){var p=this,m=null;if(typeof u=="number")m=u,u=null;else{if(typeof u=="string"&&p._state==="loaded"&&!p._sprite[u])return null;if(typeof u>"u"&&(u="__default",!p._playLock)){for(var g=0,f=0;f<p._sounds.length;f++)p._sounds[f]._paused&&!p._sounds[f]._ended&&(g++,m=p._sounds[f]._id);g===1?u=null:m=null}}var v=m?p._soundById(m):p._inactiveSound();if(!v)return null;if(m&&!u&&(u=v._sprite||"__default"),p._state!=="loaded"){v._sprite=u,v._ended=!1;var y=v._id;return p._queue.push({event:"play",action:function(){p.play(y)}}),y}if(m&&!v._paused)return d||p._loadQueue("play"),v._id;p._webAudio&&i._autoResume();var x=Math.max(0,v._seek>0?v._seek:p._sprite[u][0]/1e3),b=Math.max(0,(p._sprite[u][0]+p._sprite[u][1])/1e3-x),S=b*1e3/Math.abs(v._rate),_=p._sprite[u][0]/1e3,A=(p._sprite[u][0]+p._sprite[u][1])/1e3;v._sprite=u,v._ended=!1;var w=function(){v._paused=!1,v._seek=x,v._start=_,v._stop=A,v._loop=!!(v._loop||p._sprite[u][2])};if(x>=A){p._ended(v);return}var E=v._node;if(p._webAudio){var T=function(){p._playLock=!1,w(),p._refreshBuffer(v);var D=v._muted||p._muted?0:v._volume;E.gain.setValueAtTime(D,i.ctx.currentTime),v._playStart=i.ctx.currentTime,typeof E.bufferSource.start>"u"?v._loop?E.bufferSource.noteGrainOn(0,x,86400):E.bufferSource.noteGrainOn(0,x,b):v._loop?E.bufferSource.start(0,x,86400):E.bufferSource.start(0,x,b),S!==1/0&&(p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),S)),d||setTimeout(function(){p._emit("play",v._id),p._loadQueue()},0)};i.state==="running"&&i.ctx.state!=="interrupted"?T():(p._playLock=!0,p.once("resume",T),p._clearTimer(v._id))}else{var C=function(){E.currentTime=x,E.muted=v._muted||p._muted||i._muted||E.muted,E.volume=v._volume*i.volume(),E.playbackRate=v._rate;try{var D=E.play();if(D&&typeof Promise<"u"&&(D instanceof Promise||typeof D.then=="function")?(p._playLock=!0,w(),D.then(function(){p._playLock=!1,E._unlocked=!0,d?p._loadQueue():p._emit("play",v._id)}).catch(function(){p._playLock=!1,p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):d||(p._playLock=!1,w(),p._emit("play",v._id)),E.playbackRate=v._rate,E.paused){p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}u!=="__default"||v._loop?p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),S):(p._endTimers[v._id]=function(){p._ended(v),E.removeEventListener("ended",p._endTimers[v._id],!1)},E.addEventListener("ended",p._endTimers[v._id],!1))}catch(R){p._emit("playerror",v._id,R)}};E.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(E.src=p._src,E.load());var P=window&&window.ejecta||!E.readyState&&i._navigator.isCocoonJS;if(E.readyState>=3||P)C();else{p._playLock=!0,p._state="loading";var k=function(){p._state="loaded",C(),E.removeEventListener(i._canPlayEvent,k,!1)};E.addEventListener(i._canPlayEvent,k,!1),p._clearTimer(v._id)}}return v._id},pause:function(u){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"pause",action:function(){d.pause(u)}}),d;for(var p=d._getSoundIds(u),m=0;m<p.length;m++){d._clearTimer(p[m]);var g=d._soundById(p[m]);if(g&&!g._paused&&(g._seek=d.seek(p[m]),g._rateSeek=0,g._paused=!0,d._stopFade(p[m]),g._node))if(d._webAudio){if(!g._node.bufferSource)continue;typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),d._cleanBuffer(g._node)}else(!isNaN(g._node.duration)||g._node.duration===1/0)&&g._node.pause();arguments[1]||d._emit("pause",g?g._id:null)}return d},stop:function(u,d){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(u)}}),p;for(var m=p._getSoundIds(u),g=0;g<m.length;g++){p._clearTimer(m[g]);var f=p._soundById(m[g]);f&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,p._stopFade(m[g]),f._node&&(p._webAudio?f._node.bufferSource&&(typeof f._node.bufferSource.stop>"u"?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),p._cleanBuffer(f._node)):(!isNaN(f._node.duration)||f._node.duration===1/0)&&(f._node.currentTime=f._start||0,f._node.pause(),f._node.duration===1/0&&p._clearSound(f._node))),d||p._emit("stop",f._id))}return p},mute:function(u,d){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(u,d)}}),p;if(typeof d>"u")if(typeof u=="boolean")p._muted=u;else return p._muted;for(var m=p._getSoundIds(d),g=0;g<m.length;g++){var f=p._soundById(m[g]);f&&(f._muted=u,f._interval&&p._stopFade(f._id),p._webAudio&&f._node?f._node.gain.setValueAtTime(u?0:f._volume,i.ctx.currentTime):f._node&&(f._node.muted=i._muted?!0:u),p._emit("mute",f._id))}return p},volume:function(){var u=this,d=arguments,p,m;if(d.length===0)return u._volume;if(d.length===1||d.length===2&&typeof d[1]>"u"){var g=u._getSoundIds(),f=g.indexOf(d[0]);f>=0?m=parseInt(d[0],10):p=parseFloat(d[0])}else d.length>=2&&(p=parseFloat(d[0]),m=parseInt(d[1],10));var v;if(typeof p<"u"&&p>=0&&p<=1){if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"volume",action:function(){u.volume.apply(u,d)}}),u;typeof m>"u"&&(u._volume=p),m=u._getSoundIds(m);for(var y=0;y<m.length;y++)v=u._soundById(m[y]),v&&(v._volume=p,d[2]||u._stopFade(m[y]),u._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(p,i.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=p*i.volume()),u._emit("volume",v._id))}else return v=m?u._soundById(m):u._sounds[0],v?v._volume:0;return u},fade:function(u,d,p,m){var g=this;if(g._state!=="loaded"||g._playLock)return g._queue.push({event:"fade",action:function(){g.fade(u,d,p,m)}}),g;u=Math.min(Math.max(0,parseFloat(u)),1),d=Math.min(Math.max(0,parseFloat(d)),1),p=parseFloat(p),g.volume(u,m);for(var f=g._getSoundIds(m),v=0;v<f.length;v++){var y=g._soundById(f[v]);if(y){if(m||g._stopFade(f[v]),g._webAudio&&!y._muted){var x=i.ctx.currentTime,b=x+p/1e3;y._volume=u,y._node.gain.setValueAtTime(u,x),y._node.gain.linearRampToValueAtTime(d,b)}g._startFadeInterval(y,u,d,p,f[v],typeof m>"u")}}return g},_startFadeInterval:function(u,d,p,m,g,f){var v=this,y=d,x=p-d,b=Math.abs(x/.01),S=Math.max(4,b>0?m/b:m),_=Date.now();u._fadeTo=p,u._interval=setInterval(function(){var A=(Date.now()-_)/m;_=Date.now(),y+=x*A,y=Math.round(y*100)/100,x<0?y=Math.max(p,y):y=Math.min(p,y),v._webAudio?u._volume=y:v.volume(y,u._id,!0),f&&(v._volume=y),(p<d&&y<=p||p>d&&y>=p)&&(clearInterval(u._interval),u._interval=null,u._fadeTo=null,v.volume(p,u._id),v._emit("fade",u._id))},S)},_stopFade:function(u){var d=this,p=d._soundById(u);return p&&p._interval&&(d._webAudio&&p._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(p._interval),p._interval=null,d.volume(p._fadeTo,u),p._fadeTo=null,d._emit("fade",u)),d},loop:function(){var u=this,d=arguments,p,m,g;if(d.length===0)return u._loop;if(d.length===1)if(typeof d[0]=="boolean")p=d[0],u._loop=p;else return g=u._soundById(parseInt(d[0],10)),g?g._loop:!1;else d.length===2&&(p=d[0],m=parseInt(d[1],10));for(var f=u._getSoundIds(m),v=0;v<f.length;v++)g=u._soundById(f[v]),g&&(g._loop=p,u._webAudio&&g._node&&g._node.bufferSource&&(g._node.bufferSource.loop=p,p&&(g._node.bufferSource.loopStart=g._start||0,g._node.bufferSource.loopEnd=g._stop,u.playing(f[v])&&(u.pause(f[v],!0),u.play(f[v],!0)))));return u},rate:function(){var u=this,d=arguments,p,m;if(d.length===0)m=u._sounds[0]._id;else if(d.length===1){var g=u._getSoundIds(),f=g.indexOf(d[0]);f>=0?m=parseInt(d[0],10):p=parseFloat(d[0])}else d.length===2&&(p=parseFloat(d[0]),m=parseInt(d[1],10));var v;if(typeof p=="number"){if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"rate",action:function(){u.rate.apply(u,d)}}),u;typeof m>"u"&&(u._rate=p),m=u._getSoundIds(m);for(var y=0;y<m.length;y++)if(v=u._soundById(m[y]),v){u.playing(m[y])&&(v._rateSeek=u.seek(m[y]),v._playStart=u._webAudio?i.ctx.currentTime:v._playStart),v._rate=p,u._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(p,i.ctx.currentTime):v._node&&(v._node.playbackRate=p);var x=u.seek(m[y]),b=(u._sprite[v._sprite][0]+u._sprite[v._sprite][1])/1e3-x,S=b*1e3/Math.abs(v._rate);(u._endTimers[m[y]]||!v._paused)&&(u._clearTimer(m[y]),u._endTimers[m[y]]=setTimeout(u._ended.bind(u,v),S)),u._emit("rate",v._id)}}else return v=u._soundById(m),v?v._rate:u._rate;return u},seek:function(){var u=this,d=arguments,p,m;if(d.length===0)u._sounds.length&&(m=u._sounds[0]._id);else if(d.length===1){var g=u._getSoundIds(),f=g.indexOf(d[0]);f>=0?m=parseInt(d[0],10):u._sounds.length&&(m=u._sounds[0]._id,p=parseFloat(d[0]))}else d.length===2&&(p=parseFloat(d[0]),m=parseInt(d[1],10));if(typeof m>"u")return 0;if(typeof p=="number"&&(u._state!=="loaded"||u._playLock))return u._queue.push({event:"seek",action:function(){u.seek.apply(u,d)}}),u;var v=u._soundById(m);if(v)if(typeof p=="number"&&p>=0){var y=u.playing(m);y&&u.pause(m,!0),v._seek=p,v._ended=!1,u._clearTimer(m),!u._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=p);var x=function(){y&&u.play(m,!0),u._emit("seek",m)};if(y&&!u._webAudio){var b=function(){u._playLock?setTimeout(b,0):x()};setTimeout(b,0)}else x()}else if(u._webAudio){var S=u.playing(m)?i.ctx.currentTime-v._playStart:0,_=v._rateSeek?v._rateSeek-v._seek:0;return v._seek+(_+S*Math.abs(v._rate))}else return v._node.currentTime;return u},playing:function(u){var d=this;if(typeof u=="number"){var p=d._soundById(u);return p?!p._paused:!1}for(var m=0;m<d._sounds.length;m++)if(!d._sounds[m]._paused)return!0;return!1},duration:function(u){var d=this,p=d._duration,m=d._soundById(u);return m&&(p=d._sprite[m._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var u=this,d=u._sounds,p=0;p<d.length;p++)d[p]._paused||u.stop(d[p]._id),u._webAudio||(u._clearSound(d[p]._node),d[p]._node.removeEventListener("error",d[p]._errorFn,!1),d[p]._node.removeEventListener(i._canPlayEvent,d[p]._loadFn,!1),d[p]._node.removeEventListener("ended",d[p]._endFn,!1),i._releaseHtml5Audio(d[p]._node)),delete d[p]._node,u._clearTimer(d[p]._id);var m=i._howls.indexOf(u);m>=0&&i._howls.splice(m,1);var g=!0;for(p=0;p<i._howls.length;p++)if(i._howls[p]._src===u._src||u._src.indexOf(i._howls[p]._src)>=0){g=!1;break}return s&&g&&delete s[u._src],i.noAudio=!1,u._state="unloaded",u._sounds=[],u=null,null},on:function(u,d,p,m){var g=this,f=g["_on"+u];return typeof d=="function"&&f.push(m?{id:p,fn:d,once:m}:{id:p,fn:d}),g},off:function(u,d,p){var m=this,g=m["_on"+u],f=0;if(typeof d=="number"&&(p=d,d=null),d||p)for(f=0;f<g.length;f++){var v=p===g[f].id;if(d===g[f].fn&&v||!d&&v){g.splice(f,1);break}}else if(u)m["_on"+u]=[];else{var y=Object.keys(m);for(f=0;f<y.length;f++)y[f].indexOf("_on")===0&&Array.isArray(m[y[f]])&&(m[y[f]]=[])}return m},once:function(u,d,p){var m=this;return m.on(u,d,p,1),m},_emit:function(u,d,p){for(var m=this,g=m["_on"+u],f=g.length-1;f>=0;f--)(!g[f].id||g[f].id===d||u==="load")&&(setTimeout(function(v){v.call(this,d,p)}.bind(m,g[f].fn),0),g[f].once&&m.off(u,g[f].fn,g[f].id));return m._loadQueue(u),m},_loadQueue:function(u){var d=this;if(d._queue.length>0){var p=d._queue[0];p.event===u&&(d._queue.shift(),d._loadQueue()),u||p.action()}return d},_ended:function(u){var d=this,p=u._sprite;if(!d._webAudio&&u._node&&!u._node.paused&&!u._node.ended&&u._node.currentTime<u._stop)return setTimeout(d._ended.bind(d,u),100),d;var m=!!(u._loop||d._sprite[p][2]);if(d._emit("end",u._id),!d._webAudio&&m&&d.stop(u._id,!0).play(u._id),d._webAudio&&m){d._emit("play",u._id),u._seek=u._start||0,u._rateSeek=0,u._playStart=i.ctx.currentTime;var g=(u._stop-u._start)*1e3/Math.abs(u._rate);d._endTimers[u._id]=setTimeout(d._ended.bind(d,u),g)}return d._webAudio&&!m&&(u._paused=!0,u._ended=!0,u._seek=u._start||0,u._rateSeek=0,d._clearTimer(u._id),d._cleanBuffer(u._node),i._autoSuspend()),!d._webAudio&&!m&&d.stop(u._id,!0),d},_clearTimer:function(u){var d=this;if(d._endTimers[u]){if(typeof d._endTimers[u]!="function")clearTimeout(d._endTimers[u]);else{var p=d._soundById(u);p&&p._node&&p._node.removeEventListener("ended",d._endTimers[u],!1)}delete d._endTimers[u]}return d},_soundById:function(u){for(var d=this,p=0;p<d._sounds.length;p++)if(u===d._sounds[p]._id)return d._sounds[p];return null},_inactiveSound:function(){var u=this;u._drain();for(var d=0;d<u._sounds.length;d++)if(u._sounds[d]._ended)return u._sounds[d].reset();return new n(u)},_drain:function(){var u=this,d=u._pool,p=0,m=0;if(!(u._sounds.length<d)){for(m=0;m<u._sounds.length;m++)u._sounds[m]._ended&&p++;for(m=u._sounds.length-1;m>=0;m--){if(p<=d)return;u._sounds[m]._ended&&(u._webAudio&&u._sounds[m]._node&&u._sounds[m]._node.disconnect(0),u._sounds.splice(m,1),p--)}}},_getSoundIds:function(u){var d=this;if(typeof u>"u"){for(var p=[],m=0;m<d._sounds.length;m++)p.push(d._sounds[m]._id);return p}else return[u]},_refreshBuffer:function(u){var d=this;return u._node.bufferSource=i.ctx.createBufferSource(),u._node.bufferSource.buffer=s[d._src],u._panner?u._node.bufferSource.connect(u._panner):u._node.bufferSource.connect(u._node),u._node.bufferSource.loop=u._loop,u._loop&&(u._node.bufferSource.loopStart=u._start||0,u._node.bufferSource.loopEnd=u._stop||0),u._node.bufferSource.playbackRate.setValueAtTime(u._rate,i.ctx.currentTime),d},_cleanBuffer:function(u){var d=this,p=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&u.bufferSource&&(u.bufferSource.onended=null,u.bufferSource.disconnect(0),p))try{u.bufferSource.buffer=i._scratchBuffer}catch{}return u.bufferSource=null,d},_clearSound:function(u){var d=/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent);d||(u.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var n=function(u){this._parent=u,this.init()};n.prototype={init:function(){var u=this,d=u._parent;return u._muted=d._muted,u._loop=d._loop,u._volume=d._volume,u._rate=d._rate,u._seek=0,u._paused=!0,u._ended=!0,u._sprite="__default",u._id=++i._counter,d._sounds.push(u),u.create(),u},create:function(){var u=this,d=u._parent,p=i._muted||u._muted||u._parent._muted?0:u._volume;return d._webAudio?(u._node=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),u._node.gain.setValueAtTime(p,i.ctx.currentTime),u._node.paused=!0,u._node.connect(i.masterGain)):i.noAudio||(u._node=i._obtainHtml5Audio(),u._errorFn=u._errorListener.bind(u),u._node.addEventListener("error",u._errorFn,!1),u._loadFn=u._loadListener.bind(u),u._node.addEventListener(i._canPlayEvent,u._loadFn,!1),u._endFn=u._endListener.bind(u),u._node.addEventListener("ended",u._endFn,!1),u._node.src=d._src,u._node.preload=d._preload===!0?"auto":d._preload,u._node.volume=p*i.volume(),u._node.load()),u},reset:function(){var u=this,d=u._parent;return u._muted=d._muted,u._loop=d._loop,u._volume=d._volume,u._rate=d._rate,u._seek=0,u._rateSeek=0,u._paused=!0,u._ended=!0,u._sprite="__default",u._id=++i._counter,u},_errorListener:function(){var u=this;u._parent._emit("loaderror",u._id,u._node.error?u._node.error.code:0),u._node.removeEventListener("error",u._errorFn,!1)},_loadListener:function(){var u=this,d=u._parent;d._duration=Math.ceil(u._node.duration*10)/10,Object.keys(d._sprite).length===0&&(d._sprite={__default:[0,d._duration*1e3]}),d._state!=="loaded"&&(d._state="loaded",d._emit("load"),d._loadQueue()),u._node.removeEventListener(i._canPlayEvent,u._loadFn,!1)},_endListener:function(){var u=this,d=u._parent;d._duration===1/0&&(d._duration=Math.ceil(u._node.duration*10)/10,d._sprite.__default[1]===1/0&&(d._sprite.__default[1]=d._duration*1e3),d._ended(u)),u._node.removeEventListener("ended",u._endFn,!1)}};var s={},a=function(u){var d=u._src;if(s[d]){u._duration=s[d].duration,h(u);return}if(/^data:[^;]+;base64,/.test(d)){for(var p=atob(d.split(",")[1]),m=new Uint8Array(p.length),g=0;g<p.length;++g)m[g]=p.charCodeAt(g);l(m.buffer,u)}else{var f=new XMLHttpRequest;f.open(u._xhr.method,d,!0),f.withCredentials=u._xhr.withCredentials,f.responseType="arraybuffer",u._xhr.headers&&Object.keys(u._xhr.headers).forEach(function(v){f.setRequestHeader(v,u._xhr.headers[v])}),f.onload=function(){var v=(f.status+"")[0];if(v!=="0"&&v!=="2"&&v!=="3"){u._emit("loaderror",null,"Failed loading audio file with status: "+f.status+".");return}l(f.response,u)},f.onerror=function(){u._webAudio&&(u._html5=!0,u._webAudio=!1,u._sounds=[],delete s[d],u.load())},o(f)}},o=function(u){try{u.send()}catch{u.onerror()}},l=function(u,d){var p=function(){d._emit("loaderror",null,"Decoding audio data failed.")},m=function(g){g&&d._sounds.length>0?(s[d._src]=g,h(d,g)):p()};typeof Promise<"u"&&i.ctx.decodeAudioData.length===1?i.ctx.decodeAudioData(u).then(m).catch(p):i.ctx.decodeAudioData(u,m,p)},h=function(u,d){d&&!u._duration&&(u._duration=d.duration),Object.keys(u._sprite).length===0&&(u._sprite={__default:[0,u._duration*1e3]}),u._state!=="loaded"&&(u._state="loaded",u._emit("load"),u._loadQueue())},c=function(){if(i.usingWebAudio){try{typeof AudioContext<"u"?i.ctx=new AudioContext:typeof webkitAudioContext<"u"?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch{i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var u=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),d=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=d?parseInt(d[1],10):null;if(u&&p&&p<9){var m=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!m&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:i,Howl:r}}),typeof e<"u"&&(e.Howler=i,e.Howl=r),typeof global<"u"?(global.HowlerGlobal=t,global.Howler=i,global.Howl=r,global.Sound=n):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=i,window.Howl=r,window.Sound=n)})(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(i){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var n=r._howls.length-1;n>=0;n--)r._howls[n].stereo(i);return r},HowlerGlobal.prototype.pos=function(i,r,n){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(r=typeof r!="number"?s._pos[1]:r,n=typeof n!="number"?s._pos[2]:n,typeof i=="number")s._pos=[i,r,n],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(i,r,n,s,a,o){var l=this;if(!l.ctx||!l.ctx.listener)return l;var h=l._orientation;if(r=typeof r!="number"?h[1]:r,n=typeof n!="number"?h[2]:n,s=typeof s!="number"?h[3]:s,a=typeof a!="number"?h[4]:a,o=typeof o!="number"?h[5]:o,typeof i=="number")l._orientation=[i,r,n,s,a,o],typeof l.ctx.listener.forwardX<"u"?(l.ctx.listener.forwardX.setTargetAtTime(i,Howler.ctx.currentTime,.1),l.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),l.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),l.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),l.ctx.listener.upY.setTargetAtTime(a,Howler.ctx.currentTime,.1),l.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):l.ctx.listener.setOrientation(i,r,n,s,a,o);else return h;return l},Howl.prototype.init=function(i){return function(r){var n=this;return n._orientation=r.orientation||[1,0,0],n._stereo=r.stereo||null,n._pos=r.pos||null,n._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},n._onstereo=r.onstereo?[{fn:r.onstereo}]:[],n._onpos=r.onpos?[{fn:r.onpos}]:[],n._onorientation=r.onorientation?[{fn:r.onorientation}]:[],i.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(i,r){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"stereo",action:function(){n.stereo(i,r)}}),n;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof i=="number")n._stereo=i,n._pos=[i,0,0];else return n._stereo;for(var a=n._getSoundIds(r),o=0;o<a.length;o++){var l=n._soundById(a[o]);if(l)if(typeof i=="number")l._stereo=i,l._pos=[i,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",(!l._panner||!l._panner.pan)&&t(l,s),s==="spatial"?typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(i,0,0):l._panner.pan.setValueAtTime(i,Howler.ctx.currentTime)),n._emit("stereo",l._id);else return l._stereo}return n},Howl.prototype.pos=function(i,r,n,s){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"pos",action:function(){a.pos(i,r,n,s)}}),a;if(r=typeof r!="number"?0:r,n=typeof n!="number"?-.5:n,typeof s>"u")if(typeof i=="number")a._pos=[i,r,n];else return a._pos;for(var o=a._getSoundIds(s),l=0;l<o.length;l++){var h=a._soundById(o[l]);if(h)if(typeof i=="number")h._pos=[i,r,n],h._node&&((!h._panner||h._panner.pan)&&t(h,"spatial"),typeof h._panner.positionX<"u"?(h._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):h._panner.setPosition(i,r,n)),a._emit("pos",h._id);else return h._pos}return a},Howl.prototype.orientation=function(i,r,n,s){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"orientation",action:function(){a.orientation(i,r,n,s)}}),a;if(r=typeof r!="number"?a._orientation[1]:r,n=typeof n!="number"?a._orientation[2]:n,typeof s>"u")if(typeof i=="number")a._orientation=[i,r,n];else return a._orientation;for(var o=a._getSoundIds(s),l=0;l<o.length;l++){var h=a._soundById(o[l]);if(h)if(typeof i=="number")h._orientation=[i,r,n],h._node&&(h._panner||(h._pos||(h._pos=a._pos||[0,0,-.5]),t(h,"spatial")),typeof h._panner.orientationX<"u"?(h._panner.orientationX.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):h._panner.setOrientation(i,r,n)),a._emit("orientation",h._id);else return h._orientation}return a},Howl.prototype.pannerAttr=function(){var i=this,r=arguments,n,s,a;if(!i._webAudio)return i;if(r.length===0)return i._pannerAttr;if(r.length===1)if(typeof r[0]=="object")n=r[0],typeof s>"u"&&(n.pannerAttr||(n.pannerAttr={coneInnerAngle:n.coneInnerAngle,coneOuterAngle:n.coneOuterAngle,coneOuterGain:n.coneOuterGain,distanceModel:n.distanceModel,maxDistance:n.maxDistance,refDistance:n.refDistance,rolloffFactor:n.rolloffFactor,panningModel:n.panningModel}),i._pannerAttr={coneInnerAngle:typeof n.pannerAttr.coneInnerAngle<"u"?n.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof n.pannerAttr.coneOuterAngle<"u"?n.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof n.pannerAttr.coneOuterGain<"u"?n.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof n.pannerAttr.distanceModel<"u"?n.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof n.pannerAttr.maxDistance<"u"?n.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof n.pannerAttr.refDistance<"u"?n.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof n.pannerAttr.rolloffFactor<"u"?n.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof n.pannerAttr.panningModel<"u"?n.pannerAttr.panningModel:i._panningModel});else return a=i._soundById(parseInt(r[0],10)),a?a._pannerAttr:i._pannerAttr;else r.length===2&&(n=r[0],s=parseInt(r[1],10));for(var o=i._getSoundIds(s),l=0;l<o.length;l++)if(a=i._soundById(o[l]),a){var h=a._pannerAttr;h={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:h.coneOuterAngle,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:h.coneOuterGain,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:h.distanceModel,maxDistance:typeof n.maxDistance<"u"?n.maxDistance:h.maxDistance,refDistance:typeof n.refDistance<"u"?n.refDistance:h.refDistance,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:h.rolloffFactor,panningModel:typeof n.panningModel<"u"?n.panningModel:h.panningModel};var c=a._panner;c?(c.coneInnerAngle=h.coneInnerAngle,c.coneOuterAngle=h.coneOuterAngle,c.coneOuterGain=h.coneOuterGain,c.distanceModel=h.distanceModel,c.maxDistance=h.maxDistance,c.refDistance=h.refDistance,c.rolloffFactor=h.rolloffFactor,c.panningModel=h.panningModel):(a._pos||(a._pos=i._pos||[0,0,-.5]),t(a,"spatial"))}return i},Sound.prototype.init=function(i){return function(){var r=this,n=r._parent;r._orientation=n._orientation,r._stereo=n._stereo,r._pos=n._pos,r._pannerAttr=n._pannerAttr,i.call(this),r._stereo?n.stereo(r._stereo):r._pos&&n.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(i){return function(){var r=this,n=r._parent;return r._orientation=n._orientation,r._stereo=n._stereo,r._pos=n._pos,r._pannerAttr=n._pannerAttr,r._stereo?n.stereo(r._stereo):r._pos?n.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,n._refreshBuffer(r)),i.call(this)}}(Sound.prototype.reset);var t=function(i,r){r=r||"spatial",r==="spatial"?(i._panner=Howler.ctx.createPanner(),i._panner.coneInnerAngle=i._pannerAttr.coneInnerAngle,i._panner.coneOuterAngle=i._pannerAttr.coneOuterAngle,i._panner.coneOuterGain=i._pannerAttr.coneOuterGain,i._panner.distanceModel=i._pannerAttr.distanceModel,i._panner.maxDistance=i._pannerAttr.maxDistance,i._panner.refDistance=i._pannerAttr.refDistance,i._panner.rolloffFactor=i._pannerAttr.rolloffFactor,i._panner.panningModel=i._pannerAttr.panningModel,typeof i._panner.positionX<"u"?(i._panner.positionX.setValueAtTime(i._pos[0],Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(i._pos[1],Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(i._pos[2],Howler.ctx.currentTime)):i._panner.setPosition(i._pos[0],i._pos[1],i._pos[2]),typeof i._panner.orientationX<"u"?(i._panner.orientationX.setValueAtTime(i._orientation[0],Howler.ctx.currentTime),i._panner.orientationY.setValueAtTime(i._orientation[1],Howler.ctx.currentTime),i._panner.orientationZ.setValueAtTime(i._orientation[2],Howler.ctx.currentTime)):i._panner.setOrientation(i._orientation[0],i._orientation[1],i._orientation[2])):(i._panner=Howler.ctx.createStereoPanner(),i._panner.pan.setValueAtTime(i._stereo,Howler.ctx.currentTime)),i._panner.connect(i._node),i._paused||i._parent.pause(i._id,!0).play(i._id,!0)}}()}),Su="142",xr={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},FO=0,r1=1,zO=2,Xv=1,LA=2,Th=3,ys=0,Ai=1,Lr=2,GO=1,Ei=0,qa=1,n1=2,s1=3,a1=4,HO=5,qo=100,VO=101,jO=102,o1=103,l1=104,WO=200,qO=201,YO=202,XO=203,OA=204,RA=205,QO=206,KO=207,ZO=208,JO=209,$O=210,eR=0,tR=1,iR=2,rg=3,rR=4,nR=5,sR=6,aR=7,IA=0,oR=1,lR=2,ds=0,hR=1,uR=2,cR=3,dR=4,pR=5,BA=300,to=301,io=302,ng=303,sg=304,Au=306,Kh=1e3,or=1001,ag=1002,Xt=1003,h1=1004,u1=1005,Ot=1006,fR=1007,Eu=1008,Ii=1009,mR=1010,gR=1011,NA=1012,vR=1013,qs=1014,Ys=1015,Zh=1016,yR=1017,xR=1018,Ya=1020,bR=1021,wR=1022,Dn=1023,_R=1024,SR=1025,Xa=1026,ro=1027,AR=1028,ER=1029,TR=1030,MR=1031,CR=1033,Jp=33776,$p=33777,ef=33778,tf=33779,c1=35840,d1=35841,p1=35842,f1=35843,DR=36196,m1=37492,g1=37496,v1=37808,y1=37809,x1=37810,b1=37811,w1=37812,_1=37813,S1=37814,A1=37815,E1=37816,T1=37817,M1=37818,C1=37819,D1=37820,P1=37821,L1=36492,Vn=3e3,pt=3001,Ss=3200,kA=3201,PR=0,LR=1,ss="srgb",Va="srgb-linear",rf=7680,OR=519,og=35044,O1="300 es",lg=1035,Bi=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,e);e.target=null}}},Mi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],R1=1234567,Uh=Math.PI/180,Jh=180/Math.PI;function kn(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Mi[e&255]+Mi[e>>8&255]+Mi[e>>16&255]+Mi[e>>24&255]+"-"+Mi[t&255]+Mi[t>>8&255]+"-"+Mi[t>>16&15|64]+Mi[t>>24&255]+"-"+Mi[i&63|128]+Mi[i>>8&255]+"-"+Mi[i>>16&255]+Mi[i>>24&255]+Mi[r&255]+Mi[r>>8&255]+Mi[r>>16&255]+Mi[r>>24&255]).toLowerCase()}function ui(e,t,i){return Math.max(t,Math.min(i,e))}function Qv(e,t){return(e%t+t)%t}function RR(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function IR(e,t,i){return e!==t?(i-e)/(t-e):0}function Fh(e,t,i){return(1-i)*e+i*t}function BR(e,t,i,r){return Fh(e,t,1-Math.exp(-i*r))}function NR(e,t=1){return t-Math.abs(Qv(e,t*2)-t)}function kR(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function UR(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function FR(e,t){return e+Math.floor(Math.random()*(t-e+1))}function zR(e,t){return e+Math.random()*(t-e)}function GR(e){return e*(.5-Math.random())}function HR(e){e!==void 0&&(R1=e);let t=R1+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function VR(e){return e*Uh}function jR(e){return e*Jh}function hg(e){return(e&e-1)===0&&e!==0}function WR(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function xd(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function qR(e,t,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),h=s((t+r)/2),c=a((t+r)/2),u=s((t-r)/2),d=a((t-r)/2),p=s((r-t)/2),m=a((r-t)/2);switch(n){case"XYX":e.set(o*c,l*u,l*d,o*h);break;case"YZY":e.set(l*d,o*c,l*u,o*h);break;case"ZXZ":e.set(l*u,l*d,o*c,o*h);break;case"XZX":e.set(o*c,l*m,l*p,o*h);break;case"YXY":e.set(l*p,o*c,l*m,o*h);break;case"ZYZ":e.set(l*m,l*p,o*c,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function YR(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function XR(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var lt=Object.freeze({__proto__:null,DEG2RAD:Uh,RAD2DEG:Jh,generateUUID:kn,clamp:ui,euclideanModulo:Qv,mapLinear:RR,inverseLerp:IR,lerp:Fh,damp:BR,pingpong:NR,smoothstep:kR,smootherstep:UR,randInt:FR,randFloat:zR,randFloatSpread:GR,seededRandom:HR,degToRad:VR,radToDeg:jR,isPowerOfTwo:hg,ceilPowerOfTwo:WR,floorPowerOfTwo:xd,setQuaternionFromProperEuler:qR,normalize:XR,denormalize:YR}),q=class{constructor(e=0,t=0){q.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,s=this.y-e.y;return this.x=n*i-s*r+e.x,this.y=n*r+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Ri=class{constructor(){Ri.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,n,s,a,o,l){let h=this.elements;return h[0]=e,h[1]=r,h[2]=a,h[3]=t,h[4]=n,h[5]=o,h[6]=i,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],h=i[4],c=i[7],u=i[2],d=i[5],p=i[8],m=r[0],g=r[3],f=r[6],v=r[1],y=r[4],x=r[7],b=r[2],S=r[5],_=r[8];return n[0]=s*m+a*v+o*b,n[3]=s*g+a*y+o*S,n[6]=s*f+a*x+o*_,n[1]=l*m+h*v+c*b,n[4]=l*g+h*y+c*S,n[7]=l*f+h*x+c*_,n[2]=u*m+d*v+p*b,n[5]=u*g+d*y+p*S,n[8]=u*f+d*x+p*_,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8];return t*s*h-t*a*l-i*n*h+i*a*o+r*n*l-r*s*o}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=h*s-a*l,u=a*o-h*n,d=l*n-s*o,p=t*c+i*u+r*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let m=1/p;return e[0]=c*m,e[1]=(r*l-h*i)*m,e[2]=(a*i-r*s)*m,e[3]=u*m,e[4]=(h*t-r*o)*m,e[5]=(r*n-a*t)*m,e[6]=d*m,e[7]=(i*o-l*t)*m,e[8]=(s*t-i*n)*m,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){let i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){let t=Math.cos(e),i=Math.sin(e),r=this.elements,n=r[0],s=r[3],a=r[6],o=r[1],l=r[4],h=r[7];return r[0]=t*n+i*o,r[3]=t*s+i*l,r[6]=t*a+i*h,r[1]=-i*n+t*o,r[4]=-i*s+t*l,r[7]=-i*a+t*h,this}translate(e,t){let i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};function UA(e){for(let t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}var QR={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ku(e,t){return new QR[e](t)}function bd(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Qa(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function id(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var nf={[ss]:{[Va]:Qa},[Va]:{[ss]:id}},Gr={legacyMode:!0,get workingColorSpace(){return Va},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(nf[t]&&nf[t][i]!==void 0){let r=nf[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},FA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},oi={r:0,g:0,b:0},Hr={h:0,s:0,l:0},Zu={h:0,s:0,l:0};function sf(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function Ju(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Ze=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ss){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Gr.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Va){return this.r=e,this.g=t,this.b=i,Gr.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Va){if(e=Qv(e,1),t=ui(t,0,1),i=ui(i,0,1),t===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=sf(s,n,e+1/3),this.g=sf(s,n,e),this.b=sf(s,n,e-1/3)}return Gr.toWorkingColorSpace(this,r),this}setStyle(e,t=ss){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let n,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,Gr.toWorkingColorSpace(this,t),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,Gr.toWorkingColorSpace(this,t),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(n[1])/360,l=parseInt(n[2],10)/100,h=parseInt(n[3],10)/100;return i(n[4]),this.setHSL(o,l,h,t)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,Gr.toWorkingColorSpace(this,t),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,Gr.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=ss){let i=FA[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Qa(e.r),this.g=Qa(e.g),this.b=Qa(e.b),this}copyLinearToSRGB(e){return this.r=id(e.r),this.g=id(e.g),this.b=id(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ss){return Gr.fromWorkingColorSpace(Ju(this,oi),e),ui(oi.r*255,0,255)<<16^ui(oi.g*255,0,255)<<8^ui(oi.b*255,0,255)<<0}getHexString(e=ss){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Va){Gr.fromWorkingColorSpace(Ju(this,oi),t);let i=oi.r,r=oi.g,n=oi.b,s=Math.max(i,r,n),a=Math.min(i,r,n),o,l,h=(a+s)/2;if(a===s)o=0,l=0;else{let c=s-a;switch(l=h<=.5?c/(s+a):c/(2-s-a),s){case i:o=(r-n)/c+(r<n?6:0);break;case r:o=(n-i)/c+2;break;case n:o=(i-r)/c+4;break}o/=6}return e.h=o,e.s=l,e.l=h,e}getRGB(e,t=Va){return Gr.fromWorkingColorSpace(Ju(this,oi),t),e.r=oi.r,e.g=oi.g,e.b=oi.b,e}getStyle(e=ss){return Gr.fromWorkingColorSpace(Ju(this,oi),e),e!==ss?`color(${e} ${oi.r} ${oi.g} ${oi.b})`:`rgb(${oi.r*255|0},${oi.g*255|0},${oi.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(Hr),Hr.h+=e,Hr.s+=t,Hr.l+=i,this.setHSL(Hr.h,Hr.s,Hr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Hr),e.getHSL(Zu);let i=Fh(Hr.h,Zu.h,t),r=Fh(Hr.s,Zu.s,t),n=Fh(Hr.l,Zu.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Ze.NAMES=FA;var bo,zA=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{bo===void 0&&(bo=bd("canvas")),bo.width=e.width,bo.height=e.height;let i=bo.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=bo}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=bd("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=Qa(n[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Qa(t[i]/255)*255):t[i]=Qa(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},GA=class{constructor(e=null){this.isSource=!0,this.uuid=kn(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let s=0,a=r.length;s<a;s++)r[s].isDataTexture?n.push(af(r[s].image)):n.push(af(r[s]))}else n=af(r);i.url=n}return t||(e.images[this.uuid]=i),i}};function af(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?zA.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var KR=0,ji=class extends Bi{constructor(e=ji.DEFAULT_IMAGE,t=ji.DEFAULT_MAPPING,i=or,r=or,n=Ot,s=Eu,a=Dn,o=Ii,l=1,h=Vn){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:KR++}),this.uuid=kn(),this.name="",this.source=new GA(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new q(0,0),this.repeat=new q(1,1),this.center=new q(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ri,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==BA)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Kh:e.x=e.x-Math.floor(e.x);break;case or:e.x=e.x<0?0:1;break;case ag:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Kh:e.y=e.y-Math.floor(e.y);break;case or:e.y=e.y<0?0:1;break;case ag:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};ji.DEFAULT_IMAGE=null;ji.DEFAULT_MAPPING=BA;var ht=class{constructor(e=0,t=0,i=0,r=1){ht.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*t+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*t+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*t+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n,s=e.elements,a=s[0],o=s[4],l=s[8],h=s[1],c=s[5],u=s[9],d=s[2],p=s[6],m=s[10];if(Math.abs(o-h)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(o+h)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(a+c+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let f=(a+1)/2,v=(c+1)/2,y=(m+1)/2,x=(o+h)/4,b=(l+d)/4,S=(u+p)/4;return f>v&&f>y?f<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(f),r=x/i,n=b/i):v>y?v<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(v),i=x/r,n=S/r):y<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(y),i=b/n,r=S/n),this.set(i,r,n,t),this}let g=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(h-o)*(h-o));return Math.abs(g)<.001&&(g=1),this.x=(p-u)/g,this.y=(l-d)/g,this.z=(h-o)/g,this.w=Math.acos((a+c+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},ri=class extends Bi{constructor(e,t,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ht(0,0,e,t),this.scissorTest=!1,this.viewport=new ht(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new ji(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Ot,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new GA(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},HA=class extends ji{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Xt,this.minFilter=Xt,this.wrapR=or,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},ZR=class extends ji{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Xt,this.minFilter=Xt,this.wrapR=or,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Lt=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerp(e,t,i,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,r)}static slerpFlat(e,t,i,r,n,s,a){let o=i[r+0],l=i[r+1],h=i[r+2],c=i[r+3],u=n[s+0],d=n[s+1],p=n[s+2],m=n[s+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=h,e[t+3]=c;return}if(a===1){e[t+0]=u,e[t+1]=d,e[t+2]=p,e[t+3]=m;return}if(c!==m||o!==u||l!==d||h!==p){let g=1-a,f=o*u+l*d+h*p+c*m,v=f>=0?1:-1,y=1-f*f;if(y>Number.EPSILON){let b=Math.sqrt(y),S=Math.atan2(b,f*v);g=Math.sin(g*S)/b,a=Math.sin(a*S)/b}let x=a*v;if(o=o*g+u*x,l=l*g+d*x,h=h*g+p*x,c=c*g+m*x,g===1-a){let b=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=b,l*=b,h*=b,c*=b}}e[t]=o,e[t+1]=l,e[t+2]=h,e[t+3]=c}static multiplyQuaternionsFlat(e,t,i,r,n,s){let a=i[r],o=i[r+1],l=i[r+2],h=i[r+3],c=n[s],u=n[s+1],d=n[s+2],p=n[s+3];return e[t]=a*p+h*c+o*d-l*u,e[t+1]=o*p+h*u+l*c-a*d,e[t+2]=l*p+h*d+a*u-o*c,e[t+3]=h*p-a*c-o*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let i=e._x,r=e._y,n=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),h=a(r/2),c=a(n/2),u=o(i/2),d=o(r/2),p=o(n/2);switch(s){case"XYZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"YXZ":this._x=u*h*c+l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"ZXY":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c-u*d*p;break;case"ZYX":this._x=u*h*c-l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c+u*d*p;break;case"YZX":this._x=u*h*c+l*d*p,this._y=l*d*c+u*h*p,this._z=l*h*p-u*d*c,this._w=l*h*c-u*d*p;break;case"XZY":this._x=u*h*c-l*d*p,this._y=l*d*c-u*h*p,this._z=l*h*p+u*d*c,this._w=l*h*c+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],n=t[8],s=t[1],a=t[5],o=t[9],l=t[2],h=t[6],c=t[10],u=i+a+c;if(u>0){let d=.5/Math.sqrt(u+1);this._w=.25/d,this._x=(h-o)*d,this._y=(n-l)*d,this._z=(s-r)*d}else if(i>a&&i>c){let d=2*Math.sqrt(1+i-a-c);this._w=(h-o)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(n+l)/d}else if(a>c){let d=2*Math.sqrt(1+a-i-c);this._w=(n-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(o+h)/d}else{let d=2*Math.sqrt(1+c-i-a);this._w=(s-r)/d,this._x=(n+l)/d,this._y=(o+h)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ui(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,n=e._z,s=e._w,a=t._x,o=t._y,l=t._z,h=t._w;return this._x=i*h+s*a+r*l-n*o,this._y=r*h+s*o+n*a-i*l,this._z=n*h+s*l+i*o-r*a,this._w=s*h-i*a-r*o-n*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,n=this._z,s=this._w,a=s*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*i+t*this._x,this._y=d*r+t*this._y,this._z=d*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),h=Math.atan2(l,a),c=Math.sin((1-t)*h)/l,u=Math.sin(t*h)/l;return this._w=s*c+this._w*u,this._x=i*c+this._x*u,this._y=r*c+this._y*u,this._z=n*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},M=class{constructor(e=0,t=0,i=0){M.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(I1.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(I1.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=e.elements,s=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,n=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*r-a*i,h=o*i+a*t-n*r,c=o*r+n*i-s*t,u=-n*t-s*i-a*r;return this.x=l*o+u*-n+h*-a-c*-s,this.y=h*o+u*-s+c*-n-l*-a,this.z=c*o+u*-a+l*-s-h*-n,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,n=e.z,s=t.x,a=t.y,o=t.z;return this.x=r*o-n*a,this.y=n*s-i*o,this.z=i*a-r*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return of.copy(this).projectOnVector(e),this.sub(of)}reflect(e){return this.sub(of.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(ui(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},of=new M,I1=new Lt,fi=class{constructor(e=new M(1/0,1/0,1/0),t=new M(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let h=e[o],c=e[o+1],u=e[o+2];h<t&&(t=h),c<i&&(i=c),u<r&&(r=u),h>n&&(n=h),c>s&&(s=c),u>a&&(a=u)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let h=e.getX(o),c=e.getY(o),u=e.getZ(o);h<t&&(t=h),c<i&&(i=c),u<r&&(r=u),h>n&&(n=h),c>s&&(s=c),u>a&&(a=u)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Sa.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,a=n.count;s<a;s++)Sa.fromBufferAttribute(n,s).applyMatrix4(e.matrixWorld),this.expandByPoint(Sa)}else i.boundingBox===null&&i.computeBoundingBox(),lf.copy(i.boundingBox),lf.applyMatrix4(e.matrixWorld),this.union(lf);let r=e.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Sa),Sa.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ah),$u.subVectors(this.max,ah),wo.subVectors(e.a,ah),_o.subVectors(e.b,ah),So.subVectors(e.c,ah),Ms.subVectors(_o,wo),Cs.subVectors(So,_o),Aa.subVectors(wo,So);let t=[0,-Ms.z,Ms.y,0,-Cs.z,Cs.y,0,-Aa.z,Aa.y,Ms.z,0,-Ms.x,Cs.z,0,-Cs.x,Aa.z,0,-Aa.x,-Ms.y,Ms.x,0,-Cs.y,Cs.x,0,-Aa.y,Aa.x,0];return!hf(t,wo,_o,So,$u)||(t=[1,0,0,0,1,0,0,0,1],!hf(t,wo,_o,So,$u))?!1:(ec.crossVectors(Ms,Cs),t=[ec.x,ec.y,ec.z],hf(t,wo,_o,So,$u))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Sa.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Sa).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Zn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Zn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Zn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Zn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Zn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Zn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Zn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Zn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Zn),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Zn=[new M,new M,new M,new M,new M,new M,new M,new M],Sa=new M,lf=new fi,wo=new M,_o=new M,So=new M,Ms=new M,Cs=new M,Aa=new M,ah=new M,$u=new M,ec=new M,Ea=new M;function hf(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){Ea.fromArray(e,s);let o=n.x*Math.abs(Ea.x)+n.y*Math.abs(Ea.y)+n.z*Math.abs(Ea.z),l=t.dot(Ea),h=i.dot(Ea),c=r.dot(Ea);if(Math.max(-Math.max(l,h,c),Math.min(l,h,c))>o)return!1}return!0}var JR=new fi,B1=new M,tc=new M,uf=new M,tn=class{constructor(e=new M,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):JR.setFromPoints(e).getCenter(i);let r=0;for(let n=0,s=e.length;n<s;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){uf.subVectors(e,this.center);let t=uf.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.add(uf.multiplyScalar(r/i)),this.radius+=r}return this}union(e){return this.center.equals(e.center)===!0?tc.set(0,0,1).multiplyScalar(e.radius):tc.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(B1.copy(e.center).add(tc)),this.expandByPoint(B1.copy(e.center).sub(tc)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},Jn=new M,cf=new M,ic=new M,Ds=new M,df=new M,rc=new M,pf=new M,Ul=class{constructor(e=new M,t=new M(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Jn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Jn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Jn.copy(this.direction).multiplyScalar(t).add(this.origin),Jn.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){cf.copy(e).add(t).multiplyScalar(.5),ic.copy(t).sub(e).normalize(),Ds.copy(this.origin).sub(cf);let n=e.distanceTo(t)*.5,s=-this.direction.dot(ic),a=Ds.dot(this.direction),o=-Ds.dot(ic),l=Ds.lengthSq(),h=Math.abs(1-s*s),c,u,d,p;if(h>0)if(c=s*o-a,u=s*a-o,p=n*h,c>=0)if(u>=-p)if(u<=p){let m=1/h;c*=m,u*=m,d=c*(c+s*u+2*a)+u*(s*c+u+2*o)+l}else u=n,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;else u=-n,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;else u<=-p?(c=Math.max(0,-(-s*n+a)),u=c>0?-n:Math.min(Math.max(-n,-o),n),d=-c*c+u*(u+2*o)+l):u<=p?(c=0,u=Math.min(Math.max(-n,-o),n),d=u*(u+2*o)+l):(c=Math.max(0,-(s*n+a)),u=c>0?n:Math.min(Math.max(-n,-o),n),d=-c*c+u*(u+2*o)+l);else u=s>0?-n:n,c=Math.max(0,-(s*u+a)),d=-c*c+u*(u+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(c).add(this.origin),r&&r.copy(ic).multiplyScalar(u).add(cf),d}intersectSphere(e,t){Jn.subVectors(e.center,this.origin);let i=Jn.dot(this.direction),r=Jn.dot(Jn)-i*i,n=e.radius*e.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,s,a,o,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,r=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,r=(e.min.x-u.x)*l),h>=0?(n=(e.min.y-u.y)*h,s=(e.max.y-u.y)*h):(n=(e.max.y-u.y)*h,s=(e.min.y-u.y)*h),i>s||n>r||((n>i||i!==i)&&(i=n),(s<r||r!==r)&&(r=s),c>=0?(a=(e.min.z-u.z)*c,o=(e.max.z-u.z)*c):(a=(e.max.z-u.z)*c,o=(e.min.z-u.z)*c),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Jn)!==null}intersectTriangle(e,t,i,r,n){df.subVectors(t,e),rc.subVectors(i,e),pf.crossVectors(df,rc);let s=this.direction.dot(pf),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Ds.subVectors(this.origin,e);let o=a*this.direction.dot(rc.crossVectors(Ds,rc));if(o<0)return null;let l=a*this.direction.dot(df.cross(Ds));if(l<0||o+l>s)return null;let h=-a*Ds.dot(pf);return h<0?null:this.at(h/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Fe=class{constructor(){Fe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,r,n,s,a,o,l,h,c,u,d,p,m,g){let f=this.elements;return f[0]=e,f[4]=t,f[8]=i,f[12]=r,f[1]=n,f[5]=s,f[9]=a,f[13]=o,f[2]=l,f[6]=h,f[10]=c,f[14]=u,f[3]=d,f[7]=p,f[11]=m,f[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Fe().fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,r=1/Ao.setFromMatrixColumn(e,0).length(),n=1/Ao.setFromMatrixColumn(e,1).length(),s=1/Ao.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[7]=0,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let t=this.elements,i=e.x,r=e.y,n=e.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(r),l=Math.sin(r),h=Math.cos(n),c=Math.sin(n);if(e.order==="XYZ"){let u=s*h,d=s*c,p=a*h,m=a*c;t[0]=o*h,t[4]=-o*c,t[8]=l,t[1]=d+p*l,t[5]=u-m*l,t[9]=-a*o,t[2]=m-u*l,t[6]=p+d*l,t[10]=s*o}else if(e.order==="YXZ"){let u=o*h,d=o*c,p=l*h,m=l*c;t[0]=u+m*a,t[4]=p*a-d,t[8]=s*l,t[1]=s*c,t[5]=s*h,t[9]=-a,t[2]=d*a-p,t[6]=m+u*a,t[10]=s*o}else if(e.order==="ZXY"){let u=o*h,d=o*c,p=l*h,m=l*c;t[0]=u-m*a,t[4]=-s*c,t[8]=p+d*a,t[1]=d+p*a,t[5]=s*h,t[9]=m-u*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if(e.order==="ZYX"){let u=s*h,d=s*c,p=a*h,m=a*c;t[0]=o*h,t[4]=p*l-d,t[8]=u*l+m,t[1]=o*c,t[5]=m*l+u,t[9]=d*l-p,t[2]=-l,t[6]=a*o,t[10]=s*o}else if(e.order==="YZX"){let u=s*o,d=s*l,p=a*o,m=a*l;t[0]=o*h,t[4]=m-u*c,t[8]=p*c+d,t[1]=c,t[5]=s*h,t[9]=-a*h,t[2]=-l*h,t[6]=d*c+p,t[10]=u-m*c}else if(e.order==="XZY"){let u=s*o,d=s*l,p=a*o,m=a*l;t[0]=o*h,t[4]=-c,t[8]=l*h,t[1]=u*c+m,t[5]=s*h,t[9]=d*c-p,t[2]=p*c-d,t[6]=a*h,t[10]=m*c+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose($R,e,eI)}lookAt(e,t,i){let r=this.elements;return rr.subVectors(e,t),rr.lengthSq()===0&&(rr.z=1),rr.normalize(),Ps.crossVectors(i,rr),Ps.lengthSq()===0&&(Math.abs(i.z)===1?rr.x+=1e-4:rr.z+=1e-4,rr.normalize(),Ps.crossVectors(i,rr)),Ps.normalize(),nc.crossVectors(rr,Ps),r[0]=Ps.x,r[4]=nc.x,r[8]=rr.x,r[1]=Ps.y,r[5]=nc.y,r[9]=rr.y,r[2]=Ps.z,r[6]=nc.z,r[10]=rr.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],m=i[6],g=i[10],f=i[14],v=i[3],y=i[7],x=i[11],b=i[15],S=r[0],_=r[4],A=r[8],w=r[12],E=r[1],T=r[5],C=r[9],P=r[13],k=r[2],D=r[6],R=r[10],G=r[14],N=r[3],L=r[7],H=r[11],F=r[15];return n[0]=s*S+a*E+o*k+l*N,n[4]=s*_+a*T+o*D+l*L,n[8]=s*A+a*C+o*R+l*H,n[12]=s*w+a*P+o*G+l*F,n[1]=h*S+c*E+u*k+d*N,n[5]=h*_+c*T+u*D+d*L,n[9]=h*A+c*C+u*R+d*H,n[13]=h*w+c*P+u*G+d*F,n[2]=p*S+m*E+g*k+f*N,n[6]=p*_+m*T+g*D+f*L,n[10]=p*A+m*C+g*R+f*H,n[14]=p*w+m*P+g*G+f*F,n[3]=v*S+y*E+x*k+b*N,n[7]=v*_+y*T+x*D+b*L,n[11]=v*A+y*C+x*R+b*H,n[15]=v*w+y*P+x*G+b*F,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],s=e[1],a=e[5],o=e[9],l=e[13],h=e[2],c=e[6],u=e[10],d=e[14],p=e[3],m=e[7],g=e[11],f=e[15];return p*(+n*o*c-r*l*c-n*a*u+i*l*u+r*a*d-i*o*d)+m*(+t*o*d-t*l*u+n*s*u-r*s*d+r*l*h-n*o*h)+g*(+t*l*c-t*a*d-n*s*c+i*s*d+n*a*h-i*l*h)+f*(-r*a*h-t*o*c+t*a*u+r*s*c-i*s*u+i*o*h)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){let r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],c=e[9],u=e[10],d=e[11],p=e[12],m=e[13],g=e[14],f=e[15],v=c*g*l-m*u*l+m*o*d-a*g*d-c*o*f+a*u*f,y=p*u*l-h*g*l-p*o*d+s*g*d+h*o*f-s*u*f,x=h*m*l-p*c*l+p*a*d-s*m*d-h*a*f+s*c*f,b=p*c*o-h*m*o-p*a*u+s*m*u+h*a*g-s*c*g,S=t*v+i*y+r*x+n*b;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let _=1/S;return e[0]=v*_,e[1]=(m*u*n-c*g*n-m*r*d+i*g*d+c*r*f-i*u*f)*_,e[2]=(a*g*n-m*o*n+m*r*l-i*g*l-a*r*f+i*o*f)*_,e[3]=(c*o*n-a*u*n-c*r*l+i*u*l+a*r*d-i*o*d)*_,e[4]=y*_,e[5]=(h*g*n-p*u*n+p*r*d-t*g*d-h*r*f+t*u*f)*_,e[6]=(p*o*n-s*g*n-p*r*l+t*g*l+s*r*f-t*o*f)*_,e[7]=(s*u*n-h*o*n+h*r*l-t*u*l-s*r*d+t*o*d)*_,e[8]=x*_,e[9]=(p*c*n-h*m*n-p*i*d+t*m*d+h*i*f-t*c*f)*_,e[10]=(s*m*n-p*a*n+p*i*l-t*m*l-s*i*f+t*a*f)*_,e[11]=(h*a*n-s*c*n-h*i*l+t*c*l+s*i*d-t*a*d)*_,e[12]=b*_,e[13]=(h*m*r-p*c*r+p*i*u-t*m*u-h*i*g+t*c*g)*_,e[14]=(p*a*r-s*m*r-p*i*o+t*m*o+s*i*g-t*a*g)*_,e[15]=(s*c*r-h*a*r+h*i*o-t*c*o-s*i*u+t*a*u)*_,this}scale(e){let t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),r=Math.sin(t),n=1-i,s=e.x,a=e.y,o=e.z,l=n*s,h=n*a;return this.set(l*s+i,l*a-r*o,l*o+r*a,0,l*a+r*o,h*a+i,h*o-r*s,0,l*o-r*a,h*o+r*s,n*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,n,s){return this.set(1,i,n,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){let r=this.elements,n=t._x,s=t._y,a=t._z,o=t._w,l=n+n,h=s+s,c=a+a,u=n*l,d=n*h,p=n*c,m=s*h,g=s*c,f=a*c,v=o*l,y=o*h,x=o*c,b=i.x,S=i.y,_=i.z;return r[0]=(1-(m+f))*b,r[1]=(d+x)*b,r[2]=(p-y)*b,r[3]=0,r[4]=(d-x)*S,r[5]=(1-(u+f))*S,r[6]=(g+v)*S,r[7]=0,r[8]=(p+y)*_,r[9]=(g-v)*_,r[10]=(1-(u+m))*_,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){let r=this.elements,n=Ao.set(r[0],r[1],r[2]).length(),s=Ao.set(r[4],r[5],r[6]).length(),a=Ao.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),e.x=r[12],e.y=r[13],e.z=r[14],Vr.copy(this);let o=1/n,l=1/s,h=1/a;return Vr.elements[0]*=o,Vr.elements[1]*=o,Vr.elements[2]*=o,Vr.elements[4]*=l,Vr.elements[5]*=l,Vr.elements[6]*=l,Vr.elements[8]*=h,Vr.elements[9]*=h,Vr.elements[10]*=h,t.setFromRotationMatrix(Vr),i.x=n,i.y=s,i.z=a,this}makePerspective(e,t,i,r,n,s){s===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let a=this.elements,o=2*n/(t-e),l=2*n/(i-r),h=(t+e)/(t-e),c=(i+r)/(i-r),u=-(s+n)/(s-n),d=-2*s*n/(s-n);return a[0]=o,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,n,s){let a=this.elements,o=1/(t-e),l=1/(i-r),h=1/(s-n),c=(t+e)*o,u=(i+r)*l,d=(s+n)*h;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},Ao=new M,Vr=new Fe,$R=new M(0,0,0),eI=new M(1,1,1),Ps=new M,nc=new M,rr=new M,N1=new Fe,k1=new Lt,zi=class{constructor(e=0,t=0,i=0,r=zi.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],h=r[9],c=r[2],u=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(ui(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ui(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(ui(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-ui(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(ui(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-ui(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return N1.makeRotationFromQuaternion(e),this.setFromRotationMatrix(N1,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return k1.setFromEuler(this),this.setFromQuaternion(k1,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}};zi.DefaultOrder="XYZ";zi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Kv=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},tI=0,U1=new M,Eo=new Lt,$n=new Fe,sc=new M,oh=new M,iI=new M,rI=new Lt,F1=new M(1,0,0),z1=new M(0,1,0),G1=new M(0,0,1),nI={type:"added"},H1={type:"removed"},Ut=class extends Bi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:tI++}),this.uuid=kn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ut.DefaultUp.clone();let e=new M,t=new zi,i=new Lt,r=new M(1,1,1);function n(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Fe},normalMatrix:{value:new Ri}}),this.matrix=new Fe,this.matrixWorld=new Fe,this.matrixAutoUpdate=Ut.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Kv,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Eo.setFromAxisAngle(e,t),this.quaternion.multiply(Eo),this}rotateOnWorldAxis(e,t){return Eo.setFromAxisAngle(e,t),this.quaternion.premultiply(Eo),this}rotateX(e){return this.rotateOnAxis(F1,e)}rotateY(e){return this.rotateOnAxis(z1,e)}rotateZ(e){return this.rotateOnAxis(G1,e)}translateOnAxis(e,t){return U1.copy(e).applyQuaternion(this.quaternion),this.position.add(U1.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(F1,e)}translateY(e){return this.translateOnAxis(z1,e)}translateZ(e){return this.translateOnAxis(G1,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4($n.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?sc.copy(e):sc.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),oh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$n.lookAt(oh,sc,this.up):$n.lookAt(sc,oh,this.up),this.quaternion.setFromRotationMatrix($n),r&&($n.extractRotation(r.matrixWorld),Eo.setFromRotationMatrix($n),this.quaternion.premultiply(Eo.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(nI)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(H1)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(H1)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),$n.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),$n.multiply(e.parent.matrixWorld)),e.applyMatrix4($n),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(e,t);if(n!==void 0)return n}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(oh,e,iI),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(oh,rI,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++)r[n].updateWorldMatrix(!1,!0)}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,h=o.length;l<h;l++){let c=o[l];n(e.shapes,c)}else n(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(e.materials,this.material[o]));r.material=a}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(n(e.animations,o))}}if(t){let a=s(e.geometries),o=s(e.materials),l=s(e.textures),h=s(e.images),c=s(e.shapes),u=s(e.skeletons),d=s(e.animations),p=s(e.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),h.length>0&&(i.images=h),c.length>0&&(i.shapes=c),u.length>0&&(i.skeletons=u),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=r,i;function s(a){let o=[];for(let l in a){let h=a[l];delete h.metadata,o.push(h)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};Ut.DefaultUp=new M(0,1,0);Ut.DefaultMatrixAutoUpdate=!0;var jr=new M,es=new M,ff=new M,ts=new M,To=new M,Mo=new M,V1=new M,mf=new M,gf=new M,vf=new M,Dr=class{constructor(e=new M,t=new M,i=new M){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),jr.subVectors(e,t),r.cross(jr);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(e,t,i,r,n){jr.subVectors(r,t),es.subVectors(i,t),ff.subVectors(e,t);let s=jr.dot(jr),a=jr.dot(es),o=jr.dot(ff),l=es.dot(es),h=es.dot(ff),c=s*l-a*a;if(c===0)return n.set(-2,-1,-1);let u=1/c,d=(l*o-a*h)*u,p=(s*h-a*o)*u;return n.set(1-d-p,p,d)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,ts),ts.x>=0&&ts.y>=0&&ts.x+ts.y<=1}static getUV(e,t,i,r,n,s,a,o){return this.getBarycoord(e,t,i,r,ts),o.set(0,0),o.addScaledVector(n,ts.x),o.addScaledVector(s,ts.y),o.addScaledVector(a,ts.z),o}static isFrontFacing(e,t,i,r){return jr.subVectors(i,t),es.subVectors(e,t),jr.cross(es).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return jr.subVectors(this.c,this.b),es.subVectors(this.a,this.b),jr.cross(es).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Dr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Dr.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,n){return Dr.getUV(e,this.a,this.b,this.c,t,i,r,n)}containsPoint(e){return Dr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Dr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i=this.a,r=this.b,n=this.c,s,a;To.subVectors(r,i),Mo.subVectors(n,i),mf.subVectors(e,i);let o=To.dot(mf),l=Mo.dot(mf);if(o<=0&&l<=0)return t.copy(i);gf.subVectors(e,r);let h=To.dot(gf),c=Mo.dot(gf);if(h>=0&&c<=h)return t.copy(r);let u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return s=o/(o-h),t.copy(i).addScaledVector(To,s);vf.subVectors(e,n);let d=To.dot(vf),p=Mo.dot(vf);if(p>=0&&d<=p)return t.copy(n);let m=d*l-o*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(i).addScaledVector(Mo,a);let g=h*p-d*c;if(g<=0&&c-h>=0&&d-p>=0)return V1.subVectors(n,r),a=(c-h)/(c-h+(d-p)),t.copy(r).addScaledVector(V1,a);let f=1/(g+m+u);return s=m*f,a=u*f,t.copy(i).addScaledVector(To,s).addScaledVector(Mo,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},sI=0,Tu=class extends Bi{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:sI++}),this.uuid=kn(),this.name="",this.type="Material",this.blending=qa,this.side=ys,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=OA,this.blendDst=RA,this.blendEquation=qo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=rg,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=OR,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=rf,this.stencilZFail=rf,this.stencilZPass=rf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===GO;continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==qa&&(i.blending=this.blending),this.side!==ys&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(t){let n=r(e.textures),s=r(e.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},Zv=class extends Tu{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ze(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=IA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},si=new M,ac=new q,at=class{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=og,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new Ze),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}copyVector2sArray(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new q),t[i++]=s.x,t[i++]=s.y}return this}copyVector3sArray(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new M),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}copyVector4sArray(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new ht),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)ac.fromBufferAttribute(this,t),ac.applyMatrix3(e),this.setXY(t,ac.x,ac.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)si.fromBufferAttribute(this,t),si.applyMatrix3(e),this.setXYZ(t,si.x,si.y,si.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)si.fromBufferAttribute(this,t),si.applyMatrix4(e),this.setXYZ(t,si.x,si.y,si.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)si.fromBufferAttribute(this,t),si.applyNormalMatrix(e),this.setXYZ(t,si.x,si.y,si.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)si.fromBufferAttribute(this,t),si.transformDirection(e),this.setXYZ(t,si.x,si.y,si.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==og&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}},VA=class extends at{constructor(e,t,i){super(new Uint16Array(e),t,i)}},zh=class extends at{constructor(e,t,i){super(new Uint32Array(e),t,i)}},Be=class extends at{constructor(e,t,i){super(new Float32Array(e),t,i)}},aI=0,br=new Fe,yf=new Ut,Co=new M,nr=new fi,lh=new fi,vi=new M,it=class extends Bi{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:aI++}),this.uuid=kn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(UA(e)?zh:VA)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new Ri().getNormalMatrix(e);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return br.makeRotationFromQuaternion(e),this.applyMatrix4(br),this}rotateX(e){return br.makeRotationX(e),this.applyMatrix4(br),this}rotateY(e){return br.makeRotationY(e),this.applyMatrix4(br),this}rotateZ(e){return br.makeRotationZ(e),this.applyMatrix4(br),this}translate(e,t,i){return br.makeTranslation(e,t,i),this.applyMatrix4(br),this}scale(e,t,i){return br.makeScale(e,t,i),this.applyMatrix4(br),this}lookAt(e){return yf.lookAt(e),yf.updateMatrix(),this.applyMatrix4(yf.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Co).negate(),this.translate(Co.x,Co.y,Co.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Be(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new fi);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new M(-1/0,-1/0,-1/0),new M(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let n=t[i];nr.setFromBufferAttribute(n),this.morphTargetsRelative?(vi.addVectors(this.boundingBox.min,nr.min),this.boundingBox.expandByPoint(vi),vi.addVectors(this.boundingBox.max,nr.max),this.boundingBox.expandByPoint(vi)):(this.boundingBox.expandByPoint(nr.min),this.boundingBox.expandByPoint(nr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new tn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new M,1/0);return}if(e){let i=this.boundingSphere.center;if(nr.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){let a=t[n];lh.setFromBufferAttribute(a),this.morphTargetsRelative?(vi.addVectors(nr.min,lh.min),nr.expandByPoint(vi),vi.addVectors(nr.max,lh.max),nr.expandByPoint(vi)):(nr.expandByPoint(lh.min),nr.expandByPoint(lh.max))}nr.getCenter(i);let r=0;for(let n=0,s=e.count;n<s;n++)vi.fromBufferAttribute(e,n),r=Math.max(r,i.distanceToSquared(vi));if(t)for(let n=0,s=t.length;n<s;n++){let a=t[n],o=this.morphTargetsRelative;for(let l=0,h=a.count;l<h;l++)vi.fromBufferAttribute(a,l),o&&(Co.fromBufferAttribute(e,l),vi.add(Co)),r=Math.max(r,i.distanceToSquared(vi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,n=t.normal.array,s=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new at(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],h=[];for(let E=0;E<a;E++)l[E]=new M,h[E]=new M;let c=new M,u=new M,d=new M,p=new q,m=new q,g=new q,f=new M,v=new M;function y(E,T,C){c.fromArray(r,E*3),u.fromArray(r,T*3),d.fromArray(r,C*3),p.fromArray(s,E*2),m.fromArray(s,T*2),g.fromArray(s,C*2),u.sub(c),d.sub(c),m.sub(p),g.sub(p);let P=1/(m.x*g.y-g.x*m.y);!isFinite(P)||(f.copy(u).multiplyScalar(g.y).addScaledVector(d,-m.y).multiplyScalar(P),v.copy(d).multiplyScalar(m.x).addScaledVector(u,-g.x).multiplyScalar(P),l[E].add(f),l[T].add(f),l[C].add(f),h[E].add(v),h[T].add(v),h[C].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let E=0,T=x.length;E<T;++E){let C=x[E],P=C.start,k=C.count;for(let D=P,R=P+k;D<R;D+=3)y(i[D+0],i[D+1],i[D+2])}let b=new M,S=new M,_=new M,A=new M;function w(E){_.fromArray(n,E*3),A.copy(_);let T=l[E];b.copy(T),b.sub(_.multiplyScalar(_.dot(T))).normalize(),S.crossVectors(A,T);let C=S.dot(h[E])<0?-1:1;o[E*4]=b.x,o[E*4+1]=b.y,o[E*4+2]=b.z,o[E*4+3]=C}for(let E=0,T=x.length;E<T;++E){let C=x[E],P=C.start,k=C.count;for(let D=P,R=P+k;D<R;D+=3)w(i[D+0]),w(i[D+1]),w(i[D+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new at(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let u=0,d=i.count;u<d;u++)i.setXYZ(u,0,0,0);let r=new M,n=new M,s=new M,a=new M,o=new M,l=new M,h=new M,c=new M;if(e)for(let u=0,d=e.count;u<d;u+=3){let p=e.getX(u+0),m=e.getX(u+1),g=e.getX(u+2);r.fromBufferAttribute(t,p),n.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),h.subVectors(s,n),c.subVectors(r,n),h.cross(c),a.fromBufferAttribute(i,p),o.fromBufferAttribute(i,m),l.fromBufferAttribute(i,g),a.add(h),o.add(h),l.add(h),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(m,o.x,o.y,o.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let u=0,d=t.count;u<d;u+=3)r.fromBufferAttribute(t,u+0),n.fromBufferAttribute(t,u+1),s.fromBufferAttribute(t,u+2),h.subVectors(s,n),c.subVectors(r,n),h.cross(c),i.setXYZ(u+0,h.x,h.y,h.z),i.setXYZ(u+1,h.x,h.y,h.z),i.setXYZ(u+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let i=this.attributes;for(let r in i){if(e.attributes[r]===void 0)continue;let n=i[r].array,s=e.attributes[r],a=s.array,o=s.itemSize*t,l=Math.min(a.length,n.length-o);for(let h=0,c=o;h<l;h++,c++)n[c]=a[h]}return this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)vi.fromBufferAttribute(e,t),vi.normalize(),e.setXYZ(t,vi.x,vi.y,vi.z)}toNonIndexed(){function e(a,o){let l=a.array,h=a.itemSize,c=a.normalized,u=new l.constructor(o.length*h),d=0,p=0;for(let m=0,g=o.length;m<g;m++){a.isInterleavedBufferAttribute?d=o[m]*a.data.stride+a.offset:d=o[m]*h;for(let f=0;f<h;f++)u[p++]=l[d++]}return new at(u,h,c)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new it,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=e(o,i);t.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let h=0,c=l.length;h<c;h++){let u=l[h],d=e(u,i);o.push(d)}t.morphAttributes[a]=o}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let l=i[o];e.data.attributes[o]=l.toJSON(e.data)}let r={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],h=[];for(let c=0,u=l.length;c<u;c++){let d=l[c];h.push(d.toJSON(e.data))}h.length>0&&(r[o]=h,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let l in r){let h=r[l];this.setAttribute(l,h.clone(t))}let n=e.morphAttributes;for(let l in n){let h=[],c=n[l];for(let u=0,d=c.length;u<d;u++)h.push(c[u].clone(t));this.morphAttributes[l]=h}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,h=s.length;l<h;l++){let c=s[l];this.addGroup(c.start,c.count,c.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},j1=new Fe,Do=new Ul,xf=new tn,Ls=new M,Os=new M,Rs=new M,bf=new M,wf=new M,_f=new M,oc=new M,lc=new M,hc=new M,uc=new q,cc=new q,dc=new q,Sf=new M,pc=new M,Gi=class extends Ut{constructor(e=new it,t=new Zv){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}raycast(e,t){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),xf.copy(i.boundingSphere),xf.applyMatrix4(n),e.ray.intersectsSphere(xf)===!1)||(j1.copy(n).invert(),Do.copy(e.ray).applyMatrix4(j1),i.boundingBox!==null&&Do.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.morphAttributes.position,h=i.morphTargetsRelative,c=i.attributes.uv,u=i.attributes.uv2,d=i.groups,p=i.drawRange;if(a!==null)if(Array.isArray(r))for(let m=0,g=d.length;m<g;m++){let f=d[m],v=r[f.materialIndex],y=Math.max(f.start,p.start),x=Math.min(a.count,Math.min(f.start+f.count,p.start+p.count));for(let b=y,S=x;b<S;b+=3){let _=a.getX(b),A=a.getX(b+1),w=a.getX(b+2);s=fc(this,v,e,Do,o,l,h,c,u,_,A,w),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let m=Math.max(0,p.start),g=Math.min(a.count,p.start+p.count);for(let f=m,v=g;f<v;f+=3){let y=a.getX(f),x=a.getX(f+1),b=a.getX(f+2);s=fc(this,r,e,Do,o,l,h,c,u,y,x,b),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let m=0,g=d.length;m<g;m++){let f=d[m],v=r[f.materialIndex],y=Math.max(f.start,p.start),x=Math.min(o.count,Math.min(f.start+f.count,p.start+p.count));for(let b=y,S=x;b<S;b+=3){let _=b,A=b+1,w=b+2;s=fc(this,v,e,Do,o,l,h,c,u,_,A,w),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let m=Math.max(0,p.start),g=Math.min(o.count,p.start+p.count);for(let f=m,v=g;f<v;f+=3){let y=f,x=f+1,b=f+2;s=fc(this,r,e,Do,o,l,h,c,u,y,x,b),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}}};function oI(e,t,i,r,n,s,a,o){let l;if(t.side===Ai?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side!==Lr,o),l===null)return null;pc.copy(o),pc.applyMatrix4(e.matrixWorld);let h=i.ray.origin.distanceTo(pc);return h<i.near||h>i.far?null:{distance:h,point:pc.clone(),object:e}}function fc(e,t,i,r,n,s,a,o,l,h,c,u){Ls.fromBufferAttribute(n,h),Os.fromBufferAttribute(n,c),Rs.fromBufferAttribute(n,u);let d=e.morphTargetInfluences;if(s&&d){oc.set(0,0,0),lc.set(0,0,0),hc.set(0,0,0);for(let m=0,g=s.length;m<g;m++){let f=d[m],v=s[m];f!==0&&(bf.fromBufferAttribute(v,h),wf.fromBufferAttribute(v,c),_f.fromBufferAttribute(v,u),a?(oc.addScaledVector(bf,f),lc.addScaledVector(wf,f),hc.addScaledVector(_f,f)):(oc.addScaledVector(bf.sub(Ls),f),lc.addScaledVector(wf.sub(Os),f),hc.addScaledVector(_f.sub(Rs),f)))}Ls.add(oc),Os.add(lc),Rs.add(hc)}e.isSkinnedMesh&&(e.boneTransform(h,Ls),e.boneTransform(c,Os),e.boneTransform(u,Rs));let p=oI(e,t,i,r,Ls,Os,Rs,Sf);if(p){o&&(uc.fromBufferAttribute(o,h),cc.fromBufferAttribute(o,c),dc.fromBufferAttribute(o,u),p.uv=Dr.getUV(Sf,Ls,Os,Rs,uc,cc,dc,new q)),l&&(uc.fromBufferAttribute(l,h),cc.fromBufferAttribute(l,c),dc.fromBufferAttribute(l,u),p.uv2=Dr.getUV(Sf,Ls,Os,Rs,uc,cc,dc,new q));let m={a:h,b:c,c:u,normal:new M,materialIndex:0};Dr.getNormal(Ls,Os,Rs,m.normal),p.face=m}return p}var la=class extends it{constructor(e=1,t=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],h=[],c=[],u=0,d=0;p("z","y","x",-1,-1,i,t,e,s,n,0),p("z","y","x",1,-1,i,t,-e,s,n,1),p("x","z","y",1,1,e,i,t,r,s,2),p("x","z","y",1,-1,e,i,-t,r,s,3),p("x","y","z",1,-1,e,t,i,r,n,4),p("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new Be(l,3)),this.setAttribute("normal",new Be(h,3)),this.setAttribute("uv",new Be(c,2));function p(m,g,f,v,y,x,b,S,_,A,w){let E=x/_,T=b/A,C=x/2,P=b/2,k=S/2,D=_+1,R=A+1,G=0,N=0,L=new M;for(let H=0;H<R;H++){let F=H*T-P;for(let z=0;z<D;z++){let U=z*E-C;L[m]=U*v,L[g]=F*y,L[f]=k,l.push(L.x,L.y,L.z),L[m]=0,L[g]=0,L[f]=S>0?1:-1,h.push(L.x,L.y,L.z),c.push(z/_),c.push(1-H/A),G+=1}}for(let H=0;H<A;H++)for(let F=0;F<_;F++){let z=u+F+D*H,U=u+F+D*(H+1),W=u+(F+1)+D*(H+1),Y=u+(F+1)+D*H;o.push(z,U,Y),o.push(U,W,Y),N+=6}a.addGroup(d,N,w),d+=N,u+=G}}static fromJSON(e){return new la(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Tl(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function Pi(e){let t={};for(let i=0;i<e.length;i++){let r=Tl(e[i]);for(let n in r)t[n]=r[n]}return t}var Fl={clone:Tl,merge:Pi},lI=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,hI=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,ci=class extends Tu{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=lI,this.fragmentShader=hI,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Tl(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},zl=class extends Ut{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Fe,this.projectionMatrix=new Fe,this.projectionMatrixInverse=new Fe}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Oi=class extends zl{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=Jh*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Uh*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Jh*2*Math.atan(Math.tan(Uh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(Uh*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,t-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Po=90,Lo=1,uI=class extends Ut{constructor(e,t,i){if(super(),this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;let r=new Oi(Po,Lo,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new M(1,0,0)),this.add(r);let n=new Oi(Po,Lo,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new M(-1,0,0)),this.add(n);let s=new Oi(Po,Lo,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new M(0,1,0)),this.add(s);let a=new Oi(Po,Lo,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new M(0,-1,0)),this.add(a);let o=new Oi(Po,Lo,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new M(0,0,1)),this.add(o);let l=new Oi(Po,Lo,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new M(0,0,-1)),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,h=e.getRenderTarget(),c=e.toneMapping,u=e.xr.enabled;e.toneMapping=ds,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(h),e.toneMapping=c,e.xr.enabled=u,i.texture.needsPMREMUpdate=!0}},Jv=class extends ji{constructor(e,t,i,r,n,s,a,o,l,h){e=e!==void 0?e:[],t=t!==void 0?t:to,super(e,t,i,r,n,s,a,o,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},cI=class extends ri{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new Jv(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ot}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new la(5,5,5),n=new ci({name:"CubemapFromEquirect",uniforms:Tl(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Ai,blending:Ei});n.uniforms.tEquirect.value=t;let s=new Gi(r,n),a=t.minFilter;return t.minFilter===Eu&&(t.minFilter=Ot),new uI(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(n)}},Af=new M,dI=new M,pI=new Ri,Cr=class{constructor(e=new M(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=Af.subVectors(i,t).cross(dI.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(Af),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||pI.getNormalMatrix(e),r=this.coplanarPoint(Af).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},Oo=new tn,mc=new M,$v=class{constructor(e=new Cr,t=new Cr,i=new Cr,r=new Cr,n=new Cr,s=new Cr){this.planes=[e,t,i,r,n,s]}set(e,t,i,r,n,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=i[9],p=i[10],m=i[11],g=i[12],f=i[13],v=i[14],y=i[15];return t[0].setComponents(a-r,c-o,m-u,y-g).normalize(),t[1].setComponents(a+r,c+o,m+u,y+g).normalize(),t[2].setComponents(a+n,c+l,m+d,y+f).normalize(),t[3].setComponents(a-n,c-l,m-d,y-f).normalize(),t[4].setComponents(a-s,c-h,m-p,y-v).normalize(),t[5].setComponents(a+s,c+h,m+p,y+v).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Oo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Oo)}intersectsSprite(e){return Oo.center.set(0,0,0),Oo.radius=.7071067811865476,Oo.applyMatrix4(e.matrixWorld),this.intersectsSphere(Oo)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(mc.x=r.normal.x>0?e.max.x:e.min.x,mc.y=r.normal.y>0?e.max.y:e.min.y,mc.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(mc)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function jA(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function fI(e,t){let i=t.isWebGL2,r=new WeakMap;function n(h,c){let u=h.array,d=h.usage,p=e.createBuffer();e.bindBuffer(c,p),e.bufferData(c,u,d),h.onUploadCallback();let m;if(u instanceof Float32Array)m=5126;else if(u instanceof Uint16Array)if(h.isFloat16BufferAttribute)if(i)m=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else m=5123;else if(u instanceof Int16Array)m=5122;else if(u instanceof Uint32Array)m=5125;else if(u instanceof Int32Array)m=5124;else if(u instanceof Int8Array)m=5120;else if(u instanceof Uint8Array)m=5121;else if(u instanceof Uint8ClampedArray)m=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:p,type:m,bytesPerElement:u.BYTES_PER_ELEMENT,version:h.version}}function s(h,c,u){let d=c.array,p=c.updateRange;e.bindBuffer(u,h),p.count===-1?e.bufferSubData(u,0,d):(i?e.bufferSubData(u,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(u,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1)}function a(h){return h.isInterleavedBufferAttribute&&(h=h.data),r.get(h)}function o(h){h.isInterleavedBufferAttribute&&(h=h.data);let c=r.get(h);c&&(e.deleteBuffer(c.buffer),r.delete(h))}function l(h,c){if(h.isGLBufferAttribute){let d=r.get(h);(!d||d.version<h.version)&&r.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}h.isInterleavedBufferAttribute&&(h=h.data);let u=r.get(h);u===void 0?r.set(h,n(h,c)):u.version<h.version&&(s(u.buffer,h,c),u.version=h.version)}return{get:a,remove:o,update:l}}var hp=class extends it{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let n=e/2,s=t/2,a=Math.floor(i),o=Math.floor(r),l=a+1,h=o+1,c=e/a,u=t/o,d=[],p=[],m=[],g=[];for(let f=0;f<h;f++){let v=f*u-s;for(let y=0;y<l;y++){let x=y*c-n;p.push(x,-v,0),m.push(0,0,1),g.push(y/a),g.push(1-f/o)}}for(let f=0;f<o;f++)for(let v=0;v<a;v++){let y=v+l*f,x=v+l*(f+1),b=v+1+l*(f+1),S=v+1+l*f;d.push(y,x,S),d.push(x,b,S)}this.setIndex(d),this.setAttribute("position",new Be(p,3)),this.setAttribute("normal",new Be(m,3)),this.setAttribute("uv",new Be(g,2))}static fromJSON(e){return new hp(e.width,e.height,e.widthSegments,e.heightSegments)}},mI=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,gI=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,vI=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,yI=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,xI=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,bI=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,wI="vec3 transformed = vec3( position );",_I=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,SI=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = mix(F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence);
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,AI=`#ifdef USE_IRIDESCENCE
const mat3 XYZ_TO_REC709 = mat3(
    3.2404542, -0.9692660,  0.0556434,
   -1.5371385,  1.8760108, -0.2040259,
   -0.4985314,  0.0415560,  1.0572252
);
vec3 Fresnel0ToIor( vec3 fresnel0 ) {
   vec3 sqrtF0 = sqrt( fresnel0 );
   return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
}
vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
   return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
}
float IorToFresnel0( float transmittedIor, float incidentIor ) {
   return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
}
vec3 evalSensitivity( float OPD, vec3 shift ) {
   float phase = 2.0 * PI * OPD * 1.0e-9;
   vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
   vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
   vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
   vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( -pow2( phase ) * var );
   xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[0] ) * exp( -4.5282e+09 * pow2( phase ) );
   xyz /= 1.0685e-7;
   vec3 srgb = XYZ_TO_REC709 * xyz;
   return srgb;
}
vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
   vec3 I;
   float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
   float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
   float cosTheta2Sq = 1.0 - sinTheta2Sq;
   if ( cosTheta2Sq < 0.0 ) {
       return vec3( 1.0 );
   }
   float cosTheta2 = sqrt( cosTheta2Sq );
   float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
   float R12 = F_Schlick( R0, 1.0, cosTheta1 );
   float R21 = R12;
   float T121 = 1.0 - R12;
   float phi12 = 0.0;
   if ( iridescenceIOR < outsideIOR ) phi12 = PI;
   float phi21 = PI - phi12;
   vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );   vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
   vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
   vec3 phi23 = vec3( 0.0 );
   if ( baseIOR[0] < iridescenceIOR ) phi23[0] = PI;
   if ( baseIOR[1] < iridescenceIOR ) phi23[1] = PI;
   if ( baseIOR[2] < iridescenceIOR ) phi23[2] = PI;
   float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
   vec3 phi = vec3( phi21 ) + phi23;
   vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
   vec3 r123 = sqrt( R123 );
   vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
   vec3 C0 = R12 + Rs;
   I = C0;
   vec3 Cm = Rs - T121;
   for ( int m = 1; m <= 2; ++m ) {
       Cm *= r123;
       vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
       I += Cm * Sm;
   }
   return max( I, vec3( 0.0 ) );
}
#endif`,EI=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,TI=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,MI=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,CI=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,DI=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,PI=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,LI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,OI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,RI=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,II=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,BI=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,NI=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,kI=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,UI=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,FI=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,zI=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,GI="gl_FragColor = linearToOutputTexel( gl_FragColor );",HI=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,VI=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,jI=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,WI=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,qI=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,YI=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,XI=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,QI=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,KI=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,ZI=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,JI=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,$I=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,eB=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,tB=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,iB=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,rB=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,nB=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,sB=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,aB=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,oB=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lB=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,hB=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,uB=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
float dotNVi = saturate( dot( normal, geometry.viewDir ) );
if ( material.iridescenceThickness == 0.0 ) {
	material.iridescence = 0.0;
} else {
	material.iridescence = saturate( material.iridescence );
}
if ( material.iridescence > 0.0 ) {
	material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
	material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,cB=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,dB=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,pB=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,fB=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,mB=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,gB=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,vB=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,yB=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,xB=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,bB=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wB=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,_B=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,SB=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,AB=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,EB=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,TB=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,MB=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,CB=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,DB=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,PB=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,LB=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,OB=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,RB=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,IB=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,BB=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,NB=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,kB=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,UB=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,FB=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,zB=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,GB=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,HB=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,VB=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,jB=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,WB=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,qB=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,YB=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,XB=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,QB=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,KB=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,ZB=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,JB=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,$B=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,eN=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tN=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,iN=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,rN=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,nN=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,sN=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,aN=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,oN=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,lN=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,hN=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uN=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,cN=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,dN=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,pN=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,fN=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,mN=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,gN=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,vN=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,yN=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,xN=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,bN=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,wN=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,_N=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,SN=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,AN=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,EN=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,TN=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,MN=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,CN=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,DN=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PN=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,LN=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,ON=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,RN=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,IN=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,BN=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NN=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kN=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,UN=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,FN=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,zN=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,GN=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,HN=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,VN=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ot={alphamap_fragment:mI,alphamap_pars_fragment:gI,alphatest_fragment:vI,alphatest_pars_fragment:yI,aomap_fragment:xI,aomap_pars_fragment:bI,begin_vertex:wI,beginnormal_vertex:_I,bsdfs:SI,iridescence_fragment:AI,bumpmap_pars_fragment:EI,clipping_planes_fragment:TI,clipping_planes_pars_fragment:MI,clipping_planes_pars_vertex:CI,clipping_planes_vertex:DI,color_fragment:PI,color_pars_fragment:LI,color_pars_vertex:OI,color_vertex:RI,common:II,cube_uv_reflection_fragment:BI,defaultnormal_vertex:NI,displacementmap_pars_vertex:kI,displacementmap_vertex:UI,emissivemap_fragment:FI,emissivemap_pars_fragment:zI,encodings_fragment:GI,encodings_pars_fragment:HI,envmap_fragment:VI,envmap_common_pars_fragment:jI,envmap_pars_fragment:WI,envmap_pars_vertex:qI,envmap_physical_pars_fragment:rB,envmap_vertex:YI,fog_vertex:XI,fog_pars_vertex:QI,fog_fragment:KI,fog_pars_fragment:ZI,gradientmap_pars_fragment:JI,lightmap_fragment:$I,lightmap_pars_fragment:eB,lights_lambert_vertex:tB,lights_pars_begin:iB,lights_toon_fragment:nB,lights_toon_pars_fragment:sB,lights_phong_fragment:aB,lights_phong_pars_fragment:oB,lights_physical_fragment:lB,lights_physical_pars_fragment:hB,lights_fragment_begin:uB,lights_fragment_maps:cB,lights_fragment_end:dB,logdepthbuf_fragment:pB,logdepthbuf_pars_fragment:fB,logdepthbuf_pars_vertex:mB,logdepthbuf_vertex:gB,map_fragment:vB,map_pars_fragment:yB,map_particle_fragment:xB,map_particle_pars_fragment:bB,metalnessmap_fragment:wB,metalnessmap_pars_fragment:_B,morphcolor_vertex:SB,morphnormal_vertex:AB,morphtarget_pars_vertex:EB,morphtarget_vertex:TB,normal_fragment_begin:MB,normal_fragment_maps:CB,normal_pars_fragment:DB,normal_pars_vertex:PB,normal_vertex:LB,normalmap_pars_fragment:OB,clearcoat_normal_fragment_begin:RB,clearcoat_normal_fragment_maps:IB,clearcoat_pars_fragment:BB,iridescence_pars_fragment:NB,output_fragment:kB,packing:UB,premultiplied_alpha_fragment:FB,project_vertex:zB,dithering_fragment:GB,dithering_pars_fragment:HB,roughnessmap_fragment:VB,roughnessmap_pars_fragment:jB,shadowmap_pars_fragment:WB,shadowmap_pars_vertex:qB,shadowmap_vertex:YB,shadowmask_pars_fragment:XB,skinbase_vertex:QB,skinning_pars_vertex:KB,skinning_vertex:ZB,skinnormal_vertex:JB,specularmap_fragment:$B,specularmap_pars_fragment:eN,tonemapping_fragment:tN,tonemapping_pars_fragment:iN,transmission_fragment:rN,transmission_pars_fragment:nN,uv_pars_fragment:sN,uv_pars_vertex:aN,uv_vertex:oN,uv2_pars_fragment:lN,uv2_pars_vertex:hN,uv2_vertex:uN,worldpos_vertex:cN,background_vert:dN,background_frag:pN,cube_vert:fN,cube_frag:mN,depth_vert:gN,depth_frag:vN,distanceRGBA_vert:yN,distanceRGBA_frag:xN,equirect_vert:bN,equirect_frag:wN,linedashed_vert:_N,linedashed_frag:SN,meshbasic_vert:AN,meshbasic_frag:EN,meshlambert_vert:TN,meshlambert_frag:MN,meshmatcap_vert:CN,meshmatcap_frag:DN,meshnormal_vert:PN,meshnormal_frag:LN,meshphong_vert:ON,meshphong_frag:RN,meshphysical_vert:IN,meshphysical_frag:BN,meshtoon_vert:NN,meshtoon_frag:kN,points_vert:UN,points_frag:FN,shadow_vert:zN,shadow_frag:GN,sprite_vert:HN,sprite_frag:VN},we={common:{diffuse:{value:new Ze(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ri},uv2Transform:{value:new Ri},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new q(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ze(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ze(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ri}},sprite:{diffuse:{value:new Ze(16777215)},opacity:{value:1},center:{value:new q(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ri}}},An={basic:{uniforms:Pi([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.fog]),vertexShader:ot.meshbasic_vert,fragmentShader:ot.meshbasic_frag},lambert:{uniforms:Pi([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.fog,we.lights,{emissive:{value:new Ze(0)}}]),vertexShader:ot.meshlambert_vert,fragmentShader:ot.meshlambert_frag},phong:{uniforms:Pi([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.fog,we.lights,{emissive:{value:new Ze(0)},specular:{value:new Ze(1118481)},shininess:{value:30}}]),vertexShader:ot.meshphong_vert,fragmentShader:ot.meshphong_frag},standard:{uniforms:Pi([we.common,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.roughnessmap,we.metalnessmap,we.fog,we.lights,{emissive:{value:new Ze(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ot.meshphysical_vert,fragmentShader:ot.meshphysical_frag},toon:{uniforms:Pi([we.common,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.gradientmap,we.fog,we.lights,{emissive:{value:new Ze(0)}}]),vertexShader:ot.meshtoon_vert,fragmentShader:ot.meshtoon_frag},matcap:{uniforms:Pi([we.common,we.bumpmap,we.normalmap,we.displacementmap,we.fog,{matcap:{value:null}}]),vertexShader:ot.meshmatcap_vert,fragmentShader:ot.meshmatcap_frag},points:{uniforms:Pi([we.points,we.fog]),vertexShader:ot.points_vert,fragmentShader:ot.points_frag},dashed:{uniforms:Pi([we.common,we.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ot.linedashed_vert,fragmentShader:ot.linedashed_frag},depth:{uniforms:Pi([we.common,we.displacementmap]),vertexShader:ot.depth_vert,fragmentShader:ot.depth_frag},normal:{uniforms:Pi([we.common,we.bumpmap,we.normalmap,we.displacementmap,{opacity:{value:1}}]),vertexShader:ot.meshnormal_vert,fragmentShader:ot.meshnormal_frag},sprite:{uniforms:Pi([we.sprite,we.fog]),vertexShader:ot.sprite_vert,fragmentShader:ot.sprite_frag},background:{uniforms:{uvTransform:{value:new Ri},t2D:{value:null}},vertexShader:ot.background_vert,fragmentShader:ot.background_frag},cube:{uniforms:Pi([we.envmap,{opacity:{value:1}}]),vertexShader:ot.cube_vert,fragmentShader:ot.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ot.equirect_vert,fragmentShader:ot.equirect_frag},distanceRGBA:{uniforms:Pi([we.common,we.displacementmap,{referencePosition:{value:new M},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ot.distanceRGBA_vert,fragmentShader:ot.distanceRGBA_frag},shadow:{uniforms:Pi([we.lights,we.fog,{color:{value:new Ze(0)},opacity:{value:1}}]),vertexShader:ot.shadow_vert,fragmentShader:ot.shadow_frag}};An.physical={uniforms:Pi([An.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new q(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ze(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new q},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ze(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ze(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ot.meshphysical_vert,fragmentShader:ot.meshphysical_frag};function jN(e,t,i,r,n,s){let a=new Ze(0),o=n===!0?0:1,l,h,c=null,u=0,d=null;function p(g,f){let v=!1,y=f.isScene===!0?f.background:null;y&&y.isTexture&&(y=t.get(y));let x=e.xr,b=x.getSession&&x.getSession();b&&b.environmentBlendMode==="additive"&&(y=null),y===null?m(a,o):y&&y.isColor&&(m(y,1),v=!0),(e.autoClear||v)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),y&&(y.isCubeTexture||y.mapping===Au)?(h===void 0&&(h=new Gi(new la(1,1,1),new ci({name:"BackgroundCubeMaterial",uniforms:Tl(An.cube.uniforms),vertexShader:An.cube.vertexShader,fragmentShader:An.cube.fragmentShader,side:Ai,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(S,_,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(h)),h.material.uniforms.envMap.value=y,h.material.uniforms.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,(c!==y||u!==y.version||d!==e.toneMapping)&&(h.material.needsUpdate=!0,c=y,u=y.version,d=e.toneMapping),h.layers.enableAll(),g.unshift(h,h.geometry,h.material,0,0,null)):y&&y.isTexture&&(l===void 0&&(l=new Gi(new hp(2,2),new ci({name:"BackgroundMaterial",uniforms:Tl(An.background.uniforms),vertexShader:An.background.vertexShader,fragmentShader:An.background.fragmentShader,side:ys,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=y,y.matrixAutoUpdate===!0&&y.updateMatrix(),l.material.uniforms.uvTransform.value.copy(y.matrix),(c!==y||u!==y.version||d!==e.toneMapping)&&(l.material.needsUpdate=!0,c=y,u=y.version,d=e.toneMapping),l.layers.enableAll(),g.unshift(l,l.geometry,l.material,0,0,null))}function m(g,f){i.buffers.color.setClear(g.r,g.g,g.b,f,s)}return{getClearColor:function(){return a},setClearColor:function(g,f=1){a.set(g),o=f,m(a,o)},getClearAlpha:function(){return o},setClearAlpha:function(g){o=g,m(a,o)},render:p}}function WN(e,t,i,r){let n=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=f(null),h=l,c=!1;function u(D,R,G,N,L){let H=!1;if(a){let F=g(N,G,R);h!==F&&(h=F,p(h.object)),H=v(D,N,G,L),H&&y(D,N,G,L)}else{let F=R.wireframe===!0;(h.geometry!==N.id||h.program!==G.id||h.wireframe!==F)&&(h.geometry=N.id,h.program=G.id,h.wireframe=F,H=!0)}L!==null&&i.update(L,34963),(H||c)&&(c=!1,w(D,R,G,N),L!==null&&e.bindBuffer(34963,i.get(L).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(D){return r.isWebGL2?e.bindVertexArray(D):s.bindVertexArrayOES(D)}function m(D){return r.isWebGL2?e.deleteVertexArray(D):s.deleteVertexArrayOES(D)}function g(D,R,G){let N=G.wireframe===!0,L=o[D.id];L===void 0&&(L={},o[D.id]=L);let H=L[R.id];H===void 0&&(H={},L[R.id]=H);let F=H[N];return F===void 0&&(F=f(d()),H[N]=F),F}function f(D){let R=[],G=[],N=[];for(let L=0;L<n;L++)R[L]=0,G[L]=0,N[L]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:G,attributeDivisors:N,object:D,attributes:{},index:null}}function v(D,R,G,N){let L=h.attributes,H=R.attributes,F=0,z=G.getAttributes();for(let U in z)if(z[U].location>=0){let W=L[U],Y=H[U];if(Y===void 0&&(U==="instanceMatrix"&&D.instanceMatrix&&(Y=D.instanceMatrix),U==="instanceColor"&&D.instanceColor&&(Y=D.instanceColor)),W===void 0||W.attribute!==Y||Y&&W.data!==Y.data)return!0;F++}return h.attributesNum!==F||h.index!==N}function y(D,R,G,N){let L={},H=R.attributes,F=0,z=G.getAttributes();for(let U in z)if(z[U].location>=0){let W=H[U];W===void 0&&(U==="instanceMatrix"&&D.instanceMatrix&&(W=D.instanceMatrix),U==="instanceColor"&&D.instanceColor&&(W=D.instanceColor));let Y={};Y.attribute=W,W&&W.data&&(Y.data=W.data),L[U]=Y,F++}h.attributes=L,h.attributesNum=F,h.index=N}function x(){let D=h.newAttributes;for(let R=0,G=D.length;R<G;R++)D[R]=0}function b(D){S(D,0)}function S(D,R){let G=h.newAttributes,N=h.enabledAttributes,L=h.attributeDivisors;G[D]=1,N[D]===0&&(e.enableVertexAttribArray(D),N[D]=1),L[D]!==R&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](D,R),L[D]=R)}function _(){let D=h.newAttributes,R=h.enabledAttributes;for(let G=0,N=R.length;G<N;G++)R[G]!==D[G]&&(e.disableVertexAttribArray(G),R[G]=0)}function A(D,R,G,N,L,H){r.isWebGL2===!0&&(G===5124||G===5125)?e.vertexAttribIPointer(D,R,G,L,H):e.vertexAttribPointer(D,R,G,N,L,H)}function w(D,R,G,N){if(r.isWebGL2===!1&&(D.isInstancedMesh||N.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;x();let L=N.attributes,H=G.getAttributes(),F=R.defaultAttributeValues;for(let z in H){let U=H[z];if(U.location>=0){let W=L[z];if(W===void 0&&(z==="instanceMatrix"&&D.instanceMatrix&&(W=D.instanceMatrix),z==="instanceColor"&&D.instanceColor&&(W=D.instanceColor)),W!==void 0){let Y=W.normalized,K=W.itemSize,V=i.get(W);if(V===void 0)continue;let ie=V.buffer,Q=V.type,J=V.bytesPerElement;if(W.isInterleavedBufferAttribute){let Z=W.data,ue=Z.stride,de=W.offset;if(Z.isInstancedInterleavedBuffer){for(let he=0;he<U.locationSize;he++)S(U.location+he,Z.meshPerAttribute);D.isInstancedMesh!==!0&&N._maxInstanceCount===void 0&&(N._maxInstanceCount=Z.meshPerAttribute*Z.count)}else for(let he=0;he<U.locationSize;he++)b(U.location+he);e.bindBuffer(34962,ie);for(let he=0;he<U.locationSize;he++)A(U.location+he,K/U.locationSize,Q,Y,ue*J,(de+K/U.locationSize*he)*J)}else{if(W.isInstancedBufferAttribute){for(let Z=0;Z<U.locationSize;Z++)S(U.location+Z,W.meshPerAttribute);D.isInstancedMesh!==!0&&N._maxInstanceCount===void 0&&(N._maxInstanceCount=W.meshPerAttribute*W.count)}else for(let Z=0;Z<U.locationSize;Z++)b(U.location+Z);e.bindBuffer(34962,ie);for(let Z=0;Z<U.locationSize;Z++)A(U.location+Z,K/U.locationSize,Q,Y,K*J,K/U.locationSize*Z*J)}}else if(F!==void 0){let Y=F[z];if(Y!==void 0)switch(Y.length){case 2:e.vertexAttrib2fv(U.location,Y);break;case 3:e.vertexAttrib3fv(U.location,Y);break;case 4:e.vertexAttrib4fv(U.location,Y);break;default:e.vertexAttrib1fv(U.location,Y)}}}}_()}function E(){P();for(let D in o){let R=o[D];for(let G in R){let N=R[G];for(let L in N)m(N[L].object),delete N[L];delete R[G]}delete o[D]}}function T(D){if(o[D.id]===void 0)return;let R=o[D.id];for(let G in R){let N=R[G];for(let L in N)m(N[L].object),delete N[L];delete R[G]}delete o[D.id]}function C(D){for(let R in o){let G=o[R];if(G[D.id]===void 0)continue;let N=G[D.id];for(let L in N)m(N[L].object),delete N[L];delete G[D.id]}}function P(){k(),c=!0,h!==l&&(h=l,p(h.object))}function k(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:P,resetDefaultState:k,dispose:E,releaseStatesOfGeometry:T,releaseStatesOfProgram:C,initAttributes:x,enableAttribute:b,disableUnusedAttributes:_}}function qN(e,t,i,r){let n=r.isWebGL2,s;function a(h){s=h}function o(h,c){e.drawArrays(s,h,c),i.update(c,s,1)}function l(h,c,u){if(u===0)return;let d,p;if(n)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,h,c,u),i.update(c,s,u)}this.setMode=a,this.render=o,this.renderInstances=l}function YN(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let A=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(A){if(A==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return A==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&e instanceof WebGL2ComputeRenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let h=a||t.has("WEBGL_draw_buffers"),c=i.logarithmicDepthBuffer===!0,u=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),m=e.getParameter(34076),g=e.getParameter(34921),f=e.getParameter(36347),v=e.getParameter(36348),y=e.getParameter(36349),x=d>0,b=a||t.has("OES_texture_float"),S=x&&b,_=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:h,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:m,maxAttributes:g,maxVertexUniforms:f,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:b,floatVertexTextures:S,maxSamples:_}}function XN(e){let t=this,i=null,r=0,n=!1,s=!1,a=new Cr,o=new Ri,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d,p){let m=u.length!==0||d||r!==0||n;return n=d,i=c(u,p,0),r=u.length,m},this.beginShadows=function(){s=!0,c(null)},this.endShadows=function(){s=!1,h()},this.setState=function(u,d,p){let m=u.clippingPlanes,g=u.clipIntersection,f=u.clipShadows,v=e.get(u);if(!n||m===null||m.length===0||s&&!f)s?c(null):h();else{let y=s?0:r,x=y*4,b=v.clippingState||null;l.value=b,b=c(m,d,x,p);for(let S=0;S!==x;++S)b[S]=i[S];v.clippingState=b,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=y}};function h(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(u,d,p,m){let g=u!==null?u.length:0,f=null;if(g!==0){if(f=l.value,m!==!0||f===null){let v=p+g*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(f===null||f.length<v)&&(f=new Float32Array(v));for(let x=0,b=p;x!==g;++x,b+=4)a.copy(u[x]).applyMatrix4(y,o),a.normal.toArray(f,b),f[b+3]=a.constant}l.value=f,l.needsUpdate=!0}return t.numPlanes=g,t.numIntersection=0,f}}function QN(e){let t=new WeakMap;function i(a,o){return o===ng?a.mapping=to:o===sg&&(a.mapping=io),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===ng||o===sg)if(t.has(a)){let l=t.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let h=new cI(l.height/2);return h.fromEquirectangularTexture(e,a),t.set(a,h),a.addEventListener("dispose",n),i(h.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}var e0=class extends zl{constructor(e=-1,t=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,s=i+e,a=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=h*this.view.offsetY,o=a-h*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},$o=4,W1=[.125,.215,.35,.446,.526,.582],Na=20,Ef=new e0,q1=new Ze,Tf=null,Oa=(1+Math.sqrt(5))/2,Ro=1/Oa,Y1=[new M(1,1,1),new M(-1,1,1),new M(1,1,-1),new M(-1,1,-1),new M(0,Oa,Ro),new M(0,Oa,-Ro),new M(Ro,0,Oa),new M(-Ro,0,Oa),new M(Oa,Ro,0),new M(-Oa,Ro,0)],X1=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){Tf=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Z1(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=K1(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Tf),e.scissorTest=!1,gc(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===to||e.mapping===io?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Tf=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Ot,minFilter:Ot,generateMipmaps:!1,type:Zh,format:Dn,encoding:Vn,depthBuffer:!1},r=Q1(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Q1(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=KN(n)),this._blurMaterial=ZN(n,e,t)}return r}_compileMaterial(e){let t=new Gi(this._lodPlanes[0],e);this._renderer.compile(t,Ef)}_sceneToCubeUV(e,t,i,r){let n=new Oi(90,1,t,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,h=o.toneMapping;o.getClearColor(q1),o.toneMapping=ds,o.autoClear=!1;let c=new Zv({name:"PMREM.Background",side:Ai,depthWrite:!1,depthTest:!1}),u=new Gi(new la,c),d=!1,p=e.background;p?p.isColor&&(c.color.copy(p),e.background=null,d=!0):(c.color.copy(q1),d=!0);for(let m=0;m<6;m++){let g=m%3;g===0?(n.up.set(0,s[m],0),n.lookAt(a[m],0,0)):g===1?(n.up.set(0,0,s[m]),n.lookAt(0,a[m],0)):(n.up.set(0,s[m],0),n.lookAt(0,0,a[m]));let f=this._cubeSize;gc(r,g*f,m>2?f:0,f,f),o.setRenderTarget(r),d&&o.render(u,n),o.render(e,n)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=h,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===to||e.mapping===io;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=Z1()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=K1());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new Gi(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=e;let o=this._cubeSize;gc(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,Ef)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=Y1[(r-1)%Y1.length];this._blur(e,r-1,r,n,s)}t.autoClear=i}_blur(e,t,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",n),this._halfBlur(s,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let h=3,c=new Gi(this._lodPlanes[r],l),u=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*Na-1),m=n/p,g=isFinite(n)?1+Math.floor(h*m):Na;g>Na&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Na}`);let f=[],v=0;for(let _=0;_<Na;++_){let A=_/m,w=Math.exp(-A*A/2);f.push(w),_===0?v+=w:_<g&&(v+=2*w)}for(let _=0;_<f.length;_++)f[_]=f[_]/v;u.envMap.value=e.texture,u.samples.value=g,u.weights.value=f,u.latitudinal.value=s==="latitudinal",a&&(u.poleAxis.value=a);let{_lodMax:y}=this;u.dTheta.value=p,u.mipInt.value=y-i;let x=this._sizeLods[r],b=3*x*(r>y-$o?r-y+$o:0),S=4*(this._cubeSize-x);gc(t,b,S,3*x,2*x),o.setRenderTarget(t),o.render(c,Ef)}};function KN(e){let t=[],i=[],r=[],n=e,s=e-$o+1+W1.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>e-$o?l=W1[a-e+$o-1]:a===0&&(l=0),r.push(l);let h=1/(o-2),c=-h,u=1+h,d=[c,c,u,c,u,u,c,c,u,u,c,u],p=6,m=6,g=3,f=2,v=1,y=new Float32Array(g*m*p),x=new Float32Array(f*m*p),b=new Float32Array(v*m*p);for(let _=0;_<p;_++){let A=_%3*2/3-1,w=_>2?0:-1,E=[A,w,0,A+2/3,w,0,A+2/3,w+1,0,A,w,0,A+2/3,w+1,0,A,w+1,0];y.set(E,g*m*_),x.set(d,f*m*_);let T=[_,_,_,_,_,_];b.set(T,v*m*_)}let S=new it;S.setAttribute("position",new at(y,g)),S.setAttribute("uv",new at(x,f)),S.setAttribute("faceIndex",new at(b,v)),t.push(S),n>$o&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function Q1(e,t,i){let r=new ri(e,t,i);return r.texture.mapping=Au,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function gc(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function ZN(e,t,i){let r=new Float32Array(Na),n=new M(0,1,0);return new ci({name:"SphericalGaussianBlur",defines:{n:Na,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:t0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ei,depthTest:!1,depthWrite:!1})}function K1(){return new ci({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:t0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ei,depthTest:!1,depthWrite:!1})}function Z1(){return new ci({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:t0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ei,depthTest:!1,depthWrite:!1})}function t0(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function JN(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,h=l===ng||l===sg,c=l===to||l===io;if(h||c)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let u=t.get(o);return i===null&&(i=new X1(e)),u=h?i.fromEquirectangular(o,u):i.fromCubemap(o,u),t.set(o,u),u.texture}else{if(t.has(o))return t.get(o).texture;{let u=o.image;if(h&&u&&u.height>0||c&&u&&n(u)){i===null&&(i=new X1(e));let d=h?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,h=6;for(let c=0;c<h;c++)o[c]!==void 0&&l++;return l===h}function s(o){let l=o.target;l.removeEventListener("dispose",s);let h=t.get(l);h!==void 0&&(t.delete(l),h.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function $N(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function ek(e,t,i,r){let n={},s=new WeakMap;function a(u){let d=u.target;d.index!==null&&t.remove(d.index);for(let m in d.attributes)t.remove(d.attributes[m]);d.removeEventListener("dispose",a),delete n[d.id];let p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(u,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(u){let d=u.attributes;for(let m in d)t.update(d[m],34962);let p=u.morphAttributes;for(let m in p){let g=p[m];for(let f=0,v=g.length;f<v;f++)t.update(g[f],34962)}}function h(u){let d=[],p=u.index,m=u.attributes.position,g=0;if(p!==null){let y=p.array;g=p.version;for(let x=0,b=y.length;x<b;x+=3){let S=y[x+0],_=y[x+1],A=y[x+2];d.push(S,_,_,A,A,S)}}else{let y=m.array;g=m.version;for(let x=0,b=y.length/3-1;x<b;x+=3){let S=x+0,_=x+1,A=x+2;d.push(S,_,_,A,A,S)}}let f=new(UA(d)?zh:VA)(d,1);f.version=g;let v=s.get(u);v&&t.remove(v),s.set(u,f)}function c(u){let d=s.get(u);if(d){let p=u.index;p!==null&&d.version<p.version&&h(u)}else h(u);return s.get(u)}return{get:o,update:l,getWireframeAttribute:c}}function tk(e,t,i,r){let n=r.isWebGL2,s;function a(d){s=d}let o,l;function h(d){o=d.type,l=d.bytesPerElement}function c(d,p){e.drawElements(s,p,o,d*l),i.update(p,s,1)}function u(d,p,m){if(m===0)return;let g,f;if(n)g=e,f="drawElementsInstanced";else if(g=t.get("ANGLE_instanced_arrays"),f="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[f](s,p,o,d*l,m),i.update(p,s,m)}this.setMode=a,this.setIndex=h,this.render=c,this.renderInstances=u}function ik(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function rk(e,t){return e[0]-t[0]}function nk(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Mf(e,t){let i=1,r=t.isInterleavedBufferAttribute?t.data.array:t.array;r instanceof Int8Array?i=127:r instanceof Uint8Array?i=255:r instanceof Uint16Array?i=65535:r instanceof Int16Array?i=32767:r instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),e.divideScalar(i)}function sk(e,t,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new ht,o=[];for(let h=0;h<8;h++)o[h]=[h,0];function l(h,c,u,d){let p=h.morphTargetInfluences;if(t.isWebGL2===!0){let m=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,g=m!==void 0?m.length:0,f=s.get(c);if(f===void 0||f.count!==g){let x=function(){D.dispose(),s.delete(c),c.removeEventListener("dispose",x)};f!==void 0&&f.texture.dispose();let b=c.morphAttributes.position!==void 0,S=c.morphAttributes.normal!==void 0,_=c.morphAttributes.color!==void 0,A=c.morphAttributes.position||[],w=c.morphAttributes.normal||[],E=c.morphAttributes.color||[],T=0;b===!0&&(T=1),S===!0&&(T=2),_===!0&&(T=3);let C=c.attributes.position.count*T,P=1;C>t.maxTextureSize&&(P=Math.ceil(C/t.maxTextureSize),C=t.maxTextureSize);let k=new Float32Array(C*P*4*g),D=new HA(k,C,P,g);D.type=Ys,D.needsUpdate=!0;let R=T*4;for(let G=0;G<g;G++){let N=A[G],L=w[G],H=E[G],F=C*P*4*G;for(let z=0;z<N.count;z++){let U=z*R;b===!0&&(a.fromBufferAttribute(N,z),N.normalized===!0&&Mf(a,N),k[F+U+0]=a.x,k[F+U+1]=a.y,k[F+U+2]=a.z,k[F+U+3]=0),S===!0&&(a.fromBufferAttribute(L,z),L.normalized===!0&&Mf(a,L),k[F+U+4]=a.x,k[F+U+5]=a.y,k[F+U+6]=a.z,k[F+U+7]=0),_===!0&&(a.fromBufferAttribute(H,z),H.normalized===!0&&Mf(a,H),k[F+U+8]=a.x,k[F+U+9]=a.y,k[F+U+10]=a.z,k[F+U+11]=H.itemSize===4?a.w:1)}}f={count:g,texture:D,size:new q(C,P)},s.set(c,f),c.addEventListener("dispose",x)}let v=0;for(let x=0;x<p.length;x++)v+=p[x];let y=c.morphTargetsRelative?1:1-v;d.getUniforms().setValue(e,"morphTargetBaseInfluence",y),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",f.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{let m=p===void 0?0:p.length,g=r[c.id];if(g===void 0||g.length!==m){g=[];for(let b=0;b<m;b++)g[b]=[b,0];r[c.id]=g}for(let b=0;b<m;b++){let S=g[b];S[0]=b,S[1]=p[b]}g.sort(nk);for(let b=0;b<8;b++)b<m&&g[b][1]?(o[b][0]=g[b][0],o[b][1]=g[b][1]):(o[b][0]=Number.MAX_SAFE_INTEGER,o[b][1]=0);o.sort(rk);let f=c.morphAttributes.position,v=c.morphAttributes.normal,y=0;for(let b=0;b<8;b++){let S=o[b],_=S[0],A=S[1];_!==Number.MAX_SAFE_INTEGER&&A?(f&&c.getAttribute("morphTarget"+b)!==f[_]&&c.setAttribute("morphTarget"+b,f[_]),v&&c.getAttribute("morphNormal"+b)!==v[_]&&c.setAttribute("morphNormal"+b,v[_]),n[b]=A,y+=A):(f&&c.hasAttribute("morphTarget"+b)===!0&&c.deleteAttribute("morphTarget"+b),v&&c.hasAttribute("morphNormal"+b)===!0&&c.deleteAttribute("morphNormal"+b),n[b]=0)}let x=c.morphTargetsRelative?1:1-y;d.getUniforms().setValue(e,"morphTargetBaseInfluence",x),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function ak(e,t,i,r){let n=new WeakMap;function s(l){let h=r.render.frame,c=l.geometry,u=t.get(l,c);return n.get(u)!==h&&(t.update(u),n.set(u,h)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),u}function a(){n=new WeakMap}function o(l){let h=l.target;h.removeEventListener("dispose",o),i.remove(h.instanceMatrix),h.instanceColor!==null&&i.remove(h.instanceColor)}return{update:s,dispose:a}}var WA=new ji,qA=new HA,YA=new ZR,XA=new Jv,J1=[],$1=[],ex=new Float32Array(16),tx=new Float32Array(9),ix=new Float32Array(4);function Gl(e,t,i){let r=e[0];if(r<=0||r>0)return e;let n=t*i,s=J1[n];if(s===void 0&&(s=new Float32Array(n),J1[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Wi(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function qi(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function up(e,t){let i=$1[t];i===void 0&&(i=new Int32Array(t),$1[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function ok(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function lk(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Wi(i,t))return;e.uniform2fv(this.addr,t),qi(i,t)}}function hk(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Wi(i,t))return;e.uniform3fv(this.addr,t),qi(i,t)}}function uk(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Wi(i,t))return;e.uniform4fv(this.addr,t),qi(i,t)}}function ck(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Wi(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),qi(i,t)}else{if(Wi(i,r))return;ix.set(r),e.uniformMatrix2fv(this.addr,!1,ix),qi(i,r)}}function dk(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Wi(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),qi(i,t)}else{if(Wi(i,r))return;tx.set(r),e.uniformMatrix3fv(this.addr,!1,tx),qi(i,r)}}function pk(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(Wi(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),qi(i,t)}else{if(Wi(i,r))return;ex.set(r),e.uniformMatrix4fv(this.addr,!1,ex),qi(i,r)}}function fk(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function mk(e,t){let i=this.cache;Wi(i,t)||(e.uniform2iv(this.addr,t),qi(i,t))}function gk(e,t){let i=this.cache;Wi(i,t)||(e.uniform3iv(this.addr,t),qi(i,t))}function vk(e,t){let i=this.cache;Wi(i,t)||(e.uniform4iv(this.addr,t),qi(i,t))}function yk(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function xk(e,t){let i=this.cache;Wi(i,t)||(e.uniform2uiv(this.addr,t),qi(i,t))}function bk(e,t){let i=this.cache;Wi(i,t)||(e.uniform3uiv(this.addr,t),qi(i,t))}function wk(e,t){let i=this.cache;Wi(i,t)||(e.uniform4uiv(this.addr,t),qi(i,t))}function _k(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||WA,n)}function Sk(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||YA,n)}function Ak(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||XA,n)}function Ek(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||qA,n)}function Tk(e){switch(e){case 5126:return ok;case 35664:return lk;case 35665:return hk;case 35666:return uk;case 35674:return ck;case 35675:return dk;case 35676:return pk;case 5124:case 35670:return fk;case 35667:case 35671:return mk;case 35668:case 35672:return gk;case 35669:case 35673:return vk;case 5125:return yk;case 36294:return xk;case 36295:return bk;case 36296:return wk;case 35678:case 36198:case 36298:case 36306:case 35682:return _k;case 35679:case 36299:case 36307:return Sk;case 35680:case 36300:case 36308:case 36293:return Ak;case 36289:case 36303:case 36311:case 36292:return Ek}}function Mk(e,t){e.uniform1fv(this.addr,t)}function Ck(e,t){let i=Gl(t,this.size,2);e.uniform2fv(this.addr,i)}function Dk(e,t){let i=Gl(t,this.size,3);e.uniform3fv(this.addr,i)}function Pk(e,t){let i=Gl(t,this.size,4);e.uniform4fv(this.addr,i)}function Lk(e,t){let i=Gl(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function Ok(e,t){let i=Gl(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Rk(e,t){let i=Gl(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Ik(e,t){e.uniform1iv(this.addr,t)}function Bk(e,t){e.uniform2iv(this.addr,t)}function Nk(e,t){e.uniform3iv(this.addr,t)}function kk(e,t){e.uniform4iv(this.addr,t)}function Uk(e,t){e.uniform1uiv(this.addr,t)}function Fk(e,t){e.uniform2uiv(this.addr,t)}function zk(e,t){e.uniform3uiv(this.addr,t)}function Gk(e,t){e.uniform4uiv(this.addr,t)}function Hk(e,t,i){let r=t.length,n=up(i,r);e.uniform1iv(this.addr,n);for(let s=0;s!==r;++s)i.setTexture2D(t[s]||WA,n[s])}function Vk(e,t,i){let r=t.length,n=up(i,r);e.uniform1iv(this.addr,n);for(let s=0;s!==r;++s)i.setTexture3D(t[s]||YA,n[s])}function jk(e,t,i){let r=t.length,n=up(i,r);e.uniform1iv(this.addr,n);for(let s=0;s!==r;++s)i.setTextureCube(t[s]||XA,n[s])}function Wk(e,t,i){let r=t.length,n=up(i,r);e.uniform1iv(this.addr,n);for(let s=0;s!==r;++s)i.setTexture2DArray(t[s]||qA,n[s])}function qk(e){switch(e){case 5126:return Mk;case 35664:return Ck;case 35665:return Dk;case 35666:return Pk;case 35674:return Lk;case 35675:return Ok;case 35676:return Rk;case 5124:case 35670:return Ik;case 35667:case 35671:return Bk;case 35668:case 35672:return Nk;case 35669:case 35673:return kk;case 5125:return Uk;case 36294:return Fk;case 36295:return zk;case 36296:return Gk;case 35678:case 36198:case 36298:case 36306:case 35682:return Hk;case 35679:case 36299:case 36307:return Vk;case 35680:case 36300:case 36308:case 36293:return jk;case 36289:case 36303:case 36311:case 36292:return Wk}}var Yk=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=Tk(t.type)}},Xk=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=qk(t.type)}},Qk=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(e,t[a.id],i)}}},Cf=/(\w+)(\])?(\[|\.)?/g;function rx(e,t){e.seq.push(t),e.map[t.id]=t}function Kk(e,t,i){let r=e.name,n=r.length;for(Cf.lastIndex=0;;){let s=Cf.exec(r),a=Cf.lastIndex,o=s[1],l=s[2]==="]",h=s[3];if(l&&(o=o|0),h===void 0||h==="["&&a+2===n){rx(i,h===void 0?new Yk(o,e,t):new Xk(o,e,t));break}else{let c=i.map[o];c===void 0&&(c=new Qk(o),rx(i,c)),i=c}}}var rd=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let n=e.getActiveUniform(t,r),s=e.getUniformLocation(t,n.name);Kk(n,s,this)}}setValue(e,t,i,r){let n=this.map[t];n!==void 0&&n.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,s=t.length;n!==s;++n){let a=t[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,n=e.length;r!==n;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function nx(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var Zk=0;function Jk(e,t){let i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function $k(e){switch(e){case Vn:return["Linear","( value )"];case pt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function sx(e,t,i){let r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+Jk(e.getShaderSource(t),a)}else return n}function e4(e,t){let i=$k(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function t4(e,t){let i;switch(t){case hR:i="Linear";break;case uR:i="Reinhard";break;case cR:i="OptimizedCineon";break;case dR:i="ACESFilmic";break;case pR:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function i4(e){return[e.extensionDerivatives||!!e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Mh).join(`
`)}function r4(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function n4(e,t){let i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let s=e.getActiveAttrib(t,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function Mh(e){return e!==""}function ax(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ox(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var s4=/^[ \t]*#include +<([\w\d./]+)>/gm;function ug(e){return e.replace(s4,a4)}function a4(e,t){let i=ot[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return ug(i)}var o4=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,l4=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function lx(e){return e.replace(l4,QA).replace(o4,h4)}function h4(e,t,i,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),QA(e,t,i,r)}function QA(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function hx(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function u4(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===Xv?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===LA?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Th&&(t="SHADOWMAP_TYPE_VSM"),t}function c4(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case to:case io:t="ENVMAP_TYPE_CUBE";break;case Au:t="ENVMAP_TYPE_CUBE_UV";break}return t}function d4(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case io:t="ENVMAP_MODE_REFRACTION";break}return t}function p4(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case IA:t="ENVMAP_BLENDING_MULTIPLY";break;case oR:t="ENVMAP_BLENDING_MIX";break;case lR:t="ENVMAP_BLENDING_ADD";break}return t}function f4(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function m4(e,t,i,r){let n=e.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=u4(i),h=c4(i),c=d4(i),u=p4(i),d=f4(i),p=i.isWebGL2?"":i4(i),m=r4(s),g=n.createProgram(),f,v,y=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(f=[m].filter(Mh).join(`
`),f.length>0&&(f+=`
`),v=[p,m].filter(Mh).join(`
`),v.length>0&&(v+=`
`)):(f=[hx(i),"#define SHADER_NAME "+i.shaderName,m,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Mh).join(`
`),v=[p,hx(i),"#define SHADER_NAME "+i.shaderName,m,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==ds?"#define TONE_MAPPING":"",i.toneMapping!==ds?ot.tonemapping_pars_fragment:"",i.toneMapping!==ds?t4("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",ot.encodings_pars_fragment,e4("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Mh).join(`
`)),a=ug(a),a=ax(a,i),a=ox(a,i),o=ug(o),o=ax(o,i),o=ox(o,i),a=lx(a),o=lx(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,f=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+f,v=["#define varying in",i.glslVersion===O1?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===O1?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);let x=y+f+a,b=y+v+o,S=nx(n,35633,x),_=nx(n,35632,b);if(n.attachShader(g,S),n.attachShader(g,_),i.index0AttributeName!==void 0?n.bindAttribLocation(g,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g),e.debug.checkShaderErrors){let E=n.getProgramInfoLog(g).trim(),T=n.getShaderInfoLog(S).trim(),C=n.getShaderInfoLog(_).trim(),P=!0,k=!0;if(n.getProgramParameter(g,35714)===!1){P=!1;let D=sx(n,S,"vertex"),R=sx(n,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(g,35715)+`

Program Info Log: `+E+`
`+D+`
`+R)}else E!==""?console.warn("THREE.WebGLProgram: Program Info Log:",E):(T===""||C==="")&&(k=!1);k&&(this.diagnostics={runnable:P,programLog:E,vertexShader:{log:T,prefix:f},fragmentShader:{log:C,prefix:v}})}n.deleteShader(S),n.deleteShader(_);let A;this.getUniforms=function(){return A===void 0&&(A=new rd(n,g)),A};let w;return this.getAttributes=function(){return w===void 0&&(w=n4(n,g)),w},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.name=i.shaderName,this.id=Zk++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=S,this.fragmentShader=_,this}var g4=0,v4=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache;return t.has(e)===!1&&t.set(e,new Set),t.get(e)}_getShaderStage(e){let t=this.shaderCache;if(t.has(e)===!1){let i=new y4(e);t.set(e,i)}return t.get(e)}},y4=class{constructor(e){this.id=g4++,this.code=e,this.usedTimes=0}};function x4(e,t,i,r,n,s,a){let o=new Kv,l=new v4,h=[],c=n.isWebGL2,u=n.logarithmicDepthBuffer,d=n.vertexTextures,p=n.precision,m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(w,E,T,C,P){let k=C.fog,D=P.geometry,R=w.isMeshStandardMaterial?C.environment:null,G=(w.isMeshStandardMaterial?i:t).get(w.envMap||R),N=!!G&&G.mapping===Au?G.image.height:null,L=m[w.type];w.precision!==null&&(p=n.getMaxPrecision(w.precision),p!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",p,"instead."));let H=D.morphAttributes.position||D.morphAttributes.normal||D.morphAttributes.color,F=H!==void 0?H.length:0,z=0;D.morphAttributes.position!==void 0&&(z=1),D.morphAttributes.normal!==void 0&&(z=2),D.morphAttributes.color!==void 0&&(z=3);let U,W,Y,K;if(L){let Z=An[L];U=Z.vertexShader,W=Z.fragmentShader}else U=w.vertexShader,W=w.fragmentShader,l.update(w),Y=l.getVertexShaderID(w),K=l.getFragmentShaderID(w);let V=e.getRenderTarget(),ie=w.alphaTest>0,Q=w.clearcoat>0,J=w.iridescence>0;return{isWebGL2:c,shaderID:L,shaderName:w.type,vertexShader:U,fragmentShader:W,defines:w.defines,customVertexShaderID:Y,customFragmentShaderID:K,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:p,instancing:P.isInstancedMesh===!0,instancingColor:P.isInstancedMesh===!0&&P.instanceColor!==null,supportsVertexTextures:d,outputEncoding:V===null?e.outputEncoding:V.isXRRenderTarget===!0?V.texture.encoding:Vn,map:!!w.map,matcap:!!w.matcap,envMap:!!G,envMapMode:G&&G.mapping,envMapCubeUVHeight:N,lightMap:!!w.lightMap,aoMap:!!w.aoMap,emissiveMap:!!w.emissiveMap,bumpMap:!!w.bumpMap,normalMap:!!w.normalMap,objectSpaceNormalMap:w.normalMapType===LR,tangentSpaceNormalMap:w.normalMapType===PR,decodeVideoTexture:!!w.map&&w.map.isVideoTexture===!0&&w.map.encoding===pt,clearcoat:Q,clearcoatMap:Q&&!!w.clearcoatMap,clearcoatRoughnessMap:Q&&!!w.clearcoatRoughnessMap,clearcoatNormalMap:Q&&!!w.clearcoatNormalMap,iridescence:J,iridescenceMap:J&&!!w.iridescenceMap,iridescenceThicknessMap:J&&!!w.iridescenceThicknessMap,displacementMap:!!w.displacementMap,roughnessMap:!!w.roughnessMap,metalnessMap:!!w.metalnessMap,specularMap:!!w.specularMap,specularIntensityMap:!!w.specularIntensityMap,specularColorMap:!!w.specularColorMap,opaque:w.transparent===!1&&w.blending===qa,alphaMap:!!w.alphaMap,alphaTest:ie,gradientMap:!!w.gradientMap,sheen:w.sheen>0,sheenColorMap:!!w.sheenColorMap,sheenRoughnessMap:!!w.sheenRoughnessMap,transmission:w.transmission>0,transmissionMap:!!w.transmissionMap,thicknessMap:!!w.thicknessMap,combine:w.combine,vertexTangents:!!w.normalMap&&!!D.attributes.tangent,vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!D.attributes.color&&D.attributes.color.itemSize===4,vertexUvs:!!w.map||!!w.bumpMap||!!w.normalMap||!!w.specularMap||!!w.alphaMap||!!w.emissiveMap||!!w.roughnessMap||!!w.metalnessMap||!!w.clearcoatMap||!!w.clearcoatRoughnessMap||!!w.clearcoatNormalMap||!!w.iridescenceMap||!!w.iridescenceThicknessMap||!!w.displacementMap||!!w.transmissionMap||!!w.thicknessMap||!!w.specularIntensityMap||!!w.specularColorMap||!!w.sheenColorMap||!!w.sheenRoughnessMap,uvsVertexOnly:!(!!w.map||!!w.bumpMap||!!w.normalMap||!!w.specularMap||!!w.alphaMap||!!w.emissiveMap||!!w.roughnessMap||!!w.metalnessMap||!!w.clearcoatNormalMap||!!w.iridescenceMap||!!w.iridescenceThicknessMap||w.transmission>0||!!w.transmissionMap||!!w.thicknessMap||!!w.specularIntensityMap||!!w.specularColorMap||w.sheen>0||!!w.sheenColorMap||!!w.sheenRoughnessMap)&&!!w.displacementMap,fog:!!k,useFog:w.fog===!0,fogExp2:k&&k.isFogExp2,flatShading:!!w.flatShading,sizeAttenuation:w.sizeAttenuation,logarithmicDepthBuffer:u,skinning:P.isSkinnedMesh===!0,morphTargets:D.morphAttributes.position!==void 0,morphNormals:D.morphAttributes.normal!==void 0,morphColors:D.morphAttributes.color!==void 0,morphTargetsCount:F,morphTextureStride:z,numDirLights:E.directional.length,numPointLights:E.point.length,numSpotLights:E.spot.length,numRectAreaLights:E.rectArea.length,numHemiLights:E.hemi.length,numDirLightShadows:E.directionalShadowMap.length,numPointLightShadows:E.pointShadowMap.length,numSpotLightShadows:E.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:w.dithering,shadowMapEnabled:e.shadowMap.enabled&&T.length>0,shadowMapType:e.shadowMap.type,toneMapping:w.toneMapped?e.toneMapping:ds,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===Lr,flipSided:w.side===Ai,useDepthPacking:!!w.depthPacking,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionDerivatives:w.extensions&&w.extensions.derivatives,extensionFragDepth:w.extensions&&w.extensions.fragDepth,extensionDrawBuffers:w.extensions&&w.extensions.drawBuffers,extensionShaderTextureLOD:w.extensions&&w.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||r.has("EXT_shader_texture_lod"),customProgramCacheKey:w.customProgramCacheKey()}}function f(w){let E=[];if(w.shaderID?E.push(w.shaderID):(E.push(w.customVertexShaderID),E.push(w.customFragmentShaderID)),w.defines!==void 0)for(let T in w.defines)E.push(T),E.push(w.defines[T]);return w.isRawShaderMaterial===!1&&(v(E,w),y(E,w),E.push(e.outputEncoding)),E.push(w.customProgramCacheKey),E.join()}function v(w,E){w.push(E.precision),w.push(E.outputEncoding),w.push(E.envMapMode),w.push(E.envMapCubeUVHeight),w.push(E.combine),w.push(E.vertexUvs),w.push(E.fogExp2),w.push(E.sizeAttenuation),w.push(E.morphTargetsCount),w.push(E.morphAttributeCount),w.push(E.numDirLights),w.push(E.numPointLights),w.push(E.numSpotLights),w.push(E.numHemiLights),w.push(E.numRectAreaLights),w.push(E.numDirLightShadows),w.push(E.numPointLightShadows),w.push(E.numSpotLightShadows),w.push(E.shadowMapType),w.push(E.toneMapping),w.push(E.numClippingPlanes),w.push(E.numClipIntersection),w.push(E.depthPacking)}function y(w,E){o.disableAll(),E.isWebGL2&&o.enable(0),E.supportsVertexTextures&&o.enable(1),E.instancing&&o.enable(2),E.instancingColor&&o.enable(3),E.map&&o.enable(4),E.matcap&&o.enable(5),E.envMap&&o.enable(6),E.lightMap&&o.enable(7),E.aoMap&&o.enable(8),E.emissiveMap&&o.enable(9),E.bumpMap&&o.enable(10),E.normalMap&&o.enable(11),E.objectSpaceNormalMap&&o.enable(12),E.tangentSpaceNormalMap&&o.enable(13),E.clearcoat&&o.enable(14),E.clearcoatMap&&o.enable(15),E.clearcoatRoughnessMap&&o.enable(16),E.clearcoatNormalMap&&o.enable(17),E.iridescence&&o.enable(18),E.iridescenceMap&&o.enable(19),E.iridescenceThicknessMap&&o.enable(20),E.displacementMap&&o.enable(21),E.specularMap&&o.enable(22),E.roughnessMap&&o.enable(23),E.metalnessMap&&o.enable(24),E.gradientMap&&o.enable(25),E.alphaMap&&o.enable(26),E.alphaTest&&o.enable(27),E.vertexColors&&o.enable(28),E.vertexAlphas&&o.enable(29),E.vertexUvs&&o.enable(30),E.vertexTangents&&o.enable(31),E.uvsVertexOnly&&o.enable(32),E.fog&&o.enable(33),w.push(o.mask),o.disableAll(),E.useFog&&o.enable(0),E.flatShading&&o.enable(1),E.logarithmicDepthBuffer&&o.enable(2),E.skinning&&o.enable(3),E.morphTargets&&o.enable(4),E.morphNormals&&o.enable(5),E.morphColors&&o.enable(6),E.premultipliedAlpha&&o.enable(7),E.shadowMapEnabled&&o.enable(8),E.physicallyCorrectLights&&o.enable(9),E.doubleSided&&o.enable(10),E.flipSided&&o.enable(11),E.useDepthPacking&&o.enable(12),E.dithering&&o.enable(13),E.specularIntensityMap&&o.enable(14),E.specularColorMap&&o.enable(15),E.transmission&&o.enable(16),E.transmissionMap&&o.enable(17),E.thicknessMap&&o.enable(18),E.sheen&&o.enable(19),E.sheenColorMap&&o.enable(20),E.sheenRoughnessMap&&o.enable(21),E.decodeVideoTexture&&o.enable(22),E.opaque&&o.enable(23),w.push(o.mask)}function x(w){let E=m[w.type],T;if(E){let C=An[E];T=Fl.clone(C.uniforms)}else T=w.uniforms;return T}function b(w,E){let T;for(let C=0,P=h.length;C<P;C++){let k=h[C];if(k.cacheKey===E){T=k,++T.usedTimes;break}}return T===void 0&&(T=new m4(e,E,w,s),h.push(T)),T}function S(w){if(--w.usedTimes===0){let E=h.indexOf(w);h[E]=h[h.length-1],h.pop(),w.destroy()}}function _(w){l.remove(w)}function A(){l.dispose()}return{getParameters:g,getProgramCacheKey:f,getUniforms:x,acquireProgram:b,releaseProgram:S,releaseShaderCache:_,programs:h,dispose:A}}function b4(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function w4(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ux(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function cx(){let e=[],t=0,i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(u,d,p,m,g,f){let v=e[t];return v===void 0?(v={id:u.id,object:u,geometry:d,material:p,groupOrder:m,renderOrder:u.renderOrder,z:g,group:f},e[t]=v):(v.id=u.id,v.object=u,v.geometry=d,v.material=p,v.groupOrder=m,v.renderOrder=u.renderOrder,v.z=g,v.group=f),t++,v}function o(u,d,p,m,g,f){let v=a(u,d,p,m,g,f);p.transmission>0?r.push(v):p.transparent===!0?n.push(v):i.push(v)}function l(u,d,p,m,g,f){let v=a(u,d,p,m,g,f);p.transmission>0?r.unshift(v):p.transparent===!0?n.unshift(v):i.unshift(v)}function h(u,d){i.length>1&&i.sort(u||w4),r.length>1&&r.sort(d||ux),n.length>1&&n.sort(d||ux)}function c(){for(let u=t,d=e.length;u<d;u++){let p=e[u];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:c,sort:h}}function _4(){let e=new WeakMap;function t(r,n){let s;return e.has(r)===!1?(s=new cx,e.set(r,[s])):n>=e.get(r).length?(s=new cx,e.get(r).push(s)):s=e.get(r)[n],s}function i(){e=new WeakMap}return{get:t,dispose:i}}function S4(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new M,color:new Ze};break;case"SpotLight":i={position:new M,direction:new M,color:new Ze,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new M,color:new Ze,distance:0,decay:0};break;case"HemisphereLight":i={direction:new M,skyColor:new Ze,groundColor:new Ze};break;case"RectAreaLight":i={color:new Ze,position:new M,halfWidth:new M,halfHeight:new M};break}return e[t.id]=i,i}}}function A4(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new q};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new q};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new q,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var E4=0;function T4(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function M4(e,t){let i=new S4,r=A4(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let c=0;c<9;c++)n.probe.push(new M);let s=new M,a=new Fe,o=new Fe;function l(c,u){let d=0,p=0,m=0;for(let E=0;E<9;E++)n.probe[E].set(0,0,0);let g=0,f=0,v=0,y=0,x=0,b=0,S=0,_=0;c.sort(T4);let A=u!==!0?Math.PI:1;for(let E=0,T=c.length;E<T;E++){let C=c[E],P=C.color,k=C.intensity,D=C.distance,R=C.shadow&&C.shadow.map?C.shadow.map.texture:null;if(C.isAmbientLight)d+=P.r*k*A,p+=P.g*k*A,m+=P.b*k*A;else if(C.isLightProbe)for(let G=0;G<9;G++)n.probe[G].addScaledVector(C.sh.coefficients[G],k);else if(C.isDirectionalLight){let G=i.get(C);if(G.color.copy(C.color).multiplyScalar(C.intensity*A),C.castShadow){let N=C.shadow,L=r.get(C);L.shadowBias=N.bias,L.shadowNormalBias=N.normalBias,L.shadowRadius=N.radius,L.shadowMapSize=N.mapSize,n.directionalShadow[g]=L,n.directionalShadowMap[g]=R,n.directionalShadowMatrix[g]=C.shadow.matrix,b++}n.directional[g]=G,g++}else if(C.isSpotLight){let G=i.get(C);if(G.position.setFromMatrixPosition(C.matrixWorld),G.color.copy(P).multiplyScalar(k*A),G.distance=D,G.coneCos=Math.cos(C.angle),G.penumbraCos=Math.cos(C.angle*(1-C.penumbra)),G.decay=C.decay,C.castShadow){let N=C.shadow,L=r.get(C);L.shadowBias=N.bias,L.shadowNormalBias=N.normalBias,L.shadowRadius=N.radius,L.shadowMapSize=N.mapSize,n.spotShadow[v]=L,n.spotShadowMap[v]=R,n.spotShadowMatrix[v]=C.shadow.matrix,_++}n.spot[v]=G,v++}else if(C.isRectAreaLight){let G=i.get(C);G.color.copy(P).multiplyScalar(k),G.halfWidth.set(C.width*.5,0,0),G.halfHeight.set(0,C.height*.5,0),n.rectArea[y]=G,y++}else if(C.isPointLight){let G=i.get(C);if(G.color.copy(C.color).multiplyScalar(C.intensity*A),G.distance=C.distance,G.decay=C.decay,C.castShadow){let N=C.shadow,L=r.get(C);L.shadowBias=N.bias,L.shadowNormalBias=N.normalBias,L.shadowRadius=N.radius,L.shadowMapSize=N.mapSize,L.shadowCameraNear=N.camera.near,L.shadowCameraFar=N.camera.far,n.pointShadow[f]=L,n.pointShadowMap[f]=R,n.pointShadowMatrix[f]=C.shadow.matrix,S++}n.point[f]=G,f++}else if(C.isHemisphereLight){let G=i.get(C);G.skyColor.copy(C.color).multiplyScalar(k*A),G.groundColor.copy(C.groundColor).multiplyScalar(k*A),n.hemi[x]=G,x++}}y>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=we.LTC_FLOAT_1,n.rectAreaLTC2=we.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=we.LTC_HALF_1,n.rectAreaLTC2=we.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=m;let w=n.hash;(w.directionalLength!==g||w.pointLength!==f||w.spotLength!==v||w.rectAreaLength!==y||w.hemiLength!==x||w.numDirectionalShadows!==b||w.numPointShadows!==S||w.numSpotShadows!==_)&&(n.directional.length=g,n.spot.length=v,n.rectArea.length=y,n.point.length=f,n.hemi.length=x,n.directionalShadow.length=b,n.directionalShadowMap.length=b,n.pointShadow.length=S,n.pointShadowMap.length=S,n.spotShadow.length=_,n.spotShadowMap.length=_,n.directionalShadowMatrix.length=b,n.pointShadowMatrix.length=S,n.spotShadowMatrix.length=_,w.directionalLength=g,w.pointLength=f,w.spotLength=v,w.rectAreaLength=y,w.hemiLength=x,w.numDirectionalShadows=b,w.numPointShadows=S,w.numSpotShadows=_,n.version=E4++)}function h(c,u){let d=0,p=0,m=0,g=0,f=0,v=u.matrixWorldInverse;for(let y=0,x=c.length;y<x;y++){let b=c[y];if(b.isDirectionalLight){let S=n.directional[d];S.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(s),S.direction.transformDirection(v),d++}else if(b.isSpotLight){let S=n.spot[m];S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(v),S.direction.setFromMatrixPosition(b.matrixWorld),s.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(s),S.direction.transformDirection(v),m++}else if(b.isRectAreaLight){let S=n.rectArea[g];S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(v),o.identity(),a.copy(b.matrixWorld),a.premultiply(v),o.extractRotation(a),S.halfWidth.set(b.width*.5,0,0),S.halfHeight.set(0,b.height*.5,0),S.halfWidth.applyMatrix4(o),S.halfHeight.applyMatrix4(o),g++}else if(b.isPointLight){let S=n.point[p];S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(v),p++}else if(b.isHemisphereLight){let S=n.hemi[f];S.direction.setFromMatrixPosition(b.matrixWorld),S.direction.transformDirection(v),f++}}}return{setup:l,setupView:h,state:n}}function dx(e,t){let i=new M4(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(c){r.push(c)}function o(c){n.push(c)}function l(c){i.setup(r,c)}function h(c){i.setupView(r,c)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:h,pushLight:a,pushShadow:o}}function C4(e,t){let i=new WeakMap;function r(s,a=0){let o;return i.has(s)===!1?(o=new dx(e,t),i.set(s,[o])):a>=i.get(s).length?(o=new dx(e,t),i.get(s).push(o)):o=i.get(s)[a],o}function n(){i=new WeakMap}return{get:r,dispose:n}}var KA=class extends Tu{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Ss,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},D4=class extends Tu{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new M,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},P4=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,L4=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function O4(e,t,i){let r=new $v,n=new q,s=new q,a=new ht,o=new KA({depthPacking:kA}),l=new D4,h={},c=i.maxTextureSize,u={0:Ai,1:ys,2:Lr},d=new ci({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new q},radius:{value:4}},vertexShader:P4,fragmentShader:L4}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let m=new it;m.setAttribute("position",new at(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new Gi(m,d),f=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Xv,this.render=function(b,S,_){if(f.enabled===!1||f.autoUpdate===!1&&f.needsUpdate===!1||b.length===0)return;let A=e.getRenderTarget(),w=e.getActiveCubeFace(),E=e.getActiveMipmapLevel(),T=e.state;T.setBlending(Ei),T.buffers.color.setClear(1,1,1,1),T.buffers.depth.setTest(!0),T.setScissorTest(!1);for(let C=0,P=b.length;C<P;C++){let k=b[C],D=k.shadow;if(D===void 0){console.warn("THREE.WebGLShadowMap:",k,"has no shadow.");continue}if(D.autoUpdate===!1&&D.needsUpdate===!1)continue;n.copy(D.mapSize);let R=D.getFrameExtents();if(n.multiply(R),s.copy(D.mapSize),(n.x>c||n.y>c)&&(n.x>c&&(s.x=Math.floor(c/R.x),n.x=s.x*R.x,D.mapSize.x=s.x),n.y>c&&(s.y=Math.floor(c/R.y),n.y=s.y*R.y,D.mapSize.y=s.y)),D.map===null){let N=this.type!==Th?{minFilter:Xt,magFilter:Xt}:{};D.map=new ri(n.x,n.y,N),D.map.texture.name=k.name+".shadowMap",D.camera.updateProjectionMatrix()}e.setRenderTarget(D.map),e.clear();let G=D.getViewportCount();for(let N=0;N<G;N++){let L=D.getViewport(N);a.set(s.x*L.x,s.y*L.y,s.x*L.z,s.y*L.w),T.viewport(a),D.updateMatrices(k,N),r=D.getFrustum(),x(S,_,D.camera,k,this.type)}D.isPointLightShadow!==!0&&this.type===Th&&v(D,_),D.needsUpdate=!1}f.needsUpdate=!1,e.setRenderTarget(A,w,E)};function v(b,S){let _=t.update(g);d.defines.VSM_SAMPLES!==b.blurSamples&&(d.defines.VSM_SAMPLES=b.blurSamples,p.defines.VSM_SAMPLES=b.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),b.mapPass===null&&(b.mapPass=new ri(n.x,n.y)),d.uniforms.shadow_pass.value=b.map.texture,d.uniforms.resolution.value=b.mapSize,d.uniforms.radius.value=b.radius,e.setRenderTarget(b.mapPass),e.clear(),e.renderBufferDirect(S,null,_,d,g,null),p.uniforms.shadow_pass.value=b.mapPass.texture,p.uniforms.resolution.value=b.mapSize,p.uniforms.radius.value=b.radius,e.setRenderTarget(b.map),e.clear(),e.renderBufferDirect(S,null,_,p,g,null)}function y(b,S,_,A,w,E){let T=null,C=_.isPointLight===!0?b.customDistanceMaterial:b.customDepthMaterial;if(C!==void 0?T=C:T=_.isPointLight===!0?l:o,e.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0){let P=T.uuid,k=S.uuid,D=h[P];D===void 0&&(D={},h[P]=D);let R=D[k];R===void 0&&(R=T.clone(),D[k]=R),T=R}return T.visible=S.visible,T.wireframe=S.wireframe,E===Th?T.side=S.shadowSide!==null?S.shadowSide:S.side:T.side=S.shadowSide!==null?S.shadowSide:u[S.side],T.alphaMap=S.alphaMap,T.alphaTest=S.alphaTest,T.clipShadows=S.clipShadows,T.clippingPlanes=S.clippingPlanes,T.clipIntersection=S.clipIntersection,T.displacementMap=S.displacementMap,T.displacementScale=S.displacementScale,T.displacementBias=S.displacementBias,T.wireframeLinewidth=S.wireframeLinewidth,T.linewidth=S.linewidth,_.isPointLight===!0&&T.isMeshDistanceMaterial===!0&&(T.referencePosition.setFromMatrixPosition(_.matrixWorld),T.nearDistance=A,T.farDistance=w),T}function x(b,S,_,A,w){if(b.visible===!1)return;if(b.layers.test(S.layers)&&(b.isMesh||b.isLine||b.isPoints)&&(b.castShadow||b.receiveShadow&&w===Th)&&(!b.frustumCulled||r.intersectsObject(b))){b.modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,b.matrixWorld);let T=t.update(b),C=b.material;if(Array.isArray(C)){let P=T.groups;for(let k=0,D=P.length;k<D;k++){let R=P[k],G=C[R.materialIndex];if(G&&G.visible){let N=y(b,G,A,_.near,_.far,w);e.renderBufferDirect(_,null,T,N,b,R)}}}else if(C.visible){let P=y(b,C,A,_.near,_.far,w);e.renderBufferDirect(_,null,T,P,b,null)}}let E=b.children;for(let T=0,C=E.length;T<C;T++)x(E[T],S,_,A,w)}}function R4(e,t,i){let r=i.isWebGL2;function n(){let j=!1,Ee=new ht,be=null,Je=new ht(0,0,0,0);return{setMask:function(Ie){be!==Ie&&!j&&(e.colorMask(Ie,Ie,Ie,Ie),be=Ie)},setLocked:function(Ie){j=Ie},setClear:function(Ie,et,xe,We,Pe){Pe===!0&&(Ie*=We,et*=We,xe*=We),Ee.set(Ie,et,xe,We),Je.equals(Ee)===!1&&(e.clearColor(Ie,et,xe,We),Je.copy(Ee))},reset:function(){j=!1,be=null,Je.set(-1,0,0,0)}}}function s(){let j=!1,Ee=null,be=null,Je=null;return{setTest:function(Ie){Ie?K(2929):V(2929)},setMask:function(Ie){Ee!==Ie&&!j&&(e.depthMask(Ie),Ee=Ie)},setFunc:function(Ie){if(be!==Ie){if(Ie)switch(Ie){case eR:e.depthFunc(512);break;case tR:e.depthFunc(519);break;case iR:e.depthFunc(513);break;case rg:e.depthFunc(515);break;case rR:e.depthFunc(514);break;case nR:e.depthFunc(518);break;case sR:e.depthFunc(516);break;case aR:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);be=Ie}},setLocked:function(Ie){j=Ie},setClear:function(Ie){Je!==Ie&&(e.clearDepth(Ie),Je=Ie)},reset:function(){j=!1,Ee=null,be=null,Je=null}}}function a(){let j=!1,Ee=null,be=null,Je=null,Ie=null,et=null,xe=null,We=null,Pe=null;return{setTest:function(Ce){j||(Ce?K(2960):V(2960))},setMask:function(Ce){Ee!==Ce&&!j&&(e.stencilMask(Ce),Ee=Ce)},setFunc:function(Ce,Ve,nt){(be!==Ce||Je!==Ve||Ie!==nt)&&(e.stencilFunc(Ce,Ve,nt),be=Ce,Je=Ve,Ie=nt)},setOp:function(Ce,Ve,nt){(et!==Ce||xe!==Ve||We!==nt)&&(e.stencilOp(Ce,Ve,nt),et=Ce,xe=Ve,We=nt)},setLocked:function(Ce){j=Ce},setClear:function(Ce){Pe!==Ce&&(e.clearStencil(Ce),Pe=Ce)},reset:function(){j=!1,Ee=null,be=null,Je=null,Ie=null,et=null,xe=null,We=null,Pe=null}}}let o=new n,l=new s,h=new a,c={},u={},d=new WeakMap,p=[],m=null,g=!1,f=null,v=null,y=null,x=null,b=null,S=null,_=null,A=!1,w=null,E=null,T=null,C=null,P=null,k=e.getParameter(35661),D=!1,R=0,G=e.getParameter(7938);G.indexOf("WebGL")!==-1?(R=parseFloat(/^WebGL (\d)/.exec(G)[1]),D=R>=1):G.indexOf("OpenGL ES")!==-1&&(R=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),D=R>=2);let N=null,L={},H=e.getParameter(3088),F=e.getParameter(2978),z=new ht().fromArray(H),U=new ht().fromArray(F);function W(j,Ee,be){let Je=new Uint8Array(4),Ie=e.createTexture();e.bindTexture(j,Ie),e.texParameteri(j,10241,9728),e.texParameteri(j,10240,9728);for(let et=0;et<be;et++)e.texImage2D(Ee+et,0,6408,1,1,0,6408,5121,Je);return Ie}let Y={};Y[3553]=W(3553,3553,1),Y[34067]=W(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),h.setClear(0),K(2929),l.setFunc(rg),ge(!1),pe(r1),K(2884),de(Ei);function K(j){c[j]!==!0&&(e.enable(j),c[j]=!0)}function V(j){c[j]!==!1&&(e.disable(j),c[j]=!1)}function ie(j,Ee){return u[j]!==Ee?(e.bindFramebuffer(j,Ee),u[j]=Ee,r&&(j===36009&&(u[36160]=Ee),j===36160&&(u[36009]=Ee)),!0):!1}function Q(j,Ee){let be=p,Je=!1;if(j)if(be=d.get(Ee),be===void 0&&(be=[],d.set(Ee,be)),j.isWebGLMultipleRenderTargets){let Ie=j.texture;if(be.length!==Ie.length||be[0]!==36064){for(let et=0,xe=Ie.length;et<xe;et++)be[et]=36064+et;be.length=Ie.length,Je=!0}}else be[0]!==36064&&(be[0]=36064,Je=!0);else be[0]!==1029&&(be[0]=1029,Je=!0);Je&&(i.isWebGL2?e.drawBuffers(be):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(be))}function J(j){return m!==j?(e.useProgram(j),m=j,!0):!1}let Z={[qo]:32774,[VO]:32778,[jO]:32779};if(r)Z[o1]=32775,Z[l1]=32776;else{let j=t.get("EXT_blend_minmax");j!==null&&(Z[o1]=j.MIN_EXT,Z[l1]=j.MAX_EXT)}let ue={[WO]:0,[qO]:1,[YO]:768,[OA]:770,[$O]:776,[ZO]:774,[QO]:772,[XO]:769,[RA]:771,[JO]:775,[KO]:773};function de(j,Ee,be,Je,Ie,et,xe,We){if(j===Ei){g===!0&&(V(3042),g=!1);return}if(g===!1&&(K(3042),g=!0),j!==HO){if(j!==f||We!==A){if((v!==qo||b!==qo)&&(e.blendEquation(32774),v=qo,b=qo),We)switch(j){case qa:e.blendFuncSeparate(1,771,1,771);break;case n1:e.blendFunc(1,1);break;case s1:e.blendFuncSeparate(0,769,0,1);break;case a1:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",j);break}else switch(j){case qa:e.blendFuncSeparate(770,771,1,771);break;case n1:e.blendFunc(770,1);break;case s1:e.blendFuncSeparate(0,769,0,1);break;case a1:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",j);break}y=null,x=null,S=null,_=null,f=j,A=We}return}Ie=Ie||Ee,et=et||be,xe=xe||Je,(Ee!==v||Ie!==b)&&(e.blendEquationSeparate(Z[Ee],Z[Ie]),v=Ee,b=Ie),(be!==y||Je!==x||et!==S||xe!==_)&&(e.blendFuncSeparate(ue[be],ue[Je],ue[et],ue[xe]),y=be,x=Je,S=et,_=xe),f=j,A=null}function he(j,Ee){j.side===Lr?V(2884):K(2884);let be=j.side===Ai;Ee&&(be=!be),ge(be),j.blending===qa&&j.transparent===!1?de(Ei):de(j.blending,j.blendEquation,j.blendSrc,j.blendDst,j.blendEquationAlpha,j.blendSrcAlpha,j.blendDstAlpha,j.premultipliedAlpha),l.setFunc(j.depthFunc),l.setTest(j.depthTest),l.setMask(j.depthWrite),o.setMask(j.colorWrite);let Je=j.stencilWrite;h.setTest(Je),Je&&(h.setMask(j.stencilWriteMask),h.setFunc(j.stencilFunc,j.stencilRef,j.stencilFuncMask),h.setOp(j.stencilFail,j.stencilZFail,j.stencilZPass)),Re(j.polygonOffset,j.polygonOffsetFactor,j.polygonOffsetUnits),j.alphaToCoverage===!0?K(32926):V(32926)}function ge(j){w!==j&&(j?e.frontFace(2304):e.frontFace(2305),w=j)}function pe(j){j!==FO?(K(2884),j!==E&&(j===r1?e.cullFace(1029):j===zO?e.cullFace(1028):e.cullFace(1032))):V(2884),E=j}function ve(j){j!==T&&(D&&e.lineWidth(j),T=j)}function Re(j,Ee,be){j?(K(32823),(C!==Ee||P!==be)&&(e.polygonOffset(Ee,be),C=Ee,P=be)):V(32823)}function Te(j){j?K(3089):V(3089)}function Me(j){j===void 0&&(j=33984+k-1),N!==j&&(e.activeTexture(j),N=j)}function yt(j,Ee){N===null&&Me();let be=L[N];be===void 0&&(be={type:void 0,texture:void 0},L[N]=be),(be.type!==j||be.texture!==Ee)&&(e.bindTexture(j,Ee||Y[j]),be.type=j,be.texture=Ee)}function Ge(){let j=L[N];j!==void 0&&j.type!==void 0&&(e.bindTexture(j.type,null),j.type=void 0,j.texture=void 0)}function B(){try{e.compressedTexImage2D.apply(e,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function O(){try{e.texSubImage2D.apply(e,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function ne(){try{e.texSubImage3D.apply(e,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function fe(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function ye(){try{e.texStorage2D.apply(e,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function Ae(){try{e.texStorage3D.apply(e,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function Xe(){try{e.texImage2D.apply(e,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function se(){try{e.texImage3D.apply(e,arguments)}catch(j){console.error("THREE.WebGLState:",j)}}function je(j){z.equals(j)===!1&&(e.scissor(j.x,j.y,j.z,j.w),z.copy(j))}function _e(j){U.equals(j)===!1&&(e.viewport(j.x,j.y,j.z,j.w),U.copy(j))}function Se(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},N=null,L={},u={},d=new WeakMap,p=[],m=null,g=!1,f=null,v=null,y=null,x=null,b=null,S=null,_=null,A=!1,w=null,E=null,T=null,C=null,P=null,z.set(0,0,e.canvas.width,e.canvas.height),U.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),h.reset()}return{buffers:{color:o,depth:l,stencil:h},enable:K,disable:V,bindFramebuffer:ie,drawBuffers:Q,useProgram:J,setBlending:de,setMaterial:he,setFlipSided:ge,setCullFace:pe,setLineWidth:ve,setPolygonOffset:Re,setScissorTest:Te,activeTexture:Me,bindTexture:yt,unbindTexture:Ge,compressedTexImage2D:B,texImage2D:Xe,texImage3D:se,texStorage2D:ye,texStorage3D:Ae,texSubImage2D:O,texSubImage3D:ne,compressedTexSubImage2D:fe,scissor:je,viewport:_e,reset:Se}}function I4(e,t,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,h=n.maxCubemapSize,c=n.maxTextureSize,u=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap,g,f=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(B,O){return v?new OffscreenCanvas(B,O):bd("canvas")}function x(B,O,ne,fe){let ye=1;if((B.width>fe||B.height>fe)&&(ye=fe/Math.max(B.width,B.height)),ye<1||O===!0)if(typeof HTMLImageElement<"u"&&B instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&B instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&B instanceof ImageBitmap){let Ae=O?xd:Math.floor,Xe=Ae(ye*B.width),se=Ae(ye*B.height);g===void 0&&(g=y(Xe,se));let je=ne?y(Xe,se):g;return je.width=Xe,je.height=se,je.getContext("2d").drawImage(B,0,0,Xe,se),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+B.width+"x"+B.height+") to ("+Xe+"x"+se+")."),je}else return"data"in B&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+B.width+"x"+B.height+")."),B;return B}function b(B){return hg(B.width)&&hg(B.height)}function S(B){return o?!1:B.wrapS!==or||B.wrapT!==or||B.minFilter!==Xt&&B.minFilter!==Ot}function _(B,O){return B.generateMipmaps&&O&&B.minFilter!==Xt&&B.minFilter!==Ot}function A(B){e.generateMipmap(B)}function w(B,O,ne,fe,ye=!1){if(o===!1)return O;if(B!==null){if(e[B]!==void 0)return e[B];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+B+"'")}let Ae=O;return O===6403&&(ne===5126&&(Ae=33326),ne===5131&&(Ae=33325),ne===5121&&(Ae=33321)),O===33319&&(ne===5126&&(Ae=33328),ne===5131&&(Ae=33327),ne===5121&&(Ae=33323)),O===6408&&(ne===5126&&(Ae=34836),ne===5131&&(Ae=34842),ne===5121&&(Ae=fe===pt&&ye===!1?35907:32856),ne===32819&&(Ae=32854),ne===32820&&(Ae=32855)),(Ae===33325||Ae===33326||Ae===33327||Ae===33328||Ae===34842||Ae===34836)&&t.get("EXT_color_buffer_float"),Ae}function E(B,O,ne){return _(B,ne)===!0||B.isFramebufferTexture&&B.minFilter!==Xt&&B.minFilter!==Ot?Math.log2(Math.max(O.width,O.height))+1:B.mipmaps!==void 0&&B.mipmaps.length>0?B.mipmaps.length:B.isCompressedTexture&&Array.isArray(B.image)?O.mipmaps.length:1}function T(B){return B===Xt||B===h1||B===u1?9728:9729}function C(B){let O=B.target;O.removeEventListener("dispose",C),k(O),O.isVideoTexture&&m.delete(O)}function P(B){let O=B.target;O.removeEventListener("dispose",P),R(O)}function k(B){let O=r.get(B);if(O.__webglInit===void 0)return;let ne=B.source,fe=f.get(ne);if(fe){let ye=fe[O.__cacheKey];ye.usedTimes--,ye.usedTimes===0&&D(B),Object.keys(fe).length===0&&f.delete(ne)}r.remove(B)}function D(B){let O=r.get(B);e.deleteTexture(O.__webglTexture);let ne=B.source,fe=f.get(ne);delete fe[O.__cacheKey],a.memory.textures--}function R(B){let O=B.texture,ne=r.get(B),fe=r.get(O);if(fe.__webglTexture!==void 0&&(e.deleteTexture(fe.__webglTexture),a.memory.textures--),B.depthTexture&&B.depthTexture.dispose(),B.isWebGLCubeRenderTarget)for(let ye=0;ye<6;ye++)e.deleteFramebuffer(ne.__webglFramebuffer[ye]),ne.__webglDepthbuffer&&e.deleteRenderbuffer(ne.__webglDepthbuffer[ye]);else{if(e.deleteFramebuffer(ne.__webglFramebuffer),ne.__webglDepthbuffer&&e.deleteRenderbuffer(ne.__webglDepthbuffer),ne.__webglMultisampledFramebuffer&&e.deleteFramebuffer(ne.__webglMultisampledFramebuffer),ne.__webglColorRenderbuffer)for(let ye=0;ye<ne.__webglColorRenderbuffer.length;ye++)ne.__webglColorRenderbuffer[ye]&&e.deleteRenderbuffer(ne.__webglColorRenderbuffer[ye]);ne.__webglDepthRenderbuffer&&e.deleteRenderbuffer(ne.__webglDepthRenderbuffer)}if(B.isWebGLMultipleRenderTargets)for(let ye=0,Ae=O.length;ye<Ae;ye++){let Xe=r.get(O[ye]);Xe.__webglTexture&&(e.deleteTexture(Xe.__webglTexture),a.memory.textures--),r.remove(O[ye])}r.remove(O),r.remove(B)}let G=0;function N(){G=0}function L(){let B=G;return B>=l&&console.warn("THREE.WebGLTextures: Trying to use "+B+" texture units while this GPU supports only "+l),G+=1,B}function H(B){let O=[];return O.push(B.wrapS),O.push(B.wrapT),O.push(B.magFilter),O.push(B.minFilter),O.push(B.anisotropy),O.push(B.internalFormat),O.push(B.format),O.push(B.type),O.push(B.generateMipmaps),O.push(B.premultiplyAlpha),O.push(B.flipY),O.push(B.unpackAlignment),O.push(B.encoding),O.join()}function F(B,O){let ne=r.get(B);if(B.isVideoTexture&&yt(B),B.isRenderTargetTexture===!1&&B.version>0&&ne.__version!==B.version){let fe=B.image;if(fe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(fe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Q(ne,B,O);return}}i.activeTexture(33984+O),i.bindTexture(3553,ne.__webglTexture)}function z(B,O){let ne=r.get(B);if(B.version>0&&ne.__version!==B.version){Q(ne,B,O);return}i.activeTexture(33984+O),i.bindTexture(35866,ne.__webglTexture)}function U(B,O){let ne=r.get(B);if(B.version>0&&ne.__version!==B.version){Q(ne,B,O);return}i.activeTexture(33984+O),i.bindTexture(32879,ne.__webglTexture)}function W(B,O){let ne=r.get(B);if(B.version>0&&ne.__version!==B.version){J(ne,B,O);return}i.activeTexture(33984+O),i.bindTexture(34067,ne.__webglTexture)}let Y={[Kh]:10497,[or]:33071,[ag]:33648},K={[Xt]:9728,[h1]:9984,[u1]:9986,[Ot]:9729,[fR]:9985,[Eu]:9987};function V(B,O,ne){if(ne?(e.texParameteri(B,10242,Y[O.wrapS]),e.texParameteri(B,10243,Y[O.wrapT]),(B===32879||B===35866)&&e.texParameteri(B,32882,Y[O.wrapR]),e.texParameteri(B,10240,K[O.magFilter]),e.texParameteri(B,10241,K[O.minFilter])):(e.texParameteri(B,10242,33071),e.texParameteri(B,10243,33071),(B===32879||B===35866)&&e.texParameteri(B,32882,33071),(O.wrapS!==or||O.wrapT!==or)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(B,10240,T(O.magFilter)),e.texParameteri(B,10241,T(O.minFilter)),O.minFilter!==Xt&&O.minFilter!==Ot&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let fe=t.get("EXT_texture_filter_anisotropic");if(O.type===Ys&&t.has("OES_texture_float_linear")===!1||o===!1&&O.type===Zh&&t.has("OES_texture_half_float_linear")===!1)return;(O.anisotropy>1||r.get(O).__currentAnisotropy)&&(e.texParameterf(B,fe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(O.anisotropy,n.getMaxAnisotropy())),r.get(O).__currentAnisotropy=O.anisotropy)}}function ie(B,O){let ne=!1;B.__webglInit===void 0&&(B.__webglInit=!0,O.addEventListener("dispose",C));let fe=O.source,ye=f.get(fe);ye===void 0&&(ye={},f.set(fe,ye));let Ae=H(O);if(Ae!==B.__cacheKey){ye[Ae]===void 0&&(ye[Ae]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,ne=!0),ye[Ae].usedTimes++;let Xe=ye[B.__cacheKey];Xe!==void 0&&(ye[B.__cacheKey].usedTimes--,Xe.usedTimes===0&&D(O)),B.__cacheKey=Ae,B.__webglTexture=ye[Ae].texture}return ne}function Q(B,O,ne){let fe=3553;O.isDataArrayTexture&&(fe=35866),O.isData3DTexture&&(fe=32879);let ye=ie(B,O),Ae=O.source;if(i.activeTexture(33984+ne),i.bindTexture(fe,B.__webglTexture),Ae.version!==Ae.__currentVersion||ye===!0){e.pixelStorei(37440,O.flipY),e.pixelStorei(37441,O.premultiplyAlpha),e.pixelStorei(3317,O.unpackAlignment),e.pixelStorei(37443,0);let Xe=S(O)&&b(O.image)===!1,se=x(O.image,Xe,!1,c);se=Ge(O,se);let je=b(se)||o,_e=s.convert(O.format,O.encoding),Se=s.convert(O.type),j=w(O.internalFormat,_e,Se,O.encoding,O.isVideoTexture);V(fe,O,je);let Ee,be=O.mipmaps,Je=o&&O.isVideoTexture!==!0,Ie=Ae.__currentVersion===void 0||ye===!0,et=E(O,se,je);if(O.isDepthTexture)j=6402,o?O.type===Ys?j=36012:O.type===qs?j=33190:O.type===Ya?j=35056:j=33189:O.type===Ys&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),O.format===Xa&&j===6402&&O.type!==NA&&O.type!==qs&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),O.type=qs,Se=s.convert(O.type)),O.format===ro&&j===6402&&(j=34041,O.type!==Ya&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),O.type=Ya,Se=s.convert(O.type))),Ie&&(Je?i.texStorage2D(3553,1,j,se.width,se.height):i.texImage2D(3553,0,j,se.width,se.height,0,_e,Se,null));else if(O.isDataTexture)if(be.length>0&&je){Je&&Ie&&i.texStorage2D(3553,et,j,be[0].width,be[0].height);for(let xe=0,We=be.length;xe<We;xe++)Ee=be[xe],Je?i.texSubImage2D(3553,xe,0,0,Ee.width,Ee.height,_e,Se,Ee.data):i.texImage2D(3553,xe,j,Ee.width,Ee.height,0,_e,Se,Ee.data);O.generateMipmaps=!1}else Je?(Ie&&i.texStorage2D(3553,et,j,se.width,se.height),i.texSubImage2D(3553,0,0,0,se.width,se.height,_e,Se,se.data)):i.texImage2D(3553,0,j,se.width,se.height,0,_e,Se,se.data);else if(O.isCompressedTexture){Je&&Ie&&i.texStorage2D(3553,et,j,be[0].width,be[0].height);for(let xe=0,We=be.length;xe<We;xe++)Ee=be[xe],O.format!==Dn?_e!==null?Je?i.compressedTexSubImage2D(3553,xe,0,0,Ee.width,Ee.height,_e,Ee.data):i.compressedTexImage2D(3553,xe,j,Ee.width,Ee.height,0,Ee.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Je?i.texSubImage2D(3553,xe,0,0,Ee.width,Ee.height,_e,Se,Ee.data):i.texImage2D(3553,xe,j,Ee.width,Ee.height,0,_e,Se,Ee.data)}else if(O.isDataArrayTexture)Je?(Ie&&i.texStorage3D(35866,et,j,se.width,se.height,se.depth),i.texSubImage3D(35866,0,0,0,0,se.width,se.height,se.depth,_e,Se,se.data)):i.texImage3D(35866,0,j,se.width,se.height,se.depth,0,_e,Se,se.data);else if(O.isData3DTexture)Je?(Ie&&i.texStorage3D(32879,et,j,se.width,se.height,se.depth),i.texSubImage3D(32879,0,0,0,0,se.width,se.height,se.depth,_e,Se,se.data)):i.texImage3D(32879,0,j,se.width,se.height,se.depth,0,_e,Se,se.data);else if(O.isFramebufferTexture){if(Ie)if(Je)i.texStorage2D(3553,et,j,se.width,se.height);else{let xe=se.width,We=se.height;for(let Pe=0;Pe<et;Pe++)i.texImage2D(3553,Pe,j,xe,We,0,_e,Se,null),xe>>=1,We>>=1}}else if(be.length>0&&je){Je&&Ie&&i.texStorage2D(3553,et,j,be[0].width,be[0].height);for(let xe=0,We=be.length;xe<We;xe++)Ee=be[xe],Je?i.texSubImage2D(3553,xe,0,0,_e,Se,Ee):i.texImage2D(3553,xe,j,_e,Se,Ee);O.generateMipmaps=!1}else Je?(Ie&&i.texStorage2D(3553,et,j,se.width,se.height),i.texSubImage2D(3553,0,0,0,_e,Se,se)):i.texImage2D(3553,0,j,_e,Se,se);_(O,je)&&A(fe),Ae.__currentVersion=Ae.version,O.onUpdate&&O.onUpdate(O)}B.__version=O.version}function J(B,O,ne){if(O.image.length!==6)return;let fe=ie(B,O),ye=O.source;if(i.activeTexture(33984+ne),i.bindTexture(34067,B.__webglTexture),ye.version!==ye.__currentVersion||fe===!0){e.pixelStorei(37440,O.flipY),e.pixelStorei(37441,O.premultiplyAlpha),e.pixelStorei(3317,O.unpackAlignment),e.pixelStorei(37443,0);let Ae=O.isCompressedTexture||O.image[0].isCompressedTexture,Xe=O.image[0]&&O.image[0].isDataTexture,se=[];for(let xe=0;xe<6;xe++)!Ae&&!Xe?se[xe]=x(O.image[xe],!1,!0,h):se[xe]=Xe?O.image[xe].image:O.image[xe],se[xe]=Ge(O,se[xe]);let je=se[0],_e=b(je)||o,Se=s.convert(O.format,O.encoding),j=s.convert(O.type),Ee=w(O.internalFormat,Se,j,O.encoding),be=o&&O.isVideoTexture!==!0,Je=ye.__currentVersion===void 0||fe===!0,Ie=E(O,je,_e);V(34067,O,_e);let et;if(Ae){be&&Je&&i.texStorage2D(34067,Ie,Ee,je.width,je.height);for(let xe=0;xe<6;xe++){et=se[xe].mipmaps;for(let We=0;We<et.length;We++){let Pe=et[We];O.format!==Dn?Se!==null?be?i.compressedTexSubImage2D(34069+xe,We,0,0,Pe.width,Pe.height,Se,Pe.data):i.compressedTexImage2D(34069+xe,We,Ee,Pe.width,Pe.height,0,Pe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):be?i.texSubImage2D(34069+xe,We,0,0,Pe.width,Pe.height,Se,j,Pe.data):i.texImage2D(34069+xe,We,Ee,Pe.width,Pe.height,0,Se,j,Pe.data)}}}else{et=O.mipmaps,be&&Je&&(et.length>0&&Ie++,i.texStorage2D(34067,Ie,Ee,se[0].width,se[0].height));for(let xe=0;xe<6;xe++)if(Xe){be?i.texSubImage2D(34069+xe,0,0,0,se[xe].width,se[xe].height,Se,j,se[xe].data):i.texImage2D(34069+xe,0,Ee,se[xe].width,se[xe].height,0,Se,j,se[xe].data);for(let We=0;We<et.length;We++){let Pe=et[We].image[xe].image;be?i.texSubImage2D(34069+xe,We+1,0,0,Pe.width,Pe.height,Se,j,Pe.data):i.texImage2D(34069+xe,We+1,Ee,Pe.width,Pe.height,0,Se,j,Pe.data)}}else{be?i.texSubImage2D(34069+xe,0,0,0,Se,j,se[xe]):i.texImage2D(34069+xe,0,Ee,Se,j,se[xe]);for(let We=0;We<et.length;We++){let Pe=et[We];be?i.texSubImage2D(34069+xe,We+1,0,0,Se,j,Pe.image[xe]):i.texImage2D(34069+xe,We+1,Ee,Se,j,Pe.image[xe])}}}_(O,_e)&&A(34067),ye.__currentVersion=ye.version,O.onUpdate&&O.onUpdate(O)}B.__version=O.version}function Z(B,O,ne,fe,ye){let Ae=s.convert(ne.format,ne.encoding),Xe=s.convert(ne.type),se=w(ne.internalFormat,Ae,Xe,ne.encoding);r.get(O).__hasExternalTextures||(ye===32879||ye===35866?i.texImage3D(ye,0,se,O.width,O.height,O.depth,0,Ae,Xe,null):i.texImage2D(ye,0,se,O.width,O.height,0,Ae,Xe,null)),i.bindFramebuffer(36160,B),Me(O)?d.framebufferTexture2DMultisampleEXT(36160,fe,ye,r.get(ne).__webglTexture,0,Te(O)):e.framebufferTexture2D(36160,fe,ye,r.get(ne).__webglTexture,0),i.bindFramebuffer(36160,null)}function ue(B,O,ne){if(e.bindRenderbuffer(36161,B),O.depthBuffer&&!O.stencilBuffer){let fe=33189;if(ne||Me(O)){let ye=O.depthTexture;ye&&ye.isDepthTexture&&(ye.type===Ys?fe=36012:ye.type===qs&&(fe=33190));let Ae=Te(O);Me(O)?d.renderbufferStorageMultisampleEXT(36161,Ae,fe,O.width,O.height):e.renderbufferStorageMultisample(36161,Ae,fe,O.width,O.height)}else e.renderbufferStorage(36161,fe,O.width,O.height);e.framebufferRenderbuffer(36160,36096,36161,B)}else if(O.depthBuffer&&O.stencilBuffer){let fe=Te(O);ne&&Me(O)===!1?e.renderbufferStorageMultisample(36161,fe,35056,O.width,O.height):Me(O)?d.renderbufferStorageMultisampleEXT(36161,fe,35056,O.width,O.height):e.renderbufferStorage(36161,34041,O.width,O.height),e.framebufferRenderbuffer(36160,33306,36161,B)}else{let fe=O.isWebGLMultipleRenderTargets===!0?O.texture:[O.texture];for(let ye=0;ye<fe.length;ye++){let Ae=fe[ye],Xe=s.convert(Ae.format,Ae.encoding),se=s.convert(Ae.type),je=w(Ae.internalFormat,Xe,se,Ae.encoding),_e=Te(O);ne&&Me(O)===!1?e.renderbufferStorageMultisample(36161,_e,je,O.width,O.height):Me(O)?d.renderbufferStorageMultisampleEXT(36161,_e,je,O.width,O.height):e.renderbufferStorage(36161,je,O.width,O.height)}}e.bindRenderbuffer(36161,null)}function de(B,O){if(O&&O.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,B),!(O.depthTexture&&O.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(O.depthTexture).__webglTexture||O.depthTexture.image.width!==O.width||O.depthTexture.image.height!==O.height)&&(O.depthTexture.image.width=O.width,O.depthTexture.image.height=O.height,O.depthTexture.needsUpdate=!0),F(O.depthTexture,0);let ne=r.get(O.depthTexture).__webglTexture,fe=Te(O);if(O.depthTexture.format===Xa)Me(O)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,ne,0,fe):e.framebufferTexture2D(36160,36096,3553,ne,0);else if(O.depthTexture.format===ro)Me(O)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,ne,0,fe):e.framebufferTexture2D(36160,33306,3553,ne,0);else throw new Error("Unknown depthTexture format")}function he(B){let O=r.get(B),ne=B.isWebGLCubeRenderTarget===!0;if(B.depthTexture&&!O.__autoAllocateDepthBuffer){if(ne)throw new Error("target.depthTexture not supported in Cube render targets");de(O.__webglFramebuffer,B)}else if(ne){O.__webglDepthbuffer=[];for(let fe=0;fe<6;fe++)i.bindFramebuffer(36160,O.__webglFramebuffer[fe]),O.__webglDepthbuffer[fe]=e.createRenderbuffer(),ue(O.__webglDepthbuffer[fe],B,!1)}else i.bindFramebuffer(36160,O.__webglFramebuffer),O.__webglDepthbuffer=e.createRenderbuffer(),ue(O.__webglDepthbuffer,B,!1);i.bindFramebuffer(36160,null)}function ge(B,O,ne){let fe=r.get(B);O!==void 0&&Z(fe.__webglFramebuffer,B,B.texture,36064,3553),ne!==void 0&&he(B)}function pe(B){let O=B.texture,ne=r.get(B),fe=r.get(O);B.addEventListener("dispose",P),B.isWebGLMultipleRenderTargets!==!0&&(fe.__webglTexture===void 0&&(fe.__webglTexture=e.createTexture()),fe.__version=O.version,a.memory.textures++);let ye=B.isWebGLCubeRenderTarget===!0,Ae=B.isWebGLMultipleRenderTargets===!0,Xe=b(B)||o;if(ye){ne.__webglFramebuffer=[];for(let se=0;se<6;se++)ne.__webglFramebuffer[se]=e.createFramebuffer()}else{if(ne.__webglFramebuffer=e.createFramebuffer(),Ae)if(n.drawBuffers){let se=B.texture;for(let je=0,_e=se.length;je<_e;je++){let Se=r.get(se[je]);Se.__webglTexture===void 0&&(Se.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&B.samples>0&&Me(B)===!1){let se=Ae?O:[O];ne.__webglMultisampledFramebuffer=e.createFramebuffer(),ne.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,ne.__webglMultisampledFramebuffer);for(let je=0;je<se.length;je++){let _e=se[je];ne.__webglColorRenderbuffer[je]=e.createRenderbuffer(),e.bindRenderbuffer(36161,ne.__webglColorRenderbuffer[je]);let Se=s.convert(_e.format,_e.encoding),j=s.convert(_e.type),Ee=w(_e.internalFormat,Se,j,_e.encoding),be=Te(B);e.renderbufferStorageMultisample(36161,be,Ee,B.width,B.height),e.framebufferRenderbuffer(36160,36064+je,36161,ne.__webglColorRenderbuffer[je])}e.bindRenderbuffer(36161,null),B.depthBuffer&&(ne.__webglDepthRenderbuffer=e.createRenderbuffer(),ue(ne.__webglDepthRenderbuffer,B,!0)),i.bindFramebuffer(36160,null)}}if(ye){i.bindTexture(34067,fe.__webglTexture),V(34067,O,Xe);for(let se=0;se<6;se++)Z(ne.__webglFramebuffer[se],B,O,36064,34069+se);_(O,Xe)&&A(34067),i.unbindTexture()}else if(Ae){let se=B.texture;for(let je=0,_e=se.length;je<_e;je++){let Se=se[je],j=r.get(Se);i.bindTexture(3553,j.__webglTexture),V(3553,Se,Xe),Z(ne.__webglFramebuffer,B,Se,36064+je,3553),_(Se,Xe)&&A(3553)}i.unbindTexture()}else{let se=3553;(B.isWebGL3DRenderTarget||B.isWebGLArrayRenderTarget)&&(o?se=B.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(se,fe.__webglTexture),V(se,O,Xe),Z(ne.__webglFramebuffer,B,O,36064,se),_(O,Xe)&&A(se),i.unbindTexture()}B.depthBuffer&&he(B)}function ve(B){let O=b(B)||o,ne=B.isWebGLMultipleRenderTargets===!0?B.texture:[B.texture];for(let fe=0,ye=ne.length;fe<ye;fe++){let Ae=ne[fe];if(_(Ae,O)){let Xe=B.isWebGLCubeRenderTarget?34067:3553,se=r.get(Ae).__webglTexture;i.bindTexture(Xe,se),A(Xe),i.unbindTexture()}}}function Re(B){if(o&&B.samples>0&&Me(B)===!1){let O=B.isWebGLMultipleRenderTargets?B.texture:[B.texture],ne=B.width,fe=B.height,ye=16384,Ae=[],Xe=B.stencilBuffer?33306:36096,se=r.get(B),je=B.isWebGLMultipleRenderTargets===!0;if(je)for(let _e=0;_e<O.length;_e++)i.bindFramebuffer(36160,se.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+_e,36161,null),i.bindFramebuffer(36160,se.__webglFramebuffer),e.framebufferTexture2D(36009,36064+_e,3553,null,0);i.bindFramebuffer(36008,se.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,se.__webglFramebuffer);for(let _e=0;_e<O.length;_e++){Ae.push(36064+_e),B.depthBuffer&&Ae.push(Xe);let Se=se.__ignoreDepthValues!==void 0?se.__ignoreDepthValues:!1;if(Se===!1&&(B.depthBuffer&&(ye|=256),B.stencilBuffer&&(ye|=1024)),je&&e.framebufferRenderbuffer(36008,36064,36161,se.__webglColorRenderbuffer[_e]),Se===!0&&(e.invalidateFramebuffer(36008,[Xe]),e.invalidateFramebuffer(36009,[Xe])),je){let j=r.get(O[_e]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,j,0)}e.blitFramebuffer(0,0,ne,fe,0,0,ne,fe,ye,9728),p&&e.invalidateFramebuffer(36008,Ae)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),je)for(let _e=0;_e<O.length;_e++){i.bindFramebuffer(36160,se.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+_e,36161,se.__webglColorRenderbuffer[_e]);let Se=r.get(O[_e]).__webglTexture;i.bindFramebuffer(36160,se.__webglFramebuffer),e.framebufferTexture2D(36009,36064+_e,3553,Se,0)}i.bindFramebuffer(36009,se.__webglMultisampledFramebuffer)}}function Te(B){return Math.min(u,B.samples)}function Me(B){let O=r.get(B);return o&&B.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&O.__useRenderToTexture!==!1}function yt(B){let O=a.render.frame;m.get(B)!==O&&(m.set(B,O),B.update())}function Ge(B,O){let ne=B.encoding,fe=B.format,ye=B.type;return B.isCompressedTexture===!0||B.isVideoTexture===!0||B.format===lg||ne!==Vn&&(ne===pt?o===!1?t.has("EXT_sRGB")===!0&&fe===Dn?(B.format=lg,B.minFilter=Ot,B.generateMipmaps=!1):O=zA.sRGBToLinear(O):(fe!==Dn||ye!==Ii)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ne)),O}this.allocateTextureUnit=L,this.resetTextureUnits=N,this.setTexture2D=F,this.setTexture2DArray=z,this.setTexture3D=U,this.setTextureCube=W,this.rebindTextures=ge,this.setupRenderTarget=pe,this.updateRenderTargetMipmap=ve,this.updateMultisampleRenderTarget=Re,this.setupDepthRenderbuffer=he,this.setupFrameBufferTexture=Z,this.useMultisampledRTT=Me}function B4(e,t,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===Ii)return 5121;if(s===yR)return 32819;if(s===xR)return 32820;if(s===mR)return 5120;if(s===gR)return 5122;if(s===NA)return 5123;if(s===vR)return 5124;if(s===qs)return 5125;if(s===Ys)return 5126;if(s===Zh)return r?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===bR)return 6406;if(s===Dn)return 6408;if(s===_R)return 6409;if(s===SR)return 6410;if(s===Xa)return 6402;if(s===ro)return 34041;if(s===AR)return 6403;if(s===wR)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(s===lg)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===ER)return 36244;if(s===TR)return 33319;if(s===MR)return 33320;if(s===CR)return 36249;if(s===Jp||s===$p||s===ef||s===tf)if(a===pt)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===Jp)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===$p)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===ef)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===tf)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===Jp)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===$p)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===ef)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===tf)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===c1||s===d1||s===p1||s===f1)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===c1)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===d1)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===p1)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===f1)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===DR)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===m1||s===g1)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===m1)return a===pt?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===g1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===v1||s===y1||s===x1||s===b1||s===w1||s===_1||s===S1||s===A1||s===E1||s===T1||s===M1||s===C1||s===D1||s===P1)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===v1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===y1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===x1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===b1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===w1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===_1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===S1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===A1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===E1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===T1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===M1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===C1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===D1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===P1)return a===pt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===L1)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===L1)return a===pt?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return s===Ya?r?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}var N4=class extends Oi{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Ch=class extends Ut{constructor(){super(),this.isGroup=!0,this.type="Group"}},k4={type:"move"},Df=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ch,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ch,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new M,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new M),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ch,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new M,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new M),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let m of e.hand.values()){let g=t.getJointPose(m,i);if(l.joints[m.jointName]===void 0){let v=new Ch;v.matrixAutoUpdate=!1,v.visible=!1,l.joints[m.jointName]=v,l.add(v)}let f=l.joints[m.jointName];g!==null&&(f.matrix.fromArray(g.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.jointRadius=g.radius),f.visible=g!==null}let h=l.joints["index-finger-tip"],c=l.joints["thumb-tip"],u=h.position.distanceTo(c.position),d=.02,p=.005;l.inputState.pinching&&u>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&u<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(k4)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}},i0=class extends ji{constructor(e,t,i,r,n,s,a,o,l,h){if(h=h!==void 0?h:Xa,h!==Xa&&h!==ro)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===Xa&&(i=qs),i===void 0&&h===ro&&(i=Ya),super(null,r,n,s,a,o,h,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Xt,this.minFilter=o!==void 0?o:Xt,this.flipY=!1,this.generateMipmaps=!1}},U4=class extends Bi{constructor(e,t){super();let i=this,r=null,n=1,s=null,a="local-floor",o=null,l=null,h=null,c=null,u=null,d=null,p=t.getContextAttributes(),m=null,g=null,f=[],v=[],y=new Oi;y.layers.enable(1),y.viewport=new ht;let x=new Oi;x.layers.enable(2),x.viewport=new ht;let b=[y,x],S=new N4;S.layers.enable(1),S.layers.enable(2);let _=null,A=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(L){let H=f[L];return H===void 0&&(H=new Df,f[L]=H),H.getTargetRaySpace()},this.getControllerGrip=function(L){let H=f[L];return H===void 0&&(H=new Df,f[L]=H),H.getGripSpace()},this.getHand=function(L){let H=f[L];return H===void 0&&(H=new Df,f[L]=H),H.getHandSpace()};function w(L){let H=v.indexOf(L.inputSource);if(H===-1)return;let F=f[H];F!==void 0&&F.dispatchEvent({type:L.type,data:L.inputSource})}function E(){r.removeEventListener("select",w),r.removeEventListener("selectstart",w),r.removeEventListener("selectend",w),r.removeEventListener("squeeze",w),r.removeEventListener("squeezestart",w),r.removeEventListener("squeezeend",w),r.removeEventListener("end",E),r.removeEventListener("inputsourceschange",T);for(let L=0;L<f.length;L++){let H=v[L];H!==null&&(v[L]=null,f[L].disconnect(H))}_=null,A=null,e.setRenderTarget(m),u=null,c=null,h=null,r=null,g=null,N.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(L){n=L,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(L){a=L,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o||s},this.setReferenceSpace=function(L){o=L},this.getBaseLayer=function(){return c!==null?c:u},this.getBinding=function(){return h},this.getFrame=function(){return d},this.getSession=function(){return r},this.setSession=async function(L){if(r=L,r!==null){if(m=e.getRenderTarget(),r.addEventListener("select",w),r.addEventListener("selectstart",w),r.addEventListener("selectend",w),r.addEventListener("squeeze",w),r.addEventListener("squeezestart",w),r.addEventListener("squeezeend",w),r.addEventListener("end",E),r.addEventListener("inputsourceschange",T),p.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let H={antialias:r.renderState.layers===void 0?p.antialias:!0,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:n};u=new XRWebGLLayer(r,t,H),r.updateRenderState({baseLayer:u}),g=new ri(u.framebufferWidth,u.framebufferHeight,{format:Dn,type:Ii,encoding:e.outputEncoding})}else{let H=null,F=null,z=null;p.depth&&(z=p.stencil?35056:33190,H=p.stencil?ro:Xa,F=p.stencil?Ya:qs);let U={colorFormat:32856,depthFormat:z,scaleFactor:n};h=new XRWebGLBinding(r,t),c=h.createProjectionLayer(U),r.updateRenderState({layers:[c]}),g=new ri(c.textureWidth,c.textureHeight,{format:Dn,type:Ii,depthTexture:new i0(c.textureWidth,c.textureHeight,F,void 0,void 0,void 0,void 0,void 0,void 0,H),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0});let W=e.properties.get(g);W.__ignoreDepthValues=c.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(1),o=null,s=await r.requestReferenceSpace(a),N.setContext(r),N.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function T(L){for(let H=0;H<L.removed.length;H++){let F=L.removed[H],z=v.indexOf(F);z>=0&&(v[z]=null,f[z].dispatchEvent({type:"disconnected",data:F}))}for(let H=0;H<L.added.length;H++){let F=L.added[H],z=v.indexOf(F);if(z===-1){for(let W=0;W<f.length;W++)if(W>=v.length){v.push(F),z=W;break}else if(v[W]===null){v[W]=F,z=W;break}if(z===-1)break}let U=f[z];U&&U.dispatchEvent({type:"connected",data:F})}}let C=new M,P=new M;function k(L,H,F){C.setFromMatrixPosition(H.matrixWorld),P.setFromMatrixPosition(F.matrixWorld);let z=C.distanceTo(P),U=H.projectionMatrix.elements,W=F.projectionMatrix.elements,Y=U[14]/(U[10]-1),K=U[14]/(U[10]+1),V=(U[9]+1)/U[5],ie=(U[9]-1)/U[5],Q=(U[8]-1)/U[0],J=(W[8]+1)/W[0],Z=Y*Q,ue=Y*J,de=z/(-Q+J),he=de*-Q;H.matrixWorld.decompose(L.position,L.quaternion,L.scale),L.translateX(he),L.translateZ(de),L.matrixWorld.compose(L.position,L.quaternion,L.scale),L.matrixWorldInverse.copy(L.matrixWorld).invert();let ge=Y+de,pe=K+de,ve=Z-he,Re=ue+(z-he),Te=V*K/pe*ge,Me=ie*K/pe*ge;L.projectionMatrix.makePerspective(ve,Re,Te,Me,ge,pe)}function D(L,H){H===null?L.matrixWorld.copy(L.matrix):L.matrixWorld.multiplyMatrices(H.matrixWorld,L.matrix),L.matrixWorldInverse.copy(L.matrixWorld).invert()}this.updateCamera=function(L){if(r===null)return;S.near=x.near=y.near=L.near,S.far=x.far=y.far=L.far,(_!==S.near||A!==S.far)&&(r.updateRenderState({depthNear:S.near,depthFar:S.far}),_=S.near,A=S.far);let H=L.parent,F=S.cameras;D(S,H);for(let U=0;U<F.length;U++)D(F[U],H);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),L.position.copy(S.position),L.quaternion.copy(S.quaternion),L.scale.copy(S.scale),L.matrix.copy(S.matrix),L.matrixWorld.copy(S.matrixWorld);let z=L.children;for(let U=0,W=z.length;U<W;U++)z[U].updateMatrixWorld(!0);F.length===2?k(S,y,x):S.projectionMatrix.copy(y.projectionMatrix)},this.getCamera=function(){return S},this.getFoveation=function(){if(c!==null)return c.fixedFoveation;if(u!==null)return u.fixedFoveation},this.setFoveation=function(L){c!==null&&(c.fixedFoveation=L),u!==null&&u.fixedFoveation!==void 0&&(u.fixedFoveation=L)};let R=null;function G(L,H){if(l=H.getViewerPose(o||s),d=H,l!==null){let F=l.views;u!==null&&(e.setRenderTargetFramebuffer(g,u.framebuffer),e.setRenderTarget(g));let z=!1;F.length!==S.cameras.length&&(S.cameras.length=0,z=!0);for(let U=0;U<F.length;U++){let W=F[U],Y=null;if(u!==null)Y=u.getViewport(W);else{let V=h.getViewSubImage(c,W);Y=V.viewport,U===0&&(e.setRenderTargetTextures(g,V.colorTexture,c.ignoreDepthValues?void 0:V.depthStencilTexture),e.setRenderTarget(g))}let K=b[U];K===void 0&&(K=new Oi,K.layers.enable(U),K.viewport=new ht,b[U]=K),K.matrix.fromArray(W.transform.matrix),K.projectionMatrix.fromArray(W.projectionMatrix),K.viewport.set(Y.x,Y.y,Y.width,Y.height),U===0&&S.matrix.copy(K.matrix),z===!0&&S.cameras.push(K)}}for(let F=0;F<f.length;F++){let z=v[F],U=f[F];z!==null&&U!==void 0&&U.update(z,H,o||s)}R&&R(L,H),d=null}let N=new jA;N.setAnimationLoop(G),this.setAnimationLoop=function(L){R=L},this.dispose=function(){}}};function F4(e,t){function i(g,f){g.fogColor.value.copy(f.color),f.isFog?(g.fogNear.value=f.near,g.fogFar.value=f.far):f.isFogExp2&&(g.fogDensity.value=f.density)}function r(g,f,v,y,x){f.isMeshBasicMaterial||f.isMeshLambertMaterial?n(g,f):f.isMeshToonMaterial?(n(g,f),c(g,f)):f.isMeshPhongMaterial?(n(g,f),h(g,f)):f.isMeshStandardMaterial?(n(g,f),u(g,f),f.isMeshPhysicalMaterial&&d(g,f,x)):f.isMeshMatcapMaterial?(n(g,f),p(g,f)):f.isMeshDepthMaterial?n(g,f):f.isMeshDistanceMaterial?(n(g,f),m(g,f)):f.isMeshNormalMaterial?n(g,f):f.isLineBasicMaterial?(s(g,f),f.isLineDashedMaterial&&a(g,f)):f.isPointsMaterial?o(g,f,v,y):f.isSpriteMaterial?l(g,f):f.isShadowMaterial?(g.color.value.copy(f.color),g.opacity.value=f.opacity):f.isShaderMaterial&&(f.uniformsNeedUpdate=!1)}function n(g,f){g.opacity.value=f.opacity,f.color&&g.diffuse.value.copy(f.color),f.emissive&&g.emissive.value.copy(f.emissive).multiplyScalar(f.emissiveIntensity),f.map&&(g.map.value=f.map),f.alphaMap&&(g.alphaMap.value=f.alphaMap),f.bumpMap&&(g.bumpMap.value=f.bumpMap,g.bumpScale.value=f.bumpScale,f.side===Ai&&(g.bumpScale.value*=-1)),f.displacementMap&&(g.displacementMap.value=f.displacementMap,g.displacementScale.value=f.displacementScale,g.displacementBias.value=f.displacementBias),f.emissiveMap&&(g.emissiveMap.value=f.emissiveMap),f.normalMap&&(g.normalMap.value=f.normalMap,g.normalScale.value.copy(f.normalScale),f.side===Ai&&g.normalScale.value.negate()),f.specularMap&&(g.specularMap.value=f.specularMap),f.alphaTest>0&&(g.alphaTest.value=f.alphaTest);let v=t.get(f).envMap;if(v&&(g.envMap.value=v,g.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=f.reflectivity,g.ior.value=f.ior,g.refractionRatio.value=f.refractionRatio),f.lightMap){g.lightMap.value=f.lightMap;let b=e.physicallyCorrectLights!==!0?Math.PI:1;g.lightMapIntensity.value=f.lightMapIntensity*b}f.aoMap&&(g.aoMap.value=f.aoMap,g.aoMapIntensity.value=f.aoMapIntensity);let y;f.map?y=f.map:f.specularMap?y=f.specularMap:f.displacementMap?y=f.displacementMap:f.normalMap?y=f.normalMap:f.bumpMap?y=f.bumpMap:f.roughnessMap?y=f.roughnessMap:f.metalnessMap?y=f.metalnessMap:f.alphaMap?y=f.alphaMap:f.emissiveMap?y=f.emissiveMap:f.clearcoatMap?y=f.clearcoatMap:f.clearcoatNormalMap?y=f.clearcoatNormalMap:f.clearcoatRoughnessMap?y=f.clearcoatRoughnessMap:f.iridescenceMap?y=f.iridescenceMap:f.iridescenceThicknessMap?y=f.iridescenceThicknessMap:f.specularIntensityMap?y=f.specularIntensityMap:f.specularColorMap?y=f.specularColorMap:f.transmissionMap?y=f.transmissionMap:f.thicknessMap?y=f.thicknessMap:f.sheenColorMap?y=f.sheenColorMap:f.sheenRoughnessMap&&(y=f.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),g.uvTransform.value.copy(y.matrix));let x;f.aoMap?x=f.aoMap:f.lightMap&&(x=f.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),g.uv2Transform.value.copy(x.matrix))}function s(g,f){g.diffuse.value.copy(f.color),g.opacity.value=f.opacity}function a(g,f){g.dashSize.value=f.dashSize,g.totalSize.value=f.dashSize+f.gapSize,g.scale.value=f.scale}function o(g,f,v,y){g.diffuse.value.copy(f.color),g.opacity.value=f.opacity,g.size.value=f.size*v,g.scale.value=y*.5,f.map&&(g.map.value=f.map),f.alphaMap&&(g.alphaMap.value=f.alphaMap),f.alphaTest>0&&(g.alphaTest.value=f.alphaTest);let x;f.map?x=f.map:f.alphaMap&&(x=f.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),g.uvTransform.value.copy(x.matrix))}function l(g,f){g.diffuse.value.copy(f.color),g.opacity.value=f.opacity,g.rotation.value=f.rotation,f.map&&(g.map.value=f.map),f.alphaMap&&(g.alphaMap.value=f.alphaMap),f.alphaTest>0&&(g.alphaTest.value=f.alphaTest);let v;f.map?v=f.map:f.alphaMap&&(v=f.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),g.uvTransform.value.copy(v.matrix))}function h(g,f){g.specular.value.copy(f.specular),g.shininess.value=Math.max(f.shininess,1e-4)}function c(g,f){f.gradientMap&&(g.gradientMap.value=f.gradientMap)}function u(g,f){g.roughness.value=f.roughness,g.metalness.value=f.metalness,f.roughnessMap&&(g.roughnessMap.value=f.roughnessMap),f.metalnessMap&&(g.metalnessMap.value=f.metalnessMap),t.get(f).envMap&&(g.envMapIntensity.value=f.envMapIntensity)}function d(g,f,v){g.ior.value=f.ior,f.sheen>0&&(g.sheenColor.value.copy(f.sheenColor).multiplyScalar(f.sheen),g.sheenRoughness.value=f.sheenRoughness,f.sheenColorMap&&(g.sheenColorMap.value=f.sheenColorMap),f.sheenRoughnessMap&&(g.sheenRoughnessMap.value=f.sheenRoughnessMap)),f.clearcoat>0&&(g.clearcoat.value=f.clearcoat,g.clearcoatRoughness.value=f.clearcoatRoughness,f.clearcoatMap&&(g.clearcoatMap.value=f.clearcoatMap),f.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=f.clearcoatRoughnessMap),f.clearcoatNormalMap&&(g.clearcoatNormalScale.value.copy(f.clearcoatNormalScale),g.clearcoatNormalMap.value=f.clearcoatNormalMap,f.side===Ai&&g.clearcoatNormalScale.value.negate())),f.iridescence>0&&(g.iridescence.value=f.iridescence,g.iridescenceIOR.value=f.iridescenceIOR,g.iridescenceThicknessMinimum.value=f.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=f.iridescenceThicknessRange[1],f.iridescenceMap&&(g.iridescenceMap.value=f.iridescenceMap),f.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=f.iridescenceThicknessMap)),f.transmission>0&&(g.transmission.value=f.transmission,g.transmissionSamplerMap.value=v.texture,g.transmissionSamplerSize.value.set(v.width,v.height),f.transmissionMap&&(g.transmissionMap.value=f.transmissionMap),g.thickness.value=f.thickness,f.thicknessMap&&(g.thicknessMap.value=f.thicknessMap),g.attenuationDistance.value=f.attenuationDistance,g.attenuationColor.value.copy(f.attenuationColor)),g.specularIntensity.value=f.specularIntensity,g.specularColor.value.copy(f.specularColor),f.specularIntensityMap&&(g.specularIntensityMap.value=f.specularIntensityMap),f.specularColorMap&&(g.specularColorMap.value=f.specularColorMap)}function p(g,f){f.matcap&&(g.matcap.value=f.matcap)}function m(g,f){g.referencePosition.value.copy(f.referencePosition),g.nearDistance.value=f.nearDistance,g.farDistance.value=f.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function z4(){let e=bd("canvas");return e.style.display="block",e}function ZA(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:z4(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",h=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,c;i!==null?c=i.getContextAttributes().alpha:c=e.alpha!==void 0?e.alpha:!1;let u=null,d=null,p=[],m=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Vn,this.physicallyCorrectLights=!1,this.toneMapping=ds,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});let g=this,f=!1,v=0,y=0,x=null,b=-1,S=null,_=new ht,A=new ht,w=null,E=t.width,T=t.height,C=1,P=null,k=null,D=new ht(0,0,E,T),R=new ht(0,0,E,T),G=!1,N=new $v,L=!1,H=!1,F=null,z=new Fe,U=new q,W=new M,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function K(){return x===null?C:1}let V=i;function ie(I,$){for(let ae=0;ae<I.length;ae++){let re=I[ae],ce=t.getContext(re,$);if(ce!==null)return ce}return null}try{let I={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Su}`),t.addEventListener("webglcontextlost",j,!1),t.addEventListener("webglcontextrestored",Ee,!1),t.addEventListener("webglcontextcreationerror",be,!1),V===null){let $=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&$.shift(),V=ie($,I),V===null)throw ie($)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}V.getShaderPrecisionFormat===void 0&&(V.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(I){throw console.error("THREE.WebGLRenderer: "+I.message),I}let Q,J,Z,ue,de,he,ge,pe,ve,Re,Te,Me,yt,Ge,B,O,ne,fe,ye,Ae,Xe,se,je;function _e(){Q=new $N(V),J=new YN(V,Q,e),Q.init(J),se=new B4(V,Q,J),Z=new R4(V,Q,J),ue=new ik,de=new b4,he=new I4(V,Q,Z,de,J,se,ue),ge=new QN(g),pe=new JN(g),ve=new fI(V,J),je=new WN(V,Q,ve,J),Re=new ek(V,ve,ue,je),Te=new ak(V,Re,ve,ue),ye=new sk(V,J,he),O=new XN(de),Me=new x4(g,ge,pe,Q,J,je,O),yt=new F4(g,de),Ge=new _4,B=new C4(Q,J),fe=new jN(g,ge,Z,Te,c,a),ne=new O4(g,Te,J),Ae=new qN(V,Q,ue,J),Xe=new tk(V,Q,ue,J),ue.programs=Me.programs,g.capabilities=J,g.extensions=Q,g.properties=de,g.renderLists=Ge,g.shadowMap=ne,g.state=Z,g.info=ue}_e();let Se=new U4(g,V);this.xr=Se,this.getContext=function(){return V},this.getContextAttributes=function(){return V.getContextAttributes()},this.forceContextLoss=function(){let I=Q.get("WEBGL_lose_context");I&&I.loseContext()},this.forceContextRestore=function(){let I=Q.get("WEBGL_lose_context");I&&I.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(I){I!==void 0&&(C=I,this.setSize(E,T,!1))},this.getSize=function(I){return I.set(E,T)},this.setSize=function(I,$,ae){if(Se.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}E=I,T=$,t.width=Math.floor(I*C),t.height=Math.floor($*C),ae!==!1&&(t.style.width=I+"px",t.style.height=$+"px"),this.setViewport(0,0,I,$)},this.getDrawingBufferSize=function(I){return I.set(E*C,T*C).floor()},this.setDrawingBufferSize=function(I,$,ae){E=I,T=$,C=ae,t.width=Math.floor(I*ae),t.height=Math.floor($*ae),this.setViewport(0,0,I,$)},this.getCurrentViewport=function(I){return I.copy(_)},this.getViewport=function(I){return I.copy(D)},this.setViewport=function(I,$,ae,re){I.isVector4?D.set(I.x,I.y,I.z,I.w):D.set(I,$,ae,re),Z.viewport(_.copy(D).multiplyScalar(C).floor())},this.getScissor=function(I){return I.copy(R)},this.setScissor=function(I,$,ae,re){I.isVector4?R.set(I.x,I.y,I.z,I.w):R.set(I,$,ae,re),Z.scissor(A.copy(R).multiplyScalar(C).floor())},this.getScissorTest=function(){return G},this.setScissorTest=function(I){Z.setScissorTest(G=I)},this.setOpaqueSort=function(I){P=I},this.setTransparentSort=function(I){k=I},this.getClearColor=function(I){return I.copy(fe.getClearColor())},this.setClearColor=function(){fe.setClearColor.apply(fe,arguments)},this.getClearAlpha=function(){return fe.getClearAlpha()},this.setClearAlpha=function(){fe.setClearAlpha.apply(fe,arguments)},this.clear=function(I=!0,$=!0,ae=!0){let re=0;I&&(re|=16384),$&&(re|=256),ae&&(re|=1024),V.clear(re)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",j,!1),t.removeEventListener("webglcontextrestored",Ee,!1),t.removeEventListener("webglcontextcreationerror",be,!1),Ge.dispose(),B.dispose(),de.dispose(),ge.dispose(),pe.dispose(),Te.dispose(),je.dispose(),Me.dispose(),Se.dispose(),Se.removeEventListener("sessionstart",Pe),Se.removeEventListener("sessionend",Ce),F&&(F.dispose(),F=null),Ve.stop()};function j(I){I.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),f=!0}function Ee(){console.log("THREE.WebGLRenderer: Context Restored."),f=!1;let I=ue.autoReset,$=ne.enabled,ae=ne.autoUpdate,re=ne.needsUpdate,ce=ne.type;_e(),ue.autoReset=I,ne.enabled=$,ne.autoUpdate=ae,ne.needsUpdate=re,ne.type=ce}function be(I){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",I.statusMessage)}function Je(I){let $=I.target;$.removeEventListener("dispose",Je),Ie($)}function Ie(I){et(I),de.remove(I)}function et(I){let $=de.get(I).programs;$!==void 0&&($.forEach(function(ae){Me.releaseProgram(ae)}),I.isShaderMaterial&&Me.releaseShaderCache(I))}this.renderBufferDirect=function(I,$,ae,re,ce,Ye){$===null&&($=Y);let ut=ce.isMesh&&ce.matrixWorld.determinant()<0,ct=mi(I,$,ae,re,ce);Z.setMaterial(re,ut);let gt=ae.index,Wt=ae.attributes.position;if(gt===null){if(Wt===void 0||Wt.count===0)return}else if(gt.count===0)return;let vt=1;re.wireframe===!0&&(gt=Re.getWireframeAttribute(ae),vt=2),je.setup(ce,re,ct,ae,gt);let bt,gi=Ae;gt!==null&&(bt=ve.get(gt),gi=Xe,gi.setIndex(bt));let _a=gt!==null?gt.count:Wt.count,mo=ae.drawRange.start*vt,go=ae.drawRange.count*vt,pn=Ye!==null?Ye.start*vt:0,At=Ye!==null?Ye.count*vt:1/0,vo=Math.max(mo,pn),th=Math.min(_a,mo+go,pn+At)-1,fn=Math.max(0,th-vo+1);if(fn!==0){if(ce.isMesh)re.wireframe===!0?(Z.setLineWidth(re.wireframeLinewidth*K()),gi.setMode(1)):gi.setMode(4);else if(ce.isLine){let Es=re.linewidth;Es===void 0&&(Es=1),Z.setLineWidth(Es*K()),ce.isLineSegments?gi.setMode(1):ce.isLineLoop?gi.setMode(2):gi.setMode(3)}else ce.isPoints?gi.setMode(0):ce.isSprite&&gi.setMode(4);if(ce.isInstancedMesh)gi.renderInstances(vo,fn,ce.count);else if(ae.isInstancedBufferGeometry){let Es=Math.min(ae.instanceCount,ae._maxInstanceCount);gi.renderInstances(vo,fn,Es)}else gi.render(vo,fn)}},this.compile=function(I,$){d=B.get(I),d.init(),m.push(d),I.traverseVisible(function(ae){ae.isLight&&ae.layers.test($.layers)&&(d.pushLight(ae),ae.castShadow&&d.pushShadow(ae))}),d.setupLights(g.physicallyCorrectLights),I.traverse(function(ae){let re=ae.material;if(re)if(Array.isArray(re))for(let ce=0;ce<re.length;ce++){let Ye=re[ce];Dt(Ye,I,ae)}else Dt(re,I,ae)}),m.pop(),d=null};let xe=null;function We(I){xe&&xe(I)}function Pe(){Ve.stop()}function Ce(){Ve.start()}let Ve=new jA;Ve.setAnimationLoop(We),typeof self<"u"&&Ve.setContext(self),this.setAnimationLoop=function(I){xe=I,Se.setAnimationLoop(I),I===null?Ve.stop():Ve.start()},Se.addEventListener("sessionstart",Pe),Se.addEventListener("sessionend",Ce),this.render=function(I,$){if($!==void 0&&$.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(f===!0)return;I.autoUpdate===!0&&I.updateMatrixWorld(),$.parent===null&&$.updateMatrixWorld(),Se.enabled===!0&&Se.isPresenting===!0&&(Se.cameraAutoUpdate===!0&&Se.updateCamera($),$=Se.getCamera()),I.isScene===!0&&I.onBeforeRender(g,I,$,x),d=B.get(I,m.length),d.init(),m.push(d),z.multiplyMatrices($.projectionMatrix,$.matrixWorldInverse),N.setFromProjectionMatrix(z),H=this.localClippingEnabled,L=O.init(this.clippingPlanes,H,$),u=Ge.get(I,p.length),u.init(),p.push(u),nt(I,$,0,g.sortObjects),u.finish(),g.sortObjects===!0&&u.sort(P,k),L===!0&&O.beginShadows();let ae=d.state.shadowsArray;if(ne.render(ae,I,$),L===!0&&O.endShadows(),this.info.autoReset===!0&&this.info.reset(),fe.render(u,I),d.setupLights(g.physicallyCorrectLights),$.isArrayCamera){let re=$.cameras;for(let ce=0,Ye=re.length;ce<Ye;ce++){let ut=re[ce];xt(u,I,ut,ut.viewport)}}else xt(u,I,$);x!==null&&(he.updateMultisampleRenderTarget(x),he.updateRenderTargetMipmap(x)),I.isScene===!0&&I.onAfterRender(g,I,$),je.resetDefaultState(),b=-1,S=null,m.pop(),m.length>0?d=m[m.length-1]:d=null,p.pop(),p.length>0?u=p[p.length-1]:u=null};function nt(I,$,ae,re){if(I.visible===!1)return;if(I.layers.test($.layers)){if(I.isGroup)ae=I.renderOrder;else if(I.isLOD)I.autoUpdate===!0&&I.update($);else if(I.isLight)d.pushLight(I),I.castShadow&&d.pushShadow(I);else if(I.isSprite){if(!I.frustumCulled||N.intersectsSprite(I)){re&&W.setFromMatrixPosition(I.matrixWorld).applyMatrix4(z);let Ye=Te.update(I),ut=I.material;ut.visible&&u.push(I,Ye,ut,ae,W.z,null)}}else if((I.isMesh||I.isLine||I.isPoints)&&(I.isSkinnedMesh&&I.skeleton.frame!==ue.render.frame&&(I.skeleton.update(),I.skeleton.frame=ue.render.frame),!I.frustumCulled||N.intersectsObject(I))){re&&W.setFromMatrixPosition(I.matrixWorld).applyMatrix4(z);let Ye=Te.update(I),ut=I.material;if(Array.isArray(ut)){let ct=Ye.groups;for(let gt=0,Wt=ct.length;gt<Wt;gt++){let vt=ct[gt],bt=ut[vt.materialIndex];bt&&bt.visible&&u.push(I,Ye,bt,ae,W.z,vt)}}else ut.visible&&u.push(I,Ye,ut,ae,W.z,null)}}let ce=I.children;for(let Ye=0,ut=ce.length;Ye<ut;Ye++)nt(ce[Ye],$,ae,re)}function xt(I,$,ae,re){let ce=I.opaque,Ye=I.transmissive,ut=I.transparent;d.setupLightsView(ae),Ye.length>0&&Ht(ce,$,ae),re&&Z.viewport(_.copy(re)),ce.length>0&&St(ce,$,ae),Ye.length>0&&St(Ye,$,ae),ut.length>0&&St(ut,$,ae),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function Ht(I,$,ae){let re=J.isWebGL2;F===null&&(F=new ri(1,1,{generateMipmaps:!0,type:Q.has("EXT_color_buffer_half_float")?Zh:Ii,minFilter:Eu,samples:re&&s===!0?4:0})),g.getDrawingBufferSize(U),re?F.setSize(U.x,U.y):F.setSize(xd(U.x),xd(U.y));let ce=g.getRenderTarget();g.setRenderTarget(F),g.clear();let Ye=g.toneMapping;g.toneMapping=ds,St(I,$,ae),g.toneMapping=Ye,he.updateMultisampleRenderTarget(F),he.updateRenderTargetMipmap(F),g.setRenderTarget(ce)}function St(I,$,ae){let re=$.isScene===!0?$.overrideMaterial:null;for(let ce=0,Ye=I.length;ce<Ye;ce++){let ut=I[ce],ct=ut.object,gt=ut.geometry,Wt=re===null?ut.material:re,vt=ut.group;ct.layers.test(ae.layers)&&Bt(ct,$,ae,gt,Wt,vt)}}function Bt(I,$,ae,re,ce,Ye){I.onBeforeRender(g,$,ae,re,ce,Ye),I.modelViewMatrix.multiplyMatrices(ae.matrixWorldInverse,I.matrixWorld),I.normalMatrix.getNormalMatrix(I.modelViewMatrix),ce.onBeforeRender(g,$,ae,re,I,Ye),ce.transparent===!0&&ce.side===Lr?(ce.side=Ai,ce.needsUpdate=!0,g.renderBufferDirect(ae,$,re,ce,I,Ye),ce.side=ys,ce.needsUpdate=!0,g.renderBufferDirect(ae,$,re,ce,I,Ye),ce.side=Lr):g.renderBufferDirect(ae,$,re,ce,I,Ye),I.onAfterRender(g,$,ae,re,ce,Ye)}function Dt(I,$,ae){$.isScene!==!0&&($=Y);let re=de.get(I),ce=d.state.lights,Ye=d.state.shadowsArray,ut=ce.state.version,ct=Me.getParameters(I,ce.state,Ye,$,ae),gt=Me.getProgramCacheKey(ct),Wt=re.programs;re.environment=I.isMeshStandardMaterial?$.environment:null,re.fog=$.fog,re.envMap=(I.isMeshStandardMaterial?pe:ge).get(I.envMap||re.environment),Wt===void 0&&(I.addEventListener("dispose",Je),Wt=new Map,re.programs=Wt);let vt=Wt.get(gt);if(vt!==void 0){if(re.currentProgram===vt&&re.lightsStateVersion===ut)return Nt(I,ct),vt}else ct.uniforms=Me.getUniforms(I),I.onBuild(ae,ct,g),I.onBeforeCompile(ct,g),vt=Me.acquireProgram(ct,gt),Wt.set(gt,vt),re.uniforms=ct.uniforms;let bt=re.uniforms;(!I.isShaderMaterial&&!I.isRawShaderMaterial||I.clipping===!0)&&(bt.clippingPlanes=O.uniform),Nt(I,ct),re.needsLights=Ni(I),re.lightsStateVersion=ut,re.needsLights&&(bt.ambientLightColor.value=ce.state.ambient,bt.lightProbe.value=ce.state.probe,bt.directionalLights.value=ce.state.directional,bt.directionalLightShadows.value=ce.state.directionalShadow,bt.spotLights.value=ce.state.spot,bt.spotLightShadows.value=ce.state.spotShadow,bt.rectAreaLights.value=ce.state.rectArea,bt.ltc_1.value=ce.state.rectAreaLTC1,bt.ltc_2.value=ce.state.rectAreaLTC2,bt.pointLights.value=ce.state.point,bt.pointLightShadows.value=ce.state.pointShadow,bt.hemisphereLights.value=ce.state.hemi,bt.directionalShadowMap.value=ce.state.directionalShadowMap,bt.directionalShadowMatrix.value=ce.state.directionalShadowMatrix,bt.spotShadowMap.value=ce.state.spotShadowMap,bt.spotShadowMatrix.value=ce.state.spotShadowMatrix,bt.pointShadowMap.value=ce.state.pointShadowMap,bt.pointShadowMatrix.value=ce.state.pointShadowMatrix);let gi=vt.getUniforms(),_a=rd.seqWithValue(gi.seq,bt);return re.currentProgram=vt,re.uniformsList=_a,vt}function Nt(I,$){let ae=de.get(I);ae.outputEncoding=$.outputEncoding,ae.instancing=$.instancing,ae.skinning=$.skinning,ae.morphTargets=$.morphTargets,ae.morphNormals=$.morphNormals,ae.morphColors=$.morphColors,ae.morphTargetsCount=$.morphTargetsCount,ae.numClippingPlanes=$.numClippingPlanes,ae.numIntersection=$.numClipIntersection,ae.vertexAlphas=$.vertexAlphas,ae.vertexTangents=$.vertexTangents,ae.toneMapping=$.toneMapping}function mi(I,$,ae,re,ce){$.isScene!==!0&&($=Y),he.resetTextureUnits();let Ye=$.fog,ut=re.isMeshStandardMaterial?$.environment:null,ct=x===null?g.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:Vn,gt=(re.isMeshStandardMaterial?pe:ge).get(re.envMap||ut),Wt=re.vertexColors===!0&&!!ae.attributes.color&&ae.attributes.color.itemSize===4,vt=!!re.normalMap&&!!ae.attributes.tangent,bt=!!ae.morphAttributes.position,gi=!!ae.morphAttributes.normal,_a=!!ae.morphAttributes.color,mo=re.toneMapped?g.toneMapping:ds,go=ae.morphAttributes.position||ae.morphAttributes.normal||ae.morphAttributes.color,pn=go!==void 0?go.length:0,At=de.get(re),vo=d.state.lights;if(L===!0&&(H===!0||I!==S)){let mn=I===S&&re.id===b;O.setState(re,I,mn)}let th=!1;re.version===At.__version?(At.needsLights&&At.lightsStateVersion!==vo.state.version||At.outputEncoding!==ct||ce.isInstancedMesh&&At.instancing===!1||!ce.isInstancedMesh&&At.instancing===!0||ce.isSkinnedMesh&&At.skinning===!1||!ce.isSkinnedMesh&&At.skinning===!0||At.envMap!==gt||re.fog===!0&&At.fog!==Ye||At.numClippingPlanes!==void 0&&(At.numClippingPlanes!==O.numPlanes||At.numIntersection!==O.numIntersection)||At.vertexAlphas!==Wt||At.vertexTangents!==vt||At.morphTargets!==bt||At.morphNormals!==gi||At.morphColors!==_a||At.toneMapping!==mo||J.isWebGL2===!0&&At.morphTargetsCount!==pn)&&(th=!0):(th=!0,At.__version=re.version);let fn=At.currentProgram;th===!0&&(fn=Dt(re,$,ce));let Es=!1,ih=!1,kp=!1,ki=fn.getUniforms(),rh=At.uniforms;if(Z.useProgram(fn.program)&&(Es=!0,ih=!0,kp=!0),re.id!==b&&(b=re.id,ih=!0),Es||S!==I){if(ki.setValue(V,"projectionMatrix",I.projectionMatrix),J.logarithmicDepthBuffer&&ki.setValue(V,"logDepthBufFC",2/(Math.log(I.far+1)/Math.LN2)),S!==I&&(S=I,ih=!0,kp=!0),re.isShaderMaterial||re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshStandardMaterial||re.envMap){let mn=ki.map.cameraPosition;mn!==void 0&&mn.setValue(V,W.setFromMatrixPosition(I.matrixWorld))}(re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshLambertMaterial||re.isMeshBasicMaterial||re.isMeshStandardMaterial||re.isShaderMaterial)&&ki.setValue(V,"isOrthographic",I.isOrthographicCamera===!0),(re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshLambertMaterial||re.isMeshBasicMaterial||re.isMeshStandardMaterial||re.isShaderMaterial||re.isShadowMaterial||ce.isSkinnedMesh)&&ki.setValue(V,"viewMatrix",I.matrixWorldInverse)}if(ce.isSkinnedMesh){ki.setOptional(V,ce,"bindMatrix"),ki.setOptional(V,ce,"bindMatrixInverse");let mn=ce.skeleton;mn&&(J.floatVertexTextures?(mn.boneTexture===null&&mn.computeBoneTexture(),ki.setValue(V,"boneTexture",mn.boneTexture,he),ki.setValue(V,"boneTextureSize",mn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let Up=ae.morphAttributes;return(Up.position!==void 0||Up.normal!==void 0||Up.color!==void 0&&J.isWebGL2===!0)&&ye.update(ce,ae,re,fn),(ih||At.receiveShadow!==ce.receiveShadow)&&(At.receiveShadow=ce.receiveShadow,ki.setValue(V,"receiveShadow",ce.receiveShadow)),ih&&(ki.setValue(V,"toneMappingExposure",g.toneMappingExposure),At.needsLights&&ir(rh,kp),Ye&&re.fog===!0&&yt.refreshFogUniforms(rh,Ye),yt.refreshMaterialUniforms(rh,re,C,T,F),rd.upload(V,At.uniformsList,rh,he)),re.isShaderMaterial&&re.uniformsNeedUpdate===!0&&(rd.upload(V,At.uniformsList,rh,he),re.uniformsNeedUpdate=!1),re.isSpriteMaterial&&ki.setValue(V,"center",ce.center),ki.setValue(V,"modelViewMatrix",ce.modelViewMatrix),ki.setValue(V,"normalMatrix",ce.normalMatrix),ki.setValue(V,"modelMatrix",ce.matrixWorld),fn}function ir(I,$){I.ambientLightColor.needsUpdate=$,I.lightProbe.needsUpdate=$,I.directionalLights.needsUpdate=$,I.directionalLightShadows.needsUpdate=$,I.pointLights.needsUpdate=$,I.pointLightShadows.needsUpdate=$,I.spotLights.needsUpdate=$,I.spotLightShadows.needsUpdate=$,I.rectAreaLights.needsUpdate=$,I.hemisphereLights.needsUpdate=$}function Ni(I){return I.isMeshLambertMaterial||I.isMeshToonMaterial||I.isMeshPhongMaterial||I.isMeshStandardMaterial||I.isShadowMaterial||I.isShaderMaterial&&I.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(I,$,ae){de.get(I.texture).__webglTexture=$,de.get(I.depthTexture).__webglTexture=ae;let re=de.get(I);re.__hasExternalTextures=!0,re.__hasExternalTextures&&(re.__autoAllocateDepthBuffer=ae===void 0,re.__autoAllocateDepthBuffer||Q.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),re.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(I,$){let ae=de.get(I);ae.__webglFramebuffer=$,ae.__useDefaultFramebuffer=$===void 0},this.setRenderTarget=function(I,$=0,ae=0){x=I,v=$,y=ae;let re=!0;if(I){let ct=de.get(I);ct.__useDefaultFramebuffer!==void 0?(Z.bindFramebuffer(36160,null),re=!1):ct.__webglFramebuffer===void 0?he.setupRenderTarget(I):ct.__hasExternalTextures&&he.rebindTextures(I,de.get(I.texture).__webglTexture,de.get(I.depthTexture).__webglTexture)}let ce=null,Ye=!1,ut=!1;if(I){let ct=I.texture;(ct.isData3DTexture||ct.isDataArrayTexture)&&(ut=!0);let gt=de.get(I).__webglFramebuffer;I.isWebGLCubeRenderTarget?(ce=gt[$],Ye=!0):J.isWebGL2&&I.samples>0&&he.useMultisampledRTT(I)===!1?ce=de.get(I).__webglMultisampledFramebuffer:ce=gt,_.copy(I.viewport),A.copy(I.scissor),w=I.scissorTest}else _.copy(D).multiplyScalar(C).floor(),A.copy(R).multiplyScalar(C).floor(),w=G;if(Z.bindFramebuffer(36160,ce)&&J.drawBuffers&&re&&Z.drawBuffers(I,ce),Z.viewport(_),Z.scissor(A),Z.setScissorTest(w),Ye){let ct=de.get(I.texture);V.framebufferTexture2D(36160,36064,34069+$,ct.__webglTexture,ae)}else if(ut){let ct=de.get(I.texture),gt=$||0;V.framebufferTextureLayer(36160,36064,ct.__webglTexture,ae||0,gt)}b=-1},this.readRenderTargetPixels=function(I,$,ae,re,ce,Ye,ut){if(!(I&&I.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ct=de.get(I).__webglFramebuffer;if(I.isWebGLCubeRenderTarget&&ut!==void 0&&(ct=ct[ut]),ct){Z.bindFramebuffer(36160,ct);try{let gt=I.texture,Wt=gt.format,vt=gt.type;if(Wt!==Dn&&se.convert(Wt)!==V.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let bt=vt===Zh&&(Q.has("EXT_color_buffer_half_float")||J.isWebGL2&&Q.has("EXT_color_buffer_float"));if(vt!==Ii&&se.convert(vt)!==V.getParameter(35738)&&!(vt===Ys&&(J.isWebGL2||Q.has("OES_texture_float")||Q.has("WEBGL_color_buffer_float")))&&!bt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}$>=0&&$<=I.width-re&&ae>=0&&ae<=I.height-ce&&V.readPixels($,ae,re,ce,se.convert(Wt),se.convert(vt),Ye)}finally{let gt=x!==null?de.get(x).__webglFramebuffer:null;Z.bindFramebuffer(36160,gt)}}},this.copyFramebufferToTexture=function(I,$,ae=0){let re=Math.pow(2,-ae),ce=Math.floor($.image.width*re),Ye=Math.floor($.image.height*re);he.setTexture2D($,0),V.copyTexSubImage2D(3553,ae,0,0,I.x,I.y,ce,Ye),Z.unbindTexture()},this.copyTextureToTexture=function(I,$,ae,re=0){let ce=$.image.width,Ye=$.image.height,ut=se.convert(ae.format),ct=se.convert(ae.type);he.setTexture2D(ae,0),V.pixelStorei(37440,ae.flipY),V.pixelStorei(37441,ae.premultiplyAlpha),V.pixelStorei(3317,ae.unpackAlignment),$.isDataTexture?V.texSubImage2D(3553,re,I.x,I.y,ce,Ye,ut,ct,$.image.data):$.isCompressedTexture?V.compressedTexSubImage2D(3553,re,I.x,I.y,$.mipmaps[0].width,$.mipmaps[0].height,ut,$.mipmaps[0].data):V.texSubImage2D(3553,re,I.x,I.y,ut,ct,$.image),re===0&&ae.generateMipmaps&&V.generateMipmap(3553),Z.unbindTexture()},this.copyTextureToTexture3D=function(I,$,ae,re,ce=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Ye=I.max.x-I.min.x+1,ut=I.max.y-I.min.y+1,ct=I.max.z-I.min.z+1,gt=se.convert(re.format),Wt=se.convert(re.type),vt;if(re.isData3DTexture)he.setTexture3D(re,0),vt=32879;else if(re.isDataArrayTexture)he.setTexture2DArray(re,0),vt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}V.pixelStorei(37440,re.flipY),V.pixelStorei(37441,re.premultiplyAlpha),V.pixelStorei(3317,re.unpackAlignment);let bt=V.getParameter(3314),gi=V.getParameter(32878),_a=V.getParameter(3316),mo=V.getParameter(3315),go=V.getParameter(32877),pn=ae.isCompressedTexture?ae.mipmaps[0]:ae.image;V.pixelStorei(3314,pn.width),V.pixelStorei(32878,pn.height),V.pixelStorei(3316,I.min.x),V.pixelStorei(3315,I.min.y),V.pixelStorei(32877,I.min.z),ae.isDataTexture||ae.isData3DTexture?V.texSubImage3D(vt,ce,$.x,$.y,$.z,Ye,ut,ct,gt,Wt,pn.data):ae.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),V.compressedTexSubImage3D(vt,ce,$.x,$.y,$.z,Ye,ut,ct,gt,pn.data)):V.texSubImage3D(vt,ce,$.x,$.y,$.z,Ye,ut,ct,gt,Wt,pn),V.pixelStorei(3314,bt),V.pixelStorei(32878,gi),V.pixelStorei(3316,_a),V.pixelStorei(3315,mo),V.pixelStorei(32877,go),ce===0&&re.generateMipmaps&&V.generateMipmap(vt),Z.unbindTexture()},this.initTexture=function(I){I.isCubeTexture?he.setTextureCube(I,0):I.isData3DTexture?he.setTexture3D(I,0):I.isDataArrayTexture?he.setTexture2DArray(I,0):he.setTexture2D(I,0),Z.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,Z.reset(),je.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var G4=class extends ZA{};G4.prototype.isWebGL1Renderer=!0;var JA=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Ze(e),this.near=t,this.far=i}clone(){return new JA(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Ka=class extends Ut{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}},H4=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=og,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=kn()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=kn()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=kn()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},Ui=new M,cg=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Ui.fromBufferAttribute(this,t),Ui.applyMatrix4(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Ui.fromBufferAttribute(this,t),Ui.applyNormalMatrix(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Ui.fromBufferAttribute(this,t),Ui.transformDirection(e),this.setXYZ(t,Ui.x,Ui.y,Ui.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return new at(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new cg(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},V4=class extends at{constructor(e,t,i,r=1){typeof i=="number"&&(r=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},ya=class extends Tu{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ze(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},px=new M,fx=new M,mx=new Fe,Pf=new Ul,vc=new tn,wd=class extends Ut{constructor(e=new it,t=new ya){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,n=t.count;r<n;r++)px.fromBufferAttribute(t,r-1),fx.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=px.distanceTo(fx);e.setAttribute("lineDistance",new Be(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),vc.copy(i.boundingSphere),vc.applyMatrix4(r),vc.radius+=n,e.ray.intersectsSphere(vc)===!1)return;mx.copy(r).invert(),Pf.copy(e.ray).applyMatrix4(mx);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new M,h=new M,c=new M,u=new M,d=this.isLineSegments?2:1,p=i.index,m=i.attributes.position;if(p!==null){let g=Math.max(0,s.start),f=Math.min(p.count,s.start+s.count);for(let v=g,y=f-1;v<y;v+=d){let x=p.getX(v),b=p.getX(v+1);if(l.fromBufferAttribute(m,x),h.fromBufferAttribute(m,b),Pf.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);let S=e.ray.origin.distanceTo(u);S<e.near||S>e.far||t.push({distance:S,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else{let g=Math.max(0,s.start),f=Math.min(m.count,s.start+s.count);for(let v=g,y=f-1;v<y;v+=d){if(l.fromBufferAttribute(m,v),h.fromBufferAttribute(m,v+1),Pf.distanceSqToSegment(l,h,u,c)>o)continue;u.applyMatrix4(this.matrixWorld);let x=e.ray.origin.distanceTo(u);x<e.near||x>e.far||t.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},gx=new M,vx=new M,Mu=class extends wd{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,n=t.count;r<n;r+=2)gx.fromBufferAttribute(t,r),vx.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+gx.distanceTo(vx);e.setAttribute("lineDistance",new Be(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Xn=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,n=i.length,s;t?s=t:s=e*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let h=i[r],c=i[r+1]-h,u=(s-h)/c;return(r+u)/(n-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=t||(n.isVector2?new q:new M);return a.copy(s).sub(n).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new M,r=[],n=[],s=[],a=new M,o=new Fe;for(let d=0;d<=e;d++){let p=d/e;r[d]=this.getTangentAt(p,new M)}n[0]=new M,s[0]=new M;let l=Number.MAX_VALUE,h=Math.abs(r[0].x),c=Math.abs(r[0].y),u=Math.abs(r[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),u<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=e;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(ui(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,p))}s[d].crossVectors(r[d],n[d])}if(t===!0){let d=Math.acos(ui(n[0].dot(n[e]),-1,1));d/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(d=-d);for(let p=1;p<=e;p++)n[p].applyMatrix4(o.makeRotationAxis(r[p],d*p)),s[p].crossVectors(r[p],n[p])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},cp=class extends Xn{constructor(e=0,t=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new q,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+e*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let h=Math.cos(this.aRotation),c=Math.sin(this.aRotation),u=o-this.aX,d=l-this.aY;o=u*h-d*c+this.aX,l=u*c+d*h+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},j4=class extends cp{constructor(e,t,i,r,n,s){super(e,t,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function r0(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,h){n(a,o,h*(o-s),h*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,h,c,u){let d=(a-s)/h-(o-s)/(h+c)+(o-a)/c,p=(o-a)/c-(l-a)/(c+u)+(l-o)/u;d*=c,p*=c,n(a,o,d,p)},calc:function(s){let a=s*s,o=a*s;return e+t*s+i*a+r*o}}}var yc=new M,Lf=new r0,Of=new r0,Rf=new r0,W4=class extends Xn{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new M){let i=t,r=this.points,n=r.length,s=(n-(this.closed?0:1))*e,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,h;this.closed||a>0?l=r[(a-1)%n]:(yc.subVectors(r[0],r[1]).add(r[0]),l=yc);let c=r[a%n],u=r[(a+1)%n];if(this.closed||a+2<n?h=r[(a+2)%n]:(yc.subVectors(r[n-1],r[n-2]).add(r[n-1]),h=yc),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(c),d),m=Math.pow(c.distanceToSquared(u),d),g=Math.pow(u.distanceToSquared(h),d);m<1e-4&&(m=1),p<1e-4&&(p=m),g<1e-4&&(g=m),Lf.initNonuniformCatmullRom(l.x,c.x,u.x,h.x,p,m,g),Of.initNonuniformCatmullRom(l.y,c.y,u.y,h.y,p,m,g),Rf.initNonuniformCatmullRom(l.z,c.z,u.z,h.z,p,m,g)}else this.curveType==="catmullrom"&&(Lf.initCatmullRom(l.x,c.x,u.x,h.x,this.tension),Of.initCatmullRom(l.y,c.y,u.y,h.y,this.tension),Rf.initCatmullRom(l.z,c.z,u.z,h.z,this.tension));return i.set(Lf.calc(o),Of.calc(o),Rf.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new M().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function yx(e,t,i,r,n){let s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function q4(e,t){let i=1-e;return i*i*t}function Y4(e,t){return 2*(1-e)*e*t}function X4(e,t){return e*e*t}function Gh(e,t,i,r){return q4(e,t)+Y4(e,i)+X4(e,r)}function Q4(e,t){let i=1-e;return i*i*i*t}function K4(e,t){let i=1-e;return 3*i*i*e*t}function Z4(e,t){return 3*(1-e)*e*e*t}function J4(e,t){return e*e*e*t}function Hh(e,t,i,r,n){return Q4(e,t)+K4(e,i)+Z4(e,r)+J4(e,n)}var Zr=class extends Xn{constructor(e=new q,t=new q,i=new q,r=new q){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new q){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(Hh(e,r.x,n.x,s.x,a.x),Hh(e,r.y,n.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},$4=class extends Xn{constructor(e=new M,t=new M,i=new M,r=new M){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new M){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(Hh(e,r.x,n.x,s.x,a.x),Hh(e,r.y,n.y,s.y,a.y),Hh(e,r.z,n.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},en=class extends Xn{constructor(e=new q,t=new q){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new q){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new q;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},$A=class extends Xn{constructor(e=new M,t=new M){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new M){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},ha=class extends Xn{constructor(e=new q,t=new q,i=new q){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new q){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(Gh(e,r.x,n.x,s.x),Gh(e,r.y,n.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},eU=class extends Xn{constructor(e=new M,t=new M,i=new M){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new M){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(Gh(e,r.x,n.x,s.x),Gh(e,r.y,n.y,s.y),Gh(e,r.z,n.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},n0=class extends Xn{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new q){let i=t,r=this.points,n=(r.length-1)*e,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],h=r[s>r.length-2?r.length-1:s+1],c=r[s>r.length-3?r.length-1:s+2];return i.set(yx(a,o.x,l.x,h.x,c.x),yx(a,o.y,l.y,h.y,c.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new q().fromArray(r))}return this}},tU=Object.freeze({__proto__:null,ArcCurve:j4,CatmullRomCurve3:W4,CubicBezierCurve:Zr,CubicBezierCurve3:$4,EllipseCurve:cp,LineCurve:en,LineCurve3:$A,QuadraticBezierCurve:ha,QuadraticBezierCurve3:eU,SplineCurve:n0}),iU=class extends Xn{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new en(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let l=0;l<o.length;l++){let h=o[l];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new tU[r.type]().fromJSON(r))}return this}},_d=class extends iU{constructor(e){super(),this.type="Path",this.currentPoint=new q,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new en(this.currentPoint.clone(),new q(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let n=new ha(this.currentPoint.clone(),new q(e,t),new q(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,s){let a=new Zr(this.currentPoint.clone(),new q(e,t),new q(i,r),new q(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new n0(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,r,n,s),this}absarc(e,t,i,r,n,s){return this.absellipse(e,t,i,i,r,n,s),this}ellipse(e,t,i,r,n,s,a,o){let l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+l,t+h,i,r,n,s,a,o),this}absellipse(e,t,i,r,n,s,a,o){let l=new cp(e,t,i,r,n,s,a,o);if(this.curves.length>0){let c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);let h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},eE=class extends it{constructor(e=[new q(0,.5),new q(.5,0),new q(0,-.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=ui(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],h=1/t,c=new M,u=new q,d=new M,p=new M,m=new M,g=0,f=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:g=e[v+1].x-e[v].x,f=e[v+1].y-e[v].y,d.x=f*1,d.y=-g,d.z=f*0,m.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(m.x,m.y,m.z);break;default:g=e[v+1].x-e[v].x,f=e[v+1].y-e[v].y,d.x=f*1,d.y=-g,d.z=f*0,p.copy(d),d.x+=m.x,d.y+=m.y,d.z+=m.z,d.normalize(),o.push(d.x,d.y,d.z),m.copy(p)}for(let v=0;v<=t;v++){let y=i+v*h*r,x=Math.sin(y),b=Math.cos(y);for(let S=0;S<=e.length-1;S++){c.x=e[S].x*x,c.y=e[S].y,c.z=e[S].x*b,s.push(c.x,c.y,c.z),u.x=v/t,u.y=S/(e.length-1),a.push(u.x,u.y);let _=o[3*S+0]*x,A=o[3*S+1],w=o[3*S+0]*b;l.push(_,A,w)}}for(let v=0;v<t;v++)for(let y=0;y<e.length-1;y++){let x=y+v*e.length,b=x,S=x+e.length,_=x+e.length+1,A=x+1;n.push(b,S,A),n.push(_,A,S)}this.setIndex(n),this.setAttribute("position",new Be(s,3)),this.setAttribute("uv",new Be(a,2)),this.setAttribute("normal",new Be(l,3))}static fromJSON(e){return new eE(e.points,e.segments,e.phiStart,e.phiLength)}},s0=class extends it{constructor(e=1,t=1,i=1,r=8,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let h=[],c=[],u=[],d=[],p=0,m=[],g=i/2,f=0;v(),s===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(h),this.setAttribute("position",new Be(c,3)),this.setAttribute("normal",new Be(u,3)),this.setAttribute("uv",new Be(d,2));function v(){let x=new M,b=new M,S=0,_=(t-e)/i;for(let A=0;A<=n;A++){let w=[],E=A/n,T=E*(t-e)+e;for(let C=0;C<=r;C++){let P=C/r,k=P*o+a,D=Math.sin(k),R=Math.cos(k);b.x=T*D,b.y=-E*i+g,b.z=T*R,c.push(b.x,b.y,b.z),x.set(D,_,R).normalize(),u.push(x.x,x.y,x.z),d.push(P,1-E),w.push(p++)}m.push(w)}for(let A=0;A<r;A++)for(let w=0;w<n;w++){let E=m[w][A],T=m[w+1][A],C=m[w+1][A+1],P=m[w][A+1];h.push(E,T,P),h.push(T,C,P),S+=6}l.addGroup(f,S,0),f+=S}function y(x){let b=p,S=new q,_=new M,A=0,w=x===!0?e:t,E=x===!0?1:-1;for(let C=1;C<=r;C++)c.push(0,g*E,0),u.push(0,E,0),d.push(.5,.5),p++;let T=p;for(let C=0;C<=r;C++){let P=C/r*o+a,k=Math.cos(P),D=Math.sin(P);_.x=w*D,_.y=g*E,_.z=w*k,c.push(_.x,_.y,_.z),u.push(0,E,0),S.x=k*.5+.5,S.y=D*.5*E+.5,d.push(S.x,S.y),p++}for(let C=0;C<r;C++){let P=b+C,k=T+C;x===!0?h.push(k,k+1,P):h.push(k+1,k,P),A+=3}l.addGroup(f,A,x===!0?1:2),f+=A}}static fromJSON(e){return new s0(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},tE=class extends s0{constructor(e=1,t=1,i=8,r=1,n=!1,s=0,a=Math.PI*2){super(0,e,t,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(e){return new tE(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},a0=class extends it{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let n=[],s=[];a(r),l(i),h(),this.setAttribute("position",new Be(n,3)),this.setAttribute("normal",new Be(n.slice(),3)),this.setAttribute("uv",new Be(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(v){let y=new M,x=new M,b=new M;for(let S=0;S<t.length;S+=3)d(t[S+0],y),d(t[S+1],x),d(t[S+2],b),o(y,x,b,v)}function o(v,y,x,b){let S=b+1,_=[];for(let A=0;A<=S;A++){_[A]=[];let w=v.clone().lerp(x,A/S),E=y.clone().lerp(x,A/S),T=S-A;for(let C=0;C<=T;C++)C===0&&A===S?_[A][C]=w:_[A][C]=w.clone().lerp(E,C/T)}for(let A=0;A<S;A++)for(let w=0;w<2*(S-A)-1;w++){let E=Math.floor(w/2);w%2===0?(u(_[A][E+1]),u(_[A+1][E]),u(_[A][E])):(u(_[A][E+1]),u(_[A+1][E+1]),u(_[A+1][E]))}}function l(v){let y=new M;for(let x=0;x<n.length;x+=3)y.x=n[x+0],y.y=n[x+1],y.z=n[x+2],y.normalize().multiplyScalar(v),n[x+0]=y.x,n[x+1]=y.y,n[x+2]=y.z}function h(){let v=new M;for(let y=0;y<n.length;y+=3){v.x=n[y+0],v.y=n[y+1],v.z=n[y+2];let x=g(v)/2/Math.PI+.5,b=f(v)/Math.PI+.5;s.push(x,1-b)}p(),c()}function c(){for(let v=0;v<s.length;v+=6){let y=s[v+0],x=s[v+2],b=s[v+4],S=Math.max(y,x,b),_=Math.min(y,x,b);S>.9&&_<.1&&(y<.2&&(s[v+0]+=1),x<.2&&(s[v+2]+=1),b<.2&&(s[v+4]+=1))}}function u(v){n.push(v.x,v.y,v.z)}function d(v,y){let x=v*3;y.x=e[x+0],y.y=e[x+1],y.z=e[x+2]}function p(){let v=new M,y=new M,x=new M,b=new M,S=new q,_=new q,A=new q;for(let w=0,E=0;w<n.length;w+=9,E+=6){v.set(n[w+0],n[w+1],n[w+2]),y.set(n[w+3],n[w+4],n[w+5]),x.set(n[w+6],n[w+7],n[w+8]),S.set(s[E+0],s[E+1]),_.set(s[E+2],s[E+3]),A.set(s[E+4],s[E+5]),b.copy(v).add(y).add(x).divideScalar(3);let T=g(b);m(S,E+0,v,T),m(_,E+2,y,T),m(A,E+4,x,T)}}function m(v,y,x,b){b<0&&v.x===1&&(s[y]=v.x-1),x.x===0&&x.z===0&&(s[y]=b/2/Math.PI+.5)}function g(v){return Math.atan2(v.z,-v.x)}function f(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}static fromJSON(e){return new a0(e.vertices,e.indices,e.radius,e.details)}},iE=class extends a0{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new iE(e.radius,e.detail)}},Sd=class extends _d{constructor(e){super(e),this.uuid=kn(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new _d().fromJSON(r))}return this}},rU={triangulate:function(e,t,i=2){let r=t&&t.length,n=r?t[0]*i:e.length,s=rE(e,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,h,c,u,d,p;if(r&&(s=lU(e,t,s,i)),e.length>80*i){o=h=e[0],l=c=e[1];for(let m=i;m<n;m+=i)u=e[m],d=e[m+1],u<o&&(o=u),d<l&&(l=d),u>h&&(h=u),d>c&&(c=d);p=Math.max(h-o,c-l),p=p!==0?1/p:0}return $h(s,a,i,o,l,p),a}};function rE(e,t,i,r,n){let s,a;if(n===xU(e,t,i,r)>0)for(s=t;s<i;s+=r)a=xx(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=xx(s,e[s],e[s+1],a);return a&&dp(a,a.next)&&(tu(a),a=a.next),a}function ua(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(dp(i,i.next)||jt(i.prev,i,i.next)===0)){if(tu(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function $h(e,t,i,r,n,s,a){if(!e)return;!a&&s&&pU(e,r,n,s);let o=e,l,h;for(;e.prev!==e.next;){if(l=e.prev,h=e.next,s?sU(e,r,n,s):nU(e)){t.push(l.i/i),t.push(e.i/i),t.push(h.i/i),tu(e),e=h.next,o=h.next;continue}if(e=h,e===o){a?a===1?(e=aU(ua(e),t,i),$h(e,t,i,r,n,s,2)):a===2&&oU(e,t,i,r,n,s):$h(ua(e),t,i,r,n,s,1);break}}}function nU(e){let t=e.prev,i=e,r=e.next;if(jt(t,i,r)>=0)return!1;let n=e.next.next;for(;n!==e.prev;){if(el(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&jt(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function sU(e,t,i,r){let n=e.prev,s=e,a=e.next;if(jt(n,s,a)>=0)return!1;let o=n.x<s.x?n.x<a.x?n.x:a.x:s.x<a.x?s.x:a.x,l=n.y<s.y?n.y<a.y?n.y:a.y:s.y<a.y?s.y:a.y,h=n.x>s.x?n.x>a.x?n.x:a.x:s.x>a.x?s.x:a.x,c=n.y>s.y?n.y>a.y?n.y:a.y:s.y>a.y?s.y:a.y,u=dg(o,l,t,i,r),d=dg(h,c,t,i,r),p=e.prevZ,m=e.nextZ;for(;p&&p.z>=u&&m&&m.z<=d;){if(p!==e.prev&&p!==e.next&&el(n.x,n.y,s.x,s.y,a.x,a.y,p.x,p.y)&&jt(p.prev,p,p.next)>=0||(p=p.prevZ,m!==e.prev&&m!==e.next&&el(n.x,n.y,s.x,s.y,a.x,a.y,m.x,m.y)&&jt(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;p&&p.z>=u;){if(p!==e.prev&&p!==e.next&&el(n.x,n.y,s.x,s.y,a.x,a.y,p.x,p.y)&&jt(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==e.prev&&m!==e.next&&el(n.x,n.y,s.x,s.y,a.x,a.y,m.x,m.y)&&jt(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function aU(e,t,i){let r=e;do{let n=r.prev,s=r.next.next;!dp(n,s)&&nE(n,r,r.next,s)&&eu(n,s)&&eu(s,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(s.i/i),tu(r),tu(r.next),r=e=s),r=r.next}while(r!==e);return ua(r)}function oU(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&gU(a,o)){let l=sE(a,o);a=ua(a,a.next),l=ua(l,l.next),$h(a,t,i,r,n,s),$h(l,t,i,r,n,s);return}o=o.next}a=a.next}while(a!==e)}function lU(e,t,i,r){let n=[],s,a,o,l,h;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,h=rE(e,o,l,r,!1),h===h.next&&(h.steiner=!0),n.push(mU(h));for(n.sort(hU),s=0;s<n.length;s++)uU(n[s],i),i=ua(i,i.next);return i}function hU(e,t){return e.x-t.x}function uU(e,t){if(t=cU(e,t),t){let i=sE(t,e);ua(t,t.next),ua(i,i.next)}}function cU(e,t){let i=t,r=e.x,n=e.y,s=-1/0,a;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){let d=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=r&&d>s){if(s=d,d===r){if(n===i.y)return i;if(n===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!a)return null;if(r===s)return a;let o=a,l=a.x,h=a.y,c=1/0,u;i=a;do r>=i.x&&i.x>=l&&r!==i.x&&el(n<h?r:s,n,l,h,n<h?s:r,n,i.x,i.y)&&(u=Math.abs(n-i.y)/(r-i.x),eu(i,e)&&(u<c||u===c&&(i.x>a.x||i.x===a.x&&dU(a,i)))&&(a=i,c=u)),i=i.next;while(i!==o);return a}function dU(e,t){return jt(e.prev,e,t.prev)<0&&jt(t.next,e,e.next)<0}function pU(e,t,i,r){let n=e;do n.z===null&&(n.z=dg(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,fU(n)}function fU(e){let t,i,r,n,s,a,o,l,h=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<h&&(o++,r=r.nextZ,!!r);t++);for(l=h;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,h*=2}while(a>1);return e}function dg(e,t,i,r,n){return e=32767*(e-i)*n,t=32767*(t-r)*n,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function mU(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function el(e,t,i,r,n,s,a,o){return(n-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(r-o)-(i-a)*(t-o)>=0&&(i-a)*(s-o)-(n-a)*(r-o)>=0}function gU(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!vU(e,t)&&(eu(e,t)&&eu(t,e)&&yU(e,t)&&(jt(e.prev,e,t.prev)||jt(e,t.prev,t))||dp(e,t)&&jt(e.prev,e,e.next)>0&&jt(t.prev,t,t.next)>0)}function jt(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function dp(e,t){return e.x===t.x&&e.y===t.y}function nE(e,t,i,r){let n=bc(jt(e,t,i)),s=bc(jt(e,t,r)),a=bc(jt(i,r,e)),o=bc(jt(i,r,t));return!!(n!==s&&a!==o||n===0&&xc(e,i,t)||s===0&&xc(e,r,t)||a===0&&xc(i,e,r)||o===0&&xc(i,t,r))}function xc(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function bc(e){return e>0?1:e<0?-1:0}function vU(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&nE(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function eu(e,t){return jt(e.prev,e,e.next)<0?jt(e,t,e.next)>=0&&jt(e,e.prev,t)>=0:jt(e,t,e.prev)<0||jt(e,e.next,t)<0}function yU(e,t){let i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function sE(e,t){let i=new pg(e.i,e.x,e.y),r=new pg(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function xx(e,t,i,r){let n=new pg(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function tu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function pg(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xU(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}var aE=class{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return i*.5}static isClockWise(e){return aE.area(e)<0}static triangulateShape(e,t){let i=[],r=[],n=[];bx(e),wx(i,e);let s=e.length;t.forEach(bx);for(let o=0;o<t.length;o++)r.push(s),s+=t[o].length,wx(i,t[o]);let a=rU.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function bx(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function wx(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var oE=class extends a0{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new oE(e.radius,e.detail)}},o0=class extends it{constructor(e=1,t=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,h=[],c=new M,u=new M,d=[],p=[],m=[],g=[];for(let f=0;f<=i;f++){let v=[],y=f/i,x=0;f==0&&s==0?x=.5/t:f==i&&o==Math.PI&&(x=-.5/t);for(let b=0;b<=t;b++){let S=b/t;c.x=-e*Math.cos(r+S*n)*Math.sin(s+y*a),c.y=e*Math.cos(s+y*a),c.z=e*Math.sin(r+S*n)*Math.sin(s+y*a),p.push(c.x,c.y,c.z),u.copy(c).normalize(),m.push(u.x,u.y,u.z),g.push(S+x,1-y),v.push(l++)}h.push(v)}for(let f=0;f<i;f++)for(let v=0;v<t;v++){let y=h[f][v+1],x=h[f][v],b=h[f+1][v],S=h[f+1][v+1];(f!==0||s>0)&&d.push(y,x,S),(f!==i-1||o<Math.PI)&&d.push(x,b,S)}this.setIndex(d),this.setAttribute("position",new Be(p,3)),this.setAttribute("normal",new Be(m,3)),this.setAttribute("uv",new Be(g,2))}static fromJSON(e){return new o0(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},lE=class extends it{constructor(e=1,t=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],h=[],c=new M,u=new M,d=new M,p=new M,m=new M,g=new M,f=new M;for(let y=0;y<=i;++y){let x=y/i*n*Math.PI*2;v(x,n,s,e,d),v(x+.01,n,s,e,p),g.subVectors(p,d),f.addVectors(p,d),m.crossVectors(g,f),f.crossVectors(m,g),m.normalize(),f.normalize();for(let b=0;b<=r;++b){let S=b/r*Math.PI*2,_=-t*Math.cos(S),A=t*Math.sin(S);c.x=d.x+(_*f.x+A*m.x),c.y=d.y+(_*f.y+A*m.y),c.z=d.z+(_*f.z+A*m.z),o.push(c.x,c.y,c.z),u.subVectors(c,d).normalize(),l.push(u.x,u.y,u.z),h.push(y/i),h.push(b/r)}}for(let y=1;y<=i;y++)for(let x=1;x<=r;x++){let b=(r+1)*(y-1)+(x-1),S=(r+1)*y+(x-1),_=(r+1)*y+x,A=(r+1)*(y-1)+x;a.push(b,S,A),a.push(S,_,A)}this.setIndex(a),this.setAttribute("position",new Be(o,3)),this.setAttribute("normal",new Be(l,3)),this.setAttribute("uv",new Be(h,2));function v(y,x,b,S,_){let A=Math.cos(y),w=Math.sin(y),E=b/x*y,T=Math.cos(E);_.x=S*(2+T)*.5*A,_.y=S*(2+T)*w*.5,_.z=S*Math.sin(E)*.5}}static fromJSON(e){return new lE(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},_x={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},hE=class{constructor(e,t,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,n===!1&&r.onStart!==void 0&&r.onStart(h,s,a),n=!0},this.itemEnd=function(h){s++,r.onProgress!==void 0&&r.onProgress(h,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(h){r.onError!==void 0&&r.onError(h)},this.resolveURL=function(h){return o?o(h):h},this.setURLModifier=function(h){return o=h,this},this.addHandler=function(h,c){return l.push(h,c),this},this.removeHandler=function(h){let c=l.indexOf(h);return c!==-1&&l.splice(c,2),this},this.getHandler=function(h){for(let c=0,u=l.length;c<u;c+=2){let d=l[c],p=l[c+1];if(d.global&&(d.lastIndex=0),d.test(h))return p}return null}}},bU=new hE,l0=class{constructor(e){this.manager=e!==void 0?e:bU,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,n){i.load(e,r,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},is={},fg=class extends l0{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=_x.get(e);if(n!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(is[e]!==void 0){is[e].push({onLoad:t,onProgress:i,onError:r});return}is[e]=[],is[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let h=is[e],c=l.body.getReader(),u=l.headers.get("Content-Length"),d=u?parseInt(u):0,p=d!==0,m=0,g=new ReadableStream({start(f){v();function v(){c.read().then(({done:y,value:x})=>{if(y)f.close();else{m+=x.byteLength;let b=new ProgressEvent("progress",{lengthComputable:p,loaded:m,total:d});for(let S=0,_=h.length;S<_;S++){let A=h[S];A.onProgress&&A.onProgress(b)}f.enqueue(x),v()}})}}});return new Response(g)}else throw Error(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return l.json();default:if(a===void 0)return l.text();{let h=/charset="?([^;"\s]*)"?/i.exec(a),c=h&&h[1]?h[1].toLowerCase():void 0,u=new TextDecoder(c);return l.arrayBuffer().then(d=>u.decode(d))}}}).then(l=>{_x.add(e,l);let h=is[e];delete is[e];for(let c=0,u=h.length;c<u;c++){let d=h[c];d.onLoad&&d.onLoad(l)}}).catch(l=>{let h=is[e];if(h===void 0)throw this.manager.itemError(e),l;delete is[e];for(let c=0,u=h.length;c<u;c++){let d=h[c];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},pp=class extends Ut{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ze(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},mg=class extends pp{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ut.DefaultUp),this.updateMatrix(),this.groundColor=new Ze(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},Sx=new Fe,Ax=new M,Ex=new M,h0=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new q(512,512),this.map=null,this.mapPass=null,this.matrix=new Fe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new $v,this._frameExtents=new q(1,1),this._viewportCount=1,this._viewports=[new ht(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;Ax.setFromMatrixPosition(e.matrixWorld),t.position.copy(Ax),Ex.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Ex),t.updateMatrixWorld(),Sx.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sx),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},wU=class extends h0{constructor(){super(new Oi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=Jh*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(i!==t.fov||r!==t.aspect||n!==t.far)&&(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},_U=class extends pp{constructor(e,t,i=0,r=Math.PI/3,n=0,s=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ut.DefaultUp),this.updateMatrix(),this.target=new Ut,this.distance=i,this.angle=r,this.penumbra=n,this.decay=s,this.shadow=new wU}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},Tx=new Fe,hh=new M,If=new M,SU=class extends h0{constructor(){super(new Oi(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new q(4,2),this._viewportCount=6,this._viewports=[new ht(2,1,1,1),new ht(0,1,1,1),new ht(3,1,1,1),new ht(1,1,1,1),new ht(3,0,1,1),new ht(1,0,1,1)],this._cubeDirections=[new M(1,0,0),new M(-1,0,0),new M(0,0,1),new M(0,0,-1),new M(0,1,0),new M(0,-1,0)],this._cubeUps=[new M(0,1,0),new M(0,1,0),new M(0,1,0),new M(0,1,0),new M(0,0,1),new M(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),hh.setFromMatrixPosition(e.matrixWorld),i.position.copy(hh),If.copy(i.position),If.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(If),i.updateMatrixWorld(),r.makeTranslation(-hh.x,-hh.y,-hh.z),Tx.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Tx)}},AU=class extends pp{constructor(e,t,i=0,r=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new SU}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},EU=class extends h0{constructor(){super(new e0(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},TU=class extends pp{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ut.DefaultUp),this.updateMatrix(),this.target=new Ut,this.shadow=new EU}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},MU=class extends it{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},uE=class extends l0{constructor(e){super(e)}load(e,t,i,r){let n=this,s=new fg(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(a){try{t(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(u,d){if(t[d]!==void 0)return t[d];let p=u.interleavedBuffers[d],m=n(u,p.buffer),g=Ku(p.type,m),f=new H4(g,p.stride);return f.uuid=p.uuid,t[d]=f,f}function n(u,d){if(i[d]!==void 0)return i[d];let p=u.arrayBuffers[d],m=new Uint32Array(p).buffer;return i[d]=m,m}let s=e.isInstancedBufferGeometry?new MU:new it,a=e.data.index;if(a!==void 0){let u=Ku(a.type,a.array);s.setIndex(new at(u,1))}let o=e.data.attributes;for(let u in o){let d=o[u],p;if(d.isInterleavedBufferAttribute){let m=r(e.data,d.data);p=new cg(m,d.itemSize,d.offset,d.normalized)}else{let m=Ku(d.type,d.array),g=d.isInstancedBufferAttribute?V4:at;p=new g(m,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),d.updateRange!==void 0&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),s.setAttribute(u,p)}let l=e.data.morphAttributes;if(l)for(let u in l){let d=l[u],p=[];for(let m=0,g=d.length;m<g;m++){let f=d[m],v;if(f.isInterleavedBufferAttribute){let y=r(e.data,f.data);v=new cg(y,f.itemSize,f.offset,f.normalized)}else{let y=Ku(f.type,f.array);v=new at(y,f.itemSize,f.normalized)}f.name!==void 0&&(v.name=f.name),p.push(v)}s.morphAttributes[u]=p}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let u=0,d=h.length;u!==d;++u){let p=h[u];s.addGroup(p.start,p.count,p.materialIndex)}let c=e.data.boundingSphere;if(c!==void 0){let u=new M;c.center!==void 0&&u.fromArray(c.center),s.boundingSphere=new tn(u,c.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},CU=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Mx(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=Mx();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function Mx(){return(typeof performance>"u"?Date:performance).now()}var cE="\\[\\]\\.:\\/",u0="[^"+cE+"]",DU="[^"+cE.replace("\\.","")+"]";/((?:WC+[\/:])*)/.source.replace("WC",u0);/(WCOD+)?/.source.replace("WCOD",DU);/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",u0);/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",u0);var ze=class{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new ze(this.value.clone===void 0?this.value:this.value.clone())}},dE=class{constructor(e,t,i=0,r=1/0){this.ray=new Ul(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new Kv,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return gg(e,this,i,t),i.sort(Cx),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)gg(e[r],this,i,t);return i.sort(Cx),i}};function Cx(e,t){return e.distance-t.distance}function gg(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let n=e.children;for(let s=0,a=n.length;s<a;s++)gg(n[s],t,i,!0)}}var Dx=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ui(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},Px=new q,PU=class{constructor(e=new q(1/0,1/0),t=new q(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Px.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Px.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Lx=new M,wc=new M,Rr=class{constructor(e=new M,t=new M){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Lx.subVectors(e,this.start),wc.subVectors(this.end,this.start);let i=wc.dot(wc),r=wc.dot(Lx)/i;return t&&(r=ui(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},Ox=new M,LU=class extends Ut{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;let i=new it,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,h=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(h),Math.sin(h),1)}i.setAttribute("position",new Be(r,3));let n=new ya({fog:!1,toneMapped:!1});this.cone=new Mu(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Ox.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Ox),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},OU=class extends Gi{constructor(e,t,i){let r=new o0(t,4,2),n=new Zv({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Rx=new M,_c=new M,Ix=new M,RU=class extends Ut{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,t===void 0&&(t=1);let r=new it;r.setAttribute("position",new Be([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new ya({fog:!1,toneMapped:!1});this.lightPlane=new wd(r,n),this.add(this.lightPlane),r=new it,r.setAttribute("position",new Be([0,0,0,0,0,1],3)),this.targetLine=new wd(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Rx.setFromMatrixPosition(this.light.matrixWorld),_c.setFromMatrixPosition(this.light.target.matrixWorld),Ix.subVectors(_c,Rx),this.lightPlane.lookAt(_c),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_c),this.targetLine.scale.z=Ix.length()}},Sc=new M,qt=new zl,Xs=class extends Mu{constructor(e){let t=new it,i=new ya({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,m){o(p),o(m)}function o(p){r.push(0,0,0),n.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(r.length/3-1)}t.setAttribute("position",new Be(r,3)),t.setAttribute("color",new Be(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new Ze(16755200),h=new Ze(16711680),c=new Ze(43775),u=new Ze(16777215),d=new Ze(3355443);this.setColors(l,h,c,u,d)}setColors(e,t,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;qt.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ei("c",t,e,qt,0,0,-1),ei("t",t,e,qt,0,0,1),ei("n1",t,e,qt,-i,-r,-1),ei("n2",t,e,qt,i,-r,-1),ei("n3",t,e,qt,-i,r,-1),ei("n4",t,e,qt,i,r,-1),ei("f1",t,e,qt,-i,-r,1),ei("f2",t,e,qt,i,-r,1),ei("f3",t,e,qt,-i,r,1),ei("f4",t,e,qt,i,r,1),ei("u1",t,e,qt,i*.7,r*1.1,-1),ei("u2",t,e,qt,-i*.7,r*1.1,-1),ei("u3",t,e,qt,0,r*2,-1),ei("cf1",t,e,qt,-i,0,1),ei("cf2",t,e,qt,i,0,1),ei("cf3",t,e,qt,0,-r,1),ei("cf4",t,e,qt,0,r,1),ei("cn1",t,e,qt,-i,0,-1),ei("cn2",t,e,qt,i,0,-1),ei("cn3",t,e,qt,0,-r,-1),ei("cn4",t,e,qt,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function ei(e,t,i,r,n,s,a){Sc.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let h=0,c=o.length;h<c;h++)l.setXYZ(o[h],Sc.x,Sc.y,Sc.z)}}var Ac=class extends Mu{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new it;n.setIndex(new at(i,1)),n.setAttribute("position",new Be(r,3)),super(n,new ya({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}},IU=class extends Mu{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new it;r.setAttribute("position",new Be(t,3)),r.setAttribute("color",new Be(i,3));let n=new ya({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(e,t,i){let r=new Ze,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}};BU();function BU(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let h=l-127;h<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):h<-14?(r[l]=1024>>-h-14,r[l|256]=1024>>-h-14|32768,n[l]=-h-1,n[l|256]=-h-1):h<=15?(r[l]=h+15<<10,r[l|256]=h+15<<10|32768,n[l]=13,n[l|256]=13):h<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let h=l<<13,c=0;for(;(h&8388608)===0;)h<<=1,c-=8388608;h&=-8388609,c+=947912704,s[l]=h|c}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}var NU=class extends ri{constructor(e,t,i){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(e,t,i),this.samples=4}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Su}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Su);var uh=".",c0=Symbol("target"),pE=Symbol("unsubscribe");function vg(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function kU(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var Tn=Array.isArray;function d0(e){return typeof e=="symbol"}var UU={after:(e,t)=>Tn(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>Tn(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=uh),d0(t)?e+t.toString():e+t):e,initial:e=>{if(Tn(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(uh);return t===-1?"":e.slice(0,t)},last:e=>{if(Tn(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(uh);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(Tn(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(uh);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(uh,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},Er=UU;function FU(e){return typeof e=="object"&&typeof e.next=="function"}function zU(e,t,i,r,n){let s=e.next;if(t.name==="entries")e.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],t,a.value[0],r),a.value[1]=n(a.value[1],t,a.value[0],r)),a};else if(t.name==="values"){let a=i[c0].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,t,a.next().value,r)),o}}else e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,t,a.value,r)),a};return e}function Bx(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&d0(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var GU=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let n=e[r],s=n||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(e,i):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Er.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,n){if(!this._equals(n,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function yg(e){return toString.call(e)==="[object Object]"}function Ec(){return!0}function Io(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var fE=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),HU=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),mE={push:Ec,pop:Ec,shift:Ec,unshift:Ec,copyWithin:Io,reverse:Io,sort:Io,splice:Io,flat:Io,fill:Io},VU=new Set([...fE,...HU,...Object.keys(mE)]);function Tc(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var gE=["keys","values","entries"],vE=new Set(["has","toString"]),yE={add:Tc,clear:Tc,delete:Tc,forEach:Tc},jU=new Set([...vE,...Object.keys(yE),...gE]);function Mc(e,t){if(e.size!==t.size)return!0;let i;for(let[r,n]of e)if(i=t.get(r),i!==n||i===void 0&&!t.has(r))return!0;return!1}var WU=new Set([...vE,"get"]),xE={set:Mc,clear:Mc,delete:Mc,forEach:Mc},qU=new Set([...WU,...Object.keys(xE),...gE]),ca=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return fE.has(e)}_shallowClone(e){let t=e;if(yg(e))t={...e};else if(Tn(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(Tn(r)?this._onIsChanged=mE[t]:r instanceof Set?this._onIsChanged=yE[t]:r instanceof Map&&(this._onIsChanged=xE[t]),r):i}update(e,t,i){let r=Er.after(e,this._path);if(t!=="length"){let n=this.clone;Er.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),n&&n[t]&&(n[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],Er.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},Nx=class extends ca{static isHandledMethod(e){return VU.has(e)}},YU=class extends ca{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},kx=class extends ca{static isHandledMethod(e){return jU.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},Ux=class extends ca{static isHandledMethod(e){return qU.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},XU=class extends ca{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},QU=class extends ca{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},Yo=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return yg(e)||Tn(e)||vg(e)}static isHandledMethod(e,t){return yg(e)?ca.isHandledMethod(t):Tn(e)?Nx.isHandledMethod(t):e instanceof Set?kx.isHandledMethod(t):e instanceof Map?Ux.isHandledMethod(t):vg(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=ca;Tn(e)?r=Nx:e instanceof Date?r=YU:e instanceof Set?r=kx:e instanceof Map?r=Ux:e instanceof WeakSet?r=XU:e instanceof WeakMap&&(r=QU),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,n=Yo.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},KU={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},p0=(e,t,i={})=>{i={...KU,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new GU(n),h=typeof i.onValidate=="function",c=new Yo(h),u=(y,x,b,S,_)=>!h||c.isCloning||i.onValidate(Er.concat(l.getPath(y),x),b,S,_)===!0,d=(y,x,b,S)=>{!Bx(l,i,x)&&!(a&&l.isDetached(y,e))&&p(l.getPath(y),x,b,S)},p=(y,x,b,S,_)=>{c.isCloning?c.update(y,x,S):t(Er.concat(y,x),b,S,_)},m=y=>y&&(y[r]||y),g=(y,x,b,S)=>kU(y)||b==="constructor"||s&&!Yo.isHandledMethod(x,b)||Bx(l,i,b)||l.isGetInvariant(x,b)||a&&l.isDetached(x,e)?y:(S===void 0&&(S=l.getPath(x)),l.getProxy(y,Er.concat(S,b),f,r)),f={get(y,x,b){if(d0(x)){if(x===r||x===c0)return y;if(x===pE&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}let S=vg(y)?Reflect.get(y,x):Reflect.get(y,x,b);return g(S,y,x)},set(y,x,b,S){b=m(b);let _=y[r]||y,A=_[x];if(n(A,b)&&x in y)return!0;let w=u(y,x,b,A);return w&&l.setProperty(_,x,b,S,A)?(d(y,x,y[x],A),!0):!w},defineProperty(y,x,b){if(!l.isSameDescriptor(b,y,x)){let S=y[x];u(y,x,b.value,S)&&l.defineProperty(y,x,b,S)&&d(y,x,b.value,S)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;let b=Reflect.get(y,x),S=u(y,x,void 0,b);return S&&l.deleteProperty(y,x,b)?(d(y,x,void 0,b),!0):!S},apply(y,x,b){let S=x[r]||x;if(l.isUnsubscribed)return Reflect.apply(y,S,b);if((o===!1||o!==!0&&!o.includes(y.name))&&Yo.isHandledType(S)){let _=Er.initial(l.getPath(y)),A=Yo.isHandledMethod(S,y.name);c.start(S,_,b);let w=Reflect.apply(y,c.preferredThisArg(y,x,S),A?b.map(C=>m(C)):b),E=c.isChanged(S,n),T=c.stop();if(Yo.isHandledType(w)&&A&&(x instanceof Map&&y.name==="get"&&(_=Er.concat(_,b[0])),w=l.getProxy(w,_,f)),E){let C={name:y.name,args:b,result:w},P=c.isCloning?Er.initial(_):_,k=c.isCloning?Er.last(_):"";u(Er.get(e,P),k,S,T,C)?p(P,k,S,T,C):c.undo(S)}return(x instanceof Map||x instanceof Set)&&FU(w)?zU(w,y,x,_,g):w}return Reflect.apply(y,x,b)}},v=l.getProxy(e,i.pathAsArray?[]:"",f);return t=t.bind(v),h&&(i.onValidate=i.onValidate.bind(v)),v};p0.target=e=>e&&e[c0]||e;p0.unsubscribe=e=>e[pE]||e;var Fx=p0,ZU=typeof global=="object"&&global&&global.Object===Object&&global,bE=ZU,JU=typeof self=="object"&&self&&self.Object===Object&&self,$U=bE||JU||Function("return this")(),hn=$U,eF=hn.Symbol,jn=eF,wE=Object.prototype,tF=wE.hasOwnProperty,iF=wE.toString,ch=jn?jn.toStringTag:void 0;function rF(e){var t=tF.call(e,ch),i=e[ch];try{e[ch]=void 0;var r=!0}catch{}var n=iF.call(e);return r&&(t?e[ch]=i:delete e[ch]),n}var nF=rF,sF=Object.prototype,aF=sF.toString;function oF(e){return aF.call(e)}var lF=oF,hF="[object Null]",uF="[object Undefined]",zx=jn?jn.toStringTag:void 0;function cF(e){return e==null?e===void 0?uF:hF:zx&&zx in Object(e)?nF(e):lF(e)}var ho=cF;function dF(e){return e!=null&&typeof e=="object"}var xa=dF,pF="[object Symbol]";function fF(e){return typeof e=="symbol"||xa(e)&&ho(e)==pF}var fp=fF;function mF(e,t){for(var i=-1,r=e==null?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}var _E=mF,gF=Array.isArray,Wn=gF,vF=1/0,Gx=jn?jn.prototype:void 0,Hx=Gx?Gx.toString:void 0;function SE(e){if(typeof e=="string")return e;if(Wn(e))return _E(e,SE)+"";if(fp(e))return Hx?Hx.call(e):"";var t=e+"";return t=="0"&&1/e==-vF?"-0":t}var yF=SE,xF=/\s/;function bF(e){for(var t=e.length;t--&&xF.test(e.charAt(t)););return t}var wF=bF,_F=/^\s+/;function SF(e){return e&&e.slice(0,wF(e)+1).replace(_F,"")}var AF=SF;function EF(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var fr=EF,Vx=0/0,TF=/^[-+]0x[0-9a-f]+$/i,MF=/^0b[01]+$/i,CF=/^0o[0-7]+$/i,DF=parseInt;function PF(e){if(typeof e=="number")return e;if(fp(e))return Vx;if(fr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=fr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=AF(e);var i=MF.test(e);return i||CF.test(e)?DF(e.slice(2),i?2:8):TF.test(e)?Vx:+e}var jx=PF;function LF(e){return e}var AE=LF,OF="[object AsyncFunction]",RF="[object Function]",IF="[object GeneratorFunction]",BF="[object Proxy]";function NF(e){if(!fr(e))return!1;var t=ho(e);return t==RF||t==IF||t==OF||t==BF}var f0=NF,kF=hn["__core-js_shared__"],Bf=kF,Wx=function(){var e=/[^.]+$/.exec(Bf&&Bf.keys&&Bf.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function UF(e){return!!Wx&&Wx in e}var FF=UF,zF=Function.prototype,GF=zF.toString;function HF(e){if(e!=null){try{return GF.call(e)}catch{}try{return e+""}catch{}}return""}var uo=HF,VF=/[\\^$.*+?()[\]{}|]/g,jF=/^\[object .+?Constructor\]$/,WF=Function.prototype,qF=Object.prototype,YF=WF.toString,XF=qF.hasOwnProperty,QF=RegExp("^"+YF.call(XF).replace(VF,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function KF(e){if(!fr(e)||FF(e))return!1;var t=f0(e)?QF:jF;return t.test(uo(e))}var ZF=KF;function JF(e,t){return e==null?void 0:e[t]}var $F=JF;function ez(e,t){var i=$F(e,t);return ZF(i)?i:void 0}var co=ez,tz=co(hn,"WeakMap"),xg=tz,qx=Object.create,iz=function(){function e(){}return function(t){if(!fr(t))return{};if(qx)return qx(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),rz=iz;function nz(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var sz=nz;function az(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var EE=az,oz=800,lz=16,hz=Date.now;function uz(e){var t=0,i=0;return function(){var r=hz(),n=lz-(r-i);if(i=r,n>0){if(++t>=oz)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var cz=uz;function dz(e){return function(){return e}}var pz=dz,fz=function(){try{var e=co(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Ad=fz,mz=Ad?function(e,t){return Ad(e,"toString",{configurable:!0,enumerable:!1,value:pz(t),writable:!0})}:AE,gz=mz,vz=cz(gz),TE=vz;function yz(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var xz=yz,bz=9007199254740991,wz=/^(?:0|[1-9]\d*)$/;function _z(e,t){var i=typeof e;return t=t!=null?t:bz,!!t&&(i=="number"||i!="symbol"&&wz.test(e))&&e>-1&&e%1==0&&e<t}var mp=_z;function Sz(e,t,i){t=="__proto__"&&Ad?Ad(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var m0=Sz;function Az(e,t){return e===t||e!==e&&t!==t}var gp=Az,Ez=Object.prototype,Tz=Ez.hasOwnProperty;function Mz(e,t,i){var r=e[t];(!(Tz.call(e,t)&&gp(r,i))||i===void 0&&!(t in e))&&m0(e,t,i)}var g0=Mz;function Cz(e,t,i,r){var n=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=r?r(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),n?m0(i,o,l):g0(i,o,l)}return i}var Hl=Cz,Yx=Math.max;function Dz(e,t,i){return t=Yx(t===void 0?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=Yx(r.length-t,0),a=Array(s);++n<s;)a[n]=r[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=r[n];return o[t]=i(a),sz(e,this,o)}}var ME=Dz;function Pz(e,t){return TE(ME(e,t,AE),e+"")}var Lz=Pz,Oz=9007199254740991;function Rz(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Oz}var v0=Rz;function Iz(e){return e!=null&&v0(e.length)&&!f0(e)}var vp=Iz;function Bz(e,t,i){if(!fr(i))return!1;var r=typeof t;return(r=="number"?vp(i)&&mp(t,i.length):r=="string"&&t in i)?gp(i[t],e):!1}var Nz=Bz;function kz(e){return Lz(function(t,i){var r=-1,n=i.length,s=n>1?i[n-1]:void 0,a=n>2?i[2]:void 0;for(s=e.length>3&&typeof s=="function"?(n--,s):void 0,a&&Nz(i[0],i[1],a)&&(s=n<3?void 0:s,n=1),t=Object(t);++r<n;){var o=i[r];o&&e(t,o,r,s)}return t})}var Uz=kz,Fz=Object.prototype;function zz(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||Fz;return e===i}var y0=zz;function Gz(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var Hz=Gz,Vz="[object Arguments]";function jz(e){return xa(e)&&ho(e)==Vz}var Xx=jz,CE=Object.prototype,Wz=CE.hasOwnProperty,qz=CE.propertyIsEnumerable,Yz=Xx(function(){return arguments}())?Xx:function(e){return xa(e)&&Wz.call(e,"callee")&&!qz.call(e,"callee")},iu=Yz;function Xz(){return!1}var Qz=Xz,DE=typeof oe=="object"&&oe&&!oe.nodeType&&oe,Qx=DE&&typeof ur=="object"&&ur&&!ur.nodeType&&ur,Kz=Qx&&Qx.exports===DE,Kx=Kz?hn.Buffer:void 0,Zz=Kx?Kx.isBuffer:void 0,Jz=Zz||Qz,x0=Jz,$z="[object Arguments]",e5="[object Array]",t5="[object Boolean]",i5="[object Date]",r5="[object Error]",n5="[object Function]",s5="[object Map]",a5="[object Number]",o5="[object Object]",l5="[object RegExp]",h5="[object Set]",u5="[object String]",c5="[object WeakMap]",d5="[object ArrayBuffer]",p5="[object DataView]",f5="[object Float32Array]",m5="[object Float64Array]",g5="[object Int8Array]",v5="[object Int16Array]",y5="[object Int32Array]",x5="[object Uint8Array]",b5="[object Uint8ClampedArray]",w5="[object Uint16Array]",_5="[object Uint32Array]",Ft={};Ft[f5]=Ft[m5]=Ft[g5]=Ft[v5]=Ft[y5]=Ft[x5]=Ft[b5]=Ft[w5]=Ft[_5]=!0;Ft[$z]=Ft[e5]=Ft[d5]=Ft[t5]=Ft[p5]=Ft[i5]=Ft[r5]=Ft[n5]=Ft[s5]=Ft[a5]=Ft[o5]=Ft[l5]=Ft[h5]=Ft[u5]=Ft[c5]=!1;function S5(e){return xa(e)&&v0(e.length)&&!!Ft[ho(e)]}var A5=S5;function E5(e){return function(t){return e(t)}}var b0=E5,PE=typeof oe=="object"&&oe&&!oe.nodeType&&oe,Vh=PE&&typeof ur=="object"&&ur&&!ur.nodeType&&ur,T5=Vh&&Vh.exports===PE,Nf=T5&&bE.process,M5=function(){try{var e=Vh&&Vh.require&&Vh.require("util").types;return e||Nf&&Nf.binding&&Nf.binding("util")}catch{}}(),Ml=M5,Zx=Ml&&Ml.isTypedArray,C5=Zx?b0(Zx):A5,LE=C5,D5=Object.prototype,P5=D5.hasOwnProperty;function L5(e,t){var i=Wn(e),r=!i&&iu(e),n=!i&&!r&&x0(e),s=!i&&!r&&!n&&LE(e),a=i||r||n||s,o=a?Hz(e.length,String):[],l=o.length;for(var h in e)(t||P5.call(e,h))&&!(a&&(h=="length"||n&&(h=="offset"||h=="parent")||s&&(h=="buffer"||h=="byteLength"||h=="byteOffset")||mp(h,l)))&&o.push(h);return o}var OE=L5;function O5(e,t){return function(i){return e(t(i))}}var RE=O5,R5=RE(Object.keys,Object),I5=R5,B5=Object.prototype,N5=B5.hasOwnProperty;function k5(e){if(!y0(e))return I5(e);var t=[];for(var i in Object(e))N5.call(e,i)&&i!="constructor"&&t.push(i);return t}var U5=k5;function F5(e){return vp(e)?OE(e):U5(e)}var w0=F5;function z5(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var G5=z5,H5=Object.prototype,V5=H5.hasOwnProperty;function j5(e){if(!fr(e))return G5(e);var t=y0(e),i=[];for(var r in e)r=="constructor"&&(t||!V5.call(e,r))||i.push(r);return i}var W5=j5;function q5(e){return vp(e)?OE(e,!0):W5(e)}var Cu=q5,Y5=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,X5=/^\w*$/;function Q5(e,t){if(Wn(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||fp(e)?!0:X5.test(e)||!Y5.test(e)||t!=null&&e in Object(t)}var K5=Q5,Z5=co(Object,"create"),ru=Z5;function J5(){this.__data__=ru?ru(null):{},this.size=0}var $5=J5;function e6(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var t6=e6,i6="__lodash_hash_undefined__",r6=Object.prototype,n6=r6.hasOwnProperty;function s6(e){var t=this.__data__;if(ru){var i=t[e];return i===i6?void 0:i}return n6.call(t,e)?t[e]:void 0}var a6=s6,o6=Object.prototype,l6=o6.hasOwnProperty;function h6(e){var t=this.__data__;return ru?t[e]!==void 0:l6.call(t,e)}var u6=h6,c6="__lodash_hash_undefined__";function d6(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=ru&&t===void 0?c6:t,this}var p6=d6;function Vl(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Vl.prototype.clear=$5;Vl.prototype.delete=t6;Vl.prototype.get=a6;Vl.prototype.has=u6;Vl.prototype.set=p6;var Jx=Vl;function f6(){this.__data__=[],this.size=0}var m6=f6;function g6(e,t){for(var i=e.length;i--;)if(gp(e[i][0],t))return i;return-1}var yp=g6,v6=Array.prototype,y6=v6.splice;function x6(e){var t=this.__data__,i=yp(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():y6.call(t,i,1),--this.size,!0}var b6=x6;function w6(e){var t=this.__data__,i=yp(t,e);return i<0?void 0:t[i][1]}var _6=w6;function S6(e){return yp(this.__data__,e)>-1}var A6=S6;function E6(e,t){var i=this.__data__,r=yp(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var T6=E6;function jl(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}jl.prototype.clear=m6;jl.prototype.delete=b6;jl.prototype.get=_6;jl.prototype.has=A6;jl.prototype.set=T6;var xp=jl,M6=co(hn,"Map"),nu=M6;function C6(){this.size=0,this.__data__={hash:new Jx,map:new(nu||xp),string:new Jx}}var D6=C6;function P6(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var L6=P6;function O6(e,t){var i=e.__data__;return L6(t)?i[typeof t=="string"?"string":"hash"]:i.map}var bp=O6;function R6(e){var t=bp(this,e).delete(e);return this.size-=t?1:0,t}var I6=R6;function B6(e){return bp(this,e).get(e)}var N6=B6;function k6(e){return bp(this,e).has(e)}var U6=k6;function F6(e,t){var i=bp(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var z6=F6;function Wl(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}Wl.prototype.clear=D6;Wl.prototype.delete=I6;Wl.prototype.get=N6;Wl.prototype.has=U6;Wl.prototype.set=z6;var _0=Wl,G6="Expected a function";function S0(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(G6);var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=e.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new(S0.Cache||_0),i}S0.Cache=_0;var H6=S0,V6=500;function j6(e){var t=H6(e,function(r){return i.size===V6&&i.clear(),r}),i=t.cache;return t}var W6=j6,q6=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Y6=/\\(\\)?/g,X6=W6(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(q6,function(i,r,n,s){t.push(n?s.replace(Y6,"$1"):r||i)}),t}),Q6=X6;function K6(e){return e==null?"":yF(e)}var Z6=K6;function J6(e,t){return Wn(e)?e:K5(e,t)?[e]:Q6(Z6(e))}var ql=J6,$6=1/0;function eG(e){if(typeof e=="string"||fp(e))return e;var t=e+"";return t=="0"&&1/e==-$6?"-0":t}var wp=eG;function tG(e,t){t=ql(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[wp(t[i++])];return i&&i==r?e:void 0}var IE=tG;function iG(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}var A0=iG,$x=jn?jn.isConcatSpreadable:void 0;function rG(e){return Wn(e)||iu(e)||!!($x&&e&&e[$x])}var nG=rG;function BE(e,t,i,r,n){var s=-1,a=e.length;for(i||(i=nG),n||(n=[]);++s<a;){var o=e[s];t>0&&i(o)?t>1?BE(o,t-1,i,r,n):A0(n,o):r||(n[n.length]=o)}return n}var sG=BE;function aG(e){var t=e==null?0:e.length;return t?sG(e,1):[]}var oG=aG;function lG(e){return TE(ME(e,void 0,oG),e+"")}var NE=lG,hG=RE(Object.getPrototypeOf,Object),E0=hG,uG="[object Object]",cG=Function.prototype,dG=Object.prototype,kE=cG.toString,pG=dG.hasOwnProperty,fG=kE.call(Object);function mG(e){if(!xa(e)||ho(e)!=uG)return!1;var t=E0(e);if(t===null)return!0;var i=pG.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&kE.call(i)==fG}var UE=mG;function gG(e,t,i){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),i=i>n?n:i,i<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(n);++r<n;)s[r]=e[r+t];return s}var vG=gG;function yG(){this.__data__=new xp,this.size=0}var xG=yG;function bG(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var wG=bG;function _G(e){return this.__data__.get(e)}var SG=_G;function AG(e){return this.__data__.has(e)}var EG=AG,TG=200;function MG(e,t){var i=this.__data__;if(i instanceof xp){var r=i.__data__;if(!nu||r.length<TG-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new _0(r)}return i.set(e,t),this.size=i.size,this}var CG=MG;function Yl(e){var t=this.__data__=new xp(e);this.size=t.size}Yl.prototype.clear=xG;Yl.prototype.delete=wG;Yl.prototype.get=SG;Yl.prototype.has=EG;Yl.prototype.set=CG;var FE=Yl;function DG(e,t){return e&&Hl(t,w0(t),e)}var PG=DG;function LG(e,t){return e&&Hl(t,Cu(t),e)}var OG=LG,zE=typeof oe=="object"&&oe&&!oe.nodeType&&oe,eb=zE&&typeof ur=="object"&&ur&&!ur.nodeType&&ur,RG=eb&&eb.exports===zE,tb=RG?hn.Buffer:void 0,ib=tb?tb.allocUnsafe:void 0;function IG(e,t){if(t)return e.slice();var i=e.length,r=ib?ib(i):new e.constructor(i);return e.copy(r),r}var GE=IG;function BG(e,t){for(var i=-1,r=e==null?0:e.length,n=0,s=[];++i<r;){var a=e[i];t(a,i,e)&&(s[n++]=a)}return s}var NG=BG;function kG(){return[]}var HE=kG,UG=Object.prototype,FG=UG.propertyIsEnumerable,rb=Object.getOwnPropertySymbols,zG=rb?function(e){return e==null?[]:(e=Object(e),NG(rb(e),function(t){return FG.call(e,t)}))}:HE,T0=zG;function GG(e,t){return Hl(e,T0(e),t)}var HG=GG,VG=Object.getOwnPropertySymbols,jG=VG?function(e){for(var t=[];e;)A0(t,T0(e)),e=E0(e);return t}:HE,VE=jG;function WG(e,t){return Hl(e,VE(e),t)}var qG=WG;function YG(e,t,i){var r=t(e);return Wn(e)?r:A0(r,i(e))}var jE=YG;function XG(e){return jE(e,w0,T0)}var QG=XG;function KG(e){return jE(e,Cu,VE)}var WE=KG,ZG=co(hn,"DataView"),bg=ZG,JG=co(hn,"Promise"),wg=JG,$G=co(hn,"Set"),_g=$G,nb="[object Map]",eH="[object Object]",sb="[object Promise]",ab="[object Set]",ob="[object WeakMap]",lb="[object DataView]",tH=uo(bg),iH=uo(nu),rH=uo(wg),nH=uo(_g),sH=uo(xg),Ra=ho;(bg&&Ra(new bg(new ArrayBuffer(1)))!=lb||nu&&Ra(new nu)!=nb||wg&&Ra(wg.resolve())!=sb||_g&&Ra(new _g)!=ab||xg&&Ra(new xg)!=ob)&&(Ra=function(e){var t=ho(e),i=t==eH?e.constructor:void 0,r=i?uo(i):"";if(r)switch(r){case tH:return lb;case iH:return nb;case rH:return sb;case nH:return ab;case sH:return ob}return t});var M0=Ra,aH=Object.prototype,oH=aH.hasOwnProperty;function lH(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&oH.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var hH=lH,uH=hn.Uint8Array,hb=uH;function cH(e){var t=new e.constructor(e.byteLength);return new hb(t).set(new hb(e)),t}var C0=cH;function dH(e,t){var i=t?C0(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var pH=dH,fH=/\w*$/;function mH(e){var t=new e.constructor(e.source,fH.exec(e));return t.lastIndex=e.lastIndex,t}var gH=mH,ub=jn?jn.prototype:void 0,cb=ub?ub.valueOf:void 0;function vH(e){return cb?Object(cb.call(e)):{}}var yH=vH;function xH(e,t){var i=t?C0(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var qE=xH,bH="[object Boolean]",wH="[object Date]",_H="[object Map]",SH="[object Number]",AH="[object RegExp]",EH="[object Set]",TH="[object String]",MH="[object Symbol]",CH="[object ArrayBuffer]",DH="[object DataView]",PH="[object Float32Array]",LH="[object Float64Array]",OH="[object Int8Array]",RH="[object Int16Array]",IH="[object Int32Array]",BH="[object Uint8Array]",NH="[object Uint8ClampedArray]",kH="[object Uint16Array]",UH="[object Uint32Array]";function FH(e,t,i){var r=e.constructor;switch(t){case CH:return C0(e);case bH:case wH:return new r(+e);case DH:return pH(e,i);case PH:case LH:case OH:case RH:case IH:case BH:case NH:case kH:case UH:return qE(e,i);case _H:return new r;case SH:case TH:return new r(e);case AH:return gH(e);case EH:return new r;case MH:return yH(e)}}var zH=FH;function GH(e){return typeof e.constructor=="function"&&!y0(e)?rz(E0(e)):{}}var YE=GH,HH="[object Map]";function VH(e){return xa(e)&&M0(e)==HH}var jH=VH,db=Ml&&Ml.isMap,WH=db?b0(db):jH,qH=WH,YH="[object Set]";function XH(e){return xa(e)&&M0(e)==YH}var QH=XH,pb=Ml&&Ml.isSet,KH=pb?b0(pb):QH,ZH=KH,JH=1,$H=2,eV=4,XE="[object Arguments]",tV="[object Array]",iV="[object Boolean]",rV="[object Date]",nV="[object Error]",QE="[object Function]",sV="[object GeneratorFunction]",aV="[object Map]",oV="[object Number]",KE="[object Object]",lV="[object RegExp]",hV="[object Set]",uV="[object String]",cV="[object Symbol]",dV="[object WeakMap]",pV="[object ArrayBuffer]",fV="[object DataView]",mV="[object Float32Array]",gV="[object Float64Array]",vV="[object Int8Array]",yV="[object Int16Array]",xV="[object Int32Array]",bV="[object Uint8Array]",wV="[object Uint8ClampedArray]",_V="[object Uint16Array]",SV="[object Uint32Array]",kt={};kt[XE]=kt[tV]=kt[pV]=kt[fV]=kt[iV]=kt[rV]=kt[mV]=kt[gV]=kt[vV]=kt[yV]=kt[xV]=kt[aV]=kt[oV]=kt[KE]=kt[lV]=kt[hV]=kt[uV]=kt[cV]=kt[bV]=kt[wV]=kt[_V]=kt[SV]=!0;kt[nV]=kt[QE]=kt[dV]=!1;function nd(e,t,i,r,n,s){var a,o=t&JH,l=t&$H,h=t&eV;if(i&&(a=n?i(e,r,n,s):i(e)),a!==void 0)return a;if(!fr(e))return e;var c=Wn(e);if(c){if(a=hH(e),!o)return EE(e,a)}else{var u=M0(e),d=u==QE||u==sV;if(x0(e))return GE(e,o);if(u==KE||u==XE||d&&!n){if(a=l||d?{}:YE(e),!o)return l?qG(e,OG(a,e)):HG(e,PG(a,e))}else{if(!kt[u])return n?e:{};a=zH(e,u,o)}}s||(s=new FE);var p=s.get(e);if(p)return p;s.set(e,a),ZH(e)?e.forEach(function(f){a.add(nd(f,t,i,f,e,s))}):qH(e)&&e.forEach(function(f,v){a.set(v,nd(f,t,i,v,e,s))});var m=h?l?WE:QG:l?Cu:w0,g=c?void 0:m(e);return xz(g||e,function(f,v){g&&(v=f,f=e[v]),g0(a,v,nd(f,t,i,v,e,s))}),a}var ZE=nd,AV=1,EV=4;function TV(e){return ZE(e,AV|EV)}var JE=TV;function MV(e,t){return e!=null&&t in Object(e)}var CV=MV;function DV(e,t,i){t=ql(t,e);for(var r=-1,n=t.length,s=!1;++r<n;){var a=wp(t[r]);if(!(s=e!=null&&i(e,a)))break;e=e[a]}return s||++r!=n?s:(n=e==null?0:e.length,!!n&&v0(n)&&mp(a,n)&&(Wn(e)||iu(e)))}var PV=DV;function LV(e,t){return e!=null&&PV(e,t,CV)}var OV=LV;function RV(e){return function(t,i,r){for(var n=-1,s=Object(t),a=r(t),o=a.length;o--;){var l=a[e?o:++n];if(i(s[l],l,s)===!1)break}return t}}var IV=RV,BV=IV(),NV=BV,kV=function(){return hn.Date.now()},kf=kV,UV="Expected a function",FV=Math.max,zV=Math.min;function GV(e,t,i){var r,n,s,a,o,l,h=0,c=!1,u=!1,d=!0;if(typeof e!="function")throw new TypeError(UV);t=jx(t)||0,fr(i)&&(c=!!i.leading,u="maxWait"in i,s=u?FV(jx(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(_){var A=r,w=n;return r=n=void 0,h=_,a=e.apply(w,A),a}function m(_){return h=_,o=setTimeout(v,t),c?p(_):a}function g(_){var A=_-l,w=_-h,E=t-A;return u?zV(E,s-w):E}function f(_){var A=_-l,w=_-h;return l===void 0||A>=t||A<0||u&&w>=s}function v(){var _=kf();if(f(_))return y(_);o=setTimeout(v,g(_))}function y(_){return o=void 0,d&&r?p(_):(r=n=void 0,a)}function x(){o!==void 0&&clearTimeout(o),h=0,r=l=n=o=void 0}function b(){return o===void 0?a:y(kf())}function S(){var _=kf(),A=f(_);if(r=arguments,n=this,l=_,A){if(o===void 0)return m(l);if(u)return clearTimeout(o),o=setTimeout(v,t),p(l)}return o===void 0&&(o=setTimeout(v,t)),a}return S.cancel=x,S.flush=b,S}var $E=GV;function HV(e,t,i){(i!==void 0&&!gp(e[t],i)||i===void 0&&!(t in e))&&m0(e,t,i)}var Sg=HV;function VV(e){return xa(e)&&vp(e)}var jV=VV;function WV(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ag=WV;function qV(e){return Hl(e,Cu(e))}var YV=qV;function XV(e,t,i,r,n,s,a){var o=Ag(e,i),l=Ag(t,i),h=a.get(l);if(h){Sg(e,i,h);return}var c=s?s(o,l,i+"",e,t,a):void 0,u=c===void 0;if(u){var d=Wn(l),p=!d&&x0(l),m=!d&&!p&&LE(l);c=l,d||p||m?Wn(o)?c=o:jV(o)?c=EE(o):p?(u=!1,c=GE(l,!0)):m?(u=!1,c=qE(l,!0)):c=[]:UE(l)||iu(l)?(c=o,iu(o)?c=YV(o):(!fr(o)||f0(o))&&(c=YE(l))):u=!1}u&&(a.set(l,c),n(c,l,r,s,a),a.delete(l)),Sg(e,i,c)}var QV=XV;function e2(e,t,i,r,n){e!==t&&NV(t,function(s,a){if(n||(n=new FE),fr(s))QV(e,t,a,i,e2,r,n);else{var o=r?r(Ag(e,a),s,a+"",e,t,n):void 0;o===void 0&&(o=s),Sg(e,a,o)}},Cu)}var KV=e2;function ZV(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var JV=ZV;function $V(e,t){return t.length<2?e:IE(e,vG(t,0,-1))}var ej=$V,tj=Uz(function(e,t,i){KV(e,t,i)}),Ed=tj;function ij(e,t){return t=ql(t,e),e=ej(e,t),e==null||delete e[wp(JV(t))]}var rj=ij;function nj(e){return UE(e)?void 0:e}var sj=nj,aj=1,oj=2,lj=4,hj=NE(function(e,t){var i={};if(e==null)return i;var r=!1;t=_E(t,function(s){return s=ql(s,e),r||(r=s.length>1),s}),Hl(e,WE(e),i),r&&(i=ZE(i,aj|oj|lj,sj));for(var n=t.length;n--;)rj(i,t[n]);return i}),Eg=hj;function uj(e,t,i,r){if(!fr(e))return e;t=ql(t,e);for(var n=-1,s=t.length,a=s-1,o=e;o!=null&&++n<s;){var l=wp(t[n]),h=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=a){var c=o[l];h=r?r(c,l,o):void 0,h===void 0&&(h=fr(c)?c:mp(t[n+1])?[]:{})}g0(o,l,h),o=o[l]}return e}var cj=uj;function dj(e,t,i){for(var r=-1,n=t.length,s={};++r<n;){var a=t[r],o=IE(e,a);i(o,a)&&cj(s,ql(a,e),o)}return s}var pj=dj;function fj(e,t){return pj(e,t,function(i,r){return OV(e,r)})}var mj=fj,gj=NE(function(e,t){return e==null?{}:mj(e,t)}),Td=gj,t2,vj=new Promise(e=>{t2=e}),fb=!1;async function yj(){if(fb)return;let e=await Wv(()=>import("./physics.7e974586.js"),[]);await e.init(),t2(e),fb=!0}var Fi=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r={...i,[e]:t};return Object.setPrototypeOf(r,Fi.prototype),r}}add(e,t){var i,r;return(r=(i=this.runOp({type:1,id:e,data:t}))==null?void 0:i.data)!=null?r:this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:n,data:s}=e,a={...t,[n]:s};return Object.setPrototypeOf(a,Fi.prototype),{data:a,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let n={...t};return Object.setPrototypeOf(n,Fi.prototype),delete n[i],{data:n,actual:e,reverse:{type:1,id:i,data:r}}}}throw new Error("illegal arg")}};function D0(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&D0(r)}return Object.freeze(e)}function xj(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var bj=class extends Error{};function Qs(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=e+(t-e)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function Md(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function wj(){return typeof process<"u"}function i2(e,t){for(let i of e)t(i.id,i.data),i2(i.children,t)}function r2(e,t){t(e.id,e.data);for(let i of e.children)r2(i,t)}var xs=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,xs.prototype)}deepFreeze(){let e=0;for(;e<this.length;)D0(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&r2(i,t)}}traverse(e){i2(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,xs.prototype);let n=r;return n.fillCaches(),n}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:n,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((h,c)=>h.fi-c.fi),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);e.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let u=t;for(;u!==null;){if(u===void 0)throw new Error;if(u===r)throw new bj("cyclic tree");u=this.parent(u)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(u=>u.id===r);a=[...a];let l=a.splice(o,1)[0],h=this.modifyArrayBy(n,a);n=t,a=h.childrenArray(n);let c=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((u,d)=>u.fi-d.fi),e.localIndex=a.indexOf(l),h=h.modifyArrayBy(n,a),{data:h,actual:e,reverse:{type:9,parent:s,fi:c,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>xj(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),n=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...n,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return Qs(0,i,i);{let n=r[0].fi;return Qs(n-i,n,i)}}else{let n=this.get(t);if(n===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return Qs(a,a+i,i)}else return Qs(n.fi,s.fi,i)}}},Tg;(e=>{function t(i,r){if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let h=parseInt(l);if(isNaN(h))throw new Error("wrong index");s[l]=a[h],a[h]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let h=n[l];h===void 0?delete a[l]:a[l]=h,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}e.runOp=t})(Tg||(Tg={}));var Ct=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Ct.prototype)}deepFreeze(){let e=0;for(;e<this.length;)D0(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===e);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,Ct.prototype);let t=e;return wj()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}}addOp(e){let{fi:t,id:i,data:r}=e,n=this,s={fi:t,id:i,data:r};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(s=>s.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...n}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let n=r.findIndex(o=>o.id===i);if(n===-1)return null;let s=r[n].fi,a={...r[n],fi:t};return r[n]=a,r.sort((o,l)=>o.fi-l.fi),e.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return Qs(0,t,t);{let r=i[0].fi;return Qs(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return Qs(s,s+t,t)}else return Qs(r.fi,n.fi,t)}}},Cd=class{unusedFun(e){}runOp(e){let t=[],i=this,r=0,n={};for(;r<e.path.length;)t.push(i),i=i===void 0?void 0:i[e.path[r]],r+=1;i={...i};for(let[o,l]of Object.entries(e.props)){let h=i[o];n[o]=h,l===void 0?delete i[o]:i[o]=l}for(;r>0;)Object.keys(i).length===0?(i={...t[r-1]},delete i[e.path[r-1]]):i={...t[r-1],[e.path[r-1]]:i},r-=1;let s=Object.setPrototypeOf(i,Cd.prototype),a={...e,props:n};return{data:s,actual:e,reverse:a}}},mb;(e=>{function t(r,n){var s;return(s=su(r,n))!=null?s:r}e.apply=t;function i(r,n){if(n.type===0){let s=au.zoom(r,n.path);if(s===void 0)return n;if(typeof s=="string"||typeof s=="number"||Md(s))return;if(s&&typeof s=="object"){let a={...n.props};for(let o of Object.keys(s))delete a[o];return{...n,props:a}}else return}else if(n.type===1||n.type===4||n.type===7){let s=au.zoom(r,[...n.path,n.id]);if(s===void 0)return n;if(typeof s=="string"||typeof s=="number"||Md(s))return;if(s&&typeof s=="object"){let a={...n.data,...s};return{...n,data:a}}else return}else return n}e.filterOp=i})(mb||(mb={}));function n2(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=su(n.data,t[s]);i=i||a!==void 0,a===void 0&&(a=n.data);let o=n2(n.children,t);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}});if(i)return r}function _j(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=su(n.data,t[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function su(e,t){if(t!==void 0)if(e instanceof xs){let i=n2(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof Ct)return _j(e,t);if(Array.isArray(e)){let i=!1,r=e.map((n,s)=>{let a=su(n,t[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(e&&typeof e=="object"){let i={},r=!1;for(let[n,s]of Object.entries(e)){let a=su(s,t[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}else return t!=null?t:e}}var s2=Symbol(),Du=Symbol(),Pu=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let n=i;for(;!(r instanceof o2);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[Du];i&&i(),delete this._children[e]}}}},Sj=class extends Pu{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,Tg.runOp(this._current,e),e.path)}},Aj=class extends Pu{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,Fi.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},a2={get(e,t){if(t===Du)return()=>{e._parent=null};if(t===s2)return e._current;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[t];if(n!==void 0)return n;let s=i[t],a=_p(e,t,s);return a!==s?(r===void 0&&(r={},e._children=r),r[t]=a,a):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},Ej={...a2,set(e,t,i){var n;let r={type:0,props:{[t]:(n=Ir(i))!=null?n:i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},Tj={...a2,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},P0=class extends Pu{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[Du]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=_p(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}add(e,t,i,r,n){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:n})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},Mj=class extends Pu{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i,this[Du]=()=>{this._parent=null}}feedOp(e){let{path:t,...i}=e;this.reportOp(i,this._current.runOp(e),t)}},L0=class extends Pu{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[Du]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,n=this._current[i].fi;e(this.data(this._current[i].id),r,n)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=_p(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function Uf(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&au.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var o2=class{constructor(e){this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){Uf(this.ts,t,e),Uf(this.actual,i,e),Uf(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function _p(e,t,i){return i instanceof xs?new P0(e,t,i):i instanceof Ct?new L0(e,t,i):i instanceof Cd?new Mj(e,t,i):i instanceof Fi?new Proxy(new Aj(e,t,i),Tj):i!==null&&typeof i=="object"?Md(i)?i:new Proxy(new Sj(e,t,i),Ej):i}function l2(e){let t=new o2(e);return[_p(t,"",e),t]}function gb(e,t){let[i,r]=l2(e);return t(i),r.result()}function Ir(e){return e instanceof P0||e instanceof L0?e._current:e!==null&&typeof e=="object"?e[s2]:e}var au;(e=>{function t(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}e.equal=t;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let h={...a};return Object.keys(l).forEach(c=>{delete h[c]}),h}else return a}e.removeOverridden=i;function r(s,a){if((s instanceof xs||s instanceof P0)&&typeof a=="string"||(s instanceof Ct||s instanceof L0)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object")return s[a]}e.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}e.zoom=n})(au||(au={}));var h2=class{},vb=class extends h2{constructor(e){super(),this.id=e}},yb=class extends h2{constructor(e){super(),this.data=e}},Mg;try{Mg=new TextDecoder}catch{}var Le,ea,X=0,Ki={},_t,Ks,Tr=0,Mn=0,ar,ps,Yi=[],Et,xb={useRecords:!1,mapsAsObjects:!0},u2=class{},c2=new u2;c2.name="MessagePack 0xC1";var Cl=!1,Dd=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Le)return v2(()=>(Dg(),this?this.unpack(e,t):Dd.prototype.unpack.call(xb,e,t)));ea=t>-1?t:e.length,X=0,Mn=0,Ks=null,ar=null,Le=e;try{Et=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw Le=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof Dd){if(Ki=this,this.structures)return _t=this.structures,Cc();(!_t||_t.length>0)&&(_t=[])}else Ki=xb,(!_t||_t.length>0)&&(_t=[]);return Cc()}unpackMultiple(e,t){let i,r=0;try{Cl=!0;let n=e.length,s=this?this.unpack(e,n):Ap.unpack(e,n);if(t){for(t(s);X<n;)if(r=X,t(Cc())===!1)return}else{for(i=[s];X<n;)r=X,i.push(Cc());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{Cl=!1,Dg()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let n=e[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],n=t[i];n&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function Cc(){try{if(!Ki.trusted&&!Cl){let t=_t.sharedLength||0;t<_t.length&&(_t.length=t)}let e=Qt();if(X==ea)_t.restoreStructures&&bb(),_t=null,Le=null,ps&&(ps=null);else if(X>ea){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!Cl)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw _t.restoreStructures&&bb(),Dg(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function bb(){for(let e in _t.restoreStructures)_t[e]=_t.restoreStructures[e];_t.restoreStructures=null}function Qt(){let e=Le[X++];if(e<160)if(e<128){if(e<64)return e;{let t=_t[e&63]||Ki.getStructures&&d2()[e&63];return t?(t.read||(t.read=O0(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Ki.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[f2()]=Qt();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Qt(),Qt());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Qt();return t}else if(e<192){let t=e-160;if(Mn>=X)return Ks.slice(X-Tr,(X+=t)-Tr);if(Mn==0&&ea<140){let i=t<16?R0(t):p2(t);if(i!=null)return i}return Cg(t)}else{let t;switch(e){case 192:return null;case 193:return ar?(t=Qt(),t>0?ar[1].slice(ar.position1,ar.position1+=t):ar[0].slice(ar.position0,ar.position0-=t)):c2;case 194:return!1;case 195:return!0;case 196:return Ff(Le[X++]);case 197:return t=Et.getUint16(X),X+=2,Ff(t);case 198:return t=Et.getUint32(X),X+=4,Ff(t);case 199:return Ta(Le[X++]);case 200:return t=Et.getUint16(X),X+=2,Ta(t);case 201:return t=Et.getUint32(X),X+=4,Ta(t);case 202:if(t=Et.getFloat32(X),Ki.useFloat32>2){let i=I0[(Le[X]&127)<<1|Le[X+1]>>7];return X+=4,(i*t+(t>0?.5:-.5)>>0)/i}return X+=4,t;case 203:return t=Et.getFloat64(X),X+=8,t;case 204:return Le[X++];case 205:return t=Et.getUint16(X),X+=2,t;case 206:return t=Et.getUint32(X),X+=4,t;case 207:return Ki.int64AsNumber?(t=Et.getUint32(X)*4294967296,t+=Et.getUint32(X+4)):t=Et.getBigUint64(X),X+=8,t;case 208:return Et.getInt8(X++);case 209:return t=Et.getInt16(X),X+=2,t;case 210:return t=Et.getInt32(X),X+=4,t;case 211:return Ki.int64AsNumber?(t=Et.getInt32(X)*4294967296,t+=Et.getUint32(X+4)):t=Et.getBigInt64(X),X+=8,t;case 212:if(t=Le[X++],t==114)return Eb(Le[X++]&63);{let i=Yi[t];if(i)return i.read?(X++,i.read(Qt())):i.noBuffer?(X++,i()):i(Le.subarray(X,++X));throw new Error("Unknown extension "+t)}case 213:return t=Le[X],t==114?(X++,Eb(Le[X++]&63,Le[X++])):Ta(2);case 214:return Ta(4);case 215:return Ta(8);case 216:return Ta(16);case 217:return t=Le[X++],Mn>=X?Ks.slice(X-Tr,(X+=t)-Tr):Dj(t);case 218:return t=Et.getUint16(X),X+=2,Mn>=X?Ks.slice(X-Tr,(X+=t)-Tr):Pj(t);case 219:return t=Et.getUint32(X),X+=4,Mn>=X?Ks.slice(X-Tr,(X+=t)-Tr):Lj(t);case 220:return t=Et.getUint16(X),X+=2,_b(t);case 221:return t=Et.getUint32(X),X+=4,_b(t);case 222:return t=Et.getUint16(X),X+=2,Sb(t);case 223:return t=Et.getUint32(X),X+=4,Sb(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var Cj=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function O0(e,t){function i(){if(i.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map(s=>Cj.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(Qt);return e.highByte===0&&(e.read=wb(t,e.read)),n()}let r={};for(let n=0,s=e.length;n<s;n++){let a=e[n];r[a]=Qt()}return r}return i.count=0,e.highByte===0?wb(t,i):i}var wb=(e,t)=>function(){let i=Le[X++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),n=_t[r]||d2()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=O0(n,e)),n.read()};function d2(){let e=v2(()=>(Le=null,Ki.getStructures()));return _t=Ki._mergeStructures(e,_t)}var Cg=Sp,Dj=Sp,Pj=Sp,Lj=Sp;function Sp(e){let t;if(e<16&&(t=R0(e)))return t;if(e>64&&Mg)return Mg.decode(Le.subarray(X,X+=e));let i=X+e,r=[];for(t="";X<i;){let n=Le[X++];if((n&128)===0)r.push(n);else if((n&224)===192){let s=Le[X++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=Le[X++]&63,a=Le[X++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=Le[X++]&63,a=Le[X++]&63,o=Le[X++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(t+=yi.apply(String,r),r.length=0)}return r.length>0&&(t+=yi.apply(String,r)),t}function _b(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Qt();return t}function Sb(e){if(Ki.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[f2()]=Qt();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Qt(),Qt());return t}}var yi=String.fromCharCode;function p2(e){let t=X,i=new Array(e);for(let r=0;r<e;r++){let n=Le[X++];if((n&128)>0){X=t;return}i[r]=n}return yi.apply(String,i)}function R0(e){if(e<4)if(e<2){if(e===0)return"";{let t=Le[X++];if((t&128)>1){X-=1;return}return yi(t)}}else{let t=Le[X++],i=Le[X++];if((t&128)>0||(i&128)>0){X-=2;return}if(e<3)return yi(t,i);let r=Le[X++];if((r&128)>0){X-=3;return}return yi(t,i,r)}else{let t=Le[X++],i=Le[X++],r=Le[X++],n=Le[X++];if((t&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){X-=4;return}if(e<6){if(e===4)return yi(t,i,r,n);{let s=Le[X++];if((s&128)>0){X-=5;return}return yi(t,i,r,n,s)}}else if(e<8){let s=Le[X++],a=Le[X++];if((s&128)>0||(a&128)>0){X-=6;return}if(e<7)return yi(t,i,r,n,s,a);let o=Le[X++];if((o&128)>0){X-=7;return}return yi(t,i,r,n,s,a,o)}else{let s=Le[X++],a=Le[X++],o=Le[X++],l=Le[X++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){X-=8;return}if(e<10){if(e===8)return yi(t,i,r,n,s,a,o,l);{let h=Le[X++];if((h&128)>0){X-=9;return}return yi(t,i,r,n,s,a,o,l,h)}}else if(e<12){let h=Le[X++],c=Le[X++];if((h&128)>0||(c&128)>0){X-=10;return}if(e<11)return yi(t,i,r,n,s,a,o,l,h,c);let u=Le[X++];if((u&128)>0){X-=11;return}return yi(t,i,r,n,s,a,o,l,h,c,u)}else{let h=Le[X++],c=Le[X++],u=Le[X++],d=Le[X++];if((h&128)>0||(c&128)>0||(u&128)>0||(d&128)>0){X-=12;return}if(e<14){if(e===12)return yi(t,i,r,n,s,a,o,l,h,c,u,d);{let p=Le[X++];if((p&128)>0){X-=13;return}return yi(t,i,r,n,s,a,o,l,h,c,u,d,p)}}else{let p=Le[X++],m=Le[X++];if((p&128)>0||(m&128)>0){X-=14;return}if(e<15)return yi(t,i,r,n,s,a,o,l,h,c,u,d,p,m);let g=Le[X++];if((g&128)>0){X-=15;return}return yi(t,i,r,n,s,a,o,l,h,c,u,d,p,m,g)}}}}}function Ff(e){return Ki.copyBuffers?Uint8Array.prototype.slice.call(Le,X,X+=e):Le.subarray(X,X+=e)}function Ta(e){let t=Le[X++];if(Yi[t])return Yi[t](Le.subarray(X,X+=e));throw new Error("Unknown extension type "+t)}var Ab=new Array(4096);function f2(){let e=Le[X++];if(e>=160&&e<192){if(e=e-160,Mn>=X)return Ks.slice(X-Tr,(X+=e)-Tr);if(!(Mn==0&&ea<180))return Cg(e)}else return X--,Qt();let t=(e<<5^(e>1?Et.getUint16(X):e>0?Le[X]:0))&4095,i=Ab[t],r=X,n=X+e-3,s,a=0;if(i&&i.bytes==e){for(;r<n;){if(s=Et.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=Le[r++],s!=i[a++]){r=1879048192;break}if(r===n)return X=r,i.string;n-=3,r=X}for(i=[],Ab[t]=i,i.bytes=e;r<n;)s=Et.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=Le[r++],i.push(s);let o=e<16?R0(e):p2(e);return o!=null?i.string=o:i.string=Cg(e)}var Eb=(e,t)=>{var i=Qt();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let n=_t[e];return n&&n.isShared&&((_t.restoreStructures||(_t.restoreStructures=[]))[e]=n),_t[e]=i,i.read=O0(i,r),i.read()},m2=typeof self=="object"?self:global;Yi[0]=()=>{};Yi[0].noBuffer=!0;Yi[101]=()=>{let e=Qt();return(m2[e[0]]||Error)(e[1])};Yi[105]=e=>{let t=Et.getUint32(X-4);ps||(ps=new Map);let i=Le[X],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};ps.set(t,n);let s=Qt();return n.used?Object.assign(r,s):(n.target=s,s)};Yi[112]=e=>{let t=Et.getUint32(X-4),i=ps.get(t);return i.used=!0,i.target};Yi[115]=()=>new Set(Qt());var g2=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");Yi[116]=e=>{let t=e[0],i=g2[t];if(!i)throw new Error("Could not find typed array for code "+t);return new m2[i](Uint8Array.prototype.slice.call(e,1).buffer)};Yi[120]=()=>{let e=Qt();return new RegExp(e[0],e[1])};Yi[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=X;X+=t-4,ar=[Qt(),Qt()],ar.position0=0,ar.position1=0;let r=X;X=i;try{return Qt()}finally{X=r}};Yi[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function v2(e){let t=ea,i=X,r=Tr,n=Mn,s=Ks,a=ps,o=ar,l=new Uint8Array(Le.slice(0,ea)),h=_t,c=_t.slice(0,_t.length),u=Ki,d=Cl,p=e();return ea=t,X=i,Tr=r,Mn=n,Ks=s,ps=a,ar=o,Le=l,Cl=d,_t=h,_t.splice(0,_t.length,...c),Ki=u,Et=new DataView(Le.buffer,Le.byteOffset,Le.byteLength),p}function Dg(){Le=null,ps=null,_t=null}function Oj(e){e.unpack?Yi[e.type]=e.unpack:Yi[e.type]=e}var I0=new Array(147);for(let e=0;e<256;e++)I0[e]=+("1e"+Math.floor(45.15-e*.30103));var Ap=new Dd({useRecords:!1});Ap.unpack;Ap.unpackMultiple;Ap.unpack;var Rj=new Float32Array(1);new Uint8Array(Rj.buffer,0,4);var sd;try{sd=new TextEncoder}catch{}var Pd,B0,Ep=typeof Buffer<"u",zf=Ep?Buffer.allocUnsafeSlow:Uint8Array,y2=Ep?Buffer:Uint8Array,Tb=Ep?4294967296:2144337920,le,ti,ee=0,gn,vn=null,Ij=/[\u0080-\uFFFF]/,dh=Symbol("record-id"),x2=class extends Dd{constructor(e){super(e),this.offset=0;let t,i,r,n,s,a=0,o=y2.prototype.utf8Write?function(_,A,w){return le.utf8Write(_,A,w)}:sd&&sd.encodeInto?function(_,A){return sd.encodeInto(_,le.subarray(A)).written}:!1,l=this;e||(e={});let h=e&&e.sequential,c=e.structures||e.saveStructures,u=e.maxSharedStructures;if(u==null&&(u=c?32:0),u>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=c?32:64),h&&!e.saveStructures&&(this.structures=[]);let p=u>32||d+u>64,m=u+64,g=u+d+64;if(g>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let f=[],v=0,y=0;this.pack=this.encode=function(_,A){if(le||(le=new zf(8192),ti=new DataView(le.buffer,0,8192),ee=0),gn=le.length-10,gn-ee<2048?(le=new zf(le.length),ti=new DataView(le.buffer,0,le.length),gn=le.length-10,ee=0):ee=ee+7&2147483640,t=ee,s=l.structuredClone?new Map:null,l.bundleStrings?(vn=["",""],le[ee++]=214,le[ee++]=98,vn.position=ee-t,ee+=4):vn=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let w=i.sharedLength||0;if(w>u)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let E=0;E<w;E++){let T=i[E];if(!T)continue;let C,P=i.transitions;for(let k=0,D=T.length;k<D;k++){let R=T[k];C=P[R],C||(C=P[R]=Object.create(null)),P=C}P[dh]=E+64}a=w}h||(i.nextId=w+64)}r&&(r=!1),n=i||[];try{if(x(_),vn){ti.setUint32(vn.position+t,ee-vn.position-t);let w=vn;vn=null,x(w[0]),x(w[1])}if(l.offset=ee,s&&s.idsToInsert){ee+=s.idsToInsert.length*6,ee>gn&&S(ee),l.offset=ee;let w=Nj(le.subarray(t,ee),s.idsToInsert);return s=null,w}return A&kj?(le.start=t,le.end=ee,le):le.subarray(t,ee)}finally{if(i){if(y<10&&y++,v>1e4)i.transitions=null,y=0,v=0,f.length>0&&(f=[]);else if(f.length>0&&!h){for(let w=0,E=f.length;w<E;w++)f[w][dh]=0;f=[]}if(r&&l.saveStructures){let w=i.sharedLength||u;i.length>w&&(i=i.slice(0,w));let E=le.subarray(t,ee);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(_)):(a=w,E)}}A&Uj&&(ee=t)}};let x=_=>{ee>gn&&(le=S(ee));var A=typeof _,w;if(A==="string"){let E=_.length;if(vn&&E>=8&&E<4096){let P=Ij.test(_);vn[P?0:1]+=_,le[ee++]=193,x(P?-E:E);return}let T;E<32?T=1:E<256?T=2:E<65536?T=3:T=5;let C=E*3;if(ee+C>gn&&(le=S(ee+C)),E<64||!o){let P,k,D,R=ee+T;for(P=0;P<E;P++)k=_.charCodeAt(P),k<128?le[R++]=k:k<2048?(le[R++]=k>>6|192,le[R++]=k&63|128):(k&64512)===55296&&((D=_.charCodeAt(P+1))&64512)===56320?(k=65536+((k&1023)<<10)+(D&1023),P++,le[R++]=k>>18|240,le[R++]=k>>12&63|128,le[R++]=k>>6&63|128,le[R++]=k&63|128):(le[R++]=k>>12|224,le[R++]=k>>6&63|128,le[R++]=k&63|128);w=R-ee-T}else w=o(_,ee+T,C);w<32?le[ee++]=160|w:w<256?(T<2&&le.copyWithin(ee+2,ee+1,ee+1+w),le[ee++]=217,le[ee++]=w):w<65536?(T<3&&le.copyWithin(ee+3,ee+2,ee+2+w),le[ee++]=218,le[ee++]=w>>8,le[ee++]=w&255):(T<5&&le.copyWithin(ee+5,ee+3,ee+3+w),le[ee++]=219,ti.setUint32(ee,w),ee+=4),ee+=w}else if(A==="number")if(_>>>0===_)_<64?le[ee++]=_:_<256?(le[ee++]=204,le[ee++]=_):_<65536?(le[ee++]=205,le[ee++]=_>>8,le[ee++]=_&255):(le[ee++]=206,ti.setUint32(ee,_),ee+=4);else if(_>>0===_)_>=-32?le[ee++]=256+_:_>=-128?(le[ee++]=208,le[ee++]=_+256):_>=-32768?(le[ee++]=209,ti.setInt16(ee,_),ee+=2):(le[ee++]=210,ti.setInt32(ee,_),ee+=4);else{let E;if((E=this.useFloat32)>0&&_<4294967296&&_>=-2147483648){le[ee++]=202,ti.setFloat32(ee,_);let T;if(E<4||(T=_*I0[(le[ee]&127)<<1|le[ee+1]>>7])>>0===T){ee+=4;return}else ee--}le[ee++]=203,ti.setFloat64(ee,_),ee+=8}else if(A==="object")if(!_)le[ee++]=192;else{if(s){let T=s.get(_);if(T){if(!T.id){let C=s.idsToInsert||(s.idsToInsert=[]);T.id=C.push(T)}le[ee++]=214,le[ee++]=112,ti.setUint32(ee,T.id),ee+=4;return}else s.set(_,{offset:ee-t})}let E=_.constructor;if(E===Object)b(_,!0);else if(E===Array){w=_.length,w<16?le[ee++]=144|w:w<65536?(le[ee++]=220,le[ee++]=w>>8,le[ee++]=w&255):(le[ee++]=221,ti.setUint32(ee,w),ee+=4);for(let T=0;T<w;T++)x(_[T])}else if(E===Map){w=_.size,w<16?le[ee++]=128|w:w<65536?(le[ee++]=222,le[ee++]=w>>8,le[ee++]=w&255):(le[ee++]=223,ti.setUint32(ee,w),ee+=4);for(let[T,C]of _)x(T),x(C)}else{for(let T=0,C=Pd.length;T<C;T++){let P=B0[T];if(_ instanceof P){let k=Pd[T];if(k.write){k.type&&(le[ee++]=212,le[ee++]=k.type,le[ee++]=0),x(k.write.call(this,_));return}let D=le,R=ti,G=ee;le=null;let N;try{N=k.pack.call(this,_,L=>(le=D,D=null,ee+=L,ee>gn&&S(ee),{target:le,targetView:ti,position:ee-L}),x)}finally{D&&(le=D,ti=R,ee=G,gn=le.length-10)}N&&(N.length+ee>gn&&S(N.length+ee),ee=Bj(N,le,ee,k.type));return}}b(_,!_.hasOwnProperty)}}else if(A==="boolean")le[ee++]=_?195:194;else if(A==="bigint"){if(_<BigInt(1)<<BigInt(63)&&_>=-(BigInt(1)<<BigInt(63)))le[ee++]=211,ti.setBigInt64(ee,_);else if(_<BigInt(1)<<BigInt(64)&&_>0)le[ee++]=207,ti.setBigUint64(ee,_);else if(this.largeBigIntToFloat)le[ee++]=203,ti.setFloat64(ee,Number(_));else throw new RangeError(_+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");ee+=8}else if(A==="undefined")this.encodeUndefinedAsNil?le[ee++]=192:(le[ee++]=212,le[ee++]=0,le[ee++]=0);else if(A==="function")x(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+A)},b=this.useRecords===!1?this.variableMapSize?_=>{let A=Object.keys(_),w=A.length;w<16?le[ee++]=128|w:w<65536?(le[ee++]=222,le[ee++]=w>>8,le[ee++]=w&255):(le[ee++]=223,ti.setUint32(ee,w),ee+=4);let E;for(let T=0;T<w;T++)x(E=A[T]),x(_[E])}:(_,A)=>{le[ee++]=222;let w=ee-t;ee+=2;let E=0;for(let T in _)(A||_.hasOwnProperty(T))&&(x(T),x(_[T]),E++);le[w+++t]=E>>8,le[w+t]=E&255}:_=>{let A=Object.keys(_),w,E=n.transitions||(n.transitions=Object.create(null)),T=0;for(let P=0,k=A.length;P<k;P++){let D=A[P];w=E[D],w||(w=E[D]=Object.create(null),T++),E=w}let C=E[dh];if(C)C>=96&&p?(le[ee++]=((C-=96)&31)+96,le[ee++]=C>>5):le[ee++]=C;else{C=n.nextId,C||(C=64),C<m&&this.shouldShareStructure&&!this.shouldShareStructure(A)?(C=n.nextOwnId,C<g||(C=m),n.nextOwnId=C+1):(C>=g&&(C=m),n.nextId=C+1);let P=A.highByte=C>=96&&p?C-96>>5:-1;E[dh]=C,n[C-64]=A,C<m?(A.isShared=!0,n.sharedLength=C-63,r=!0,P>=0?(le[ee++]=(C&31)+96,le[ee++]=P):le[ee++]=C):(P>=0?(le[ee++]=213,le[ee++]=114,le[ee++]=(C&31)+96,le[ee++]=P):(le[ee++]=212,le[ee++]=114,le[ee++]=C),T&&(v+=y*T),f.length>=d&&(f.shift()[dh]=0),f.push(E),x(A))}for(let P=0,k=A.length;P<k;P++)x(_[A[P]])},S=_=>{let A;if(_>16777216){if(_-t>Tb)throw new Error("Packed buffer would be larger than maximum buffer size");A=Math.min(Tb,Math.round(Math.max((_-t)*(_>67108864?1.25:2),4194304)/4096)*4096)}else A=(Math.max(_-t<<2,le.length-1)>>12)+1<<12;let w=new zf(A);return ti=new DataView(w.buffer,0,A),le.copy?le.copy(w,0,t,_):w.set(le.slice(t,_)),ee-=t,t=0,gn=w.length-10,le=w}}useBuffer(e){le=e,ti=new DataView(le.buffer,le.byteOffset,le.byteLength),ee=0}};B0=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,u2];Pd=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=t(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=t(10);n[a++]=215,n[a++]=255,s.setUint32(a,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=t(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=t(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,e.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:n,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?Mb(e,16,t):Cb(Ep?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==y2&&this.structuredClone?Mb(e,g2.indexOf(i.name),t):Cb(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function Mb(e,t,i,r){let n=e.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function Cb(e,t){let i=e.byteLength;var r,n;if(i<256){var{target:r,position:n}=t(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=t(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=t(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(e,n)}function Bj(e,t,i,r){let n=e.length;switch(n){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:n<256?(t[i++]=199,t[i++]=n):n<65536?(t[i++]=200,t[i++]=n>>8,t[i++]=n&255):(t[i++]=201,t[i++]=n>>24,t[i++]=n>>16&255,t[i++]=n>>8&255,t[i++]=n&255)}return t[i++]=r,t.set(e,i),i+=n,i}function Nj(e,t){let i,r=t.length*6,n=e.length-r;for(t.sort((s,a)=>s.offset>a.offset?1:-1);i=t.pop();){let s=i.offset,a=i.id;e.copyWithin(s+r,s,n),r-=6;let o=s+r;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=a&255,n=s}return e}function Xl(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");B0.unshift(e.Class),Pd.unshift(e)}Oj(e)}var b2=new x2({useRecords:!1});b2.pack;b2.pack;var kj=512,Uj=1024,Db=new x2({structuredClone:!0});Xl({Class:Fi.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,Fi.prototype),e}});Xl({Class:Ct.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Ct.prototype),e}});Xl({Class:xs.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,xs.prototype),e}});Xl({Class:vb.prototype.constructor,type:4,write(e){return e.id},read(e){return new vb(e)}});Xl({Class:yb.prototype.constructor,type:5,write(e){return e.data},read(e){return new yb(e)}});Xl({Class:Cd.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,Cd.prototype),e}});function Fj(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function Pg(e){if(Md(e))return e;if(Array.isArray(e))return e.map(Pg);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=Pg(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var Lg;(e=>{function t(n){return Db.pack(n)}e.serialize=t;function i(n){return Db.unpack(n)}e.deserialize=i;function r(n){return Fj(t(Pg(n))).toString()}e.checksum=r})(Lg||(Lg={}));var Gf={LookAt:[],Follow:[],MouseHover:["Transition"],Scroll:["Transition"],Start:["Transition","Audio"],Conditional:["Transition","Audio"],MouseDown:["Transition","Audio","Link"],MouseUp:["Transition","Audio","Link"],KeyDown:["Transition","Audio","Link"],KeyUp:["Transition","Audio","Link"],GameControl:["Transition","Audio"],Collision:["Transition","Audio"]},Pb;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="KeyDown"||r.type==="KeyUp"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"?{type:r,toggle:!1,actions:new Ct}:{type:r,key:void 0,toggle:!1,actions:new Ct}}e.defaultData=i})(Pb||(Pb={}));var Ld;(e=>{function t(i){return{type:"Property",value:[i!=null?i:null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(Ld||(Ld={}));var Og;(e=>{function t(n){return{type:"Comparison",operator:"==",lOperand:Ld.propertyDefaultData(n),rOperand:{...Ld.valueDefaultData}}}e.comparisonDefaultData=t;function i(n){return{type:"Distance",toObject:n!=null?n:null,fromObject:n!=null?n:null,distance:200}}e.distanceDefaultData=i;function r(n,s){return{type:"State",object:n!=null?n:null,state:s!=null?s:null}}e.stateDefaultData=r})(Og||(Og={}));var Lb;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",inActions:new Ct,outActions:new Ct,condition:Og.distanceDefaultData(r)}}e.defaultData=i})(Lb||(Lb={}));var Ob;(e=>e.defaultData={type:"Follow"})(Ob||(Ob={}));var Rb;(e=>{function t(){return{type:"LookAt",distance:1e3}}e.defaultData=t})(Rb||(Rb={}));var Ib;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",actions:new Ct}}e.defaultData=i})(Ib||(Ib={}));var Bb;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",steps:100,actions:new Ct}}e.defaultData=i})(Bb||(Bb={}));var Nb;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",actions:new Ct}}e.defaultData=i})(Nb||(Nb={}));var kb;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",toggle:!1,target:"character",actions:new Ct}}e.defaultData=i})(kb||(kb={}));var tl;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s]}e.lerp=i})(tl||(tl={}));var jh;(e=>{function t(s,a){return s[0]===a[0]&&s[1]===a[1]&&s[2]===a[2]}e.isEqual=t;function i(s,a){return[s[0]+a[0],s[1]+a[1],s[2]+a[2]]}e.add=i;function r(s,a){return[s[0]-a[0],s[1]-a[1],s[2]-a[2]]}e.sub=r;function n(s,a,o){return[s[0]+(a[0]-s[0])*o,s[1]+(a[1]-s[1])*o,s[2]+(a[2]-s[2])*o]}e.lerp=n})(jh||(jh={}));var Od;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}e.lerp=i})(Od||(Od={}));var Dl;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}e.isEqual=t;function i(n){return n!=null?n:e.identity}e.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let h=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/h,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/h,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/h}return a}e.applyMatrix4=r})(Dl||(Dl={}));var lr;(e=>{e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function t(a){return{r:Math.round(a.r*255),g:Math.round(a.g*255),b:Math.round(a.b*255),a:1}}e.toRgb255a1=t;function i(a){return{r:a.r,g:a.g,b:a.b}}e.clone=i;function r(a){return a=Math.floor(a),{r:(a>>16&255)/255,g:(a>>8&255)/255,b:(a&255)/255}}e.fromHex=r;function n(a,o){return a.r===o.r&&a.g===o.g&&a.b===o.b}e.equals=n;function s(a,o,l){return{r:a.r+(o.r-a.r)*l,g:a.g+(o.g-a.g)*l,b:a.b+(o.b-a.b)*l}}e.lerp=s})(lr||(lr={}));var Jr;(e=>{e.white={...lr.white,a:1},e.transparent={...lr.white,a:0};function t(a){return{r:a[0],g:a[1],b:a[2],a:a[3]}}e.from0to1=t;function i(a,o){return{...lr.fromHex(a),a:o}}e.fromHexAndA=i;function r(a){return{r:Math.round(a.r*255),g:Math.round(a.g*255),b:Math.round(a.b*255),a:a.a}}e.toRgb255a1=r;function n(a,o){return lr.equals(a,o)&&a.a===o.a}e.equals=n;function s(a,o,l){return{r:a.r+(o.r-a.r)*l,g:a.g+(o.g-a.g)*l,b:a.b+(o.b-a.b)*l,a:a.a+(o.a-a.a)*l}}e.lerp=s})(Jr||(Jr={}));var Rg;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(Rg||(Rg={}));var Ub;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(Ub||(Ub={}));var Fb;(e=>e.defaultData={control1:[.5,.05],control2:[.1,.3]})(Fb||(Fb={}));var Pl;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(Pl||(Pl={}));var ou;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:5,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){return i.type==="PerspectiveCamera"?i.perspective.zoom:i.orthographic.zoom}e.getZoom=t})(ou||(ou={}));var Ig;(e=>{function t(i,r=.1){return{type:"radial",hideBase:!1,count:3,radial:{radius:Math.max(i[0],i[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},linear:{scale:[1,1,1],rotation:[0,0,0],position:[i[0]+i[0]*r,0,0]},grid:{count:[2,2,2],size:i.map(n=>n*(1+r)),useCenter:!0}}}e.defaultData=t})(Ig||(Ig={}));var lu;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focalLength:2,focusDistance:2,bokehScale:2},noise:{...t,blendFunction:16}}})(lu||(lu={}));var Bg;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(Bg||(Bg={}));var Ng;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:Jr.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,depth:1e5};if(r==="SpotLight")return{type:r,color:Jr.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:Jr.white,intensity:1,shadows:!0,size:1e3,depth:1e5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(Ng||(Ng={}));var kg;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(kg||(kg={}));var Ug;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(Ug||(Ug={}));var Fg;(e=>e.defaultData={...Ug.defaultData,...kg.defaultData,cloner:null,booleanExclude:null})(Fg||(Fg={}));var w2=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],zj=["wrapping","image"],ja;(e=>{function t(n,s){return n==="light"&&s?i(s):r(n)}e.defaultData=t;function i(n){switch(n){case"basic":return{type:"light",category:"basic",alpha:1,visible:!0,mode:0};case"phong":return{category:"phong",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1,visible:!0,mode:0};case"toon":return{category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1,visible:!0,mode:0};case"lambert":return{category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0};case"physical":return{category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0}}}function r(n){switch(n){case"texture":return{alpha:1,visible:!0,size:[128,128],mode:0,axis:"x",side:2,type:"texture",projection:0,texture:{image:"image_0",wrapping:1001,repeat:[1,1],offset:[0,0]},crop:!0};case"color":return{type:"color",alpha:1,visible:!0,mode:0,color:lr.fromHex(4737101)};case"depth":return{type:"depth",alpha:1,visible:!0,mode:0,gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{type:"normal",alpha:1,visible:!0,mode:0,cnormal:[1,1,1]};case"gradient":return{type:"gradient",alpha:1,visible:!0,mode:0,gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{type:"noise",alpha:1,visible:!0,mode:0,size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...lr.fromHex(6710886),a:1},colorB:{...lr.fromHex(6710886),a:1},colorC:{...lr.fromHex(16777215),a:1},colorD:{...lr.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8]};case"fresnel":return{type:"fresnel",alpha:1,visible:!0,mode:0,color:Jr.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{type:"rainbow",alpha:1,visible:!0,mode:0,filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{type:"toon",alpha:1,visible:!0,mode:0,positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Jr.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{type:"outline",alpha:1,visible:!0,mode:0,outlineColor:Jr.fromHexAndA(0,1),contourColor:Jr.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{type:"matcap",alpha:1,visible:!0,mode:0,texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0]}};case"transmission":return{type:"transmission",alpha:1,visible:!0,mode:0,thickness:10,ior:1.5,roughness:1};case"displace":return{type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,visible:!0}}}})(ja||(ja={}));var Br;(e=>{function t(l){return!l.layers.some(h=>{if(h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")return!0})&&!r(l)}e.isMergable=t;function i(l){let h="";return l.layers.forEach(c=>{Object.entries(c.data).forEach(([u,d])=>{h+=`${u}${d}`,Array.isArray(d)?d.forEach(p=>h+=`${p}`):typeof d=="object"?Object.values(d).forEach(p=>{typeof p=="number"?h+=`${p.toFixed(4)}`:h+=`${p}`}):h+=`${d}`})}),h}e.getHash=i;function r(l){let h=0;for(let c of l.layers)"alpha"in c.data&&c.data.type!=="light"&&c.data.type!=="fresnel"&&(h+=(1-h)*c.data.alpha);return h<1}e.isTransparent=r;function n(){return{layers:new Ct}}e.defaultEmptyData=n;function s(l="layer1",h="layer2"){return a("phong",l,h)}e.defaultData=s;function a(l,h="layer1",c="layer2"){let u=new Ct;return u.push({fi:0,data:ja.defaultData("light",l),id:h}),u.push({fi:1,data:ja.defaultData("color"),id:c}),{layers:u}}e.defaultTwoLayerData=a;function o(l,h="basic",c="layer1",u="layer2"){let d=ja.defaultData("texture");Object.assign(d.texture,{image:l});let p=new Ct;return p.push({fi:0,data:d,id:c}),p.push({fi:1,data:ja.defaultData("light",h),id:u}),{layers:p}}e.defaultTwoLayerTextureData=o})(Br||(Br={}));var Rd;(e=>{function t(){return{points:new Ct,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(Rd||(Rd={}));var zg;(e=>{function t(i){return i==="PolygonGeometry"||i==="RectangleGeometry"||i==="StarGeometry"||i==="TriangleGeometry"||i==="EllipseGeometry"}e.is2DParametricMesh=t})(zg||(zg={}));var hl;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:Rd.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:"",textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};throw new Error("not implemented")}e.defaultData=t})(hl||(hl={}));var hu;(e=>{e.identity={...Rg.identity,hiddenMatrix:Dl.identity};function t(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}e.fromObject=t;function i(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}e.merge=i;function r(n,s){return{position:jh.isEqual(n.position,s.position)?null:s.position,rotation:jh.isEqual(n.rotation,s.rotation)?null:s.rotation,scale:jh.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:Dl.isEqual(n.hiddenMatrix,s.hiddenMatrix)?null:s.hiddenMatrix}}e.diff=r})(hu||(hu={}));var Gg;(e=>e.defaultData={fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(Gg||(Gg={}));var Un;(e=>e.defaultData={states:new Ct,events:new Ct,visible:!0,raycastLock:!1,physics:null,...hu.identity})(Un||(Un={}));var zb;(e=>e.defaultData={type:"Empty",...Un.defaultData})(zb||(zb={}));var ul;(e=>e.defaultData={type:"Mesh",...Un.defaultData,...Fg.defaultData})(ul||(ul={}));var Hg;(e=>e.defaultData={...Un.defaultData,...hu.identity,...ou.defaultData})(Hg||(Hg={}));var Vg;(e=>{function t(i){return{...Un.defaultData,...Ng.defaultData(i)}}e.defaultData=t})(Vg||(Vg={}));var jg;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:Dl.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:Gg.defaultData,states:new Ct,events:new Ct,...ou.defaultData},e.defaultMeshObject={name:"Rectangle",...Un.defaultData,...ul.defaultData,geometry:hl.defaultData("RectangleGeometry"),material:Br.defaultTwoLayerData("basic","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...Un.defaultData,...ul.defaultData,geometry:hl.defaultData("BooleanGeometry"),material:Br.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...Un.defaultData,...ul.defaultData,geometry:hl.defaultData("TextGeometry"),material:Br.defaultTwoLayerData("phong","layer1","layer2")}))(jg||(jg={}));var Id;(e=>{function t(r,n){if(n===void 0)return r;let s={...r};return"material"in s&&"material"in n&&n.material&&(s.material=gb(s.material,a=>{if(typeof a!="string")for(let[o,l]of Object.entries(n.material.layers)){let h=a.layers.data(o);h&&Ed(h,l)}}).data),s.materials&&n.materials&&(s.materials=gb(s.materials,a=>{var o,l;for(let h=0;h<s.materials.length;h++){let c=n.materials[h];if(typeof c!="string")for(let[u,d]of Object.entries(c.layers)){let p=(l=(o=a[h])==null?void 0:o.layers)==null?void 0:l.data(u);p&&Ed(p,d)}}}).data),s}e.patchMaterialState=t;function i(r,n){var a,o;if(n===void 0)return r;let s={...r};if(Object.assign(s,hu.merge(s,n)),Pl.is(r.type)){s.orthographic={...s.orthographic},s.perspective={...s.perspective};let l=n;((a=l.orthographic)==null?void 0:a.zoom)!==void 0&&(s.orthographic.zoom=l.orthographic.zoom),((o=l.perspective)==null?void 0:o.zoom)!==void 0&&(s.perspective.zoom=l.perspective.zoom),l.isUpVectorFlipped!==void 0&&(s.isUpVectorFlipped=l.isUpVectorFlipped),l.targetOffset!==void 0&&(s.targetOffset=l.targetOffset)}else if(r.type==="Mesh")s.geometry={...s.geometry},Object.assign(s.geometry,n.geometry),s=t(s,n);else if(Bg.is(r.type)){let l=n;l.intensity!==void 0&&(s.intensity=l.intensity),l.color!==void 0&&(typeof l.color=="string"?s.color=l.color:s.color=lr.clone(l.color))}return s}e.patch=i})(Id||(Id={}));var Bd;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:lr.white,near:.1,far:2e3})(Bd||(Bd={}));var Nd;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,isTouchZoom:!0,orbitTouches:2,panTouches:3})(Nd||(Nd={}));var Ll;(e=>e.defaultData={orbitControls:Nd.defaultData,playCamera:null,withBackground:!0,preventScroll:!1,settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:1,stopMode:"manual",duration:5e3},web:{compress:!0,preset:1,preload:!0}},stopRaycast:!0,joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),gameControlObject:null})(Ll||(Ll={}));var Fn;(e=>e.defaultData={ambientLight:{enabled:!0,type:"HemisphereLight",color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75,depth:100,groundColor:{r:.5098039215686274,g:.5098039215686274,b:.5098039215686274},softShadows:!1,softShadowQuality:"low"},usePhysics:!1,gravity:-10,pixelsPerMeter:200})(Fn||(Fn={}));var Wg;(e=>{function t(){let i=new xs,r=jg.defaultMeshObject;return i.push({fi:-1,data:{...Vg.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7},id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),i.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:r,children:[]}),i}e.defaultData={backgroundColor:Jr.fromHexAndA(1184534,1),postprocessing:lu.defaultData,fog:Bd.defaultData,objects:t(),environment:Fn.defaultData,publish:Ll.defaultData},e.emptyData=function(){return{backgroundColor:Jr.fromHexAndA(1184534,1),postprocessing:lu.defaultData,fog:Bd.defaultData,objects:new xs,environment:Fn.defaultData,publish:Ll.defaultData}}})(Wg||(Wg={}));function Tp(e,t){return Object.setPrototypeOf(e,t),e}var Gj=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),Hj=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),Vj=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||Mp&&"ontouchend"in document,jj=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Wj=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,qj=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},Yj=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]};Gj();var Mp=Hj(),qg=Vj(),Xj=jj(),hr=Wj(),kd=qj(),Ud=Number(Yj());function Qj(e){return Array.isArray(e)?e:[e]}function Dc(e){return Mp?e.metaKey:e.ctrlKey}var dt=[],Fd={},Dh={},ad={};function _2(e){dt.includes(e)||dt.push(e)}function cl(e){delete Fd[e.pointerId];for(let t=0;t<dt.length;t++)if(dt[t].pointerId===e.pointerId){dt.splice(t,1);break}}function zd(e){if(e.pointerType!=="touch")return;let t=Fd[e.pointerId];t===void 0&&(t={x:0,y:0},Fd[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function Hf(e){let t=e.pointerId===dt[0].pointerId?dt[1]:dt[0];return Fd[t.pointerId]}function S2(e){Dh[e.key]=!0,ad[e.key]=ad[e.key]===void 0?1:ad[e.key]+1}function A2(e){if(Mp&&Dh.Meta)for(let t in Dh)Dh[t]=!1;else Dh[e.key]=!1;ad={}}function Kj(e){e.addEventListener("pointerdown",_2,!0),e.addEventListener("pointerdown",zd,!0),e.addEventListener("pointermove",zd,!0),e.addEventListener("pointerup",cl,!0),e.addEventListener("pointercancel",cl,!0),e.addEventListener("pointerleave",cl,!0),window.addEventListener("keydown",S2,!0),window.addEventListener("keyup",A2,!0)}function Zj(e){e.removeEventListener("pointerdown",_2,!0),e.removeEventListener("pointerdown",zd,!0),e.removeEventListener("pointermove",zd,!0),e.removeEventListener("pointerup",cl,!0),e.removeEventListener("pointercancel",cl,!0),e.removeEventListener("pointerleave",cl,!0),window.removeEventListener("keydown",S2,!0),window.removeEventListener("keyup",A2,!0)}var Gd;(e=>{function t(){let r={};return r["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},Tp(r,Fi.prototype)}e.defaultColors=t;function i(){return{materials:new Fi,images:new Fi,colors:new Fi,audios:new Fi,fonts:new Fi,penumbraSize:[.5,.5,.5]}}e.emptyData=i})(Gd||(Gd={}));function Gb(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...Td(Ir(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,a)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...Ir(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function Vf(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function jf(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach(n=>{typeof n!="string"&&t(n)}):"material"in r&&typeof r.material!="string"&&t(r.material)})}function Jj(e){Object.assign(e.scene.publish,{orbitControls:{...Nd.defaultData,...Ir(e.scene.publish.orbitControls)}})}function $j(e){Object.assign(e.scene.publish.settings,{video:{...Ll.defaultData.settings.video,...Ir(e.scene.publish.settings.video)}})}function e8(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((w2.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(zj.includes(a)||typeof o=="boolean")&&delete s[a]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?t(s.material):s.materials&&s.materials.forEach(a=>{t(a)})})})}function t8(e){e.scene.publish.withBackground=!0}function i8(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1}}function r8(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function n8(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function s8(e){e.scene.objects.traverse((t,i)=>{var n;let r=e.scene.objects.parent(t);i.type==="Mesh"&&(!r||((n=e.scene.objects.data(r).geometry)==null?void 0:n.type)!=="BooleanGeometry")&&(i.booleanExclude=null)})}function Hb(e){e.layers===void 0&&Object.assign(e,Br.defaultTwoLayerData("lambert"))}function Wf(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let n={...Ir(t),colors:i,steps:r};Object.assign(t,n)}})}function a8(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function Vb(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&Wf(r)}):"material"in i&&typeof i.material!="string"&&Wf(i.material)}),Object.values(e.shared.materials).forEach(t=>Wf(t))}function o8(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function l8(e){e.shared.audios=Tp({},Fi.prototype)}function h8(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"basic",alpha:1,visible:!0,mode:0},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:n})}})}function u8(e){Object.entries(Ir(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(Ir(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function c8(e){e.scene.publish.settings.web.preload=!1}function jb(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function d8(e){e.shared.fonts=Tp({},Fi.prototype)}function p8(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function f8(e){let t=[];e.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=Br.defaultTwoLayerData("basic"),a=typeof n.color=="string"?e.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=p8(n.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:n.name,...Un.defaultData,...ul.defaultData,flatShading:!1,wireframe:!1,geometry:{...hl.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:Ir(n.states),events:Ir(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},h=Ir(e.scene.objects).parent(i);e.scene.objects.insertAfter(h!=null?h:null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function m8(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(t[Number(n.type)])if(Object.assign(n,{type:t[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new Ct,move:new Ct,jump:new Ct}});else{let s=new Ct;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:lt.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let h={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},c={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(c,Td(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(c,{control1:{...a.control1},control2:{...a.control2}});let u={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...u,...c},p={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new Ct({fi:0,id:lt.generateUUID(),data:h},{fi:1,id:lt.generateUUID(),data:d})};s.push({fi:l,id:o,data:p})}),delete n.targets)}})})}function g8(e){e.scene.objects.traverse((t,i)=>{function r(n,s){var l;let a=new Ct,o=[];if(i.events.forEach((h,c,u)=>{if(h.type==="Audio"&&h.trigger===s){let d;o.push(c),h.interaction==="play"?d={...Td(h,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in h?h.after:void 0,toggle:"after"in h?h.toggle:void 0,type:"Audio"}:(h.interaction==="pause"||h.interaction==="stop")&&(d={...Td(h,"interaction","delay","object","playAudio"),type:"Audio"}),d&&a.push({fi:u,id:c,data:d})}}),o.forEach(h=>i.events.delete(h)),a.length){let h=(l=i.events.find(c=>c.type===n))==null?void 0:l.data;h?"actions"in h&&h.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:lt.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}var Wb=21;function v8(e){var i;let t=(i=e.schema)!=null?i:0;t!==Wb&&(console.warn("updating from ",t,"to ",Wb),t<1&&(jf(e,Gb),Vf(e,Gb),e.schema=1),t<2&&(Jj(e),e.schema=2),t<3&&(e8(e),e.schema=3),t<4&&(t8(e),e.schema=4),t<5&&(i8(e),e.schema=5),t<6&&(r8(e),e.schema=6),t<7&&(n8(e),e.schema=7),t<8&&(s8(e),e.schema=8),t<9&&(Vb(e),e.schema=9),t<10&&(a8(e),e.schema=10),t<11&&(o8(e),e.schema=11),t<12&&(Vb(e),e.schema=12),t<13&&(l8(e),e.schema=13),t<14&&(h8(e),e.schema=14),t<15&&(u8(e),e.schema=15),t<16&&(c8(e),e.schema=16),t<17&&(jf(e,jb),Vf(e,jb),e.schema=17),t<18&&(jf(e,Hb),Vf(e,Hb),e.schema=18),t<19&&($j(e),e.schema=19),t<20&&(d8(e),f8(e),e.schema=20),t<21&&(m8(e),g8(e),e.schema=21))}var Yg;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII="})(Yg||(Yg={}));function il(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new it,h=0;for(let c=0;c<e.length;++c){let u=e[c],d=0;if(i!==(u.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in u.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;s[p]===void 0&&(s[p]=[]),s[p].push(u.attributes[p]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". Make sure all geometries have the same number of attributes."),null;if(o!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in u.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+".  .morphAttributes must be consistent throughout all geometries."),null;a[p]===void 0&&(a[p]=[]),a[p].push(u.morphAttributes[p])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(u.userData),t){let p;if(i)p=u.index.count;else if(u.attributes.position!==void 0)p=u.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+c+". The geometry must have either an index or a position attribute"),null;l.addGroup(h,p,c),h+=p}}if(i){let c=0,u=[];for(let d=0;d<e.length;++d){let p=e[d].index;for(let m=0;m<p.count;++m)u.push(p.getX(m)+c);c+=e[d].attributes.position.count}l.setIndex(u)}for(let c in s){let u=qb(s[c]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+c+" attribute."),null;l.setAttribute(c,u)}for(let c in a){let u=a[c][0].length;if(u===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[c]=[];for(let d=0;d<u;++d){let p=[];for(let g=0;g<a[c].length;++g)p.push(a[c][g][d]);let m=qb(p);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+c+" morphAttribute."),null;l.morphAttributes[c].push(m)}}return l}function qb(e){let t,i,r,n=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new t(n),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new at(s,i,r)}var y8=Math.pow(2,-24),Pc=class{constructor(){}};function Cn(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function Yb(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function Xb(e,t){t.set(e)}function Qb(e,t,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=e[s],n=t[s],i[s]=r<n?r:n,r=e[a],n=t[a],i[a]=r>n?r:n}}function Lc(e,t,i){for(let r=0;r<3;r++){let n=t[e+2*r],s=t[e+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function ph(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function x8(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),e.setIndex(new at(n,1));for(let s=0;s<i;s++)n[s]=s}}function b8(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let n of e.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];t.push({offset:s/3,count:(a-s)/3})}return t}function qf(e,t,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,h=-1/0,c=-1/0,u=1/0,d=1/0,p=1/0,m=-1/0,g=-1/0,f=-1/0,v=n!==null;for(let y=t*6,x=(t+i)*6;y<x;y+=6){let b=e[y+0],S=e[y+1],_=b-S,A=b+S;_<s&&(s=_),A>l&&(l=A),v&&b<u&&(u=b),v&&b>m&&(m=b);let w=e[y+2],E=e[y+3],T=w-E,C=w+E;T<a&&(a=T),C>h&&(h=C),v&&w<d&&(d=w),v&&w>g&&(g=w);let P=e[y+4],k=e[y+5],D=P-k,R=P+k;D<o&&(o=D),R>c&&(c=R),v&&P<p&&(p=P),v&&P>f&&(f=P)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=h,r[5]=c,v&&(n[0]=u,n[1]=d,n[2]=p,n[3]=m,n[4]=g,n[5]=f)}function w8(e,t,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,h=-1/0;for(let c=t*6,u=(t+i)*6;c<u;c+=6){let d=e[c+0];d<n&&(n=d),d>o&&(o=d);let p=e[c+2];p<s&&(s=p),p>l&&(l=p);let m=e[c+4];m<a&&(a=m),m>h&&(h=m)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=h}function _8(e,t,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&t[s*6+l]<o;)s++;for(;s<=a&&t[a*6+l]>=o;)a--;if(s<a){for(let h=0;h<3;h++){let c=e[s*3+h];e[s*3+h]=e[a*3+h],e[a*3+h]=c;let u=t[s*6+h*2+0];t[s*6+h*2+0]=t[a*6+h*2+0],t[a*6+h*2+0]=u;let d=t[s*6+h*2+1];t[s*6+h*2+1]=t[a*6+h*2+1],t[a*6+h*2+1]=d}s++,a--}else return s}}var rs=32,S8=(e,t)=>e.candidate-t.candidate,Is=new Array(rs).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Oc=new Float32Array(6);function A8(e,t,i,r,n,s){let a=-1,o=0;if(s===0)a=Yb(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(s===1)a=Yb(e),a!==-1&&(o=E8(i,r,n,a));else if(s===2){let l=ph(e),h=1.25*n,c=r*6,u=(r+n)*6;for(let d=0;d<3;d++){let p=t[d],m=(t[d+3]-p)/rs;if(n<rs/4){let g=[...Is];g.length=n;let f=0;for(let y=c;y<u;y+=6,f++){let x=g[f];x.candidate=i[y+2*d],x.count=0;let{bounds:b,leftCacheBounds:S,rightCacheBounds:_}=x;for(let A=0;A<3;A++)_[A]=1/0,_[A+3]=-1/0,S[A]=1/0,S[A+3]=-1/0,b[A]=1/0,b[A+3]=-1/0;Lc(y,i,b)}g.sort(S8);let v=n;for(let y=0;y<v;y++){let x=g[y];for(;y+1<v&&g[y+1].candidate===x.candidate;)g.splice(y+1,1),v--}for(let y=c;y<u;y+=6){let x=i[y+2*d];for(let b=0;b<v;b++){let S=g[b];x>=S.candidate?Lc(y,i,S.rightCacheBounds):(Lc(y,i,S.leftCacheBounds),S.count++)}}for(let y=0;y<v;y++){let x=g[y],b=x.count,S=n-x.count,_=x.leftCacheBounds,A=x.rightCacheBounds,w=0;b!==0&&(w=ph(_)/l);let E=0;S!==0&&(E=ph(A)/l);let T=1+1.25*(w*b+E*S);T<h&&(a=d,h=T,o=x.candidate)}}else{for(let v=0;v<rs;v++){let y=Is[v];y.count=0,y.candidate=p+m+v*m;let x=y.bounds;for(let b=0;b<3;b++)x[b]=1/0,x[b+3]=-1/0}for(let v=c;v<u;v+=6){let y=~~((i[v+2*d]-p)/m);y>=rs&&(y=rs-1);let x=Is[y];x.count++,Lc(v,i,x.bounds)}let g=Is[rs-1];Xb(g.bounds,g.rightCacheBounds);for(let v=rs-2;v>=0;v--){let y=Is[v],x=Is[v+1];Qb(y.bounds,x.rightCacheBounds,y.rightCacheBounds)}let f=0;for(let v=0;v<rs-1;v++){let y=Is[v],x=y.count,b=y.bounds,S=Is[v+1].rightCacheBounds;x!==0&&(f===0?Xb(b,Oc):Qb(b,Oc,Oc)),f+=x;let _=0,A=0;f!==0&&(_=ph(Oc)/l);let w=n-f;w!==0&&(A=ph(S)/l);let E=1+1.25*(_*f+A*w);E<h&&(a=d,h=E,o=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function E8(e,t,i,r){let n=0;for(let s=t,a=t+i;s<a;s++)n+=e[s*6+r*2];return n/i}function T8(e,t){let i=e.attributes.position,r=i.array,n=e.index.array,s=n.length/3,a=new Float32Array(s*6),o=i.offset||0,l=3;i.isInterleavedBufferAttribute&&(l=i.data.stride);for(let h=0;h<s;h++){let c=h*3,u=h*6,d=n[c+0]*l+o,p=n[c+1]*l+o,m=n[c+2]*l+o;for(let g=0;g<3;g++){let f=r[d+g],v=r[p+g],y=r[m+g],x=f;v<x&&(x=v),y<x&&(x=y);let b=f;v>b&&(b=v),y>b&&(b=y);let S=(b-x)/2,_=g*2;a[u+_+0]=x+S,a[u+_+1]=S+(Math.abs(x)+S)*y8,x<t[g]&&(t[g]=x),b>t[g+3]&&(t[g+3]=b)}}return a}function M8(e,t){function i(v){d&&d(v/p)}function r(v,y,x,b=null,S=0){if(!m&&S>=l&&(m=!0,h&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),x<=c||S>=l)return i(y+x),v.offset=y,v.count=x,v;let _=A8(v.boundingData,b,a,y,x,u);if(_.axis===-1)return i(y+x),v.offset=y,v.count=x,v;let A=_8(o,a,y,x,_);if(A===y||A===y+x)i(y+x),v.offset=y,v.count=x;else{v.splitAxis=_.axis;let w=new Pc,E=y,T=A-y;v.left=w,w.boundingData=new Float32Array(6),qf(a,E,T,w.boundingData,s),r(w,E,T,s,S+1);let C=new Pc,P=A,k=x-T;v.right=C,C.boundingData=new Float32Array(6),qf(a,P,k,C.boundingData,s),r(C,P,k,s,S+1)}return v}x8(e,t);let n=new Float32Array(6),s=new Float32Array(6),a=T8(e,n),o=e.index.array,l=t.maxDepth,h=t.verbose,c=t.maxLeafTris,u=t.strategy,d=t.onProgress,p=e.index.count/3,m=!1,g=[],f=b8(e);if(f.length===1){let v=f[0],y=new Pc;y.boundingData=n,w8(a,v.offset,v.count,s),r(y,v.offset,v.count,s),g.push(y)}else for(let v of f){let y=new Pc;y.boundingData=new Float32Array(6),qf(a,v.offset,v.count,y.boundingData,s),r(y,v.offset,v.count,s),g.push(y)}return g}function C8(e,t){let i=M8(e,t),r,n,s,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let c=0;c<i.length;c++){let u=i[c],d=l(u),p=new o(32*d);r=new Float32Array(p),n=new Uint32Array(p),s=new Uint16Array(p),h(0,u),a.push(p)}return a;function l(c){return c.count?1:1+l(c.left)+l(c.right)}function h(c,u){let d=c/4,p=c/2,m=!!u.count,g=u.boundingData;for(let f=0;f<6;f++)r[d+f]=g[f];if(m){let f=u.offset,v=u.count;return n[d+6]=f,s[p+14]=v,s[p+15]=65535,c+32}else{let f=u.left,v=u.right,y=u.splitAxis,x;if(x=h(c+32,f),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=x/4,x=h(x,v),n[d+7]=y,x}}}var qn=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n][t];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n],o=e.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};qn.prototype.setFromBox=function(){let e=new M;return function(t,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let h=0;h<=1;h++){e.x=r.x*o+n.x*(1-o),e.y=r.y*l+n.y*(1-l),e.z=r.z*h+n.z*(1-h);let c=t.dot(e);s=Math.min(c,s),a=Math.max(c,a)}this.min=s,this.max=a}}();(function(){let e=new qn;return function(t,i){let r=t.points,n=t.satAxes,s=t.satBounds,a=i.points,o=i.satAxes,l=i.satBounds;for(let h=0;h<3;h++){let c=s[h],u=n[h];if(e.setFromPoints(u,a),c.isSeparated(e))return!1}for(let h=0;h<3;h++){let c=l[h],u=o[h];if(e.setFromPoints(u,r),c.isSeparated(e))return!1}}})();var D8=function(){let e=new M,t=new M,i=new M;return function(r,n,s){let a=r.start,o=e,l=n.start,h=t;i.subVectors(a,l),e.subVectors(r.end,n.start),t.subVectors(n.end,n.start);let c=i.dot(h),u=h.dot(o),d=h.dot(h),p=i.dot(o),m=o.dot(o)*d-u*u,g,f;m!==0?g=(c*u-p*d)/m:g=0,f=(c+g*u)/d,s.x=g,s.y=f}}(),N0=function(){let e=new q,t=new M,i=new M;return function(r,n,s,a){D8(r,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let h;o<0?h=r.start:h=r.end;let c;l<0?c=n.start:c=n.end;let u=t,d=i;if(r.closestPointToPoint(c,!0,t),n.closestPointToPoint(h,!0,i),u.distanceToSquared(c)<=d.distanceToSquared(h)){s.copy(u),a.copy(c);return}else{s.copy(h),a.copy(d);return}}}}(),P8=function(){let e=new M,t=new M,i=new Cr,r=new Rr;return function(n,s){let{radius:a,center:o}=n,{a:l,b:h,c}=s;if(r.start=l,r.end=h,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(r.start=l,r.end=c,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(r.start=h,r.end=c,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let u=s.getPlane(i);if(Math.abs(u.distanceToPoint(o))<=a){let d=u.projectPoint(o,t);if(s.containsPoint(d))return!0}return!1}}(),L8=1e-15;function Bo(e){return Math.abs(e)<L8}var bs=class extends Dr{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new M),this.satBounds=new Array(4).fill().map(()=>new qn),this.points=[this.a,this.b,this.c],this.sphere=new tn,this.plane=new Cr,this.needsUpdate=!0}intersectsSphere(e){return P8(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],h=s[1];l.subVectors(e,t),h.setFromPoints(l,r);let c=n[2],u=s[2];c.subVectors(t,i),u.setFromPoints(c,r);let d=n[3],p=s[3];d.subVectors(i,e),p.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};bs.prototype.closestPointToSegment=function(){let e=new M,t=new M,i=new Rr;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,h,c=1/0;for(let u=0;u<3;u++){let d=(u+1)%3;i.start.copy(l[u]),i.end.copy(l[d]),N0(i,r,e,t),h=e.distanceToSquared(t),h<c&&(c=h,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),h=a.distanceToSquared(e),h<c&&(c=h,n&&n.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),h=o.distanceToSquared(e),h<c&&(c=h,n&&n.copy(e),s&&s.copy(o)),Math.sqrt(c)}}();bs.prototype.intersectsTriangle=function(){let e=new bs,t=new Array(3),i=new Array(3),r=new qn,n=new qn,s=new M,a=new M,o=new M,l=new M,h=new Rr,c=new Rr,u=new Rr;return function(d,p=null){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let m=this.plane,g=d.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let f=this.satBounds,v=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let b=0;b<4;b++){let S=f[b],_=v[b];if(r.setFromPoints(_,i),S.isSeparated(r))return!1}let y=d.satBounds,x=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let b=0;b<4;b++){let S=y[b],_=x[b];if(r.setFromPoints(_,t),S.isSeparated(r))return!1}for(let b=0;b<4;b++){let S=v[b];for(let _=0;_<4;_++){let A=x[_];if(s.crossVectors(S,A),r.setFromPoints(s,t),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return p&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let f=this.points,v=!1,y=0;for(let P=0;P<3;P++){let k=f[P],D=f[(P+1)%3];h.start.copy(k),h.end.copy(D),h.delta(a);let R=v?c.start:c.end,G=Bo(g.distanceToPoint(k));if(Bo(g.normal.dot(a))&&G){c.copy(h),y=2;break}if((g.intersectLine(h,R)||G)&&!Bo(R.distanceTo(D))){if(y++,v)break;v=!0}}if(y===1&&this.containsPoint(c.start))return p&&(p.start.copy(c.start),p.end.copy(c.start)),!0;if(y!==2)return!1;let x=d.points,b=!1,S=0;for(let P=0;P<3;P++){let k=x[P],D=x[(P+1)%3];h.start.copy(k),h.end.copy(D),h.delta(o);let R=b?u.start:u.end,G=Bo(m.distanceToPoint(k));if(Bo(m.normal.dot(o))&&G){u.copy(h),S=2;break}if((m.intersectLine(h,R)||G)&&!Bo(R.distanceTo(D))){if(S++,b)break;b=!0}}if(S===1&&this.containsPoint(u.start))return p&&(p.start.copy(u.start),p.end.copy(u.start)),!0;if(S!==2)return!1;if(c.delta(a),u.delta(o),a.dot(o)<0){let P=u.start;u.start=u.end,u.end=P}let _=c.start.dot(a),A=c.end.dot(a),w=u.start.dot(a),E=u.end.dot(a),T=A<w,C=_<E;return _!==E&&w!==A&&T===C?!1:(p&&(l.subVectors(c.start,u.start),l.dot(a)>0?p.start.copy(c.start):p.start.copy(u.start),l.subVectors(c.end,u.end),l.dot(a)<0?p.end.copy(c.end):p.end.copy(u.end)),!0)}}}();bs.prototype.distanceToPoint=function(){let e=new M;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();bs.prototype.distanceToTriangle=function(){let e=new M,t=new M,i=["a","b","c"],r=new Rr,n=new Rr;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let h=1/0;for(let c=0;c<3;c++){let u,d=i[c],p=s[d];this.closestPointToPoint(p,e),u=p.distanceToSquared(e),u<h&&(h=u,a&&a.copy(e),o&&o.copy(p));let m=this[d];s.closestPointToPoint(m,e),u=m.distanceToSquared(e),u<h&&(h=u,a&&a.copy(m),o&&o.copy(e))}for(let c=0;c<3;c++){let u=i[c],d=i[(c+1)%3];r.set(this[u],this[d]);for(let p=0;p<3;p++){let m=i[p],g=i[(p+1)%3];n.set(s[m],s[g]),N0(r,n,e,t);let f=e.distanceToSquared(t);f<h&&(h=f,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(h)}}();var Yn=class extends fi{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new Fe,this.invMatrix=new Fe,this.points=new Array(8).fill().map(()=>new M),this.satAxes=new Array(3).fill().map(()=>new M),this.satBounds=new Array(3).fill().map(()=>new qn),this.alignedSatBounds=new Array(3).fill().map(()=>new qn),this.needsUpdate=!1}set(e,t,i){super.set(e,t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Yn.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let c=0;c<=1;c++){let u=1*l|2*h|4*c,d=r[u];d.x=l?i.x:t.x,d.y=h?i.y:t.y,d.z=c?i.z:t.z,d.applyMatrix4(e)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let h=s[l],c=n[l],u=1<<l,d=r[u];h.subVectors(a,d),c.setFromPoints(h,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Yn.prototype.intersectsBox=function(){let e=new qn;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,a[0].isSeparated(e)||(e.min=i.y,e.max=r.y,a[1].isSeparated(e))||(e.min=i.z,e.max=r.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],h=n[o];if(e.setFromBox(l,t),h.isSeparated(e))return!1}return!0}}();Yn.prototype.intersectsTriangle=function(){let e=new bs,t=new Array(3),i=new qn,r=new qn,n=new M;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let u=0;u<3;u++){let d=a[u],p=o[u];if(i.setFromPoints(p,t),d.isSeparated(i))return!1}let l=s.satBounds,h=s.satAxes,c=this.points;for(let u=0;u<3;u++){let d=l[u],p=h[u];if(i.setFromPoints(p,c),d.isSeparated(i))return!1}for(let u=0;u<3;u++){let d=o[u];for(let p=0;p<4;p++){let m=h[p];if(n.crossVectors(d,m),i.setFromPoints(n,t),r.setFromPoints(n,c),i.isSeparated(r))return!1}}return!0}}();Yn.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Yn.prototype.distanceToPoint=function(){let e=new M;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Yn.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new Rr),i=new Array(12).fill().map(()=>new Rr),r=new M,n=new M;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let h=a*a,c=s.min,u=s.max,d=this.points,p=1/0;for(let g=0;g<8;g++){let f=d[g];n.copy(f).clamp(c,u);let v=f.distanceToSquared(n);if(v<p&&(p=v,o&&o.copy(f),l&&l.copy(n),v<h))return Math.sqrt(v)}let m=0;for(let g=0;g<3;g++)for(let f=0;f<=1;f++)for(let v=0;v<=1;v++){let y=(g+1)%3,x=(g+2)%3,b=f<<y|v<<x,S=1<<g|f<<y|v<<x,_=d[b],A=d[S];t[m].set(_,A);let w=e[g],E=e[y],T=e[x],C=i[m],P=C.start,k=C.end;P[w]=c[w],P[E]=f?c[E]:u[E],P[T]=v?c[T]:u[E],k[w]=u[w],k[E]=f?c[E]:u[E],k[T]=v?c[T]:u[E],m++}for(let g=0;g<=1;g++)for(let f=0;f<=1;f++)for(let v=0;v<=1;v++){n.x=g?u.x:c.x,n.y=f?u.y:c.y,n.z=v?u.z:c.z,this.closestPointToPoint(n,r);let y=n.distanceToSquared(r);if(y<p&&(p=y,o&&o.copy(r),l&&l.copy(n),y<h))return Math.sqrt(y)}for(let g=0;g<12;g++){let f=t[g];for(let v=0;v<12;v++){let y=i[v];N0(f,y,r,n);let x=r.distanceToSquared(n);if(x<p&&(p=x,o&&o.copy(r),l&&l.copy(n),x<h))return Math.sqrt(x)}}return Math.sqrt(p)}}();var Rc=new M,Ic=new M,Bc=new M,Kb=new q,Zb=new q,Jb=new q,$b=new M;function O8(e,t,i,r,n,s){let a;return s===Ai?a=e.intersectTriangle(r,i,t,!0,n):a=e.intersectTriangle(t,i,r,s!==Lr,n),a===null?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function R8(e,t,i,r,n,s,a){Rc.fromBufferAttribute(t,r),Ic.fromBufferAttribute(t,n),Bc.fromBufferAttribute(t,s);let o=O8(e,Rc,Ic,Bc,$b,a);if(o){i&&(Kb.fromBufferAttribute(i,r),Zb.fromBufferAttribute(i,n),Jb.fromBufferAttribute(i,s),o.uv=Dr.getUV($b,Rc,Ic,Bc,Kb,Zb,Jb,new q));let l={a:r,b:n,c:s,normal:new M,materialIndex:0};Dr.getNormal(Rc,Ic,Bc,l.normal),o.face=l,o.faceIndex=r}return o}function E2(e,t,i,r,n){let s=r*3,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),h=R8(i,e.attributes.position,e.attributes.uv,a,o,l,t);return h?(h.faceIndex=r,n&&n.push(h),h):null}function I8(e,t,i,r,n,s){for(let a=r,o=r+n;a<o;a++)E2(e,t,i,a,s)}function B8(e,t,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let h=E2(e,t,i,o);h&&h.distance<s&&(a=h,s=h.distance)}return a}function T2(e,t,i){return e===null||(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(i.ray.origin),e.object=t,e.distance<i.near||e.distance>i.far)?null:e}function En(e,t,i,r){let n=e.a,s=e.b,a=e.c,o=t,l=t+1,h=t+2;i&&(o=i.getX(t),l=i.getX(t+1),h=i.getX(t+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(h),a.y=r.getY(h),a.z=r.getZ(h)}function ew(e,t,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let h=e,c=t+e;h<c;h++)if(En(a,h*3,o,l),a.needsUpdate=!0,r(a,h,n,s))return!0;return!1}var M2=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function Ws(e,t){return t[e+15]===65535}function dl(e,t){return t[e+6]}function uu(e,t){return t[e+14]}function cu(e){return e+8}function du(e,t){return t[e+6]}function N8(e,t){return t[e+7]}var rl=new fi,Hd=new M,k8=["x","y","z"];function Xg(e,t,i,r,n){let s=e*2,a=Ql,o=ta,l=ia;if(Ws(s,o)){let h=dl(e,l),c=uu(s,o);I8(t,i,r,h,c,n)}else{let h=cu(e);Vd(h,a,r,Hd)&&Xg(h,t,i,r,n);let c=du(e,l);Vd(c,a,r,Hd)&&Xg(c,t,i,r,n)}}function Qg(e,t,i,r){let n=e*2,s=Ql,a=ta,o=ia;if(Ws(n,a)){let l=dl(e,o),h=uu(n,a);return B8(t,i,r,l,h)}else{let l=N8(e,o),h=k8[l],c=r.direction[h]>=0,u,d;c?(u=cu(e),d=du(e,o)):(u=du(e,o),d=cu(e));let p=Vd(u,s,r,Hd)?Qg(u,t,i,r):null;if(p){let g=p.point[h];if(c?g<=s[d+l]:g>=s[d+l+3])return p}let m=Vd(d,s,r,Hd)?Qg(d,t,i,r):null;return p&&m?p.distance<=m.distance?p:m:p||m||null}}var U8=function(){let e,t,i=[],r=new M2(()=>new fi);return function(...s){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let a=n(...s);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),a};function n(s,a,o,l,h=null,c=0,u=0){function d(y){let x=y*2,b=ta,S=ia;for(;!Ws(x,b);)y=cu(y),x=y*2;return dl(y,S)}function p(y){let x=y*2,b=ta,S=ia;for(;!Ws(x,b);)y=du(y,S),x=y*2;return dl(y,S)+uu(x,b)}let m=s*2,g=Ql,f=ta,v=ia;if(Ws(m,f)){let y=dl(s,v),x=uu(m,f);return Cn(s,g,e),l(y,x,!1,u,c+s,e)}else{let y=cu(s),x=du(s,v),b=y,S=x,_,A,w,E;if(h&&(w=e,E=t,Cn(b,g,w),Cn(S,g,E),_=h(w),A=h(E),A<_)){b=x,S=y;let G=_;_=A,A=G,w=E}w||(w=e,Cn(b,g,w));let T=Ws(b*2,f),C=o(w,T,_,u+1,c+b),P;if(C===2){let G=d(b),N=p(b)-G;P=l(G,N,!0,u+1,c+b,w)}else P=C&&n(b,a,o,l,h,c,u+1);if(P)return!0;E=t,Cn(S,g,E);let k=Ws(S*2,f),D=o(E,k,A,u+1,c+S),R;if(D===2){let G=d(S),N=p(S)-G;R=l(G,N,!0,u+1,c+S,E)}else R=D&&n(S,a,o,l,h,c,u+1);return!!R}}}(),F8=function(){let e=new bs,t=new bs,i=new Fe,r=new Yn,n=new Yn;return function s(a,o,l,h,c=null){let u=a*2,d=Ql,p=ta,m=ia;if(c===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,h),c=r),Ws(u,p)){let g=o,f=g.index,v=g.attributes.position,y=l.index,x=l.attributes.position,b=dl(a,m),S=uu(u,p);if(i.copy(h).invert(),l.boundsTree)return Cn(a,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:_=>n.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(h),_.b.applyMatrix4(h),_.c.applyMatrix4(h),_.needsUpdate=!0;for(let A=b*3,w=(S+b)*3;A<w;A+=3)if(En(t,A,f,v),t.needsUpdate=!0,_.intersectsTriangle(t))return!0;return!1}});for(let _=b*3,A=S+b*3;_<A;_+=3){En(e,_,f,v),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let w=0,E=y.count;w<E;w+=3)if(En(t,w,y,x),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let g=a+8,f=m[a+6];return Cn(g,d,rl),!!(c.intersectsBox(rl)&&s(g,o,l,h,c)||(Cn(f,d,rl),c.intersectsBox(rl)&&s(f,o,l,h,c)))}}}();function Vd(e,t,i,r){return Cn(e,t,rl),i.intersectBox(rl,r)}var Kg=[],od,Ql,ta,ia;function Ph(e){od&&Kg.push(od),od=e,Ql=new Float32Array(e),ta=new Uint16Array(e),ia=new Uint32Array(e)}function Nc(){od=null,Ql=null,ta=null,ia=null,Kg.length&&Ph(Kg.pop())}var Yf=Symbol("skip tree generation"),Xf=new fi,Qf=new fi,No=new Fe,Ma=new Yn,fh=new Yn,mh=new M,kc=new M,z8=new M,G8=new M,H8=new M,tw=new fi,yn=new M2(()=>new bs),Ti=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Ti.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,n=i.getIndex(),s;return t.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Ti.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=e,s=new Ti(t,{...i,[Yf]:!0});if(s._roots=n,i.setIndex){let a=t.getIndex();if(a===null){let o=new at(e.index,1,!1);t.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[Yf]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[Yf]||(this._roots=C8(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new fi))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,n=r.array,s=r.offset||0,a=3;r.isInterleavedBufferAttribute&&(a=r.data.stride);let o,l,h,c,u=0,d=this._roots;for(let m=0,g=d.length;m<g;m++)o=d[m],l=new Uint32Array(o),h=new Uint16Array(o),c=new Float32Array(o),p(0,u),u+=o.byteLength;function p(m,g,f=!1){let v=m*2;if(h[v+15]===65535){let y=l[m+6],x=h[v+14],b=1/0,S=1/0,_=1/0,A=-1/0,w=-1/0,E=-1/0;for(let T=3*y,C=3*(y+x);T<C;T++){let P=i[T]*a+s,k=n[P+0],D=n[P+1],R=n[P+2];k<b&&(b=k),k>A&&(A=k),D<S&&(S=D),D>w&&(w=D),R<_&&(_=R),R>E&&(E=R)}return c[m+0]!==b||c[m+1]!==S||c[m+2]!==_||c[m+3]!==A||c[m+4]!==w||c[m+5]!==E?(c[m+0]=b,c[m+1]=S,c[m+2]=_,c[m+3]=A,c[m+4]=w,c[m+5]=E,!0):!1}else{let y=m+8,x=l[m+6],b=y+g,S=x+g,_=f,A=!1,w=!1;e?_||(A=e.has(b),w=e.has(S),_=!A&&!w):(A=!0,w=!0);let E=_||A,T=_||w,C=!1;E&&(C=p(y,g,_));let P=!1;T&&(P=p(x,g,_));let k=C||P;if(k)for(let D=0;D<3;D++){let R=y+D,G=x+D,N=c[R],L=c[R+3],H=c[G],F=c[G+3];c[m+D]=N<H?N:H,c[m+D+3]=L>F?L:F}return k}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,h=n[l+15]===65535;if(h){let c=r[a+6],u=n[l+14];e(o,h,new Float32Array(i,a*4,6),c,u)}else{let c=a+8,u=r[a+6],d=r[a+7];e(o,h,new Float32Array(i,a*4,6),d)||(s(c,o+1),s(u,o+1))}}}raycast(e,t=ys){let i=this._roots,r=this.geometry,n=[],s=t.isMaterial,a=Array.isArray(t),o=r.groups,l=s?t.side:t;for(let h=0,c=i.length;h<c;h++){let u=a?t[o[h].materialIndex].side:l,d=n.length;if(Ph(i[h]),Xg(0,r,u,e,n),Nc(),a){let p=o[h].materialIndex;for(let m=d,g=n.length;m<g;m++)n[m].face.materialIndex=p}}return n}raycastFirst(e,t=ys){let i=this._roots,r=this.geometry,n=t.isMaterial,s=Array.isArray(t),a=null,o=r.groups,l=n?t.side:t;for(let h=0,c=i.length;h<c;h++){let u=s?t[o[h].materialIndex].side:l;Ph(i[h]);let d=Qg(0,r,u,e);Nc(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[h].materialIndex))}return a}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let n of this._roots)if(Ph(n),r=F8(0,i,e,t),Nc(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let u=t;t=(d,p,m,g)=>{let f=p*3;return u(d,f,f+1,f+2,m,g)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=yn.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let u=o;o=(d,p,m,g,f)=>u(d,p,m,g,f)?!0:ew(d,p,r,l,m,g,n)}else o||(l?o=(u,d,p,m)=>ew(u,d,r,l,p,m,n):o=(u,d,p)=>p);let h=!1,c=0;for(let u of this._roots){if(Ph(u),h=U8(0,r,a,o,s,c),Nc(),h)break;c+=u.byteLength}return yn.releasePrimitive(n),h}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;No.copy(t).invert();let h=yn.getPrimitive(),c=yn.getPrimitive();if(n){let d=function(p,m,g,f,v,y,x,b){for(let S=g,_=g+f;S<_;S++){En(c,S*3,o,l),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let A=p,w=p+m;A<w;A++)if(En(h,A*3,s,a),h.needsUpdate=!0,n(h,c,A,S,v,y,x,b))return!0}return!1};if(r){let p=r;r=function(m,g,f,v,y,x,b,S){return p(m,g,f,v,y,x,b,S)?!0:d(m,g,f,v,y,x,b,S)}}else r=d}e.getBoundingBox(Qf),Qf.applyMatrix4(t);let u=this.shapecast({intersectsBounds:d=>Qf.intersectsBox(d),intersectsRange:(d,p,m,g,f,v)=>(Xf.copy(v),Xf.applyMatrix4(No),e.shapecast({intersectsBounds:y=>Xf.intersectsBox(y),intersectsRange:(y,x,b,S,_)=>r(d,p,y,x,g,f,S,_)}))});return yn.releasePrimitive(h),yn.releasePrimitive(c),u}intersectsBox(e,t){return Ma.set(e.min,e.max,t),Ma.needsUpdate=!0,this.shapecast({intersectsBounds:i=>Ma.intersectsBox(i),intersectsTriangle:i=>Ma.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),Ma.set(e.boundingBox.min,e.boundingBox.max,t),Ma.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,h=e.attributes.position,c=e.index,u=yn.getPrimitive(),d=yn.getPrimitive(),p=kc,m=z8,g=null,f=null;r&&(g=G8,f=H8);let v=1/0,y=null,x=null;return No.copy(t).invert(),fh.matrix.copy(No),this.shapecast({boundsTraverseOrder:b=>Ma.distanceToBox(b),intersectsBounds:(b,S,_)=>_<v&&_<s?(S&&(fh.min.copy(b.min),fh.max.copy(b.max),fh.needsUpdate=!0),!0):!1,intersectsRange:(b,S)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:_=>fh.distanceToBox(_),intersectsBounds:(_,A,w)=>w<v&&w<s,intersectsRange:(_,A)=>{for(let w=_*3,E=(_+A)*3;w<E;w+=3){En(d,w,c,h),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let T=b*3,C=(b+S)*3;T<C;T+=3){En(u,T,l,o),u.needsUpdate=!0;let P=u.distanceToTriangle(d,p,g);if(P<v&&(m.copy(p),f&&f.copy(g),v=P,y=T/3,x=w/3),P<n)return!0}}}});{let _=c?c.count:h.count;for(let A=0,w=_;A<w;A+=3){En(d,A,c,h),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let E=b*3,T=(b+S)*3;E<T;E+=3){En(u,E,l,o),u.needsUpdate=!0;let C=u.distanceToTriangle(d,p,g);if(C<v&&(m.copy(p),f&&f.copy(g),v=C,y=E/3,x=A/3),C<n)return!0}}}}}),yn.releasePrimitive(u),yn.releasePrimitive(d),v===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=v,i.faceIndex=y,r&&(r.point?r.point.copy(f):r.point=f.clone(),r.point.applyMatrix4(No),m.applyMatrix4(No),r.distance=m.sub(r.point).length(),r.faceIndex=x),i)}closestPointToPoint(e,t={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:h=>(mh.copy(e).clamp(h.min,h.max),mh.distanceToSquared(e)),intersectsBounds:(h,c,u)=>u<a&&u<s,intersectsTriangle:(h,c)=>{h.closestPointToPoint(e,mh);let u=e.distanceToSquared(mh);return u<a&&(kc.copy(mh),a=u,o=c),u<n}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(kc):t.point=kc.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Cn(0,new Float32Array(t),tw),e.union(tw)}),e}},iw=Ti.prototype.raycast;Ti.prototype.raycast=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');let[t,i,r,n]=e;return iw.call(this,r,t.material).forEach(s=>{s=T2(s,t,i),s&&n.push(s)}),n}else return iw.apply(this,e)};var rw=Ti.prototype.raycastFirst;Ti.prototype.raycastFirst=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');let[t,i,r]=e;return T2(rw.call(this,r,t.material),t,i)}else return rw.apply(this,e)};var nw=Ti.prototype.closestPointToPoint;Ti.prototype.closestPointToPoint=function(...e){if(e[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),e.unshift();let t=e[1],i={};return e[1]=i,nw.apply(this,e),t&&t.copy(i.point),i.distance}else return nw.apply(this,e)};var sw=Ti.prototype.closestPointToGeometry;Ti.prototype.closestPointToGeometry=function(...e){let t=e[2],i=e[3];if(t&&t.isVector3||i&&i.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');let r={},n={},s=e[1];return e[2]=r,e[3]=n,sw.apply(this,e),t&&t.copy(r.point),i&&i.copy(n.point).applyMatrix4(s),r.distance}else return sw.apply(this,e)};var aw=Ti.prototype.refit;Ti.prototype.refit=function(...e){let t=e[0],i=e[1];if(i&&(i instanceof Set||Array.isArray(i))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');let r=new Set;i.forEach(n=>r.add(n)),t&&t.forEach(n=>r.add(n)),aw.call(this,r)}else aw.apply(this,e)};["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(e=>{let t=Ti.prototype[e];Ti.prototype[e]=function(...i){return(i[0]===null||i[0].isMesh)&&(i.shift(),console.warn(`MeshBVH: The function signature for "${e}" has changed and no longer takes Mesh. See docs for new signature.`)),t.apply(this,i)}});var V8=class extends Ut{},j8=class extends V8{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!0}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return!0}get isLight(){return!1}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){return this.object.geometry}get material(){return this.object.material}},ow=class extends Ut{constructor(e,t={}){super(),this.object=e;let i=e.recursiveBBox.getSize(new M),r=.1;this.parameters=Ig.defaultData(i.toArray(),r),Ed(this.parameters,t),this.update(),this.setHideBase(this.parameters.hideBase)}setHideBase(e){this.parameters.hideBase=e}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters)}this.children.forEach(e=>e.updateMatrix())}_updateCount(){let e=this.parameters.type==="grid"?this.parameters.grid.count[0]*this.parameters.grid.count[1]*this.parameters.grid.count[2]:this.parameters.count;if(this.children.length!==e)if(this.children.length<e)for(let t=0,i=e-this.children.length;t<i;++t){let r=new j8(this.object);r.visible=!0,this.add(r),this.parameters.hideBase&&this.setHideBase(!0)}else for(let t=0,i=this.children.length-e;t<i;++t)this.remove(this.children[0])}_updateRadial(e){let t=e.radial,i=t.start*lt.DEG2RAD,r=t.end*lt.DEG2RAD,n=i-r,s=new zi(t.rotation[0]*lt.DEG2RAD,t.rotation[1]*lt.DEG2RAD,t.rotation[2]*lt.DEG2RAD),a;switch(t.axis){case"z":a=new M(0,0,1);break;case"y":a=new M(0,1,0);break;default:case"x":a=new M(1,0,0);break}for(let[o,l]of this.children.entries()){l.scale.x=t.scale[0],l.scale.y=t.scale[1],l.scale.z=t.scale[2],l.position.setScalar(0);let h=n/e.count*o-i;switch(t.axis){case"x":l.rotation.set(0,h,0);break;case"y":l.rotation.set(0,0,h);break;case"z":l.rotation.set(h,0,0);break}l.translateOnAxis(a,t.radius),l.position.x+=t.position[0],l.position.y+=t.position[1],l.position.z+=t.position[2],t.alignment===!0?(l.rotation.x+=s.x,l.rotation.y+=s.y,l.rotation.z+=s.z):l.rotation.copy(s)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new zi(t.rotation[0]*lt.DEG2RAD,t.rotation[1]*lt.DEG2RAD,t.rotation[2]*lt.DEG2RAD);for(let[r,n]of this.children.entries())n.scale.x=1+(t.scale[0]-1)*r,n.scale.y=1+(t.scale[1]-1)*r,n.scale.z=1+(t.scale[2]-1)*r,n.rotation.x=i.x*r,n.rotation.y=i.y*r,n.rotation.z=i.z*r,n.position.x=t.position[0]*r,n.position.y=t.position[1]*r,n.position.z=t.position[2]*r}_updateGrid(e){let t=0,i=e.grid;if(i.useCenter===!0){let r={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},n=new M(i.size[0]*(i.count[0]-r.x)*.5,i.size[1]*(i.count[1]-r.y)*.5,i.size[2]*(i.count[2]-r.z)*.5);for(let s=0;s<i.count[0];s++)for(let a=0;a<i.count[1];a++)for(let o=0;o<i.count[2];o++){let l=this.children[t++];l.scale.setScalar(1),l.rotation.set(0,0,0),l.position.x=i.size[0]*s-n.x,l.position.y=i.size[1]*a-n.y,l.position.z=i.size[2]*o-n.z}}else for(let r=0;r<i.count[0];r++)for(let n=0;n<i.count[1];n++)for(let s=0;s<i.count[2];s++){let a=this.children[t++];a.scale.setScalar(1),a.rotation.set(0,0,0),a.position.x=i.size[0]*r,a.position.y=-i.size[1]*n,a.position.z=-i.size[2]*s}}fromClonerState(e){return e.hideBase!==void 0&&this.setHideBase(e.hideBase),Ed(this.parameters,e),this.update(),this}},Lu=e=>{var t;return t=class extends e{constructor(){super(...arguments),this.isObjectHelper=!0}},t.geometryHelper=new la(30,30,30),t},Uc=new Ul,Kf=new tn,lw=new Fe,Ou=(e,t,i,r,n=!1)=>{let s=t,a=e.matrixWorld;if(s.boundingSphere===null&&s.computeBoundingSphere(),Kf.copy(s.boundingSphere),Kf.applyMatrix4(a),i.ray.intersectsSphere(Kf)===!1||(lw.copy(a).invert(),Uc.copy(i.ray).applyMatrix4(lw),s.boundingBox!==null&&Uc.intersectsBox(s.boundingBox)===!1))return;let o,l,h,c,u=s.index,d=s.attributes.position,p=s.drawRange,m,g;if(n===!1){let v=Math.max(0,p.start),y=Math.min(u.count,p.start+p.count);for(m=v,g=y;m<g;m+=3)if(l=u.getX(m),h=u.getX(m+1),c=u.getX(m+2),o=f(e,i,Uc,d,l,h,c),o){o.faceIndex=Math.floor(m/3),r.push(o);return}}else{let v=s.attributes.position,y=new M,x=new M,b=new M,S=new M,_=2,A=1/((e.scale.x+e.scale.y+e.scale.z)/3),w=A*A,E=Math.max(0,p.start),T=Math.min(v.count,p.start+p.count);for(let C=E,P=T-1;C<P;C+=_){if(y.fromBufferAttribute(v,C),x.fromBufferAttribute(v,C+1),Uc.distanceSqToSegment(y,x,S,b)>w)continue;S.applyMatrix4(e.matrixWorld);let k=i.ray.origin.distanceTo(S);k<i.near||k>i.far||r.push({distance:k,point:b.clone().applyMatrix4(e.matrixWorld),object:e})}}function f(v,y,x,b,S,_,A){let w=new M,E=new M,T=new M,C=new M,P=new M;if(w.fromBufferAttribute(b,S),E.fromBufferAttribute(b,_),T.fromBufferAttribute(b,A),x.intersectTriangle(w,E,T,!1,C)===null)return null;P.copy(C),P.applyMatrix4(v.matrixWorld);let k=y.ray.origin.distanceTo(P);return k<y.near||k>y.far?null:{faceIndex:1,distance:k,point:P.clone(),object:v}}},Fc=new M,wr=new zl,W8=class extends Mu{constructor(e){let t=new it,i=new ya({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new Ze(15711266),o=new Ze(15711266),l=new Ze(2857471);h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",o),h("p","n2",o),h("p","n3",o),h("p","n4",o),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l);function h(u,d,p){c(u,p),c(d,p)}function c(u,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[u]===void 0&&(s[u]=[]),s[u].push(r.length/3-1)}t.setAttribute("position",new Be(r,3)),t.setAttribute("color",new Be(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;wr.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;Wr("n1",t,e,wr,-i,-r,n),Wr("n2",t,e,wr,i,-r,n),Wr("n3",t,e,wr,-i,r,n),Wr("n4",t,e,wr,i,r,n);let s=n;Wr("f1",t,e,wr,-i,-r,s),Wr("f2",t,e,wr,i,-r,s),Wr("f3",t,e,wr,-i,r,s),Wr("f4",t,e,wr,i,r,s);let a=s,o=.5;Wr("u1",t,e,wr,i*.7*o,r*1.1,a),Wr("u2",t,e,wr,-i*.7*o,r*1.1,a),Wr("u3",t,e,wr,0,r*(1.1+.9*o),a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Wr(e,t,i,r,n,s,a){Fc.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let h=0,c=o.length;h<c;h++)l.setXYZ(o[h],Fc.x,Fc.y,Fc.z)}}var q8=class extends Lu(W8){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){Ou(this.object,this.geometry,e,t,!0)}},C2=class extends Lu(RU){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){Ou(this.object,C2.geometryHelper,e,t)}},D2=class extends Lu(IU){constructor(e,t=15){super(t),this.object=e,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}raycast(e,t){Ou(this.object,D2.geometryHelper,e,t)}update(){}},P2=class extends Lu(OU){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){Ou(this.object,P2.geometryHelper,e,t)}},Zg=class extends Lu(LU){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){Ou(this.object,Zg.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=Zg._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},L2=Zg;L2._vector=new M;var gh=1e-12,k0=class{constructor(e){this.position=new q,this.startPosition=new q,this.uuid=lt.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new k0(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},Jg=class extends k0{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new Jg(this.parent).copy(this)}},pl=class extends k0{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new Jg(this),new Jg(this))}static create(e,t){let i=new pl(e,new q(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new pl(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new q,t=new q){let[i,r]=this.computeTangents();return i&&r&&(hw(i,e),hw(r,t)),[e,t]}computeTangent(e=new q){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new q){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function hw(e,t=new q){let i=e.length();return t.set(-e.y/i,e.x/i)}var U0=e=>e,Kl=new q,Cp=new q,Y8=new q,X8=new q,Q8=new q,K8=new q,O2=new M,R2=new M;function Z8(e){let t=new q;t.addVectors(e.v0,Kl.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new q;return i.addVectors(e.v2,Cp.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Zr(e.v0,t,i,e.v2)}function Lh(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function J8(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function $8(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function I2(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function eW(e,t,i){return cw(e,t)&&cw(t,i)&&$g(e.position,t.position,i.position)}function $g(e,t,i){return Kl.copy(t).sub(e).cross(Cp.copy(i).sub(e))===0}function tW(e,t,i,r,n){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,h=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return r.set(o+l,a+h),n.set(o-l,a-h),[r,n]}function iW(e,t,i){let r=e.distanceTo(i),n=t.distanceTo(i);return r<n?t:e}function rW(e,t,i,r,n,s){let a=t.x-e.x,o=t.y-e.y,l=i.x-e.x,h=i.y-e.y,c=Math.sqrt((a+l)*(a+l)+(o+h)*(o+h)),u;return I2(t,e,i)>Math.PI&&(c*=-1),Lh(h,o)?u=(o+h)*(r/c-.5)*8/3/(a-l):u=(a+l)*(r/c-.5)*8/3/(h-o),n.set(t.x-u*o,t.y+u*a),s.set(i.x+u*h,i.y-u*l),[n,s]}function uw(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function cw(e,t){return $g(e.position,e.controls[1].position,t.position)&&$g(e.position,t.controls[0].position,t.position)}function nW(e,t,i,r,n=.5){let s=Kl.subVectors(t,e).multiplyScalar(n).add(e),a=Cp.subVectors(i,t).multiplyScalar(n).add(t),o=Y8.subVectors(r,i).multiplyScalar(n).add(i),l=s,h=X8.subVectors(a,s).multiplyScalar(n).add(s),c=Q8.subVectors(o,a).multiplyScalar(n).add(a),u=o,d=K8.subVectors(c,h).multiplyScalar(n).add(h);return[e.x,e.y,l.x,l.y,h.x,h.y,d.x,d.y,c.x,c.y,u.x,u.y,r.x,r.y]}function sW(e,t,i=12,r=!0){let n=R2.set(0,0,0),s,a=0;for(let o=0;o<t.length;o++){let l=U0(t[o]),h=Kl,c=Za(l,i);for(let u=0;u<=c;u++)if(l instanceof Zr||l instanceof ha||l instanceof en){if(l.getPoint(u/c,h),n.set(h.x,h.y,0),s!==void 0&&$8(s,n))continue;s===void 0&&(s=O2),s.copy(n),e.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),e}function aW(e,t,i,r=12,n=!0){let s=R2.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let h,c=U0(t[l]),u=Kl,d=Za(c,r);o.push(d);for(let p=0;p<=d;p++)if(c instanceof Zr||c instanceof ha||c instanceof en){if(c.getPoint(p/d,u),s.set(u.x,u.y,0),h==null?void 0:h.equals(s))continue;h===void 0?h=O2:(e.setXYZ(a,h.x,h.y,h.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),h.copy(s)}}return n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}function dw(e,t=12,i=!1){let r=[];for(let n=0,s=e.length;n<s;n++){let a=e[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=Za(a.roundedCurveCorner,t)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=Za(a.curveAfter,t)),r.push(o)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=Za(e[0].roundedCurveCorner,t)*.5),r}function Za(e,t=12){return e&&e instanceof cp?t*2:e&&(e instanceof en||e instanceof $A)?1:e&&e instanceof n0?t*e.points.length:t}function oW(e,t,i=12,r=!0){let n,s=0;for(let a=0;a<t.length;a++){let o=U0(t[a]),l=Za(o,i),h=Kl;for(let c=0;c<=l;c++)if(o instanceof Zr||o instanceof ha||o instanceof en){if(o.getPoint(c/l,h),n!==void 0&&J8(n,h,gh))continue;n===void 0&&(n=Cp),n.copy(h),e.push(h.x,h.y),s++}}return Lh(e[0],e[e.length-2],gh)&&Lh(e[1],e[e.length-1],gh)&&(e.pop(),e.pop()),r&&s>1&&!(Lh(e[s-1],e[1],gh)&&Lh(e[s-2],e[0],gh))&&(e.push(e[0],e[1]),s++),e}var Zf=new q,lW=new q,hW=new q,uW=new q,cW=new q,dW=new q,Kt=class extends Sd{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.eventDispatcher=new Bi,this.plane=new Cr(new M(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=lt.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new Kt;return r.isClosed=e.isClosed,r.points=e.points.map(n=>pl.create(n.id,n.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(n=>Kt.createFromState(n)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(e);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=e-t;if(s<=n.points.length-1)return n.points[s];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(e);if(s>=0)return t+s;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=Zf.set(e,t);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(e,t);this._update(!1)}createPoint(e,t=0,i=lt.generateUUID()){let r;e instanceof q?r=e:r=new q(e,t);let n=new pl(i,r);return n.roundness=this.roundness,n}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(e=!0){for(let t=0,i=this.shapeHoles.length;t<i;t++)this.shapeHoles[t].update(!1);this._update(e)}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return sW(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=dw(this.points,e,!1),this.roundedCurveDivisions=dw(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return aW(e,this.curves,t,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),oW(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,n=0;t&&this.points[0].roundedCurveCorner!==void 0&&(n=Za(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-n;s<0&&(s+=r.reduce((a,o)=>a+o,0));for(let a=0,o=r.length;a<o;a++){let l=r[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let r=this.points[e],n=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(uw(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(Zf.set(i.x,i.y))/l}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){this.eventDispatcher=null}_applyCurveForPoint(e,t){uw(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(e=!0){var i,r,n;if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let s=0,a=this.points.length;s<a;s++){let o=this.points[s];if(s===0)this.moveTo(o.position.x,o.position.y);else{let l=this.points[s-1];this._applyCurveForPoint(o,l)}}let t=this.getLastPoint();if(t!=null&&t.curveAfter&&(t.curveAfter=void 0),this.isClosed){let s=this.points[0],a=this.points[this.points.length-1];this._applyCurveForPoint(s,a)}if(this.points.length>2){let s=0;for(let a=0,o=this.points.length;a<o;a++){let l=this.points[a],h=(i=this.points[a-1])!=null?i:this.points[this.points.length-1],c=(r=this.points[a+1])!=null?r:this.points[0],u=l.roundness,d=h&&c&&eW(h,l,c);if(!l.controlsMoved()&&u>0&&!d){let p=l.curveBefore,m=l.curveAfter;if(p===void 0||m===void 0)continue;let g=l.roundedCurveBefore,f=l.roundedCurveAfter,v=p.getLength(),y=m.getLength(),x=Math.min(u,v*.499),b=Math.min(u,y*.499),S=Math.min(x,b),_=1-S/v,A=S/y,w=p.getPointAt(_,Zf),E=m.getPointAt(A,lW);this._subSplitCurve(p,g,_,w,void 0),this._subSplitCurve(m,f,A,void 0,E);let T;if(this.useCubicForRoundedCorners){let C=I2(w,l.position,E)/2,P=Math.tan(C)*w.distanceTo(l.position),[k,D]=tW(w,E,P,hW,uW),R=iW(k,D,l.position),[G,N]=rW(R,w,E,P,cW,dW);T=new Zr(w.clone(),G.clone(),N.clone(),E.clone())}else T=new ha(w.clone(),l.position.clone(),E.clone());l.roundedCurveCorner=T,this.roundedCurves.splice(a+s,0,T),s++}}}e&&((n=this.eventDispatcher)==null||n.dispatchEvent({type:"update"}))}_subSplitCurve(e,t,i,r,n){if(e instanceof en)r!==void 0&&t.v2.copy(r),n!==void 0&&t.v1.copy(n);else{let s=e,a=t,o=s.getUtoTmapping(i,0),l=nW(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return t}clone(){let e=new Kt(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let r=0;r<t;r++){let n=r*7,s=e.points[n+0],a=e.points[n+1],o=e.points[n+2],l=e.points[n+3],h=e.points[n+4],c=e.points[n+5],u=e.points[n+6],d=new pl(lt.generateUUID(),new q(s,a));d.controls[0].position.set(o,l),d.controls[1].position.set(h,c),d.roundness=u,this.points.push(d)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(r=>{let n=new Kt;return n.fromJSON(r),n}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e){let t=(r,n)=>{n instanceof Zr&&n.v3.equals(r.position)&&r.controls[0].position.copy(n.v2)},i=r=>{let n=[],s,a;for(s=0,a=r.length;s<a;s++)r[s]instanceof ha&&(r[s]=Z8(r[s]));for(s=0,a=r.length;s<a;s++){let h=r[s],c=s>0?r[s-1]:null,u;h instanceof Zr?(u=this.createPoint(h.v0),u.controls[1].position.copy(h.v1)):h instanceof en&&(u=this.createPoint(h.v1)),u!==void 0&&(c!==null&&t(u,c),n.push(u))}let o=r[r.length-1],l=!1;return o instanceof Zr?o.v3.equals(n[0].position)&&(n[0].controls[0].position.copy(o.v2),l=!0):o instanceof en&&o.v2.equals(n[0].position)&&(l=!0),this.isClosed=l,n};return this.points=i(e.curves),e instanceof Sd&&(this.shapeHoles=e.holes.map(r=>{let n=new Kt;return n.fromShape(r),n})),this.update(),this}},Gt;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(Gt||(Gt={}));var Si;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Si||(Si={}));function Qe(e,t){if(!e)throw t||"Assertion Failed!"}var qe=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){Qe(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?n<s?i.t-t.t+(t.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-t.t)*(s/(n+s)):0},e.edgeSign=function(t,i,r){Qe(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-t.t)*s:0},e.transEval=function(t,i,r){Qe(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?n<s?i.s-t.s+(t.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-t.s)*(s/(n+s)):0},e.transSign=function(t,i,r){Qe(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-t.s)*s:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,n){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+n)/2:i+(n-i)*(t/(t+r)):n+(i-n)*(r/(t+r))},e.intersect=function(t,i,r,n,s){var a,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(r,n)||(l=r,r=n,n=l),e.vertLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.vertLeq(r,i)?e.vertLeq(i,n)?(a=e.edgeEval(t,r,i),o=e.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,i.s)):(a=e.edgeSign(t,r,i),o=-e.edgeSign(t,n,i),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(r,n)||(l=r,r=n,n=l),e.transLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.transLeq(r,i)?e.transLeq(i,n)?(a=e.transEval(t,r,i),o=e.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,i.t)):(a=e.transSign(t,r,i),o=-e.transSign(t,n,i),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},e}(),vh=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),zc=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),Xo=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),pw=function(){function e(){var t=new Xo,i=new vh,r=new zc(0),n=new zc(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(t){var i=new zc(0),r=new zc(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return r.next=n,n.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=t,t.Onext=n,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var n=t;Qe(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},e.prototype.makeFace_=function(t,i,r){var n=t;Qe(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.killFace_=function(t,i){var r=t.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.makeEdge=function(){var t=new Xo,i=new Xo,r=new vh,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(t,i){var r=!1,n=!1;if(t!==i){if(i.Org!==t.Org&&(n=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!n){var s=new Xo;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!r){var a=new vh;this.makeFace_(a,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var n=new vh;this.makeFace_(n,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var n=new Xo;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,n=this.makeEdge_(t),s=n.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,i),n.Org=t.Dst,s.Org=i.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!r){var a=new vh;this.makeFace_(a,n,t.Lface)}return n},e.prototype.zapFace=function(t){var i=t.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=t.prev,o=t.next,o.prev=a,a.next=o},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&qe.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&qe.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,h;for(s=t,s=t;(n=s.next)!==t;s=n){Qe(n.prev===s),l=n.anEdge;do Qe(l.Sym!==l),Qe(l.Sym.Sym===l),Qe(l.Lnext.Onext.Sym===l),Qe(l.Onext.Sym.Lnext===l),Qe(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(Qe(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){Qe(a.prev===o),l=a.anEdge;do Qe(l.Sym!==l),Qe(l.Sym.Sym===l),Qe(l.Lnext.Onext.Sym===l),Qe(l.Onext.Sym.Lnext===l),Qe(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(Qe(a.prev===o&&a.anEdge===null),h=r,h=r;(l=h.next)!==r;h=l)Qe(l.Sym.next===h.Sym),Qe(l.Sym!==l),Qe(l.Sym.Sym===l),Qe(l.Org!==null),Qe(l.Dst!==null),Qe(l.Lnext.Onext.Sym===l),Qe(l.Onext.Sym.Lnext===l);Qe(l.Sym.next===h.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),fw=function(){function e(){this.handle=null}return e}(),mw=function(){function e(){this.key=null,this.node=0}return e}(),pW=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new fw,this.handles[r]=new mw;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,Qe(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new fw;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new mw}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,n=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,n;Qe(t>=1&&t<=this.max&&r[t].key!==null),n=r[t].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),Jf=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),gw=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),fW=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new gw,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new gw;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),mW=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var n=t.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?qe.vertLeq(s.Org,a.Org)?qe.edgeSign(a.Dst,s.Org,a.Org)<=0:qe.edgeSign(s.Dst,a.Org,s.Org)>=0:qe.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return qe.edgeSign(s.Dst,n,s.Org)>=0;var o=qe.edgeEval(s.Dst,n,s.Org),l=qe.edgeEval(a.Dst,n,a.Org);return o>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&Qe(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){Qe(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,n;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var n=new Jf;return n.eUp=r,n.nodeUp=t.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(t,i){switch(t.windingRule){case Gt.ODD:return(i&1)!==0;case Gt.NONZERO:return i!==0;case Gt.POSITIVE:return i>0;case Gt.NEGATIVE:return i<0;case Gt.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=e.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}n=t.mesh.connect(o.Lprev,n.Sym),e.fixUpperEdge(t,s,n)}o.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(o,n)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,i,r,n,s,a){var o,l,h,c,u=!0;h=r;do Qe(qe.vertLeq(h.Org,h.Dst)),e.addRegionBelow(t,i,h.Sym),h=h.Onext;while(h!==n);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,c=s;o=e.regionBelow(l),h=o.eUp.Sym,h.Org===c.Org;)h.Onext!==c&&(t.mesh.splice(h.Oprev,h),t.mesh.splice(c.Oprev,h)),o.windingNumber=l.windingNumber-h.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!u&&e.checkForRightSplice(t,l)&&(e.addWinding(h,c),e.deleteRegion(t,l),t.mesh.delete(c)),u=!1,l=o,c=h;l.dirty=!0,Qe(l.windingNumber-h.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var n=qe.vertL1dist(i,t),s=qe.vertL1dist(r,t),a=.5*s/(n+s),o=.5*n/(n+s);t.coords[0]+=a*i.coords[0]+o*r.coords[0],t.coords[1]+=a*i.coords[1]+o*r.coords[1],t.coords[2]+=a*i.coords[2]+o*r.coords[2]},e.getIntersectData=function(t,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,n),e.vertexWeights(i,s,a)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp;if(qe.vertLeq(n.Org,s.Org)){if(qe.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;qe.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(t.pq.delete(n.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(qe.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Oprev,n)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a;if(Qe(!qe.vertEq(n.Dst,s.Dst)),qe.vertLeq(n.Dst,s.Dst)){if(qe.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,a=t.mesh.splitEdge(n),t.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(qe.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=t.mesh.splitEdge(s),t.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,h=s.Dst,c,u,d=new Xo,p,m;if(Qe(!qe.vertEq(h,l)),Qe(qe.edgeSign(l,t.event,a)<=0),Qe(qe.edgeSign(h,t.event,o)>=0),Qe(a!==t.event&&o!==t.event),Qe(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(c=Math.min(a.t,l.t),u=Math.max(o.t,h.t),c>u))return!1;if(qe.vertLeq(a,o)){if(qe.edgeSign(h,a,o)>0)return!1}else if(qe.edgeSign(l,o,a)<0)return!1;return e.debugEvent(t),qe.intersect(l,a,h,o,d),Qe(Math.min(a.t,l.t)<=d.t),Qe(d.t<=Math.max(o.t,h.t)),Qe(Math.min(h.s,l.s)<=d.s),Qe(d.s<=Math.max(o.s,a.s)),qe.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=qe.vertLeq(a,o)?a:o,qe.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),qe.vertEq(d,a)||qe.vertEq(d,o)?(e.checkForRightSplice(t,i),!1):!qe.vertEq(l,t.event)&&qe.edgeSign(l,t.event,d)>=0||!qe.vertEq(h,t.event)&&qe.edgeSign(h,t.event,d)<=0?h===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Sym,n),i=e.topLeftRegion(t,i),n=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,n.Oprev,n,n,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Lnext,s.Oprev),r=i,i=e.topRightRegion(i),m=e.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,s.Onext,n.Rprev,m,!0),!0):(qe.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),qe.edgeSign(h,t.event,d)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(n.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=t.pq.insert(n.Org),e.getIntersectData(t,n.Org,a,l,o,h),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(s),r=e.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);n.Org===s.Org&&n.Dst===s.Dst&&(e.addWinding(s,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var n,s=r.Onext,a=e.regionBelow(i),o=i.eUp,l=a.eUp,h=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,i),qe.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),h=!0),qe.vertEq(l.Org,t.event)&&(t.mesh.splice(r,l.Oprev),r=e.finishLeftRegions(t,a,null),h=!0),h){e.addRightEdges(t,i,r.Onext,s,s,!0);return}qe.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=t.mesh.connect(r.Lprev,n),e.addRightEdges(t,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var n,s,a,o,l;if(n=i.eUp,qe.vertEq(n.Org,r)){Qe(!1),e.spliceMergeVertices(t,n,r.anEdge);return}if(!qe.vertEq(n.Dst,r)){t.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(t.mesh.delete(n.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,n),e.sweepEvent(t,r);return}Qe(!1),i=e.topRightRegion(i),l=e.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(Qe(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(r.anEdge,a),qe.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,a.Onext,o,s,!0)},e.connectLeftVertex=function(t,i){var r,n,s,a,o,l,h=new Jf;if(h.eUp=i.anEdge.Sym,r=t.dict.search(h).key,n=e.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,qe.edgeSign(a.Dst,i,a.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(s=qe.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=t.mesh.connect(i.anEdge.Sym,a.Lnext);else{var c=t.mesh.connect(o.Dnext,i.anEdge);l=c.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,r,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var n=e.topLeftRegion(t,r.activeRegion);Qe(n!==null);var s=e.regionBelow(n),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,n,o):e.addRightEdges(t,n,o.Onext,a,a,!0)},e.addSentinel=function(t,i,r,n){var s=new Jf,a=t.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,t.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new fW(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],n=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmin[1]-r,o=t.bmax[1]+r;e.addSentinel(t,n,s,a),e.addSentinel(t,n,s,o)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(Qe(i.fixUpperEdge),Qe(++r===1)),Qe(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,n,s=t.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,qe.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,n,i),t.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),t.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,n,s=0;for(n=t.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=t.pq=new pW(s,qe.vertLeq),n=t.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,Qe(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,n;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;n=t.pq.min(),!(n===null||!qe.vertEq(n,r));)n=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,n.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),gW=function(){function e(){this.mesh=new pw,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=Gt.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,n,s,a,o,l=[0,0,0],h=[0,0,0],c=[0,0,0],u=[0,0,0],d=[0,0,0],p=[null,null,null],m=[null,null,null],g=this.mesh.vHead;i=g.next;for(var f=0;f<3;++f)s=i.coords[f],h[f]=s,m[f]=i,l[f]=s,p[f]=i;for(i=g.next;i!==g;i=i.next)for(var v=0;v<3;++v)s=i.coords[v],s<h[v]&&(h[v]=s,m[v]=i),s>l[v]&&(l[v]=s,p[v]=i);var y=0;if(l[1]-h[1]>l[0]-h[0]&&(y=1),l[2]-h[2]>l[y]-h[y]&&(y=2),h[y]>=l[y]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,r=m[y],n=p[y],c[0]=r.coords[0]-n.coords[0],c[1]=r.coords[1]-n.coords[1],c[2]=r.coords[2]-n.coords[2],i=g.next;i!==g;i=i.next)u[0]=i.coords[0]-n.coords[0],u[1]=i.coords[1]-n.coords[1],u[2]=i.coords[2]-n.coords[2],d[0]=c[1]*u[2]-c[2]*u[1],d[1]=c[2]*u[0]-c[0]*u[2],d[2]=c[0]*u[1]-c[1]*u[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,t[0]=d[0],t[1]=d[1],t[2]=d[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(c)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=t.next;a!==t;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,h=t.next;h!==t;h=h.next)l?(this.bmin[0]=this.bmax[0]=h.s,this.bmin[1]=this.bmax[1]=h.t,l=!1):(h.s<this.bmin[0]&&(this.bmin[0]=h.s),h.s>this.bmax[0]&&(this.bmax[0]=h.s),h.t<this.bmin[1]&&(this.bmin[1]=h.t),h.t>this.bmax[1]&&(this.bmax[1]=h.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;qe.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;qe.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(qe.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(qe.edgeGoesLeft(n.Lnext)||qe.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=t.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(qe.edgeGoesRight(r.Lprev)||qe.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=t.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=t.connect(n.Lnext,n),n=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,n){var s,a=0,o=0,l;r>3&&t.mergeConvexFaces(r);for(var h=t.vHead.next;h!==t.vHead;h=h.next)h.n=-1;for(var c=t.fHead.next;c!==t.fHead;c=c.next)if(c.n=-1,!!c.inside){s=c.anEdge,l=0;do{var h=s.Org;h.n===-1&&(h.n=o,o++),l++,s=s.Lnext}while(s!==c.anEdge);if(l>r)throw"Face vertex greater that support polygon";c.n=a,++a}this.elementCount=a,i===Si.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var h=t.vHead.next;h!==t.vHead;h=h.next)if(h.n!==-1){var u=h.n*n;this.vertices[u+0]=h.coords[0],this.vertices[u+1]=h.coords[1],n>2&&(this.vertices[u+2]=h.coords[2]),this.vertexIndices[h.n]=h.idx}for(var d=0,c=t.fHead.next;c!==t.fHead;c=c.next)if(c.inside){s=c.anEdge,l=0;do{var h=s.Org;this.elements[d++]=h.n,l++,s=s.Lnext}while(s!==c.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1;if(i===Si.CONNECTED_POLYGONS){s=c.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==c.anEdge);for(var m=l;m<r;++m)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,h=0,c=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[h++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[c++]=s,this.elements[c++]=a,s+=a}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new pw),t<2&&(t=2),t>3&&(t=3);for(var r=null,n=0;n<i.length;n+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],t>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,n,s,a){if(t===void 0&&(t=Gt.ODD),i===void 0&&(i=Si.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),mW.computeInterior(this,a);var o=this.mesh;return i===Si.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===Si.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},e}();function Oh(e){var t=e.windingRule,i=t===void 0?Gt.ODD:t,r=e.elementType,n=r===void 0?Si.POLYGONS:r,s=e.polySize,a=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,h=e.normal,c=h===void 0?[0,0,1]:h,u=e.contours,d=u===void 0?[]:u,p=e.strict,m=p===void 0?!0:p,g=e.debug,f=g===void 0?!1:g;if(!d&&m)throw new Error("Contours can't be empty");if(d){var v=new gW;e.edgeCreateCallback&&(v.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(v.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)v.addContour(l||2,d[y]);return v.tesselate(i,n,a,l,c,m),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:f?v.mesh:void 0}}}Gt.ODD;Gt.NONZERO;Gt.POSITIVE;Gt.NEGATIVE;Gt.ABS_GEQ_TWO;Si.POLYGONS;Si.CONNECTED_POLYGONS;Si.BOUNDARY_CONTOURS;var B2=class extends it{constructor(e,t=12,i={}){var d,p,m;super(),this.type="ShapeGeometry",this.windingRule=Gt.ODD,this.elementType=Si.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:Gt.ODD,elementType:Si.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(g=>g.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,h;for(let g=0,f=r.length/2;g<f;g++){let v=g*2,y=r[v+0],x=r[v+1];if(l!==void 0&&y!==l&&(a=!1),h!==void 0&&x!==h&&(o=!1),l=y,h=x,!a&&!o)break}!a&&!o&&(s=Oh({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict}));let c=(d=s==null?void 0:s.vertexCount)!=null?d:1,u=(p=s==null?void 0:s.elementCount)!=null?p:1;if(this._positionAttribute=new at(new Float32Array(c*3),3),this._normalAttribute=new at(new Float32Array(c*3),3),this._uvAttribute=new at(new Float32Array(c*2),2),this._indexAttribute=new at(new Uint32Array(u*3),1),s){let g=1/0,f=-1/0,v=1/0,y=-1/0;for(let S=0,_=c;S<_;S++){let A=S*2,w=s.vertices[A+0],E=s.vertices[A+1];w<g&&(g=w),w>f&&(f=w),E<v&&(v=E),E>y&&(y=E)}let x=f-g,b=y-v;for(let S=0,_=c;S<_;S++){let A=S*2,w=s.vertices[A+0],E=s.vertices[A+1],T=(w-g)/x,C=(E-v)/b;this._positionAttribute.setXYZ(S,w,E,0),this._normalAttribute.setXYZ(S,0,0,1),this._uvAttribute.setXY(S,T,C)}for(let S=0,_=u;S<_;S++){let A=S*3,w=s.elements[A+0],E=s.elements[A+1],T=s.elements[A+2];this._indexAttribute.setX(A+0,w),this._indexAttribute.setX(A+1,E),this._indexAttribute.setX(A+2,T)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((m=s==null?void 0:s.elementCount)!=null?m:1)*3)}clone(){let e=new B2(this._shape,this._curveSegments);return e.userData=JE(this.userData),e}},ev=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*ev.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.normals=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.uvs=new Float32Array(this.buffer,n*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity} \u2192 ${e}`);let i=e*ev.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*e);s+=3*e;let o=new Float32Array(r,s*n,3*e);s+=3*e;let l=new Float32Array(r,s*n,2*e);a.set(this.positions.slice(0,this.size*3)),o.set(this.normals.slice(0,this.size*3)),l.set(this.uvs.slice(0,this.size*2)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} \u2192 ${this.size}`),this.realloc(this.size,!0)}},N2=ev;N2.eSize=(3+3+2)*Float32Array.BYTES_PER_ELEMENT;var $f=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),k2=class extends it{constructor(e,t,i=0,r=12,n=3,s=Gt.ODD){super(),this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._bevel=i,this._curveSegments=r,this._bevelSegmentsInput=n,i<=0?(this._bevelSize=0,this._bevelSegments=0):(this._bevelSize=Math.min(i,t/2-1e-12),this._bevelSegments=Math.floor(n));let a=this._shape.extractShapePointsToFlatArray([],r),o=this._shape.shapeHoles.map(_=>{let A=_.extractShapePointsToFlatArray([],r),w=[];for(let E=A.length-1;E>=1;E-=2){let T=A[E-1],C=A[E-0];w.push(T,C)}return w}),l=Oh({windingRule:s,elementType:Si.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[a]}),h=Oh({windingRule:Gt.ODD,elementType:Si.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...o]});if(!l)throw new Error("error generating geometry");let c=l.elementCount;if(h){l.elementCount+=h.elementCount;for(let _=0;_<h.elements.length;_++){let A=h.elements[_],w=_%2===0?l.vertexCount:0;l.elements.push(A+w)}for(let _=0;_<h.vertexIndices.length;_++){let A=h.vertexIndices[_],w=l.vertexCount;l.vertexIndices.push(A+w)}for(let _=0;_<h.vertices.length;_++){let A=h.vertices[_];l.vertices.push(A)}}let u=1/0,d=-1/0,p=1/0,m=-1/0;for(let _=0,A=l.vertexCount;_<A;_++){let w=_*2,E=l.vertices[w+0],T=l.vertices[w+1];E<u&&(u=E),E>d&&(d=E),T<p&&(p=T),T>m&&(m=T)}this._minX=u,this._minY=p,this._width=d-u,this._height=m-p;let g=l.vertexCount*2*(2+this._bevelSegments);this._buffer=new N2(g);let f=[],v=[];for(let _=l.elementCount-1;_>=0;_--){let A=_>=c,w=_*2,E=l.elements[w+0],T=l.elements[w+1],C=E+T,P={start:E,count:T,normals:[],continuous:[],concave:[]},k=E,D=C-1,R=E+1,G=this._shape.roundedCurves.length;do{let F=k-E,z=l.vertices[D*2+0],U=l.vertices[D*2+1],W=l.vertices[k*2+0],Y=l.vertices[k*2+1],K=l.vertices[R*2+0],V=l.vertices[R*2+1],ie=W-z,Q=Y-U,J=Math.sqrt(ie*ie+Q*Q);ie/=J,Q/=J;let Z=W-K,ue=Y-V,de=Math.sqrt(Z*Z+ue*ue);Z/=de,ue/=de,P.normals[F*2+0]=-ue,P.normals[F*2+1]=Z,P.concave[F]=ie*ue-Q*Z>0;let he=l.vertexIndices[k];if(Array.isArray(he))P.continuous[F]=!1;else{let[ge,pe]=this._shape.getCurveIndexFromVertexId(he-1,!0);if(pe>0&&pe<1)P.continuous[F]=!0;else{let ve=pe===1?ge+1:ge-1;ve=(ve+G)%G;let Re=pe===1?0:1,Te=this._shape.roundedCurves[ge].getTangent(pe),Me=this._shape.roundedCurves[ve].getTangent(Re);P.continuous[F]=Te.dot(Me)>.95}}A&&(P.normals[F*2+0]*=-1,P.normals[F*2+1]*=-1),[D,k,R]=[k,R,R+1],R>=C&&(R-=T)}while(R!==E+1);let N=[];N.push({bevelI:0,angle:0,size:0,boundary:{vertices:l.vertices.slice(E*2,C*2),vertexCount:T,vertexIndices:new Array(T).fill(!0).map((F,z)=>[z,z]),elements:[0,T],elementCount:1,mesh:null},reverseMap:[],insetPoints:l.vertices.slice(E*2,C*2)});for(let F=1;F<=this._bevelSegments;F++){let z=F/this._bevelSegments*Math.PI/2,U=(1-Math.cos(z))*this._bevelSize,W=[],Y=[],K=0;for(let ie=0;ie<T;ie++){let Q=ie*2,J=(ie-1+T)%T*2,Z=l.vertices[P.start*2+Q+0],ue=l.vertices[P.start*2+Q+1],de=-P.normals[J+0]*U,he=-P.normals[J+1]*U,ge=-P.normals[Q+0]*U,pe=-P.normals[Q+1]*U;if(P.concave[ie]||!P.concave[ie]&&A){let ve=Math.atan2(he,de),Re=Math.atan2(pe,ge);Re>ve&&(Re-=Math.PI*2);let Te=Re-ve;if(P.continuous[ie]||A){let Me=ve+Te/2,yt=Math.cos(Me)*U,Ge=Math.sin(Me)*U;W[2*K+0]=Z+yt*(A?-1:1),W[2*K+1]=ue+Ge*(A?-1:1),Y[K]=ie,K++}else{let Me=Math.max(1,Math.floor(r/4*Math.abs(Te)/Math.PI));for(let yt=0;yt<=Me;yt++){let Ge=ve+Te*(yt/Me),B=Math.cos(Ge)*U,O=Math.sin(Ge)*U;W[2*K+0]=Z+B,W[2*K+1]=ue+O,Y[K]=ie,K++}}}else W[2*K+0]=Z+de,W[2*K+1]=ue+he,Y[K]=ie,K++,W[2*K+0]=Z,W[2*K+1]=ue,Y[K]=ie,K++,W[2*K+0]=Z+ge,W[2*K+1]=ue+pe,Y[K]=ie,K++}let V=Oh({windingRule:Gt.POSITIVE,elementType:Si.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[W],edgeCreateCallback:ie=>{let Q=ie.Org.idx,J=Y[Q],Z=Y[(Q+1)%Y.length];ie.idx=[J,Z],ie.Sym.idx=[Z,J]},vertexIdCallback:ie=>{let Q=ie.Lprev.idx;return[Q?Q[1]:0,ie.idx[0]]}});if(!V)throw console.log("Error"),new Error(`error generating bevel geometry for ${F}'th loop`);if(!V.vertexCount)break;for(let ie=0;ie<V.vertexIndices.length;ie++){let[Q,J]=V.vertexIndices[ie];if(Q===J)continue;let Z=J;J<Q&&(Z+=T);for(let ue=Q;ue<Z;ue++){let de=ue%T,he=(ue+1)%T;if(!P.continuous[de]||!P.continuous[he]){V.vertexIndices[ie]=[Q,de],V.vertexIndices.splice(ie+1,0,[he,J]),V.vertices.splice((ie+1)*2,0,V.vertices[ie*2],V.vertices[ie*2+1]);break}}}N.push({bevelI:F,angle:z,size:U,boundary:V,reverseMap:Y,insetPoints:W})}let L=(F,z,U)=>{let W=0,Y=F.boundary.vertexIndices.length;for(;W<Y&&U(F.boundary.vertexIndices[z]);)z=(z+1)%Y,W++;return W},H=f.length;for(let F=1;F<N.length;F++){let z=N[F-1],U=N[F],W=z.boundary.vertexIndices.length,Y=U.boundary.vertexIndices.length;if(!W||!Y)break;let K=P.concave.length,V=0,ie=$f(V,T);for(;!z.boundary.vertexIndices.filter(ie).length||!U.boundary.vertexIndices.filter(ie).length;)V++,ie=$f(V,T);let Q=z.boundary.vertexIndices.findIndex(ie),J=U.boundary.vertexIndices.findIndex(ie);do Q=(Q+1)%W;while(ie(z.boundary.vertexIndices[Q]));do J=(J+1)%Y;while(ie(U.boundary.vertexIndices[J]));V=(V+1)%T;let Z=V,ue=this.buildBevelVert(P,z,(Q-1+W)%W),de=this.buildBevelVert(P,U,(J-1+Y)%Y),he=ue,ge=de,pe,ve,Re=!1;do{ie=$f(V,T);let Te=L(z,Q,ie),Me=L(U,J,ie),yt=Re;if(Re=!1,Te&&!Me){for(let Ge=0;Ge<Te;Ge++)pe=this.buildBevelVert(P,z,(Q+Ge)%W,Ge/(Te-1)),f.push(he.topN,pe.topP,ge.topN),f.push(pe.bottomP,he.bottomN,ge.bottomN),he=pe;Re=!0}else if(!Te&&Me)for(let Ge=0;Ge<Me;Ge++)ve=this.buildBevelVert(P,U,(J+Ge)%Y,Ge/(Me-1)),f.push(ge.topN,he.topP,ve.topP),f.push(he.bottomP,ge.bottomN,ve.bottomP),ge=ve;else if(Te&&Me)if(pe=this.buildBevelVert(P,z,Q,0),ve=this.buildBevelVert(P,U,J,0),yt?(f.push(he.topN,ve.topP,ge.topN),f.push(he.topN,pe.topP,ve.topP),f.push(ve.bottomP,he.bottomN,ge.bottomN),f.push(ve.bottomP,pe.bottomP,he.bottomN)):(f.push(ge.topN,he.topN,pe.topP),f.push(ge.topN,pe.topP,ve.topP),f.push(pe.bottomP,he.bottomN,ge.bottomN),f.push(pe.bottomP,ge.bottomN,ve.bottomP)),he=pe,ge=ve,Te===Me)for(let Ge=1;Ge<Te;Ge++)pe=this.buildBevelVert(P,z,(Q+Ge)%W,Ge/(Te-1)),ve=this.buildBevelVert(P,U,(J+Ge)%Y,Ge/(Me-1)),f.push(he.topN,pe.topP,ge.topN),f.push(ge.topN,pe.topP,ve.topP),f.push(pe.bottomP,he.bottomN,ge.bottomN),f.push(pe.bottomP,ge.bottomN,ve.bottomP),he=pe,ge=ve;else if(Te>Me){let Ge=Te/Me,B=0;for(let O=1;O<Te;O++)pe=this.buildBevelVert(P,z,(Q+O)%W,O/(Te-1)),f.push(he.topN,pe.topP,ge.topN),f.push(pe.bottomP,he.bottomN,ge.bottomN),he=pe,O>(B+1)*Ge&&(B++,ve=this.buildBevelVert(P,U,(J+B)%Y,B/(Me-1)),f.push(ge.topN,pe.topP,ve.topP),f.push(pe.bottomP,ge.bottomN,ve.bottomP),ge=ve)}else{let Ge=Me/Te,B=0;for(let O=1;O<Me;O++)ve=this.buildBevelVert(P,U,(J+O)%Y,O/(Me-1)),f.push(ge.topN,pe.topP,ve.topP),f.push(pe.bottomP,ge.bottomN,ve.bottomP),ge=ve,O>(B+1)*Ge&&(B++,pe=this.buildBevelVert(P,z,(Q+B)%W,B/(Te-1)),f.push(he.topN,pe.topP,ge.topN),f.push(pe.bottomP,he.bottomN,ge.bottomN),he=pe)}Q=(Q+Te)%W,J=(J+Me)%Y,V=(V+1)%K}while(V!==Z)}{let F=N[0];for(let z=0,U=F.boundary.vertexCount;z<U;z++){let W=this.buildBevelVert(P,F,z),Y=this.buildBevelVert(P,F,(z+1)%U);f.push(Y.topP,W.topN,W.bottomN),f.push(Y.topP,W.bottomN,Y.bottomP)}}if(A){let F=[];for(let z=f.length-1;z>=H+2;z-=3){let U=f[z-2],W=f[z-1],Y=f[z-0];F.push(Y,W,U)}f.splice(H,f.length-H,...F)}if(A){let F=[];for(let z=N[N.length-1].boundary.vertices.length-1;z>=1;z-=2){let U=N[N.length-1].boundary.vertices[z-1],W=N[N.length-1].boundary.vertices[z-0];F.push(U,W)}v.push(F)}if(!A){let F=N[N.length-1],z=Oh({windingRule:N.length>1?Gt.POSITIVE:Gt.ODD,elementType:Si.POLYGONS,vertexSize:2,strict:!0,contours:[F.insetPoints,...v]});if(!z)throw new Error("Error generating geometry for surface");o.length===0&&Object.assign(this,{capStartIndex:f.length});for(let U=0;U<z.elementCount*3;U+=3){let W=this.buildSurfaceVert(z,z.elements[U+0]),Y=this.buildSurfaceVert(z,z.elements[U+1]),K=this.buildSurfaceVert(z,z.elements[U+2]);f.push(W.top,Y.top,K.top),f.push(K.bottom,Y.bottom,W.bottom)}}this.vertexCache={}}this._buffer.shrink();let y=new at(Uint32Array.from(f),1),x=new at(this._buffer.positions,3),b=new at(this._buffer.normals,3),S=new at(this._buffer.uvs,2);x.needsUpdate=!0,b.needsUpdate=!0,S.needsUpdate=!0,y.needsUpdate=!0,this.setAttribute("position",x),this.setAttribute("normal",b),this.setAttribute("uv",S),this.setIndex(y)}buildSurfaceVert(e,t){let i=t.toString();if(i in this.vertexCache)return this.vertexCache[i];let r=e.vertices[t*2+0],n=e.vertices[t*2+1],s=(r-this._minX)/this._width,a=(n-this._minY)/this._height,o=this._buffer.get(2),l=o*3,h=o*2,c={top:o+0,bottom:o+1};return this._buffer.positions[l+0]=r,this._buffer.positions[l+1]=n,this._buffer.positions[l+2]=this._depth,this._buffer.normals[l+0]=0,this._buffer.normals[l+1]=0,this._buffer.normals[l+2]=1,this._buffer.uvs[h+0]=s,this._buffer.uvs[h+1]=a,this._buffer.positions[l+3]=r,this._buffer.positions[l+4]=n,this._buffer.positions[l+5]=0,this._buffer.normals[l+3]=0,this._buffer.normals[l+4]=0,this._buffer.normals[l+5]=-1,this._buffer.uvs[h+2]=s,this._buffer.uvs[h+3]=a,this.vertexCache[i]=c,c}buildBevelVert(e,t,i,r=1){let n=`${t.bevelI}:${i}`;if(n in this.vertexCache)return this.vertexCache[n];let[s,a]=t.boundary.vertexIndices[i],o,l,h,c;s!==a?(l=s,o=a,c=!1,h=e.continuous[l]&&e.continuous[o]):(o=s,l=(o-1+e.count)%e.count,c=e.concave[o]&&t.bevelI>0,h=e.continuous[o]||c);let u=Math.cos(t.angle),d=Math.sin(t.angle),p=i*2,m=o*2,g=l*2,f=t.boundary.vertices[p+0],v=t.boundary.vertices[p+1],y=(1-d)*this._bevelSize,x=(f-this._minX)/this._width,b=(v-this._minY)/this._height,S=e.normals[m+0],_=e.normals[m+1],A=e.normals[g+0],w=e.normals[g+1];if(c){let k=A-S,D=w-_;S=S+k*(1-r),_=_+D*(1-r);let R=Math.sqrt(S*S+_*_);S/=R,_/=R}let E=this._buffer.get(h?2:4),T=E*3,C=E*2,P={i,fi:o,topP:E+0,topN:E+0,bottomP:E+1,bottomN:E+1};return this._buffer.positions[T+0]=f,this._buffer.positions[T+1]=v,this._buffer.positions[T+2]=this._depth-y,this._buffer.normals[T+0]=S*u,this._buffer.normals[T+1]=_*u,this._buffer.normals[T+2]=d,this._buffer.uvs[C+0]=x,this._buffer.uvs[C+1]=b,this._buffer.positions[T+3]=f,this._buffer.positions[T+4]=v,this._buffer.positions[T+5]=y,this._buffer.normals[T+3]=S*u,this._buffer.normals[T+4]=_*u,this._buffer.normals[T+5]=-d,this._buffer.uvs[C+2]=b,this._buffer.uvs[C+3]=x,h||(E+=2,T+=6,C+=4,P.topP=E+0,P.bottomP=E+1,this._buffer.positions[T+0]=f,this._buffer.positions[T+1]=v,this._buffer.positions[T+2]=this._depth-y,this._buffer.normals[T+0]=A*u,this._buffer.normals[T+1]=w*u,this._buffer.normals[T+2]=d,this._buffer.uvs[C+0]=x,this._buffer.uvs[C+1]=b,this._buffer.positions[T+3]=f,this._buffer.positions[T+4]=v,this._buffer.positions[T+5]=y,this._buffer.normals[T+3]=A*u,this._buffer.normals[T+4]=w*u,this._buffer.normals[T+5]=-d,this._buffer.uvs[C+2]=b,this._buffer.uvs[C+3]=x),this.vertexCache[n]=P,P}clone(){let e=new k2(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=JE(this.userData),e}},ws=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var h,c,u,d,p,m,g;let i=Object.assign({},(h=t==null?void 0:t.parameters)!=null?h:{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:Gt.ODD},e.parameters),r=Math.abs(i.width),n=Math.abs((c=i.height)!=null?c:i.width),s=Math.abs((u=i.depth)!=null?u:0),a=(d=e.shape)!=null?d:t==null?void 0:t.shape,o=(p=a==null?void 0:a.roundness)!=null?p:i.roundness;a!==void 0&&(a instanceof Kt?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new Kt(r,n).fromJSON(a),((m=e.parameters)==null?void 0:m.roundness)!==void 0&&((g=e.parameters)==null?void 0:g.roundness)>0&&a.update(!1));let l=a!=null?a:new Kt(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new B2(e.shape,n,{windingRule:a}):o=new k2(e.shape,t,i,n,r,a),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},vW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var a,o,l,h,c;let i=Object.assign({},(a=t==null?void 0:t.parameters)!=null?a:{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:0,cornerSegments:8,hollow:0},e.parameters),r=i.width/2,n=(o=i.radiusTop)!=null?o:r,s=(l=i.radiusBottom)!=null?l:r;return n===s?(n=r,s=r):n>s?(n=r,s=s*r/n):(n=n*r/s,s=r),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((h=i.height)!=null?h:i.width),depth:Math.abs((c=i.depth)!=null?c:i.width),radiusTop:n,radiusBottom:s})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:h,radiusBottom:c,cornerRadius:u,cornerSegments:d,hollow:p}=e.parameters,m;return u||p?m=new U2(h,c,r,n,s,a,o,l*Math.PI/180,u,u,d,p):m=new s0(h,c,r,n,s,a,o,l*Math.PI/180),m.scale(1,1,i/t),Object.assign(m,{userData:{...e,type:"CylinderGeometry"}})}};function Bs(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function vw(e){return new q(e.y,-e.x)}var U2=class extends it{constructor(e,t,i,r,n,s,a,o,l,h,c,u,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,h=0);let p=[],m=[],g=[],f=[],v=0,y=i/2,x=new M,b=new M;d&&e==0&&(e=l),d&&t==0&&(t=h);let S=new q(e,y),_=new q(t,-y),A=null,w=null,E=null,T=null,C=S.clone().sub(_),P=0,k=0,D=0;u>0&&(P=Math.min(e,t)*(1-u),k=e-P,D=t-P);let R=S.clone();R.x-=P;let G=Math.PI-C.angle(),N=C.angle(),L=Math.tan(N/2),H=Math.tan(G/2),F=L+H,z=u?F:H,U=u?F:L;if(l=Math.min(l,(e-k)/z,C.length()/F),h=Math.min(h,(t-D)/U,C.length()/F),l>0){let Q=l/L;A=S.clone().sub(new q(Q,l)),u&&(E=A.clone(),E.x-=P-F*l),S.sub(C.clone().setLength(Q))}if(h>0){let Q=h/H;w=_.clone().sub(new q(Q,-h)),_.add(C.clone().setLength(Q)),u&&(T=w.clone(),T.x-=P-F*h,R.sub(C.clone().setLength(Q)))}C=S.clone().sub(_);let W=C.length()<.5,Y=[];for(let Q=0;Q<=r;Q++){let J=[],Z=Q/r,ue=Z*o+a,de=new q(Math.sin(ue),Math.cos(ue));T&&w?(K(J,Z,de,G,h,T,-1,!0),K(J,Z,de,N,h,w,-1,!1)):w?(V(J,de,w.x,0,-1),K(J,Z,de,N,h,w,-1,!1)):s||V(J,de,t,D,-1);let he=vw(C).normalize();if(Bs(he,de,x),!W)for(let ge=0;ge<=n;ge++){let pe=ge/n,ve=C.clone().multiplyScalar(pe).add(_);Bs(ve,de,b),m.push(b.x,b.y,b.z),g.push(x.x,x.y,x.z),f.push(Z,.5+b.y/i),J.push(v++)}if(E&&A?(K(J,Z,de,G,l,A,1,!1),K(J,Z,de,N,l,E,1,!0)):A?(K(J,Z,de,G,l,A,1,!1),V(J,de,A.x,0,1)):s||V(J,de,e,k,1),u&&!W){let ge=vw(C).multiplyScalar(-1).normalize();Bs(ge,de,x);for(let pe=0;pe<=n;pe++){let ve=pe/n,Re=C.clone().multiplyScalar(-ve).add(R);Bs(Re,de,b),m.push(b.x,b.y,b.z),g.push(x.x,x.y,x.z),f.push(Z,.5+b.y/i),J.push(v++)}}u&&!s&&J.push(J[0]),Y.push(J)}for(let Q=0;Q<Y.length-1;Q++)for(let J=0;J<Y[0].length-1;J++){if(s&&u&&J==n)continue;let Z=Y[Q][J],ue=Y[Q+1][J],de=Y[Q+1][J+1],he=Y[Q][J+1],ge=m[de*3+0],pe=m[de*3+2];p.push(Z,ue,he),(ge!=0||pe!=0)&&p.push(ue,de,he)}o<Math.PI*2&&(ie(-1,Y[0],a),ie(1,Y[Y.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new Be(m,3)),this.setAttribute("normal",new Be(g,3)),this.setAttribute("uv",new Be(f,2));function K(Q,J,Z,ue,de,he,ge,pe){for(let ve=0;ve<c+1;ve++){let Re=ve/c,Te=ge<0?Re:1-Re;pe&&(Te-=1),Te*=ue;let Me=new q(Math.sin(Te),Math.cos(Te)*ge),yt=Me.clone().multiplyScalar(de).add(he);Bs(yt,Z,b),m.push(b.x,b.y,b.z),Bs(Me,Z,x),g.push(x.x,x.y,x.z),f.push(J,.5+b.y/i),Q.push(v++)}}function V(Q,J,Z,ue,de){let he=new M,ge=new q,pe=[Z,ue];de<0&&pe.reverse();for(let ve of pe)ge.set(ve,y*de),Bs(ge,J,he),m.push(he.x,he.y,he.z),g.push(0,de,0),f.push(.5,.5),Q.push(v++)}function ie(Q,J,Z){let ue=new q(Math.sin(Z),Math.cos(Z)),de=new q(-Math.cos(Z),Math.sin(Z)),he=new M,ge=Q<0?(Re,Te,Me)=>p.push(Re,Te,Me):(Re,Te,Me)=>p.push(Re,Me,Te),pe=new q((e+t+k+D)/4,0);Bs(pe,ue,he),m.push(he.x,he.y,he.z),g.push(de.x,0,de.y),f.push(.5,.5);let ve=v++;for(let Re of J){let Te=m.slice(Re*3,Re*3+3);m.push(...Te),g.push(de.x,0,de.y);let Me=f.slice(Re*2,Re*2+2);f.push(...Me),v++}for(let Re=ve+1;Re<v-1;Re++)ge(ve,Re,Re+1);ge(ve,v-1,ve+1)}}},yW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:0,cornerRadiusBottom:0,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:h,cornerRadiusBottom:c,cornerSegments:u}=e.parameters,d;return h>0||c>0||l<360?d=new U2(0,t/2,r,n,s,a,o,l*Math.PI/180,h,c,u,0,!0):d=new tE(t/2,r,n,s,a),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},xW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:0,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=e.parameters,h;return o==0?h=new la(t,i,r,n,s,a):h=new bW(t,i,r,n,s,a,o,l),Object.assign(h,{userData:{...e,type:"CubeGeometry"}})}},em=Math.PI/2,bW=class extends it{constructor(e=1,t=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxBufferGeometry";let l=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,i/2);let h=[],c=[],u=[],d=[],p=0,m=0;g("z","y","x",-1,-1,i,t,e,s,n,0),g("z","y","x",1,-1,i,t,-e,s,n,1),g("x","z","y",1,1,e,i,t,r,s,2),g("x","z","y",1,-1,e,i,-t,r,s,3),g("x","y","z",1,-1,e,t,i,r,n,4),g("x","y","z",-1,-1,e,t,-i,r,n,5),a>0&&(f("z","y","x",-1,-1,1,i,t,e,s,0),f("z","y","x",1,-1,-1,i,t,e,s,1),f("z","y","x",-1,1,-1,i,t,e,s,1),f("z","y","x",1,1,1,i,t,e,s,0),f("x","y","z",-1,-1,-1,e,t,i,r,0),f("x","y","z",1,-1,1,e,t,i,r,1),f("x","y","z",-1,1,1,e,t,i,r,0),f("x","y","z",1,1,-1,e,t,i,r,1),f("y","x","z",-1,-1,1,t,e,i,n,0),f("y","x","z",1,-1,-1,t,e,i,n,1),f("y","x","z",1,1,1,t,e,i,n,1),f("y","x","z",-1,1,-1,t,e,i,n,0),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(h),this.setAttribute("position",new Be(c,3)),this.setAttribute("normal",new Be(u,3)),this.setAttribute("uv",new Be(d,2));function g(y,x,b,S,_,A,w,E,T,C,P){let k=(A-2*a)/T,D=(w-2*a)/C,R=A/2-a,G=w/2-a,N=E/2,L=T+1,H=C+1,F=0,z=0,U=new M;for(let W=0;W<H;W++){let Y=W*D-G;for(let K=0;K<L;K++){let V=K*k-R;U[y]=V*S,U[x]=Y*_,U[b]=N,c.push(U.x,U.y,U.z),U[y]=0,U[x]=0,U[b]=E>0?1:-1,u.push(U.x,U.y,U.z),d.push(K/T),d.push(1-W/C),F+=1}}for(let W=0;W<C;W++)for(let Y=0;Y<T;Y++){let K=p+Y+L*W,V=p+Y+L*(W+1),ie=p+(Y+1)+L*(W+1),Q=p+(Y+1)+L*W;h.push(K,V,Q),h.push(V,ie,Q),z+=6}l.addGroup(m,z,P),m+=z,p+=F}function f(y,x,b,S,_,A,w,E,T,C,P){let k=(w-2*a)/C,D=w/2-a,R=E/2-a,G=T/2,N=C+1,L=0,H=0,F=new M,z=new M;for(let U=0;U<o+1;U++){let W=U/o*em,Y=Math.sin(W)*a,K=(1-Math.cos(W))*a,V=Math.sin(W),ie=Math.cos(W);F[x]=(R+Y)*_,F[b]=(G-K)*A,z[y]=0,z[x]=V*Math.sign(F[x]),z[b]=ie*Math.sign(F[b]);for(let Q=0;Q<N;Q++){let J=Q*k-D;F[y]=J*S,c.push(F.x,F.y,F.z),u.push(z.x,z.y,z.z),d.push(Q/C),d.push(0),L+=1}}for(let U=0;U<o;U++)for(let W=0;W<C;W++){let Y=p+W+N*U,K=p+W+N*(U+1),V=p+(W+1)+N*(U+1),ie=p+(W+1)+N*U;h.push(Y,K,ie),h.push(K,V,ie),H+=6}l.addGroup(m,H,P),m+=H,p+=L}function v(y,x,b){let S=new M,_=new M(e/2,t/2,i/2);_.subScalar(a);let A=[],w=y*x*b>0?(T,C,P)=>h.push(T,C,P):(T,C,P)=>h.push(T,P,C);for(let T=0;T<=o;T++){let C=[],P=em*(1-T/o),k=Math.cos(P),D=Math.sin(P),R=0;for(let G=0;G<=T;G++){let N=Math.cos(R),L=Math.sin(R);S.x=k*N,S.y=D,S.z=k*L;let H=_.clone().addScaledVector(S,a);c.push(y*H.x,x*H.y,b*H.z),u.push(y*S.x,x*S.y,b*S.z),d.push(0,0),C.push(p++),R+=em/T}A.push(C)}let E=A.length-1;for(let T=0;T<E;T++){let C=A[T],P=A[T+1],k=C.length-1;w(C[0],P[1],P[0]);for(let D=1;D<=k;D++)w(C[D-1],C[D],P[D]),w(C[D],P[D+1],P[D])}}}},F0=class extends it{constructor(e=[],t=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];h(),c(),this.setAttribute("position",new Be(a,3)),this.setAttribute("normal",new Be(l,3)),this.setAttribute("uv",new Be(o,2));return;function h(){var N;n=Math.min(1-1e-5,n),n==0&&(s=0);let u={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new M,p=d.clone(),m=new Dr,g=n*r,f=r-g,v=s+1,y=new M,x=(L,H)=>y.subVectors(L,H).normalize(),b=(L,H)=>Array(L).fill(void 0).map(H),S=b(e.length/3,(L,H)=>new M().fromArray(e,H*3).setLength(r)),_=[],A=1e6;for(let L=0;L<S.length;L++){let H=S[L],F=[],z,U,W,Y=1e10,K=-1;for(;(K=t.indexOf(L,K+1))!=-1;){let J=K-K%3;z=t[J+(K+1)%3],U=t[J+(K+2)%3],W=H.distanceToSquared(S[z]),Y=Math.min(Y,W),F.push([z,U,W])}Y+=1e-6;let V=[],ie=0,Q=F.length;for(let J=0;J<Q;J++){[z,U,W]=F[ie];let Z=((N=_[z])==null?void 0:N.includes(L))==!0;W<=Y&&V.push(z+ +Z*A),ie=F.findIndex(ue=>ue[0]==U)}_.push(V)}let w=[];{let L=0,H=0,F,z,U=u==3;for(let W=0;W<=s;W++){F=W*(W+1)/2,z=(W+1)*(W+2)/2;for(let Y=0;Y<s-W;Y++)[L,H]=[F+Y+W+2,z+Y+W+3],w.push(F,z,...U?[H,F]:[L,z],H,L),[F,z]=[L,H];w.push(F,z,F+s+2)}}let E=d.clone(),T=d.clone(),C=d.clone(),P=d.clone(),k=d.clone(),D=[],R=b(S.length,()=>b(u,()=>d.clone()));for(let L=0;L<S.length;L++){d.copy(S[L]).normalize(),E.copy(d).multiplyScalar(f);let H=_[L];for(let V=0;V<H.length;V++){let ie=H[V],Q=H[(V+1)%u];m.setFromPointsAndIndices(S,L,ie%A,Q%A),m.b.sub(m.a).setLength(1e10).add(m.a),m.c.sub(m.a).setLength(1e10).add(m.a),m.closestPointToPoint(E,R[L][V])}let F=[],z=[],U=[],W=new M;s==0&&[...R[L]].reduce((V,ie)=>V.add(ie),W).multiplyScalar(1/u);for(let V=0;V<u;V++){let ie=[],Q=(V-1+u)%u,J=R[L][Q],Z=R[L][V];d.copy(J).sub(E),p.copy(Z).sub(E);let ue=E.angleTo(d),de=d.angleTo(p),he=Math.cos(ue)*g;s==0?T.copy(W):T.copy(E).setLength(f+he),z.push(he);let ge=[T,J,Z];for(let pe=0;pe<2;pe++){let ve=ge[pe],Re=ge[pe+1];P.subVectors(ve,E),k.subVectors(Re,E),C.crossVectors(P,k).normalize();for(let Te=0;Te<v;Te++){let Me=[ue,de][pe]*Te/v;d.copy(P).applyAxisAngle(C,Me).add(E),F.push(d.clone()),pe&&(x(d,E),ie.push([Te==0?ve:d.clone(),y.clone()]))}pe&&(x(Re,E),ie.push([Re,y.clone()]))}U.push(ie)}D.push(U);let Y=2*v,K=2;for(let V=0;V<u;V++){let ie=Y*V,Q=Y*((V+1)%u),J=[F[ie]];for(let ue=1;ue<v;ue++){P=F[ie+ue],k=F[Q+ue],J.push(P);for(let de=1,he=ue-K+1;de<=he;de++)d.lerpVectors(P,k,de/(he+1)),d.sub(E).setLength(z[V]).add(E),J.push(d.clone());J.push(k)}for(let ue=0;ue<v;ue++)J.push(F[ue+v+ie]);J.push(F[Q+v]);let Z=w.map(ue=>J[ue]);a.push(...Z.map(ue=>[ue.x,ue.y,ue.z]).flat()),l.push(...Z.map(ue=>(x(ue,E),[y.x,y.y,y.z])).flat())}}let G=[];for(let L=0;L<_.length;L++)for(let H=0;H<u;H++){let F=_[L][H];if(F<A){let z=_[F].findIndex(Y=>Y%A==L),U=D[L][H],W=D[F][z];for(let Y=0;Y<v;Y++){let K=U[Y],V=W[v-Y],ie=U[Y+1],Q=W[v-(Y+1)];[K,V,ie,ie,V,Q].forEach(J=>{a.push(J[0].x,J[0].y,J[0].z),l.push(J[1].x,J[1].y,J[1].z)})}G.push(U[0][0],W[v][0],U[v][0],W[0][0])}}for(;G.length;){let L,H,F,z;[L,H]=G.splice(0,2);let U=[L];for(;L!=H;)U.push(H),F=G.indexOf(H),z=F%2,H=G.splice(F-z,2)[1-z];y.subVectors(U[0],U[1]).cross(d.subVectors(U[0],U[2])).normalize();let W=y.dot(U[0])<0;W&&y.negate();for(let Y=1;Y<=U.length-2;Y++)[U[Y+ +W],U[Y+1-+W],U[0]].forEach(K=>{a.push(K.x,K.y,K.z),l.push(y.x,y.y,y.z)})}}function c(){let u=new M;for(let _=0;_<a.length;_+=3){u.x=a[_+0],u.y=a[_+1],u.z=a[_+2];let A=b(u)/2/Math.PI+.5,w=S(u)/Math.PI+.5;o.push(A,1-w)}let d=new M,p=new M,m=new M,g=new M,f=new q,v=new q,y=new q,x=(_,A,w,E)=>{E<0&&_.x===1&&(o[A]=_.x-1),w.x===0&&w.z===0&&(o[A]=E/2/Math.PI+.5)};for(let _=0,A=0;_<a.length;_+=9,A+=6){d.set(a[_+0],a[_+1],a[_+2]),p.set(a[_+3],a[_+4],a[_+5]),m.set(a[_+6],a[_+7],a[_+8]),f.set(o[A+0],o[A+1]),v.set(o[A+2],o[A+3]),y.set(o[A+4],o[A+5]),g.copy(d).add(p).add(m).divideScalar(3);let w=b(g);x(f,A+0,d,w),x(v,A+2,p,w),x(y,A+4,m,w)}for(let _=0;_<o.length;_+=6){let A=o[_+0],w=o[_+2],E=o[_+4],T=Math.max(A,w,E),C=Math.min(A,w,E);T>.9&&C<.1&&(A<.2&&(o[_+0]+=1),w<.2&&(o[_+2]+=1),E<.2&&(o[_+4]+=1))}function b(_){return Math.atan2(_.z,-_.x)}function S(_){return Math.atan2(-_.y,Math.sqrt(_.x*_.x+_.z*_.z))}}}static fromJSON(e){return new F0(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},wW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new F2(t*.5,s,a):new iE(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},F2=class extends F0{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,e,t,i),this.type=o}static fromJSON(e){return new F2(e.radius,e.corner,e.cornerSides)}},tv=Math.PI*2;function tm({x:e,y:t},i,r,n,s){return{x:e*i+n,y:t*r+s}}function _W(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),n=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function yw(e,t,i,r){let n=e*r-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*r));return n*Math.acos(s)}function SW(e,t,i,r,n,s,a,o,l,h){let c=Math.pow(n,2),u=Math.pow(s,2),d=Math.pow(a,2),p=Math.pow(o,2),m=c*u-c*p-u*d;m<0&&(m=0),m/=c*p+u*d,m=Math.sqrt(m)*(l===h?-1:1);let g=m*n/s*o,f=m*-s/n*a,v=g+(e+i)/2,y=f+(t+r)/2,x=(a-g)/n,b=(o-f)/s,S=(-a-g)/n,_=(-o-f)/s,A=yw(1,0,x,b),w=yw(x,b,S,_);return!h&&w>0&&(w-=tv),h&&w<0&&(w+=tv),{centerx:v,centery:y,ang1:A,ang2:w}}function AW({px:e,py:t,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let h=(e-i)/2,c=(t-r)/2;if(h===0&&c===0)return[];n=Math.abs(n),s=Math.abs(s);let u=Math.pow(h,2)/Math.pow(n,2)+Math.pow(c,2)/Math.pow(s,2);u>1&&(n*=Math.sqrt(u),s*=Math.sqrt(u));let d=SW(e,t,i,r,n,s,h,c,a,o),{ang1:p,ang2:m}=d,{centerx:g,centery:f}=d,v=Math.abs(m)/(tv/4);Math.abs(1-v)<1e-7&&(v=1);let y=Math.max(Math.ceil(v),1);m/=y;for(let x=0;x<y;x++)l.push(_W(p,m)),p+=m;return l.map(x=>{let{x:b,y:S}=tm(x[0],n,s,g,f),{x:_,y:A}=tm(x[1],n,s,g,f),{x:w,y:E}=tm(x[2],n,s,g,f);return{x1:b,y1:S,x2:_,y2:A,x:w,y:E}})}var z2=Math.PI*2,EW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Kt?e.shape:new Kt,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:0)})}}static build(e){let{width:t,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,h=e.shape,c=t*.5,u=i*.5,d=TW(h,c,u,n*Math.PI/180,r,s);h.isClosed=!0,h.update();let p=ws.create({shape:h,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function TW(e,t,i,r,n,s){if(r>=z2)return n>30||n%4===0?(CW(e,t,i,s),Math.round(n/4)):xw(e,r,n,t,i,s);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*i},h=AW({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%h.length===0?MW(e,a.x,a.y,h,n,t,i,s):xw(e,r,n,t,i,s)}function MW(e,t,i,r,n,s,a,o){let l=Math.round(n/r.length);e.addPoint(fl(t,i));for(let h=0,c=r.length;h<c;h++){let u=r[h],d=e.points[h],p=fl(u.x,u.y);d.controls[1].position.set(u.x1,u.y1),p.controls[0].position.set(u.x2,u.y2),e.addPoint(p)}return o>0?G2(e,s,a,o):e.addPoint(fl(0,0)),l}function xw(e,t,i,r,n,s){let a=-t/i;for(let o=0;o<=i;o++){let l=a*o,h=Math.sin(l)*r,c=Math.cos(l)*n;e.addPoint(fl(h,c))}return t<z2?s>0?G2(e,r,n,s):e.addPoint(fl(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&H2(e,r,n,s)),1}function CW(e,t,i,r=0,n=0,s=0){let a=.5522847498,o=t*a,l=i*a;e.addPoint(Gc(n-t,s,n-t,s-l,n-t,s+l)),e.addPoint(Gc(n,s+i,n-o,s+i,n+o,s+i)),e.addPoint(Gc(n+t,s,n+t,s+l,n+t,s-l)),e.addPoint(Gc(n,s-i,n+o,s-i,n-o,s-i)),r>0&&H2(e,t,i,r)}function fl(e,t){return new pl(lt.generateUUID(),new q(e,t))}function Gc(e,t,i,r,n,s){let a=fl(e,t);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function G2(e,t,i,r){V2(e,t,i,r).forEach(n=>e.addPoint(n))}function H2(e,t,i,r){let n=V2(e,t,i,r),s=new Kt;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,e.shapeHoles.push(s)}function V2(e,t,i,r){let n=r*t/100,s=n*(Math.abs(i)/Math.abs(t)),a=new q(n/t,s/i),o=e.points.map(l=>{let h=l.clone();return h.uuid=lt.generateUUID(),h}).reverse();return o.forEach(l=>{l.position.multiply(a);let h=l.controls[0].position.clone().multiply(a),c=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(c),l.controls[1].position.copy(h)}),o}var DW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var o,l,h;let i=Object.assign({},(o=t==null?void 0:t.parameters)!=null?o:{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),n=Math.abs((l=i.height)!=null?l:r),s=Math.abs((h=i.depth)!=null?h:r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:h,cornerRadius:c,cornerSegments:u}=e.parameters,d=new j2(!1,t,i,r,n,s,a,o,l,h,c,u);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},j2=class extends it{constructor(e=!0,t=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,h=1,c=1,u=1){super();let d=e&&s===1;d&&(u=0),c>100&&(c=100);let p=()=>new M,m=new M,g=p(),f=p(),v=p(),y,x,b,S,_,A,w,E,T=p(),C=p(),P=p(),k=p(),D=p(),R=p(),G=p(),N=p(),L=i-2*o+.001,H=L/s,F=Math.ceil(a*s),z=F+1,U=L/F,W=-L/2,Y=h+1,K=2*Math.PI/h,V=Math.PI/2/u,ie=.01,Q=Math.min((1-c/100)*o,o-ie),J=o-Q,Z=0,ue=2,de=u*ue+ue,he=Y*de/ue,ge=he+Y*z,pe=Y*(z+de),[ve,Re,Te]=[3,3,2].map(_e=>Array(pe*_e).fill(0)),Me=[],yt=n-o;function Ge(_e,Se){let j=Math.PI/2;A=Se*U,E=2*Math.PI*(A%H)/H+j,A+=W,w=Math.sin(E)*yt,_=Math.cos(E)*yt,e?_e.set(_,w,A):_e.set(_,A,w)}Ge(m,-1e-10),Ge(g,0),T.copy(m),Ge(m,1);let B=m.distanceTo(g),O=J+Q,ne=B*F+2*O,fe=Q,ye=ne-O;for(let _e=0;_e<=F;_e++){Ge(f,_e),N.subVectors(f,T).normalize(),T.copy(f),R.copy(f).setComponent(+e+1,0).normalize(),G.crossVectors(N,R).normalize();let Se=_e===0,j=_e===F,Ee=Se?3*Math.PI/2:V,be=Se?fe:ye,Je=Se?Y:ge,Ie=Se?0:pe-Y,et=N.clone().multiplyScalar(Se?-J:J).add(f),xe=N.clone().multiplyScalar(Se?-1:1).normalize();for(let We=0;We<Y;We++){let Pe=We*K;if(C.addVectors(m.copy(R).multiplyScalar(o*Math.cos(Pe)),g.copy(G).multiplyScalar(o*Math.sin(Pe))),P.copy(C).normalize(),Se||j){d||(Z=Ie+We,[0,1,2].forEach(Ce=>{ve[Z*3+Ce]=et.getComponent(Ce),Re[Z*3+Ce]=xe.getComponent(Ce)}),Te[Z*2]=+j,Te[Z*2+1]=We/h),g.copy(P).multiplyScalar(Q),v.addVectors(f,g);for(let Ce=0;Ce<u;Ce++){let Ve=Ce*V+Ee;k.addVectors(m.copy(N).multiplyScalar(J*Math.sin(Ve)),g.copy(P).multiplyScalar(J*Math.cos(Ve))),D.copy(k).normalize(),g.addVectors(v,k),k.normalize(),Z=Je+Ce*Y+We,[0,1,2].forEach(xt=>{ve[Z*3+xt]=g.getComponent(xt),Re[Z*3+xt]=D.getComponent(xt)});let nt=+Se+Math.sin(Ve);Te[Z*2]=(be+J*nt)/ne,Te[Z*2+1]=We/h}}g.addVectors(f,C),Z=he+_e*Y+We,[0,1,2].forEach(Ce=>{ve[Z*3+Ce]=g.getComponent(Ce),Re[Z*3+Ce]=P.getComponent(Ce)}),Te[Z*2]=(O+_e*B)/ne,Te[Z*2+1]=We/h}}let Ae=z+2*u+ue,Xe=1,[se,je]=d?[Xe,Xe+z-1]:[0,Ae-1];for(let _e=se;_e<=je-1;_e++){let Se=d&&_e===je-1;for(let j=0;j<Y-1;j++)y=_e*Y+j,x=y+1,b=(Se?j:y)+Y,S=(Se?j+1:x)+Y,_e===0?Me.push(x,S,b):_e===Ae-2?Me.push(y,x,b):Me.push(y,x,b,x,S,b)}this.setIndex(Me),this.setAttribute("position",new Be(ve,3)),this.setAttribute("normal",new Be(Re,3)),this.setAttribute("uv",new Be(Te,2))}},PW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new W2(t*.5,s,a):new oE(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},W2=class extends F0{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,e,t,i),this.type=a}static fromJSON(e){return new W2(e.radius,e.corner,e.cornerSides)}},LW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s,a,o;((n=(r=e.parameters)==null?void 0:r.points)!=null?n:[]).forEach(l=>{Array.isArray(l)&&(l.x=l[0],l.y=l[1])});let i=Object.assign({},(s=t==null?void 0:t.parameters)!=null?s:{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((a=i.height)!=null?a:i.width),depth:Math.abs((o=i.depth)!=null?o:i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,n=new Sd;n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new eE(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},xn=new Fe,im=new Ut,Hc=new M,jd=class extends Bi{constructor(){super(),this.uuid=lt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Ri().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return xn.makeRotationX(e),this.applyMatrix4(xn),this}rotateY(e){return xn.makeRotationY(e),this.applyMatrix4(xn),this}rotateZ(e){return xn.makeRotationZ(e),this.applyMatrix4(xn),this}translate(e,t,i){return xn.makeTranslation(e,t,i),this.applyMatrix4(xn),this}scale(e,t,i){return xn.makeScale(e,t,i),this.applyMatrix4(xn),this}lookAt(e){return im.lookAt(e),im.updateMatrix(),this.applyMatrix4(im.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let u=0;u<n.count;u++)t.vertices.push(new M().fromBufferAttribute(n,u)),a!==void 0&&t.colors.push(new Ze().fromBufferAttribute(a,u));function h(u,d,p,m){let g=a===void 0?[]:[t.colors[u].clone(),t.colors[d].clone(),t.colors[p].clone()],f=s===void 0?[]:[new M().fromBufferAttribute(s,u),new M().fromBufferAttribute(s,d),new M().fromBufferAttribute(s,p)],v=new iv(u,d,p,f,g,m);t.faces.push(v),o!==void 0&&t.faceVertexUvs[0].push([new q().fromBufferAttribute(o,u),new q().fromBufferAttribute(o,d),new q().fromBufferAttribute(o,p)]),l!==void 0&&t.faceVertexUvs[1].push([new q().fromBufferAttribute(l,u),new q().fromBufferAttribute(l,d),new q().fromBufferAttribute(l,p)])}let c=e.groups;if(c.length>0)for(let u=0;u<c.length;u++){let d=c[u],p=d.start,m=d.count;for(let g=p,f=p+m;g<f;g+=3)i!==void 0?h(i.getX(g),i.getX(g+1),i.getX(g+2),d.materialIndex):h(g,g+1,g+2,d.materialIndex)}else if(i!==void 0)for(let u=0;u<i.count;u+=3)h(i.getX(u),i.getX(u+1),i.getX(u+2));else for(let u=0;u<n.count;u+=3)h(u,u+1,u+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Hc).negate(),this.translate(Hc.x,Hc.y,Hc.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new Fe;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new M,t=new M;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];e.subVectors(o,a),t.subVectors(s,a),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new M;if(e){let i=new M,r=new M;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],h=this.vertices[a.c];i.subVectors(h,l),r.subVectors(o,l),i.cross(r),t[a.a].add(i),t[a.b].add(i),t[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(t[n.a]),s[1].copy(t[n.b]),s[2].copy(t[n.c])):(s[0]=t[n.a].clone(),s[1]=t[n.b].clone(),s[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let e=new jd;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new M,h={a:new M,b:new M,c:new M};n.push(l),s.push(h)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new fi),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new tn),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,n=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,h=this.colors,c=e.colors;t!==void 0&&(r=new Ri().getNormalMatrix(t));for(let u=0,d=a.length;u<d;u++){let p=a[u].clone();t!==void 0&&p.applyMatrix4(t),s.push(p)}for(let u=0,d=c.length;u<d;u++)h.push(c[u].clone());for(let u=0,d=l.length;u<d;u++){let p=l[u],m,g,f=p.vertexNormals,v=p.vertexColors,y=new iv(p.a+n,p.b+n,p.c+n);y.normal.copy(p.normal),r!==void 0&&y.normal.applyMatrix3(r).normalize();for(let x=0,b=f.length;x<b;x++)m=f[x].clone(),r!==void 0&&m.applyMatrix3(r).normalize(),y.vertexNormals.push(m);y.color.copy(p.color);for(let x=0,b=v.length;x<b;x++)g=v[x],y.vertexColors.push(g.clone());y.materialIndex=p.materialIndex+i,o.push(y)}for(let u=0,d=e.faceVertexUvs.length;u<d;u++){let p=e.faceVertexUvs[u];this.faceVertexUvs[u]===void 0&&(this.faceVertexUvs[u]=[]);for(let m=0,g=p.length;m<g;m++){let f=p[m],v=[];for(let y=0,x=f.length;y<x;y++)v.push(f[y].clone());this.faceVertexUvs[u].push(v)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],n=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let h=this.vertices[o],c=Math.round(h.x*n)+"_"+Math.round(h.y*n)+"_"+Math.round(h.z*n);t[c]===void 0?(t[c]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[t[c]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let h=this.faces[o];h.a=r[h.a],h.b=r[h.b],h.c=r[h.c];let c=[h.a,h.b,h.c];for(let u=0;u<3;u++)if(c[u]===c[(u+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let h=0,c=this.faceVertexUvs.length;h<c;h++)this.faceVertexUvs[h].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new M(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===t&&(s=[]),n&&n.length===t&&(a=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let m in p)p[m]!==void 0&&(e[m]=p[m]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let m=this.vertices[p];t.push(m.x,m.y,m.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let p=0;p<this.faces.length;p++){let m=this.faces[p],g=!0,f=!1,v=this.faceVertexUvs[0][p]!==void 0,y=m.normal.length()>0,x=m.vertexNormals.length>0,b=m.color.r!==1||m.color.g!==1||m.color.b!==1,S=m.vertexColors.length>0,_=0;if(_=h(_,0,0),_=h(_,1,g),_=h(_,2,f),_=h(_,3,v),_=h(_,4,y),_=h(_,5,x),_=h(_,6,b),_=h(_,7,S),i.push(_),i.push(m.a,m.b,m.c),i.push(m.materialIndex),v){let A=this.faceVertexUvs[0][p];i.push(d(A[0]),d(A[1]),d(A[2]))}if(y&&i.push(c(m.normal)),x){let A=m.vertexNormals;i.push(c(A[0]),c(A[1]),c(A[2]))}if(b&&i.push(u(m.color)),S){let A=m.vertexColors;i.push(u(A[0]),u(A[1]),u(A[2]))}}function h(p,m,g){return g?p|1<<m:p&~(1<<m)}function c(p){let m=p.x.toString()+p.y.toString()+p.z.toString();return n[m]!==void 0||(n[m]=r.length/3,r.push(p.x,p.y,p.z)),n[m]}function u(p){let m=p.r.toString()+p.g.toString()+p.b.toString();return a[m]!==void 0||(a[m]=s.length,s.push(p.getHex())),a[m]}function d(p){let m=p.x.toString()+p.y.toString();return l[m]!==void 0||(l[m]=o.length/2,o.push(p.x,p.y)),l[m]}return e.data={},e.data.vertices=t,e.data.normals=r,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return new jd().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let u=0,d=t.length;u<d;u++)this.vertices.push(t[u].clone());let i=e.colors;for(let u=0,d=i.length;u<d;u++)this.colors.push(i[u].clone());let r=e.faces;for(let u=0,d=r.length;u<d;u++)this.faces.push(r[u].clone());for(let u=0,d=e.faceVertexUvs.length;u<d;u++){let p=e.faceVertexUvs[u];this.faceVertexUvs[u]===void 0&&(this.faceVertexUvs[u]=[]);for(let m=0,g=p.length;m<g;m++){let f=p[m],v=[];for(let y=0,x=f.length;y<x;y++){let b=f[y];v.push(b.clone())}this.faceVertexUvs[u].push(v)}}let n=e.morphTargets;for(let u=0,d=n.length;u<d;u++){let p={};if(p.name=n[u].name,n[u].vertices!==void 0){p.vertices=[];for(let m=0,g=n[u].vertices.length;m<g;m++)p.vertices.push(n[u].vertices[m].clone())}if(n[u].normals!==void 0){p.normals=[];for(let m=0,g=n[u].normals.length;m<g;m++)p.normals.push(n[u].normals[m].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let u=0,d=s.length;u<d;u++){let p={};if(s[u].vertexNormals!==void 0){p.vertexNormals=[];for(let m=0,g=s[u].vertexNormals.length;m<g;m++){let f=s[u].vertexNormals[m],v={};v.a=f.a.clone(),v.b=f.b.clone(),v.c=f.c.clone(),p.vertexNormals.push(v)}}if(s[u].faceNormals!==void 0){p.faceNormals=[];for(let m=0,g=s[u].faceNormals.length;m<g;m++)p.faceNormals.push(s[u].faceNormals[m].clone())}this.morphNormals.push(p)}let a=e.skinWeights;for(let u=0,d=a.length;u<d;u++)this.skinWeights.push(a[u].clone());let o=e.skinIndices;for(let u=0,d=o.length;u<d;u++)this.skinIndices.push(o[u].clone());let l=e.lineDistances;for(let u=0,d=l.length;u<d;u++)this.lineDistances.push(l[u]);let h=e.boundingBox;h!==null&&(this.boundingBox=h.clone());let c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new OW().fromGeometry(this),t=new it,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",new at(i,3).copyVector3sArray(e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",new at(r,3).copyVector3sArray(e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",new at(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",new at(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",new at(r,2).copyVector2sArray(e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let n=[],s=e.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],h=new Be(l.data.length*3,3);h.name=l.name,n.push(h.copyVector3sArray(l.data))}t.morphAttributes[r]=n}if(e.skinIndices.length>0){let r=new Be(e.skinIndices.length*4,4);t.setAttribute("skinIndex",r.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){let r=new Be(e.skinWeights.length*4,4);t.setAttribute("skinWeight",r.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new it,i=e.geometry;if(e.isPoints||e.isLine){let r=new Be(i.vertices.length*3,3),n=new Be(i.colors.length*3,3);if(t.setAttribute("position",r.copyVector3sArray(i.vertices)),t.setAttribute("color",n.copyColorsArray(i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new Be(i.lineDistances.length,1);t.setAttribute("lineDistance",s.copyArray(i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};jd.prototype.isGeometry=!0;var OW=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,n,s=e.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=e.morphTargets,o=a.length,l;if(o>0){l=[];for(let f=0;f<o;f++)l[f]={name:a[f].name,data:[]};this.morphTargets.position=l}let h=e.morphNormals,c=h.length,u;if(c>0){u=[];for(let f=0;f<c;f++)u[f]={name:h[f].name,data:[]};this.morphTargets.normal=u}let d=e.skinIndices,p=e.skinWeights,m=d.length===i.length,g=p.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let f=0;f<t.length;f++){let v=t[f];this.vertices.push(i[v.a],i[v.b],i[v.c]);let y=v.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let b=v.normal;this.normals.push(b,b,b)}let x=v.vertexColors;if(x.length===3)this.colors.push(x[0],x[1],x[2]);else{let b=v.color;this.colors.push(b,b,b)}if(n===!0){let b=r[0][f];b!==void 0?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",f),this.uvs.push(new q,new q,new q))}if(s===!0){let b=r[1][f];b!==void 0?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",f),this.uvs2.push(new q,new q,new q))}for(let b=0;b<o;b++){let S=a[b].vertices;l[b].data.push(S[v.a],S[v.b],S[v.c])}for(let b=0;b<c;b++){let S=h[b].vertexNormals[f];u[b].data.push(S.a,S.b,S.c)}m&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),g&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},iv=class{constructor(e,t,i,r,n,s=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new M,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Ze,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},RW=["a","b","c"];function IW(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function rm(e,t,i){let r=Math.min(e,t),n=Math.max(e,t),s=r+"_"+n;return i.get(s)}function nm(e,t,i,r,n,s){let a=Math.min(e,t),o=Math.max(e,t),l=a+"_"+o,h;if(r.has(l))h=r.get(l);else{let c=i[a],u=i[o];h={a:c,b:u,newEdge:null,faces:[]},r.set(l,h)}h.faces.push(n),s[e].edges.push(h),s[t].edges.push(h)}function BW(e,t,i,r){let n,s,a;for(n=0,s=e.length;n<s;n++)i[n]={edges:[]};for(n=0,s=t.length;n<s;n++)a=t[n],nm(a.a,a.b,e,r,a,i),nm(a.b,a.c,e,r,a,i),nm(a.c,a.a,e,r,a,i)}function Vc(e,t,i,r,n){e.push(new iv(t,i,r,void 0,void 0,n))}function ko(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function jc(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var NW=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof it?e=new jd().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new M,i,r,n,s,a,o=e.vertices,l=e.faces,h=e.faceVertexUvs[0],c=h!==void 0&&h.length>0,u=[],d=new Map;BW(o,l,u,d);let p=[],m,g,f,v,y,x,b;for(let ie of Array.from(d.keys())){for(g=d.get(ie),f=new M,y=3/8,x=1/8,b=g.faces.length,b!=2&&(y=.5,x=0,b!=1),f.addVectors(g.a,g.b).multiplyScalar(y),t.set(0,0,0),s=0;s<b;s++){for(v=g.faces[s],a=0;a<3&&(m=o[IW(v,RW[a])],!(m!==g.a&&m!==g.b));a++);m&&t.add(m)}t.multiplyScalar(x),f.add(t),g.newEdge=p.length,p.push(f)}let S,_,A,w,E,T,C,P=[];for(r=0,n=o.length;r<n;r++){for(T=o[r],E=u[r].edges,i=E.length,i==3?S=3/16:i>3&&(S=3/(8*i)),_=1-i*Number(S),A=S,i<=2&&(i==2?(_=3/4,A=1/8):i==1||i==0),C=T.clone().multiplyScalar(_),t.set(0,0,0),s=0;s<i;s++)w=E[s],m=w.a!==T?w.a:w.b,t.add(m);t.multiplyScalar(Number(A)),C.add(t),P.push(C)}let k=P.concat(p),D=P.length,R,G,N,L=[],H=[],F,z,U,W,Y=new q,K=new q,V=new q;for(r=0,n=l.length;r<n;r++)v=l[r],R=Number(rm(v.a,v.b,d).newEdge)+D,G=Number(rm(v.b,v.c,d).newEdge)+D,N=Number(rm(v.c,v.a,d).newEdge)+D,Vc(L,R,G,N,v.materialIndex),Vc(L,v.a,R,N,v.materialIndex),Vc(L,v.b,G,R,v.materialIndex),Vc(L,v.c,N,G,v.materialIndex),c&&(F=h[r],z=F[0],U=F[1],W=F[2],Y.set(ko(z.x,U.x),ko(z.y,U.y)),K.set(ko(U.x,W.x),ko(U.y,W.y)),V.set(ko(z.x,W.x),ko(z.y,W.y)),jc(H,Y,K,V),jc(H,z,Y,V),jc(H,U,K,Y),jc(H,W,V,K));e.vertices=k,e.faces=L,c&&(e.faceVertexUvs[0]=H)}},li=new M,kW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var s,a;let i=(a=(s=e.geometry)!=null?s:t==null?void 0:t.geometry)!=null?a:new it().copy(new la(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(li),r={width:li.x,height:li.y,depth:li.z,subdivisions:0}):r=t.parameters;let n={...r,...e.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(e){var l;let{width:t,height:i,depth:r,subdivisions:n}=e.parameters,s=(l=e.geometry)!=null?l:new it().copy(new la(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(li)):li.set(a.width,a.height,a.depth),(t!==li.x||i!==li.y||r!==li.z)&&s.scale(li.x===0?1:t/li.x,li.y===0?1:i/li.y,li.z===0?1:r/li.z);let o=s.originalGeometry;return n>0?(o===void 0||(a==null?void 0:a.subdivisions)!==n)&&(o===void 0&&(o=s),s=new NW(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()),o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new uE(i).load(e,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(li);let s=100/li.x;Object.assign(n.parameters,{width:100,height:li.y*s,depth:li.z*s}),t(this.build(n))})}},UW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof Kt?e.shape:new Kt,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,h=t*.5,c=i*.5,u=0,d=0,p=2*Math.PI/r;for(let g=0;g<r;g++){let f=p*g,v=u+Math.sin(f)*h,y=d+Math.cos(f)*c;l.addPoint(l.createPoint(v,y))}l.isClosed=!0;for(let g=0,f=l.points.length;g<f;g++)l.points[g].roundness=n;l.roundness=n,l.update();let m=ws.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(m,{userData:{...e,type:"PolygonGeometry"}})}},FW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,h=new GW(t*.5,i,n,s,a,o,l);return h.scale(1,1,r/t),Object.assign(h,{userData:{...e,type:"PyramidGeometry"}})}};function yh(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function sm(e,t,i,r,n,s){let a=t.clone().sub(e),o=i.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let h=a.add(o).normalize();s.copy(e).addScaledVector(h,r/Math.sin(l/2))}else{let h=a.angleTo(o);s.copy(e),s.addScaledVector(a,n/Math.sin(h)),s.addScaledVector(o,r/Math.sin(h))}}function zW(e,t,i){let r=e.clone().sub(t),n=i.clone().sub(t);return r.projectOnVector(n),r.add(t)}var GW=class extends it{constructor(e=.5,t=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],h=[],c=[],u=0,d=t/2,p=Math.PI/i,m=e*Math.cos(Math.PI/i),g=2*Math.PI/i,f=(i-2)*Math.PI/i,v=Math.PI-f,y=new M(0,-d,0),x=new M(0,d,0),b=new q(e,-d),S=new q(m,-d),_=new q(0,x.y).sub(S),A=new q(0,x.y).sub(b),w=new q(_.y,-_.x).normalize(),E=new q(A.y,-A.x).normalize(),T=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-_.angle())/2)-1e-8;s=Math.min(s,T);let C;{let N=new M(w.x,w.y,0),L=new M(Math.cos(g)*N.x,N.y,Math.sin(g)*N.x);C=N.angleTo(L)}let P=s/Math.tan((Math.PI-_.angle())/2),k=s/Math.tan((Math.PI-C)/2),D=new M;if(!n){l.push(y.x,y.y,y.z),h.push(0,-1,0),c.push(0,0);let N=u++,L=[],H=b.clone(),F=P/Math.cos(Math.PI/i);H.x-=F;for(let z=0;z<i;z++){let U=z/i*Math.PI*2+p,W=new q(Math.sin(U),Math.cos(U));yh(H,W,D),l.push(D.x,D.y,D.z),h.push(0,-1,0),c.push(0,0),L.push(u++)}for(let z=0;z<L.length;z++)o.push(L[z],N,L[(z+1)%L.length])}{let N=new M,L=new M,H=new M,F=new M,z=new M,U=new M;for(let W=0;W<i;W++){let Y=W/i*Math.PI*2+p,K=(W+.5)/i*Math.PI*2+p,V=(W+1)/i*Math.PI*2+p,ie=new q(Math.sin(Y),Math.cos(Y)),Q=new q(Math.sin(K),Math.cos(K)),J=new q(Math.sin(V),Math.cos(V));yh(b,ie,L),yh(b,J,H),yh(w,Q,N),sm(x,L,H,k,k,F),l.push(F.x,F.y,F.z),sm(L,x,H,k,P,z),l.push(z.x,z.y,z.z),sm(H,L,x,P,k,U),l.push(U.x,U.y,U.z),h.push(N.x,N.y,N.z),h.push(N.x,N.y,N.z),h.push(N.x,N.y,N.z),c.push(0,0),c.push(0,0),c.push(0,0);let Z=u++,ue=u++,de=u++;if(o.push(Z,ue,de),s>0){{let pe=L.clone().add(H).multiplyScalar(.5),ve=x.clone().sub(pe).normalize(),Re=y.clone().sub(pe).normalize().add(ve).normalize().multiplyScalar(-1),Te=U.clone().sub(z);R(pe,Te,Re,_.angle())}let he,ge;{let pe=new M;yh(E,J,pe);let ve=U.clone().add(F).multiplyScalar(.5);ve=zW(ve,H,x);let Re=U.clone().sub(F);[he,ge]=R(ve,Re,pe,C,F.y)}{let pe=he,ve=pe.clone().setY(0).normalize(),Re=new M(0,-1,0),Te=ve.clone().cross(Re);G(pe,ve,Re,Te)}{let pe=_.angle(),ve=Math.PI-pe,Re=x.clone();Re.y-=s/Math.sin(pe-Math.PI/2);let Te=new M,Me=[];for(let Ge=0;Ge<a;Ge++){let B=[],O=Math.PI/2-ve*Ge/a,ne=Math.cos(O),fe=Math.sin(O),ye=K;for(let Ae=0;Ae<=Ge;Ae++){let Xe=Math.cos(ye),se=Math.sin(ye);N.x=ne*se,N.y=fe,N.z=ne*Xe,Te.copy(Re).addScaledVector(N,s),l.push(Te.x,Te.y,Te.z),h.push(N.x,N.y,N.z),c.push(0,0),B.push(u++),ye+=Math.PI*2/Ge/i}Me.push(B)}ge.reverse(),Me.push(ge);let yt=Me.length-1;for(let Ge=0;Ge<yt;Ge++){let B=Me[Ge],O=Me[Ge+1],ne=B.length-1;o.push(O[1],B[0],O[0]);for(let fe=1;fe<=ne;fe++)o.push(B[fe],B[fe-1],O[fe]),o.push(O[fe+1],B[fe],O[fe])}}}}}this.setIndex(o),this.setAttribute("position",new Be(l,3)),this.setAttribute("normal",new Be(h,3)),this.setAttribute("uv",new Be(c,2));function R(N,L,H,F,z){let U=-F/2,W=(Math.PI-F)/2,Y=L.clone().normalize().cross(H);N.addScaledVector(H,-s/Math.sin(W));let K=new M,V=new M,ie=1,Q=u,J=[];for(let Z=0;Z<=a;Z++){let ue=U+Z/a*F;V.set(0,0,0),V.addScaledVector(Y,Math.sin(ue)),V.addScaledVector(H,Math.cos(ue));for(let de=0;de<=ie;de++){let he=de/ie-.5;if(K.copy(N),K.addScaledVector(L,he),K.addScaledVector(V,s),z!=null){let ge=Math.max(0,K.y-z);K.addScaledVector(L,-ge/L.y)}l.push(K.x,K.y,K.z),h.push(V.x,V.y,V.z),c.push(0,0),de===0&&J.push(u),u++}}for(let Z=0;Z<a;Z++)for(let ue=0;ue<ie;ue++){let de=Q+ue+(ie+1)*Z,he=de+(ie+1),ge=he+1,pe=de+1;o.push(de,he,pe),o.push(he,ge,pe)}return[N.clone().addScaledVector(L,.5),J]}function G(N,L,H,F){let z=Math.PI/2,U=A.angle()-z,W=[],Y=new M,K=new M;for(let ie=0;ie<=a;ie++){let Q=[],J=ie/a;for(let Z=0;Z<=ie;Z++){let ue=((ie?Z/ie:0)-.5)*v,de=Math.cos(ue),he=Math.sin(ue),ge=Math.atan(Math.tan(U)*de),pe=(z+ge)*J,ve=Math.cos(pe),Re=Math.sin(pe);Y.set(0,0,0),Y.addScaledVector(L,Re*de),Y.addScaledVector(H,ve),Y.addScaledVector(F,Re*he),K.copy(N).addScaledVector(Y,s),l.push(K.x,K.y,K.z),h.push(Y.x,Y.y,Y.z),c.push(0,0),Q.push(u++)}W.push(Q)}let V=W.length-1;for(let ie=0;ie<V;ie++){let Q=W[ie],J=W[ie+1],Z=Q.length-1;o.push(Q[0],J[1],J[0]);for(let ue=1;ue<=Z;ue++)o.push(Q[ue-1],Q[ue],J[ue]),o.push(Q[ue],J[ue+1],J[ue])}}}},HW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var n,s,a,o;let i=Object.assign({},(n=t==null?void 0:t.parameters)!=null?n:{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((s=t==null?void 0:t.ui)!=null?s:{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof Kt?e.shape:new Kt,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((a=i.height)!=null?a:i.width),depth:Math.abs((o=i.depth)!=null?o:0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,h={x:i*.5,y:r*.5},c={x:-h.x,y:-h.y},u={x:h.x,y:h.y};function d(b,S,_){return S>i&&_>r?Math.min(b*i/S,b*r/_):S>i?b*i/S:_>r?b*r/_:b}let p=[];p[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),p[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),p[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),p[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let m=c.x,g=u.x,f=u.y,v=c.y;t.addPoint(t.createPoint(m,f)),t.addPoint(t.createPoint(g,f)),t.addPoint(t.createPoint(g,v)),t.addPoint(t.createPoint(m,v)),t.isClosed=!0;let y=!0;for(let b=0,S=t.points.length;b<S;b++)t.points[b].roundness=p[b],b>0&&p[b]!==p[b-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=s!==1,t.update();let x=ws.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(x,{userData:{...e,type:"RectangleGeometry"}})}},VW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:h}=e.parameters,c=new o0(.5*t,n,s,a,o,l,h);return c.scale(1,i/t,r/t),Object.assign(c,{userData:{...e,type:"SphereGeometry"}})}},jW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:n=8}=e.parameters,s=new hp(t,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},WW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=e.parameters,o=new qW(t,i,r,n,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},qW=class extends it{constructor(e=1,t=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],h=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-h,r),r*=Math.PI/180;let c=[],u=Math.PI/2,d=(ie=0,Q=0,J=0)=>new M(ie,Q,J),p=d(),m=d(),[g,f,v]=[t/2,e/2,i/2],y=-f,x=+f,[b,S,_]=[d(y,-g,+v),d(y,-g,-v),d(y,+g,-v)],A=(ie,Q=!1)=>Math.sin(ie-Math.PI/(1+ +Q)),w=(ie,Q=!1)=>Math.cos(ie-Math.PI/(1+ +Q));_.y=Math.sin(r)*t-g;let E=Math.cos(r)*t-v,T=b.z-h;r<=u?(_.z=Math.min(E,T),_.z==T&&(_.y-=(E-T)/Math.tan(u-r))):S.z=Math.min(S.z-E-v,b.z-h),p.subVectors(b,S),m.subVectors(_,S);let C=Math.min(p.length(),m.length())*n/100,P=C*Math.tan(r/2),k=C/Math.cos(r/2),D=p.clone().normalize().add(m.normalize()).setLength(k).add(S);p.set(0,A(r,!0),w(r,!0)),c.push([_,p.clone()]);let R=(Math.PI-r)/s;for(let ie=0;ie<=s;ie++){let Q=u+r+ie*R;p.set(0,Math.sin(Q)*P,Math.cos(Q)*P),p.add(D),m.set(0,A(Q),w(Q)),c.push([p.clone(),m.clone()])}c.push([b,d(0,1,0)]);let G=Math.sin(R/2)*P*2,N=c.length-1,L=c[0][0].distanceTo(c[1][0]),H=c[N-1][0].distanceTo(c[N][0]),F=L+G*s+H;c[0].push(1);for(let ie=0;ie<=s;ie++)c[ie+1].push(1-(L+ie*G)/F);c[N].push(0);let[z,U,W]=c[0],Y,K,V;for(let ie=1;ie<c.length;ie++)[Y,K,V]=c[ie],a.push(y,z.y,z.z,y,Y.y,Y.z,x,z.y,z.z,x,z.y,z.z,y,Y.y,Y.z,x,Y.y,Y.z),o.push(0,U.y,U.z,0,K.y,K.z,0,U.y,U.z,0,U.y,U.z,0,K.y,K.z,0,K.y,K.z),l.push(0,W,0,V,1,W,1,W,0,V,1,V),[z,U,W]=[Y,K,V];this.setAttribute("position",new Be(a,3)),this.setAttribute("normal",new Be(o,3)),this.setAttribute("uv",new Be(l,2))}},YW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Kt?e.shape:new Kt,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}=e.parameters,c=e.shape,u=t*.5,d=i*.5,p=0,m=0,g=a*Math.PI/360/n,f=Math.PI/2*3*-1,v=u*r/100,y=d*r/100;if(n===3&&r===50){g=2*Math.PI/n;for(let b=0;b<n;b++){let S=g*b,_=p+Math.sin(S)*u,A=m+Math.cos(S)*d;c.addPoint(c.createPoint(_,A))}}else for(let b=0;b<n;b++){let S=p+Math.cos(f)*u,_=m+Math.sin(f)*d;c.addPoint(c.createPoint(S,_)),f+=g,S=p+Math.cos(f)*v,_=m+Math.sin(f)*y,c.addPoint(c.createPoint(S,_)),f+=g}c.isClosed=!0;for(let b=0,S=c.points.length;b<S;b++)c.points[b].roundness=s;c.roundness=s,c.update();let x=ws.create({shape:c,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:h}});return Object.assign(x,{userData:{...e,type:"StarGeometry"}})}},XW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new hp(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},QW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var a,o,l;let i=Object.assign({},(a=t==null?void 0:t.parameters)!=null?a:{width:100,radialSegments:32,tubularSegments:64,arc:Math.PI*2,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),n=Math.abs((o=i.height)!=null?o:i.width),s=Math.abs((l=i.depth)!=null?l:i.width*.25);return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,h=KW(t,i,r,t*.5,a,s,0,0,n,o,l);return h.scale(1,i/t,1),Object.assign(h,{userData:{...e,type:"TorusGeometry"}})}};function KW(e,t,i,r,n,s,a,o,l,h,c){return[t,i]=[i,t],a=t/2,n/=2*Math.PI,n==1&&(h=0),new j2(!0,e,t,i,r,n,s,a,o,l,h,c)}var ZW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s,a;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width),depth:Math.abs((s=i.depth)!=null?s:i.width),tube:(a=i.tube)!=null?a:i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=e.parameters,o=t*.5;o!==i&&(o-=i);let l=new lE(o,i,r,n,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},JW=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r,n,s;let i=Object.assign({},(r=t==null?void 0:t.parameters)!=null?r:{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof Kt?e.shape:new Kt,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs((n=i.height)!=null?n:i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs((s=i.depth)!=null?s:0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,h=t*.5,c=i*.5;o?(l.addPoint(l.createPoint(-h,c)),l.addPoint(l.createPoint(h,-c)),l.addPoint(l.createPoint(-h,-c))):(l.addPoint(l.createPoint(0,c)),l.addPoint(l.createPoint(h,-c)),l.addPoint(l.createPoint(-h,-c))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=r;l.roundness=r,l.update();let u=ws.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(u,{userData:{...e,type:"TriangleGeometry"}})}};function bw(){let e=new it;return e.setAttribute("position",new at(new Float32Array([]),3)),e.setIndex(new at(new Uint16Array([]),1)),e}var $W=12,q2=class extends it{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.vectorShapes=[];let i=bw();Object.entries(i.attributes).forEach(([r,n])=>{this.setAttribute(r,n)}),this.setIndex(i.index),this.updateFont(e.font,t),this.update(e)}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}async update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!t||!t.isLoaded){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l,subdivisions:h}=e;await t.loadingPromise;let c=l===2?o.toUpperCase():l===3?o.toLowerCase():o,u=e9(e,t,c),{shapes:d,charWidths:p,charCoords:m}=await t.generateShapes(u,e),g=i*.5,f=r*.5,v=d.map(b=>new Kt().fromShape(b));this.vectorShapes=v;let y=v.map(b=>ws.create({shape:b,parameters:{depth:n,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:n<=0?Gt.NONZERO:Gt.ODD,subdivisions:h!=null?h:$W}})),x=y.length?il(y):bw();x.translate(-g,f,0),this.dispose(),this.wrappedText=u,this.charCoords=m,this.charWidths=p,Object.entries(x.attributes).forEach(([b,S])=>{this.setAttribute(b,S)}),this.setIndex(x.index),this.computeBoundingSphere()}clone(){let e=Tp(new it,q2.prototype);return e.copy(this),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:e})}get text(){var e;return(e=this.userData.parameters.text)!=null?e:""}};function e9(e,t,i){i=i!=null?i:e.text;let r=[""],n="";for(let s of i)n+=s,s===" "||s===`
`?(r[r.length-1]+=n,n="",s===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+n,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+n,e)>e.width&&(n.length===1?(r[r.length-1]+=n,n=""):(r[r.length-1]+=n.slice(0,-1),n=n[n.length-1],r.push(""))));return r[r.length-1]+=n,r}var Y2,X2=new Promise(e=>{Y2=e}),ww=!1;async function t9(){if(ww)return;let e="https://unpkg.com/@splinetool/modelling-wasm@0.9.123/build",[t,i]=await Promise.all([Wv(()=>import("./process.6292a982.js"),[]),fetch(`${e}/process.wasm`).then(n=>n.arrayBuffer())]),r=await t.default({wasmBinary:i});Y2(r),ww=!0}function Q2(e,t){return i9(e)}function i9(e){let t={parameters:e,type:e.type};if(e.type==="VectorGeometry"){let r=Kt.createFromState(e.shape,e.width,e.height);t.shape=r}else e.type==="NonParametricGeometry"&&(e.data.groups&&e.data.groups.forEach(r=>{var n;return r.materialIndex=Math.max((n=r.materialIndex)!=null?n:0,0)}),t.geometry=new uE().parse(e));let i;try{i=rv(t)}catch(r){console.error(r)}if(!i){let r=Kt.createFromState(Rd.defaultData(),100,100);t.shape=r,i=rv(t)}return i}var $e;X2.then(e=>{$e=e});var _w=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),Sw=new Uint32Array([0,1,2,3]),Aw=new Uint8Array([4]),Kr=class{static build(e,t,i,r,n){var h,c;let s,a,o,l=(c=(h=e==null?void 0:e.phongAngle)!=null?h:t==null?void 0:t.phongAngle)!=null?c:35;if(r===!1&&(l=-1),e.positionWASM!==void 0){i&&i!==0&&($e.free_bvh(i),$e.free_subdivision_surface(i));try{s=Kr.allocate(e,n)}catch(u){console.error(u,e),s=Kr.allocate({positionWASM:_w,indexWASM:Sw,verticesPerFaceWASM:Aw},n)}$e.set_destination_refinement_level(s,0),a=Kr.buildLevel(s,!0,l)}else s=i,e.phongAngle!==void 0&&(a=Kr.buildLevel(s,!0,l));return e.subdivisions!==void 0&&($e.set_destination_refinement_level(s,e.subdivisions),e.subdivisions>0?o=Kr.buildLevel(s,!1,l):o=null),{subdivPointer:s,originalGeometry:a,subdividedGeometry:o}}static primitiveToQuads(e,t){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let i=e.shape!==void 0?t.geometry:Q2(e),r,n,s,a;({positions:r,triIndices:a}=z0(i.getAttribute("position"),i.getIndex()));let o;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let l=e.radialSegments*e.heightSegments*3*2,h=l+e.radialSegments*3;o=[l,h]}return{indices:n,verticesPerFace:s}=K2(r,a,i,o),{positions:r,indices:n,verticesPerFace:s}}static allocate(e,t){var x;let i,r,n,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,n=e.verticesPerFaceWASM):(i=_w,r=Sw,n=Aw);let o=i.length,l=r.length,h=n.length,c=i.length+s.length+a.length,u=r.length+n.length,d=c*Float32Array.BYTES_PER_ELEMENT+u*Uint32Array.BYTES_PER_ELEMENT,p=c*Float32Array.BYTES_PER_ELEMENT,m=$e._malloc(d),g=new Float32Array($e.HEAPF32.buffer,m,c),f=new Uint32Array($e.HEAPU32.buffer,m+p,u);g.set(i,0),g.set(s,i.length),g.set(a,i.length+s.length),f.set(r,0),f.set(n,r.length);let v;(x=e==null?void 0:e.scaleBaked)!=null&&x.some(b=>b!==1)&&(v=new Fe().makeScale(...e.scaleBaked)),t&&(v?v.premultiply(t):v=t);let y=v?$e.alloc_subdivision_surface2(m,o,m+p,l,m+p+r.length*Uint32Array.BYTES_PER_ELEMENT,h,v.elements):$e.alloc_subdivision_surface(m,o,m+p,l,m+p+r.length*Uint32Array.BYTES_PER_ELEMENT,h);return $e._free(m),y}static buildLevel(e,t,i,r,n){let s=n?$e.get_mesh_data2(e,t?$e.Level.CONTROL:$e.Level.REFINED,i,n.elements):$e.get_mesh_data(e,t?$e.Level.CONTROL:$e.Level.REFINED,i),a=8,o=$e.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,4+4),h=0,c=$e.HEAPU32[o[h]>>2],u=$e.HEAPF32.subarray(c>>2,(c>>2)+l[h]);h++;let d=$e.HEAPU32[o[h]>>2],p=$e.HEAPF32.subarray(d>>2,(d>>2)+l[h]);h++;let m=$e.HEAPU32[o[h]>>2],g=$e.HEAPU32.subarray(m>>2,(m>>2)+l[h]);h++;let f=$e.HEAPU32[o[h]>>2],v=$e.HEAPU32.subarray(f>>2,(f>>2)+l[h]);if(h++,r===void 0){let y=new it;if(y.setIndex(new zh(v,1)),y.setAttribute("position",new Be(u,3)),y.setAttribute("normal",new Be(p,3)),t){y.setAttribute("faceMap",new zh(g,1));let x=new Float32Array(p.length/3*4).fill(0);y.setAttribute("color",new at(x,4))}return $e.free_mesh_data(s),y.userData.type="SubdivGeometry",y}r.getAttribute("position").copyArray(u),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,$e.free_mesh_data(s)}static buildControlCageWireframe(e,t,i){let r=$e.get_wireframe_data_for_base_level(e),n=4,s=$e.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,2+2),o=0,l=$e.HEAPU32[s[o]>>2],h=$e.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let c=$e.HEAPU32[s[o]>>2],u=$e.HEAPU32.subarray(c>>2,(c>>2)+a[o]);if(t===void 0){let d=new it;d.setAttribute("position",new Be(h,3));let p=new Float32Array(h.length);for(let m=0,g=h.length;m<g;)p[m++]=i.r,p[m++]=i.g,p[m++]=i.b;return d.setAttribute("color",new at(p,3)),d.setIndex(new zh(u,1)),$e.free_wireframe_data_for_base_level(r),d}t.getAttribute("position").copyArray(h),t.attributes.position.needsUpdate=!0,$e.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||$e.set_destination_refinement_level(e,t);let n=i?$e.get_topological_data2(e,r?$e.Level.CONTROL:$e.Level.REFINED,i.elements):$e.get_topological_data(e,r?$e.Level.CONTROL:$e.Level.REFINED),s=6,a=$e.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,3+3),l=0,h=$e.HEAPU32[a[l]>>2],c=new Float32Array($e.HEAPF32.subarray(h>>2,(h>>2)+o[l]));l++;let u=$e.HEAPU32[a[l]>>2],d=new Uint32Array($e.HEAPU32.subarray(u>>2,(u>>2)+o[l]));l++;let p=$e.HEAPU32[a[l]>>2],m=new Uint8Array($e.HEAPU32.subarray(p>>2,(p>>2)+o[l]));return $e.free_topological_data(n),{positions:c,indices:d,verticesPerFace:m}}},Ew=["getX","getY","getZ"];function z0(e,t){let i={},r=t?t.count:e.count,n=0,s=[],a=[],o=1e4;for(let h=0;h<r;h++){let c=t?t.getX(h):h,u="";for(let d=0;d<3;d++)u+=`${~~(e[Ew[d]](c)*o)},`;if(u in i)s.push(i[u]);else{for(let d=0;d<3;d++)a.push(e[Ew[d]](c));i[u]=n,s.push(n),n++}}let l=[];for(let h=0;h<s.length;h+=3)s[h]===s[h+1]||s[h]===s[h+2]||s[h+1]===s[h+2]||l.push(s[h],s[h+1],s[h+2]);return{positions:a,triIndices:l}}var Wc=new M,am=new M,om=new M,lm=new M;function K2(e,t,i,r){var a;let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let o=i.userData.shape.extractShapePointsToFlatArray([]),l=0;for(let c=0;c<o.length;c+=2)l+=(o[c]-o[(c===0?o.length:c)-2])*(o[c+1]+o[(c===0?o.length:c)-1]);e.length=0;let h=0;if(l<0)for(let c=0;c<o.length;c+=2)e.push(o[c],o[c+1],0),n.push(h++);else for(let c=o.length-2;c>=0;c-=2)e.push(o[c],o[c+1],0),n.push(h++);return s.push(h),{indices:n,verticesPerFace:s}}for(let o=0,l=(a=i.capStartIndex)!=null?a:t.length;o<l;)if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){Wc.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),am.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),om.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),lm.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),am.sub(Wc).normalize(),om.sub(Wc).normalize(),lm.sub(Wc).normalize();let h=am.cross(om).dot(lm);Math.abs(h)>.005||r&&r.some((c,u)=>u%2===1?!1:o>=r[u]&&o<r[u+1])?(n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(n.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3;if(i.capStartIndex!==void 0){let o=[],l=[],h=0,c=new Float32Array([i.userData.parameters.depth])[0];for(let u=0,d=0;u<e.length;u+=3,d++)e[u+2]===0&&(o.push(d),h++),e[u+2]===c&&l.push(d);if(i.userData.parameters.extrudeBevelSize===0){let u=l[0];l[0]=l[1],l[1]=u}o.reverse(),n.push(...o,...l),s.push(h,h)}return{indices:n,verticesPerFace:s}}var Vs={};BO(Vs,{calcBoolean:()=>o9,calcBooleanTopological:()=>a9,freeMeshSet:()=>u9,getMeshSet:()=>l9,transformMeshSet:()=>h9});var Z2,r9=new Promise(e=>{Z2=e}),Tw=!1;async function n9(){if(Tw)return;let e="https://unpkg.com/@splinetool/boolean-wasm@0.9.123/build",[t,i]=await Promise.all([Wv(()=>import("./boolean.3a232a12.js"),[]),fetch(`${e}/boolean.wasm`).then(n=>n.arrayBuffer())]),r=await t.default({wasmBinary:i});Z2(r),Tw=!0}var mt,ml;r9.then(e=>mt=e);function s9(e,t,i){let r,{positions:n,triIndices:s}=z0(e.getAttribute("position"),e.getIndex()),a;if(t&&i){let{indices:o,verticesPerFace:l}=K2(n,s,e);a=l.length,r=[];for(let h=0,c=0;h<a;h++){r.push(l[h]);for(let u=0;u<l[h];u++)r.push(o[c++])}}else{let o=s.length;r=Array(o+o/3),a=0;for(let l=0,h=0;h<r.length;)r[h++]=3,a++,r[h++]=s[l++],r[h++]=s[l++],r[h++]=s[l++]}return{positions:n,faceIndices:r,nFaces:a}}function J2(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(e[0])?i:r,s=mt._malloc(n);return(Number.isInteger(e[0])?new Uint32Array(mt.HEAPU32.buffer,s,t):new Float32Array(mt.HEAPF32.buffer,s,t)).set(e,0),s}function $2(e){switch(e){case 0:return mt.OP.UNION;case 1:return mt.OP.INTERSECTION;case 2:return mt.OP.A_MINUS_B;case 3:return mt.OP.B_MINUS_A;case 4:return mt.OP.SYMMETRIC_DIFFERENCE;case 5:return mt.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function a9(e,t){ml===void 0&&(ml=mt.init_csg());let i=J2(e),r=mt.csg_calc_topological(ml,i,e.length,$2(t));mt._free(i);let n=6,s=mt.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,3+3),o=0,l=mt.HEAPU32[s[o]>>2],h=new Float32Array(mt.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let c=mt.HEAPU32[s[o]>>2],u=new Uint32Array(mt.HEAPU32.subarray(c>>2,(c>>2)+a[o]));o++;let d=mt.HEAPU32[s[o]>>2],p=new Uint8Array(mt.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return mt.free_mesh_data(r),{positions:h,indices:u,verticesPerFace:p}}function o9(e,t,i,r){ml===void 0&&(ml=mt.init_csg());let n=J2(e),s=mt.csg_calc(ml,n,e.length,r,$2(t));mt._free(n);let a=5,o=mt.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,2+3),h=0,c=mt.HEAPU32[o[h]>>2],u=mt.HEAPF32.subarray(c>>2,(c>>2)+l[h]);h++;let d=mt.HEAPU32[o[h]>>2],p=mt.HEAPF32.subarray(d>>2,(d>>2)+l[h]);h++;let m=l[h];i.setAttribute("position",new Be(u,3)),i.setAttribute("normal",new Be(p,3));let g=mt.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new tn),i.boundingSphere.center.set(g[0],g[1],g[2]),i.boundingSphere.radius=(g[3]**2+g[4]**2+g[5]**2)**.5,i.userData.parameters={width:g[3]*2,height:g[4]*2,depth:g[5]*2},mt.free_mesh_data(s),m}function l9(e,t,i){if(mt===void 0)return-1;let r,n,s;if(t&&e.userData.positions!==void 0){let g=e.userData;s=g.verticesPerFace.length,r=g.positions,n=Array(g.verticesPerFace.reduce((f,v)=>f+v,0)+s);for(let f=0,v=0,y=0;f<g.verticesPerFace.length;f++){n[y++]=g.verticesPerFace[f];for(let x=0;x<g.verticesPerFace[f];x++)n[y++]=g.indices[v++]}}else({positions:r,faceIndices:n,nFaces:s}=s9(e,t,i));let a=r.length,o=n.length,l=r.length,h=n.length,c=l*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,u=l*Float32Array.BYTES_PER_ELEMENT,d=mt._malloc(c),p=new Float32Array(mt.HEAPF32.buffer,d,l),m=new Uint32Array(mt.HEAPU32.buffer,d+u,h);return p.set(r,0),m.set(n,0),mt.get_csg_mesh(d,a,d+u,o,s)}function h9(e,t){mt.transform_csg_mesh(e,t.elements)}function u9(e){mt.free_csg_mesh(e)}var eT={ConeGeometry:yW,CubeGeometry:xW,CylinderGeometry:vW,DodecahedronGeometry:wW,EllipseGeometry:EW,HelixGeometry:DW,IcosahedronGeometry:PW,LatheGeometry:LW,NonParametricGeometry:kW,PolygonGeometry:UW,PyramidGeometry:FW,RectangleGeometry:HW,SphereGeometry:VW,PlaneGeometry:jW,BackdropGeometry:WW,StarGeometry:YW,TextFrameGeometry:XW,TorusGeometry:QW,TorusKnotGeometry:ZW,TriangleGeometry:JW,VectorGeometry:ws},rv=e=>eT[e.type].create(e);function $i(e,t){return t.color(e)}var fs=e=>"isEntity"in e,xi=e=>"isAbstractMesh"in e,Xi=e=>e!==null&&e.objectType==="BooleanObject",c9=e=>e.objectType==="CombinedCamera",d9=e=>fs(e)&&(e.objectType==="LightDirectional"||e.objectType==="LightSpot"||e.objectType==="LightPoint"),tT=e=>e.objectType==="EmptyObject",iT=e=>"objectHelper"in e;function rT(e,t){var r;let i=!1;t.position&&(e.position.fromArray(t.position),i=!0),t.rotation&&(e.rotation.fromArray(t.rotation),i=!0),t.scale&&(i=!0,e.scale.fromArray(t.scale)),t.hiddenMatrix!==void 0&&"hiddenMatrix"in e&&(i=!0,e.hiddenMatrix.fromArray((r=t.hiddenMatrix)!=null?r:Dl.identity)),i&&(e.updateMatrix(),Xi(e.parent)&&xi(e)&&e.invalidateDownstreamBooleanData(!0).recomputeBoolean()),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&e.updateWorldMatrix(!1,!0),e.objectType==="CombinedCamera"&&(t.isUpVectorFlipped!==void 0&&(e.isUpVectorFlipped=t.isUpVectorFlipped),e.updateUp())}function p9(e,t){rT(e,t),t.name!==void 0&&(e.name=t.name),t.visible!==void 0&&(e.visible=t.visible)}function f9(e,t,i){p9(e,t),t.color!==void 0&&(e.color=$i(t.color,i)),t.intensity!==void 0&&(e.intensity=t.intensity),t.shadows!==void 0&&!(e instanceof mg)&&(e.castShadow=t.shadows),e.shadow&&!(e instanceof mg)&&t.depth!==void 0&&(e.shadow.camera.far=t.depth,e.shadow.needsUpdate=!0)}function m9(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var nT=e=>class extends e{hasEntityChild(){return this.children.some(t=>fs(t))}isDescendantOf(t){t instanceof Ut&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new Fe().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),fs(t)?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let r=0;r<t.children.length;r++){let n=t.children[r];this.add(n.clone())}return this}},Uo=new fi,Qr=new M,_n=new M,gl=new Fe,sT=[new M(-1,1,1),new M(-1,-1,1),new M(1,-1,1),new M(1,1,1),new M(-1,1,-1),new M(-1,-1,-1),new M(1,-1,-1),new M(1,1,-1)],g9=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],v9=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]];function y9(e,t,i=0,r=t.count){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,h=-1/0;for(let c=i;c<r;c++){let u=t.getX(c),d=t.getY(c),p=t.getZ(c);u<n&&(n=u),d<s&&(s=d),p<a&&(a=p),u>o&&(o=u),d>l&&(l=d),p>h&&(h=p)}return e.min.set(n,s,a),e.max.set(o,l,h),e}var Mw=(e,t,i)=>{var r;if(xi(e)){let n=e.geometry.userData.parameters,s=e.geometry.getAttribute("position");e.geometry.userData.type==="SubdivGeometry"?Qr.copy(e.originalGeometry.boundingSphere.center):e.geometry.userData.type==="TextGeometry"?Qr.set(0,0,n.depth*.5):s!==void 0&&(y9(Uo,s,e.geometry.drawRange.start,e.geometry.drawRange.count<1/0?e.geometry.drawRange.count:s.count),Uo.getCenter(Qr)),e.forceComputeSize?Uo.getSize(_n).multiplyScalar(.5):_n.set(n.width,n.height,(r=n.depth)!=null?r:0).multiplyScalar(.5)}else if(iT(e)&&e.objectHelper.visible){let n=e.geometryHelper.getAttribute("position");Uo.setFromArray(n.array),Uo.getCenter(Qr),Uo.getSize(_n).multiplyScalar(.5)}else Qr.setScalar(0),_n.setScalar(0);gl.copy(t).multiply(e.matrixWorld),_n.x===0&&_n.y===0&&_n.z===0?i.push(new M(Qr.x,Qr.y,Qr.z).applyMatrix4(gl)):sT.forEach(n=>{i.push(n.clone().multiply(_n).add(Qr).applyMatrix4(gl))})},Cw=class extends fi{constructor(){super(...arguments),this.matrix=new Fe,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new Fe().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(n=>{n.visible&&Mw(n,t,r)}):Mw(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(gl.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(_n).multiplyScalar(.5),this.getCenter(Qr),gl.copy(this.matrix).setPosition(Qr),this.vertices=sT.map(e=>e.clone().multiply(_n).applyMatrix4(gl))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=g9.map(([e,t])=>new Rr(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new M))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=v9.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},os=e=>"isEntity"in e,x9=e=>"isAbstractMesh"in e,Zl=e=>class extends nT(e){constructor(){super(...arguments),this.objectType="",this.isEntity=!0,this.raycastLock=!1,this.scaleLock=!1,this.hiddenMatrix=new Fe,this._singleBBox=new Cw,this._recursiveBBox=new Cw,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.forceComputeSize=!1,this.states={},this.currentState=null,this.currentTransitionAction=null}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}resetBBoxNeedsUpdate(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.traverseAncestors(t=>{os(t)&&(t.singleBBoxNeedsUpdate=!0,t.recursiveBBoxNeedsUpdate=!0)}),this.traverseEntity(t=>{t.singleBBoxNeedsUpdate=!0,t.recursiveBBoxNeedsUpdate=!0})}traverseEntity(t){t(this);for(let i of this.children)os(i)&&i.traverseEntity(t)}traverseVisibleEntity(t){t(this);for(let i of this.children)os(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(super.copy(t,!1),this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),i===!0)for(let r of t.children)os(r)&&this.add(r.clone());return this}keepChildrenMatrixWorld(){let t=new Fe,i=this.matrixWorld.clone();this.updateWorldMatrix(!1,!1),t.copy(this.matrixWorld).invert(),t.multiply(i);for(let r of this.children)os(r)&&r.hiddenMatrix.premultiply(t)}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x,this.rotation.y,this.rotation.z],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return Eg(i,t)}fromObjectTransformState(t){return t.position&&this.position.fromArray(t.position),t.rotation&&this.rotation.fromArray(t.rotation),t.scale&&this.scale.fromArray(t.scale),t.hiddenMatrix&&this.hiddenMatrix.fromArray(t.hiddenMatrix),this.updateMatrix(),this}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return Eg(i,t)}fromState(t,i){return t.name&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.type!=="OrthographicCamera"&&t.type!=="PerspectiveCamera"&&(this.matrixAutoUpdate=!1),t.visible!==void 0&&(this.visible=t.visible),this.fromObjectTransformState(t),this}},Dw=class{constructor(e){e=e!=null?e:{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},ba=class{constructor(e){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=lt.generateUUID(),this.type=e,this.name=""}analyze(e,t){t=t!=null?t:{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i!=null?i:{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i!=null?i:{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t!=null?t:this.getType(e,t);let r=e.getNodeData(i!=null?i:this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,n,s){return""}generate(e,t,i,r,n){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}getHash(){let e="{",t,i;for(t in this)i=this[t],i instanceof ba&&(e+='"'+t+'":'+i.getHash()+",");if(this.hashProperties)for(let r=0;r<this.hashProperties.length;r++)t=this.hashProperties[r],i=this[t],e+='"'+t+'":"'+String(i)+'",';return e+='"id":"'+this.uuid+'"}',e}},b9=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},Zi=new b9,Rt=class extends ba{constructor(e,t){super(e),this.scope="",t=t!=null?t:{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t!=null?t:this.getType(e),this.getShared(e,t)){let n=this.getUnique(e,t);n&&this.uuid===void 0&&(this.uuid=lt.generateUUID()),i=e.getUUID(i!=null?i:this.getUUID(),!n);let s=e.getNodeData(i),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(n)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||s.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let o=this.getTemp(e,i);if(o)return e.format(o,a,t);{o=super.generate(e,t,i,s.output,r);let l=this.generate(e,a,i);return e.addNodeCode(o+" = "+l+";"),e.format(o,a,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,n){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i!=null?i:this.uuid,e.getTempVar(i,r!=null?r:this.getType(e),n,this.getLabel()).name}},mr=class extends Rt{constructor(e,t){t=t!=null?t:{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,n,s){i=e.getUUID(i!=null?i:this.getUUID()),r=r!=null?r:this.getType(e);let a=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}},Mr=class extends mr{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof q?e:new q(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,n,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},Ar=class extends mr{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof M?e:new M(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},cr=class extends Ze{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},ka=class extends mr{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof cr?e:new cr(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,n,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},w9=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,Pw=/[a-z_0-9]+/gi,He=class extends Rt{constructor(e,t,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,n){let s,a=0,o=this.src;if(this.includes)for(let h=0;h<this.includes.length;h++)e.include(this.includes[h],this);for(let h in this.extensions)e.extensions[h]=!0;let l=[];for(;s=Pw.exec(this.src);)l.push(s);for(let h=0;h<l.length;h++){let c=l[h],u=c[0],d=this.isMethod?!this.getInputByName(u):!0,p=u;if(this.keywords[u]||this.useKeywords&&d&&Zi.containsKeyword(u)){let m=this.keywords[u];if(!m){let g=Zi.getKeywordData(u);g.cache&&(m=e.keywords[u]),m=m||Zi.getKeyword(u,e),g.cache&&(e.keywords[u]=m)}p=m.build(e)}u!==p&&o[c.index+a-1]!=="."&&(o=o.substring(0,c.index+a)+p+o.substring(c.index+u.length+a),a+=p.length-u.length),this.getIncludeByName(p)===void 0&&Zi.contains(p)&&e.include(Zi.get(p))}return t==="source"?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t!=null?t:[],this.extensions=i!=null?i:{},this.keywords=r!=null?r:{},this.isMethod){let n=w9.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(Pw);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let h=s[a++];this.inputs.push({name:h,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},_9=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,aT=class extends Rt{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||aT.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,n){this.src=e||"";let s,a,o="",l=_9.exec(e);this.useDefine=n!=null?n:this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,n){return e.format(this.name,this.getType(e),t)}},Mt=aT;Mt.PI="PI",Mt.PI2="PI2",Mt.RECIPROCAL_PI="RECIPROCAL_PI",Mt.RECIPROCAL_PI2="RECIPROCAL_PI2",Mt.LOG2="LOG2",Mt.EPSILON="EPSILON";var S9=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),A9=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),oT=class extends Rt{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,n){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=S9.exec(e);if(t){let i=t[2],r;for(;r=A9.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},G0=class extends Rt{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e!=null?e:0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};Zi.addKeyword("uv",function(){return new G0});Zi.addKeyword("uv2",function(){return new G0(1)});var Qo=class extends Rt{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t!=null?t:Qo.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case Vn:return["Linear"];case pt:return["sRGB"];default:return[]}}generate(e,t){var a;let i=this.input.build(e,"v4"),r=this.getType(e),n=Qo.Nodes[this.method],s=e.include(n);if(s===Qo.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((a=n.inputs)==null?void 0:a.length)===2){let o=this.factor.build(e,"f");return e.format(s+"( "+i+", "+o+" )",r,t)}else return e.format(s+"( "+i+" )",r,t)}fromEncoding(e){let t=Qo.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=Qo.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Pn=Qo;Pn.Nodes={LinearToLinear:new He(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new He(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new He(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Pn.LINEAR_TO_LINEAR="LinearToLinear",Pn.SRGB_TO_LINEAR="sRGBToLinear",Pn.LINEAR_TO_SRGB="LinearTosRGB";var zt=class extends He{constructor(e="",t,i,r,n){super(e,n,r,i,t),this.nodeType="Expression"}},Zs=class extends mr{constructor(e=new ji,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t!=null?t:new G0,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){var h;if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=(h=this.colorSpace)!=null?h:new Pn(new zt("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,l),e.removeContext(),e.format(a,l,t)}},Ne=class extends mr{constructor(e){super("f"),this.nodeType="Float",this.value=e!=null?e:0}generateReadonly(e,t,i,r,n,s){return e.format(this.value+(this.value%1?"":".0"),r,t)}},Lw=class extends Rt{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t!=null?t:[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,n){r=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let h=s.inputs[l],c=this.inputs[l]||this.inputs[h.name];o.push(c.build(e,e.getTypeByFormat(h.type)))}a+=o.join(", ")+" )"}return e.format(a,r,t)}},lT=class extends Rt{constructor(e,t,i=lT.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),n=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+n+" )",i,t)}},Ln=lT;Ln.ADD="+",Ln.SUB="-",Ln.MUL="*",Ln.DIV="/";var Tt=class extends Rt{constructor(e,t=Tt.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case Tt.MIX:case Tt.CLAMP:case Tt.REFRACT:case Tt.SMOOTHSTEP:case Tt.FACEFORWARD:return 3;case Tt.MIN:case Tt.MAX:case Tt.MOD:case Tt.STEP:case Tt.REFLECT:case Tt.DISTANCE:case Tt.DOT:case Tt.CROSS:case Tt.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case Tt.LENGTH:case Tt.DISTANCE:case Tt.DOT:return"f";case Tt.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,n,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),h=this.getType(e);switch(this.type=h,this.method){case Tt.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case Tt.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case Tt.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case Tt.STEP:i=this.a.build(e,s===1?"f":l),r=this.b.build(e,l);break;case Tt.MIN:case Tt.MAX:case Tt.MOD:i=this.a.build(e,l),r=this.b.build(e,a===1?"f":l);break;case Tt.REFRACT:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,"f");break;case Tt.MIX:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,o===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(r=this.b.build(e,l)),this.c&&(n=this.c.build(e,l));break}let c=[];c.push(i),r&&c.push(r),n&&c.push(n);let u=this.getNumInputs(e);if(c.length!==u)throw Error(`Arguments not match used in "${this.method}". Require ${u}, currently ${c.length}.`);return e.format(this.method+"( "+c.join(", ")+" )",h,t)}},st=Tt;st.RAD="radians",st.DEG="degrees",st.EXP="exp",st.EXP2="exp2",st.LOG="log",st.LOG2="log2",st.SQRT="sqrt",st.INV_SQRT="inversesqrt",st.FLOOR="floor",st.CEIL="ceil",st.NORMALIZE="normalize",st.FRACT="fract",st.SATURATE="saturate",st.SIN="sin",st.COS="cos",st.TAN="tan",st.ASIN="asin",st.ACOS="acos",st.ARCTAN="atan",st.ABS="abs",st.SIGN="sign",st.LENGTH="length",st.NEGATE="negate",st.INVERT="invert",st.MIN="min",st.MAX="max",st.MOD="mod",st.STEP="step",st.REFLECT="reflect",st.DISTANCE="distance",st.DOT="dot",st.CROSS="cross",st.POW="pow",st.MIX="mix",st.CLAMP="clamp",st.REFRACT="refract",st.SMOOTHSTEP="smoothstep",st.FACEFORWARD="faceforward";var Rh=class extends Rt{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){var o,l,h,c;let n=new Lw(Rh.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=(o=this.colorSpaceTL)!=null?o:new Pn(new zt("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(e)+".tl"),this.colorSpaceTR=(l=this.colorSpaceTR)!=null?l:new Pn(new zt("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(e)+".tr"),this.colorSpaceBL=(h=this.colorSpaceBL)!=null?h:new Pn(new zt("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(e)+".bl"),this.colorSpaceBR=(c=this.colorSpaceBR)!=null?c:new Pn(new zt("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new zt(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new zt(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new zt(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new zt(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new zt("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,n=new Lw(Rh.Nodes.roughnessToMip,[r]),s=new st(n,Rh.Nodes.m0,Rh.Nodes.cubeUV_maxMipLevel,st.CLAMP),a=new st(s,st.FLOOR),o=new st(s,st.FRACT),l=this.bilinearCubeUV(e,this.value,i,a),h=this.bilinearCubeUV(e,this.value,i,new Ln(a,new Ne(1).setReadonly(!0),Ln.ADD)),c=new st(l,h,o,st.MIX);return e.format(c.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},nv=Rh;nv.Nodes=function(){let e=new oT(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new Mt("float cubeUV_maxMipLevel 8.0",!0),i=new Mt("float cubeUV_minMipLevel 4.0",!0),r=new Mt("float cubeUV_maxTileSize 256.0",!0),n=new Mt("float cubeUV_minTileSize 16.0",!0),s=new He(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new He(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new He(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,a,t,i,r,n]);o.useKeywords=!1;let l=new Mt("float r0 1.0",!0),h=new Mt("float v0 0.339",!0),c=new Mt("float m0 -2.0",!0),u=new Mt("float r1 0.8",!0),d=new Mt("float v1 0.276",!0),p=new Mt("float m1 -1.0",!0),m=new Mt("float r4 0.4",!0),g=new Mt("float v4 0.046",!0),f=new Mt("float m4 2.0",!0),v=new Mt("float r5 0.305",!0),y=new Mt("float v5 0.016",!0),x=new Mt("float m5 3.0",!0),b=new Mt("float r6 0.21",!0),S=new Mt("float v6 0.0038",!0),_=new Mt("float m6 4.0",!0),A=[l,h,c,u,d,p,m,g,f,v,y,x,b,S,_],w=new He(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,A);return{bilinearCubeUV:o,roughnessToMip:w,m0:c,cubeUV_maxMipLevel:t}}();var Ko=class extends Rt{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e!=null?e:Ko.VIEW}getShared(){return this.scope===Ko.WORLD}build(e,t,i,r){let n=e.context[this.scope+"Normal"];return n?n.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,n){let s;switch(this.scope){case Ko.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case Ko.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case Ko.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},er=Ko;er.LOCAL="local",er.WORLD="world",er.VIEW="view",er.NORMAL="normal";Zi.addKeyword("viewNormal",function(){return new er(er.VIEW)});Zi.addKeyword("localNormal",function(){return new er(er.NORMAL)});Zi.addKeyword("worldNormal",function(){return new er(er.WORLD)});var ns=class extends Rt{constructor(e){super("v3"),this.nodeType="Position",this.scope=e!=null?e:ns.LOCAL}getType(){switch(this.scope){case ns.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case ns.LOCAL:case ns.WORLD:return!1}return!0}generate(e,t,i,r,n){let s;switch(this.scope){case ns.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case ns.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case ns.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case ns.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},$r=ns;$r.LOCAL="local",$r.WORLD="world",$r.VIEW="view",$r.PROJECTION="projection";Zi.addKeyword("position",function(){return new $r});Zi.addKeyword("worldPosition",function(){return new $r($r.WORLD)});Zi.addKeyword("viewPosition",function(){return new $r($r.VIEW)});var wn=class extends Rt{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e!=null?e:wn.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case wn.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case wn.VECTOR:{let n=new er(er.VIEW),s=e.context.roughness,a=n.build(e,"v3"),o=new $r($r.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,h=`reflect( -normalize( ${o} ), ${a} )`;l&&(h=`normalize( mix( ${h}, ${a}, ${l} * ${l} ) )`);let c=`inverseTransformDirection( ${h}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${c};`),r="reflectVec"):r=c;break}case wn.CUBE:{let n=new wn(wn.VECTOR).build(e,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case wn.SPHERE:{let n=new wn(wn.VECTOR).build(e,"v3"),s="normalize( ( viewMatrix * vec4( "+n+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${s};`),r="reflectSphereVec"):r=s;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},vl=wn;vl.CUBE="cube",vl.SPHERE="sphere",vl.VECTOR="vector";var E9=class extends Rt{constructor(e=new Zs,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new nv(this.value,t!=null?t:new vl(vl.VECTOR),i),this.irradianceNode=new nv(this.value,new er(er.WORLD),new Ne(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},T9=class extends mr{constructor(e=new Jv,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t!=null?t:new vl,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l,h;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(l=this.uv)==null?void 0:l.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=(h=this.colorSpace)!=null?h:new Pn(new zt("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},Ow=["x","y","z","w"],M9=["float","vec2","vec3","vec4"],C9={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},D9={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},P9=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let n="";r=r.sort(e);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.material=e,this.renderer=t,this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e!=null?e:"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t!=null?t:this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t!=null?t:this.shader]+=e+`
`}clearNodeCode(e){e=e!=null?e:this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t!=null?t:this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t!=null?t:this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[e];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t!=null?t:"";let i="";for(let r=0,n=e.length;r<n;++r){let s=e[r],a=s.type,o=s.name,l=s.size,h=this.getFormatByType(a);if(h===void 0)throw new Error("Node pars "+h+" not found.");h.includes("[]")?i+=t+" "+h.substring(0,h.length-2)+" "+o+`[${l}];
`:i+=t+" "+h+" "+o+`;
`}return i}getVars(e){return this.inputs.vars[e!=null?e:this.shader]}getNodeData(e){let t=e instanceof ba?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,n,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new Dw({type:t,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new Dw({type:t,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,r,n){return this.createUniform("vertex",e,t,i,r,n)}createFragmentUniform(e,t,i,r,n){return this.createUniform("fragment",e,t,i,r,n)}include(e,t,i){var s;let r;if(e=typeof e=="string"?Zi.get(e):e,this.context.include===!1)return e.name;e instanceof He?r=this.includes.functions:e instanceof Mt?r=this.includes.consts:e instanceof oT&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(e){let a=n[e.name];if(a||(a=n[e.name]={node:e,deps:[]},n.push(a),a.src=e.build(this,"source")),e instanceof He&&t&&n[t.name]&&n[t.name].deps.indexOf(e)===-1&&(n[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let o=0;do this.include(e.includes[o++],t);while(o<e.includes.length)}return i&&(a.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return M9[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case to:case io:return new T9(i);case Au:return new E9(new Zs(i));default:return new Zs(i)}else{if(i.isVector2)return new Mr(i);if(i.isVector3)return new Ar(i);if(i.isVector4)return new ka(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return C9[e]||e}getFormatByType(e){return D9[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return Ow[e]}getIndexByElement(e){return Ow.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=Vn,t===Vn&&this.context.gamma&&(t=pt),t}},Zt=class extends mr{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof cr?e:new cr(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,n,s){i=e.getUUID(i!=null?i:this.getUUID()),r=r!=null?r:this.getType(e);let a=e.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},Pt=class extends mr{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e!=null?e:0)}generateReadonly(e,t,i,r,n,s){return e.format(this.value.toString(),r,t)}},hT=class extends ba{constructor(){super("basic"),this.nodeType="Basic",this.color=new Zt(5855577),this.shadingAlpha=new Ne(1),this.shadingBlend=new Pt(0)}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(Fl.merge([we.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new Zt(5855577)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let s=["#include <normal_fragment_begin>",i.code];r&&s.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),n?s.push(n.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${n.result}, 1.0, SPE_BLENDING_NORMAL);`):s.push(`vec3 finalColor = ${i.result};`),r?s.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} );`):s.push("gl_FragColor = vec4("+i.result+", 1.0 );"),s.push("#include <fog_fragment>","#include <dithering_fragment>"),t=s.join(`
`)}return t}},xh=class extends mr{constructor(e){super("b"),this.nodeType="Bool",this.value=e!=null?e:!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},uT=class extends mr{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e!=null?e:new Ri}generateReadonly(e,t,i,r,n,s){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},Ia=class extends mr{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},Ba=class extends mr{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof ht?new Array(e).fill(t):new Array(e).fill(new ht(0))}},H0=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e))(H0||{}),Pr=function(){let e=new He(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new He(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new Mt("float F3 0.3333333"),t.keywords.G3=new Mt("float G3 0.1666667");let i=new He(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[t]),r=new He("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),n=new He("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),s=new He(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[r,n]),a=new He("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),o=new He("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[a]),l=new He(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[o]),h=new He(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[l]);h.keywords.NUM_OCTAVES=new Mt(`int NUM_OCTAVES ${5}`);let c=new He("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),u=new He(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[r,n,c]);return{simplex:t,simplexFractal:i,simplexAshima:s,fbm:h,perlin:u}}(),cT=class extends Rt{constructor(e,t,i,r,n,s,a,o,l,h,c,u){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=h,this.alpha=c,this.noiseType=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,n){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=Object.values(H0)[this.noiseType.value],a=new He(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, float alpha, out float calpha) {
                vec3 st = position / size;
				st /= scale;
				vec3 q = vec3(${s}(st),
							  ${s}(st + vec3(1.0)),
							  ${s}(st + vec3(1.0)));
				vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
							  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
							  ${s}(st * q));
				float f = ${s}(st + r);
				vec4 color;
				color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
				color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
				color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));

                float lalpha = alpha * color.a;
                calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );

			    accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return clamp(color, 0.0, 1.0).rgb;
			}`,[Pr.simplex,Pr.simplexFractal,Pr.simplexAshima,Pr.fbm,Pr.perlin]),o=e.include(a),l=[];return l.push(this.scale.build(e,"f")),l.push(this.size.build(e,"v3")),l.push(this.move.build(e,"f")),l.push(this.fA.build(e,"v2")),l.push(this.fB.build(e,"v2")),l.push(this.distortion.build(e,"v2")),l.push(this.colorA.build(e,"v4")),l.push(this.colorB.build(e,"v4")),l.push(this.colorC.build(e,"v4")),l.push(this.colorD.build(e,"v4")),l.push(this.alpha.build(e,"f")),l.push(this.calpha),e.format(o+"("+l.join(",")+")",this.getType(e),t)}};cT.numOctaves=5;var L9=class extends ba{constructor(){super("phong"),this.nodeType="Phong",this.color=new Zt(5855577),this.specular=new Zt(1118481),this.shininess=new Ne(30),this.shadingAlpha=new Ne(1),this.shadingBlend=new Pt(0)}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(Fl.merge([we.fog,we.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Vt.penumbraSize}),this.color===void 0&&(this.color=new Zt(5855577)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;",`uniform float penumbraSize[${5}];`,"#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];h.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;"),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result}, ${a.result} );
				}
				`),o&&h.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},dT=class extends Rt{constructor(e,t,i,r,n,s,a){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=n,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(dT.Nodes.fresnel),r=[];return r.push(this.color.build(e,"c")),r.push(this.bias.build(e,"f")),r.push(this.scale.build(e,"f")),r.push(this.intensity.build(e,"f")),r.push(this.factor.build(e,"f")),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},pT=dT;pT.Nodes=function(){return{fresnel:new He(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, float alpha, int mode, out float calpha) {
				float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

				float lalpha = clamp( fresnel, 0.0, 1.0 ) * alpha;
				calpha = lalpha / clamp(lalpha + accumAlpha, 0.001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;
				return color;
			}`)}}();var fT=class extends Rt{constructor(e,t,i,r,n,s,a){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(fT.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},mT=fT;mT.Nodes=function(){let e=new He(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[Pr.simplex]);return{rainbow:new He(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, float alpha, out float calpha) {
                 vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

                 float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);
                 float lalpha = alpha * rainbowContribution;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

                 return res;
             }`,[e])}}();var gT=class extends Rt{constructor(e,t,i,r,n,s,a,o,l,h,c,u,d,p,m,g){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=h,this.compensation=c,this.resolution=u,this.normalMap=d,this.depthMap=p,this.pixelRatio=m,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.firstTime){let i=this.outlineWidth.build(e,"f"),r=this.resolution.build(e,"v2"),n=this.compensation.build(e,"b"),s=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(i,"uniform float"),e.addVertexParsVariable(r,"uniform vec2"),e.addVertexParsVariable(n,"uniform bool"),e.addVertexParsVariable(s,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float");let a=`g${this.uuid.toString().replace(/-/g,"")}`;e.addVertexFinalCode(`
                vID = randomColor.r;
                if (${n}) {
                    vec4 ${a}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${a}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    vec2 ${a}_offset = normalize(${a}_clipNormal.xy) / ${r} * (${i} / 2.0) * ${a}_clipPosition.w * 2.0 * ${s};
                    ${a}_clipPosition.xy += ${a}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${a}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(gT.Nodes.outline),r=[];return r.push(this.outlineColor.build(e,"c")),r.push(this.contourColor.build(e,"c")),r.push(this.outlineWidth.build(e,"f")),r.push(this.contourWidth.build(e,"f")),r.push(this.contourThreshold.build(e,"f")),r.push(this.outlineThreshold.build(e,"f")),r.push(this.contourFrequency.build(e,"f")),r.push(this.outlineSmoothing.build(e,"f")),r.push(this.contourDirection.build(e,"v3")),r.push(this.positionalLines.build(e,"b")),r.push(this.resolution.build(e,"v2")),r.push(this.normalMap.getTexture(e,"t")),r.push(this.depthMap.getTexture(e,"t")),r.push(this.pixelRatio.build(e,"f")),r.push(this.compensation.build(e,"b")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),this.firstTime=!this.firstTime,e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},vT=gT;vT.Nodes=function(){let e=new He(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 texelSize = (vec2(1.0) / resolution) * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -texelSize.x, -texelSize.y);
	uvSamples[1] = uv + vec2(0.0, -texelSize.y);
	uvSamples[2] = uv + vec2(  texelSize.x, -texelSize.y);
	uvSamples[3] = uv + vec2( -texelSize.x, 0.0);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  texelSize.x, 0.0);
	uvSamples[6] = uv + vec2( -texelSize.x, texelSize.y);
	uvSamples[7] = uv + vec2(0.0, texelSize.y);
	uvSamples[8] = uv + vec2(  texelSize.x, texelSize.y);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec4 sobel_edge_h = normalSamples[2] + (2.0*normalSamples[5]) + normalSamples[8] - (normalSamples[0] + (2.0*normalSamples[3]) + normalSamples[6]);
  	vec4 sobel_edge_v = normalSamples[0] + (2.0*normalSamples[1]) + normalSamples[2] - (normalSamples[6] + (2.0*normalSamples[7]) + normalSamples[8]);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new He(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
                 return result;
             }`,[e])}}();var yT=class extends Rt{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",30),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(yT.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},xT=yT;xT.Nodes=function(){let e=new He(`
            float gaussian(vec2 i) {
                const float sigma = float(NUM_SAMPLES) * .25;
                return exp( -.5* dot(i/=sigma,i) ) / ( 6.28 * sigma*sigma );
            }`),t=new He(`
            vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

                const int LOD = 2;
                const int sLOD = 4; // tile size = 2^LOD

                vec3 O = vec3(0);
                float a = 0.0;
                const int s = NUM_SAMPLES/sLOD;
                for ( int i = 0; i < s*s; i++ ) {
                    int modulo = (i)-((i)/(s))*(s);
                    vec2 d = vec2(float(modulo), float(i/s))*float(sLOD) - float(NUM_SAMPLES)/2.;
                    vec2 uv = U + (scale * aspectRatio) * d;
                    // What is the depth of the opaque object we're trying to sample
                    float opaqueDepth = unpackRGBAToDepth(texture2D(dm, uv));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU + ((scale * min(lod / 2., 1.)) * aspectRatio) * d;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    float gaussian = gaussian(d);
		            #ifdef TEXTURE_LOD_EXT
                    O += gaussian * texture2DLodEXT( sp, uv, lod).rgb;
                    #else
                    O += gaussian * textureLod( sp, uv, lod).rgb;
                    #endif
                    a += gaussian;
                }
                return O / a;
            }`,[e]),i=new He(`
            vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        // Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		        // The thickness is specified in local space.
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),r=new He(`
float applyIorToRoughness( float roughness, float ior ) {
		// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
		// an IOR of 1.5 results in the default amount of microfacet refraction.
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	} `),n=new He(`
vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
        float lod = applyIorToRoughness(roughness, ior);

        return blur(transmissionSamplerMap, fragCoord, vec2(lod / (transmissionSamplerSize.x / 2.)), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
	}`,[r,t]),s=new He(`
vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
        vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
        vec3 refractedRayExit = position + transmissionRay;

        // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
        vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
        vec2 refractionCoords = ndcPos.xy / ndcPos.w;
        refractionCoords += 1.0;
        refractionCoords /= 2.0;

        vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
        vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
        unrefractedCoords += 1.0;
        unrefractedCoords /= 2.0;

        // Sample framebuffer to get pixel the refracted ray hits.
        return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    }`,[n,i]);return{transmission:new He(`
            vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                float lalpha = alpha;

                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
                 return transmission;
            }`,[s])}}();var Ih=class extends Rt{constructor(e,t,i,r,n,s,a,o,l,h,c){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=h,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new He(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a;
               calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );

			   accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
               return color.rgb;
			}`,[Ih.Nodes.vectorLinearWorldSpaceDepth,Ih.Nodes.vectorLinearObjectSpaceDepth,Ih.Nodes.vectorSphericalObjectSpaceDepth,Ih.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let n=e.include(r),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(n+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},bT=Ih;bT.Nodes=function(){let e=new He(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new He(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new He(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new He(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var Rw=class extends Rt{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},sv=(e=>(e.NOISE="noise",e.MAP="map",e))(sv||{}),wT=class extends Rt{constructor(e,t,i,r,n){super("v3"),this.displacementTypeIndex=new Pt(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(sv)[this.displacementTypeIndex.value]==="map"&&(this.mat=new uT(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=r,this.noiseFunctionIndex=n}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(sv)[this.displacementTypeIndex.value]){case"map":{i=e.include(wT.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let n=Object.values(H0)[this.noiseFunctionIndex.value],s=new He(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=new He(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement) {
							return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
						}`,[Pr.simplex,Pr.simplexFractal,Pr.simplexAshima,Pr.fbm,Pr.perlin]),o=new He(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[a,s]);i=e.include(o),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},_T=wT;_T.Nodes=function(){let e=new He(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new He(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new He(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var ST=class extends Rt{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(ST.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},AT=ST;AT.Nodes=function(){return{gradient:new He(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return color.xyz;
			}`)}}();var ld=class extends Rt{constructor(e,t,i,r,n,s,a,o,l,h){super("v3"),this.nodeType="CustomTexture",this.firstTime=!0,this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.mat=o,this.alpha=l,this.mode=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(ld.Nodes.cylindrical);break;case 2:r=e.include(ld.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=new He(`
		vec3 ${i}_planarTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {

				vec2 uvs = ( mat * vec3( (${i}_vCustomUv * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, mat * ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}`);r=e.include(a);break;default:r=e.include(ld.Nodes.uv);break}if(this.projection.value===1&&this.firstTime){e.addVertexParsCode(`varying vec2 ${i}_vCustomUv;`),e.addFragmentParsCode(`varying vec2 ${i}_vCustomUv;`);let s=["zy","xz","xy"][this.axis.value];e.addVertexFinalCode(`${i}_vCustomUv = (1. + (transformed.${s})) / 2.;`)}e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.texture.generate(e,"t")),n.push(this.textureSize.build(e,"v2")),n.push(this.crop.build(e,"f")),n.push(this.mat.build(e,"mat3")),n.push(this.size.build(e,"v2")),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}},ET=ld;ET.Nodes=function(){let e=new He(`
vec3 cylindricalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}
`),t=new He(`
vec3 sphericalTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}
`),i=new He(`vec3 uvTexture(sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float alpha, int mode, out float calpha) {

				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				return col;
			}`);return{cylindrical:e,spherical:t,uv:i}}();var TT=class extends Rt{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t}generate(e,t){if(e.isShader("fragment")){let i=e.include(TT.Nodes.customNormal),r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.alpha.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},MT=TT;MT.Nodes=function(){return{customNormal:new He(`vec3 customNormal(vec3 cnormal, vec3 norm, float alpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return normal;
			}`)}}();var Vt={normalRenderTarget:new Zs,normalRenderTargetDepth:new Zs,transmissionRenderTarget:new Zs,transmissionSize:new Mr(2048,2048),transmissionRenderTargetDepth:new Zs,pixelRatioNode:new Ne(1),resolution:new Mr,penumbraSize:new Ia(5,.5)};for(let e of Object.values(Vt))e.isRenderGlobal=!0;var O9=class extends ba{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new Zt(5855577),this.emissive=new Zt(0),this.emissiveIntensity=new Ne(1),this.shadingAlpha=new Ne(1),this.shadingBlend=new Pt(0)}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(Fl.merge([we.fog,we.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Vt.penumbraSize}),this.color===void 0&&(this.color=new Zt(5855577)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode([`uniform float penumbraSize[${5}];`,"varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),h.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;"),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result}, ${a.result} );
				}
				`),o&&h.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},R9=class extends ba{constructor(){super("standard"),this.nodeType="Standard",this.color=new Zt(5855577),this.roughness=new Ne(.3),this.metalness=new Ne(0),this.reflectivity=new Ne(.5),this.shadingAlpha=new Ne(1),this.shadingBlend=new Pt(0)}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(Fl.merge([we.fog,we.lights])),we.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Vt.penumbraSize});let i={gamma:!0};this.color===void 0&&(this.color=new Zt(5855577)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let r=this.color.flow(e,"c",{slot:"color",context:i}),n=this.roughness.flow(e,"f"),s=this.metalness.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=h!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;",`uniform float penumbraSize[${5}];`,"#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let u=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];u.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",n.code,"	float roughnessFactor = "+n.result+";",s.code,"	float metalnessFactor = "+s.result+";"),h&&u.push(h.code,"#ifdef ALPHATEST","	if ( "+h.result+" <= ALPHATEST ) discard;","#endif"),u.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),u.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),c?u.push(c.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+c.result+" ) ), diffuseColor, metalnessFactor );"):u.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),u.push("#include <lights_fragment_begin>"),u.push("#include <lights_fragment_end>"),u.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;"),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result}, ${o.result} );
				}
				`),l&&u.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),h?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${h.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join(`
`)}return t}},I9=class extends ba{constructor(){super("toon"),this.nodeType="Toon",this.color=new Zt(5855577),this.specular=new Zt(1118481),this.shininess=new Ne(30),this.shadingAlpha=new Ne(1),this.shadingBlend=new Pt(0)}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform(Fl.merge([we.fog,we.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Vt.penumbraSize}),this.color===void 0&&(this.color=new Zt(5855577)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode([`uniform float penumbraSize[${5}];`,"varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];h.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular;"),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result}, ${a.result} );
				}
				`),o&&h.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}};function B9(e,t){switch(e.type){case"fresnel":return U9(e,t);case"gradient":return F9(e);case"depth":return z9(e);case"normal":return G9(e);case"noise":return H9(e,t);case"rainbow":return V9(e);case"toon":return j9(e,t);case"outline":return W9(e,t);case"transmission":return q9(e);case"color":return k9(e,t)}}function N9(e){return{type:e.type}}function Qn(e){let{alpha:t,mode:i}=e;return{...N9(e),alpha:t,mode:i}}function k9(e,t){return{...Qn(e),color:$i(e.color,t)}}function U9(e,t){let{bias:i,scale:r,intensity:n,factor:s,color:a}=e;return{...Qn(e),color:$i(a,t),bias:i,scale:r,intensity:n,factor:s}}function F9(e){let{gradientType:t,smooth:i,colors:r,steps:n,angle:s,offset:a,morph:o}=e;return{...Qn(e),gradientType:t,smooth:i,colors:r.map(l=>new ht(l[0],l[1],l[2],l[3])),num:r.length,steps:n,offset:new q(...a),morph:new q(...o),angle:s}}function z9(e){let{gradientType:t,near:i,far:r,isVector:n,isWorldSpace:s,origin:a,direction:o,colors:l,steps:h,smooth:c}=e;return{...Qn(e),gradientType:t,near:i,far:r,isVector:n,isWorldSpace:s,origin:new M(...a),direction:o?new M(...o):new M(1,0,0),colors:l.map(u=>u!==void 0?new ht(u[0],u[1],u[2],u[3]):new ht(0,0,0,0)),steps:h.slice(0,l.length),smooth:c}}function G9(e){let{cnormal:t}=e;return{...Qn(e),cnormal:new M(t[0],t[1],t[2])}}function H9(e,t){return{...Qn(e),scale:e.scale,move:e.move,fA:new q(...e.fA),fB:new q(...e.fB),size:new M(...e.size),distortion:new q(...e.distortion),colorA:$i(e.colorA,t),colorB:$i(e.colorB,t),colorC:$i(e.colorC,t),colorD:$i(e.colorD,t),noiseType:e.noiseType}}function V9(e){return{...Qn(e),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new M(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new M(...e.offset)}}function j9(e,t){return{...Qn(e),positioning:e.positioning,colors:e.colors.map(i=>new ht(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new M(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:$i(e.shadowColor,t),offset:new M(...e.offset)}}function W9(e,t){return{...Qn(e),outlineColor:$i(e.outlineColor,t),contourColor:$i(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:e.contourDirection,positionalLines:e.positionalLines,compensation:e.compensation}}function q9(e,t){return{...Qn(e),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}var Wd=class extends cr{},hm=new Map,Wh={url:"head",time:0,data:null,next:null,prev:null},nl={url:"tail",time:1/0,data:null,next:null,prev:null};Wh.next=nl;nl.prev=Wh;var Iw=0;function Y9(e){if(typeof e=="string")return e;let t=Date.now(),i=hm.get(e);return i===void 0?(i={url:URL.createObjectURL(new Blob([e])),data:e,time:t,next:null,prev:null},hm.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=nl.prev,i.next=nl,nl.prev.next=i,nl.prev=i,t-Iw>1e3*10&&(Iw=t+1e3,setTimeout(()=>{let r=Date.now(),n=Wh.next;for(;n.time<r-1e3*10;)URL.revokeObjectURL(n.url),hm.delete(n.data),n=n.next,n.prev=Wh,Wh.next=n},900)),i.url}var CT=class{constructor(e,t){this.data=e,this.onImageLoad=t,this.loaded=!1,this.updateSrc(e.data)}updateSrc(e){typeof document>"u"||(this.dispose(),this.loaded=!1,this.img=new Image,this.img.src=Y9(e),this.img.onload=()=>{this.loaded=!0;let t=[1e3,1001,1002];for(let i of t){let r=this[i];r&&(r.image=this.img,r.needsUpdate=!0)}this.onImageLoad&&this.onImageLoad()})}getTexture(e){let t=this[e];if(t)return t;{let i=new ji(this.img,void 0,e,e);return this.loaded&&(i.needsUpdate=!0),this[e]=i,i}}dispose(){var e,t,i;(e=this[1e3])==null||e.dispose(),this[1e3]=void 0,(t=this[1001])==null||t.dispose(),this[1001]=void 0,(i=this[1002])==null||i.dispose(),this[1002]=void 0}},av=class extends CT{},V0=class extends mr{},DT={noise:["noiseType"],texture:["projection","axis","side"],displace:["noiseType"],depth:["smooth","isWorldSpace","gradientType","isVector"]},PT={depth:["colors"]};function X9(e,t,i){var s,a;let r=DT[e.type],n=PT[e.type];if(n!==void 0){let o=e.color;if(n.includes(t)){let l=(a=(s=o[t])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function LT(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=e;if("image"in s){let a=s.image,o=t.image(a),l=r;l instanceof av||l.image.dispose(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("repeat"in s||"offset"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),o.updateMatrix()}return n}function Q9(e,t,i,r){let n=!1;for(let[s,a]of Object.entries(e)){if(!s||a===void 0||kT(s,i,r))continue;i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(!!o&&!(o instanceof V0))switch(n=n||X9(i,s,a),o.constructor){case Zt:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof Wd?o.value=new cr(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case ka:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof Wd?o.value=new cr(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case Mr:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case Ar:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case Zs:{LT(a,t,i);break}case Ba:{o.value=a.map(l=>new ht(...l));break}default:{o.value=a;break}}}return n}var OT=class extends Rt{constructor(e,t,i){super("v3"),this.nodeType="Matcap",this.texture=e,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(OT.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},RT=OT;RT.Nodes=function(){return{matcap:new He(`vec3 matcap(sampler2D matcapTex, vec3 normal, float alpha, int mode, out float calpha) {
                vec3 viewDir = normalize( vViewPosition );
                vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
                vec3 y = cross( viewDir, x );
                vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
                vec4 matcapColor = texture2D( matcapTex, uv );

                calpha =  alpha / clamp( alpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;
                
                return matcapColor.rgb;
            }
            `)}}();var Bw=class extends V0{constructor(e,t){super("t"),this.image=e,this.wrap=t}get value(){return this.image.getTexture(this.wrap)}},K9=class extends V0{constructor(e){super("v3"),this.image=e,this._value=new M}get value(){return this._value.x=this.image.img.width,this._value.y=this.image.img.height,this._value}},IT=class extends Rt{constructor(e,t,i,r,n,s,a,o,l,h){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=h,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(IT.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},BT=IT;BT.Nodes=function(){let e=new He(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new He(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new He(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new He(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new He(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new He(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Pr.simplex,e,i,n])}}();function Nw(e,t,i){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0)}var Z9=class extends uT{constructor(e,t){super(new Ri),this.repeat=e,this.offset=t,Nw(this.value,e,t)}updateMatrix(){Nw(this.value,this.repeat,this.offset)}},Ja=class{constructor(e,t,i,r){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let n in r)this.uniforms[`f${this.id}_${n}`]=r[n];for(let n in i)kT(n,this,i)}get type(){return this.data.type}static create(e,t,i,r){var n,s,a,o,l,h,c,u,d,p,m;if(i.type==="light")return sl.createLigherLayer(e,t,i,r);if(i.type==="texture"){let g=r.image(i.texture.image),f=new Bw(g,i.texture.wrapping),v=new K9(g),y=new Z9(i.texture.repeat,i.texture.offset),x=new Ne(i.crop?1:0),b=new Pt((n=i.projection)!=null?n:0),S=new Pt((s=["x","y","z"].indexOf(i.axis))!=null?s:0),_=new Pt((a=i.side)!=null?a:0),A=new Mr(i.size?new q(i.size[0],i.size[1]):new q(100,100)),w=new Ne((o=i.alpha)!=null?o:1),E=new Pt((l=i.mode)!=null?l:0),T=new ET(f,v,x,b,S,_,A,y,w,E),C=new zt(T.calpha,"f");return new Li(e,t,i,{texture:f,textureSize:v,crop:x,projection:b,axis:S,side:_,size:A,mat:y,alpha:w,mode:E},T,E,C)}else if(i.type==="matcap"){let g=r.image(i.texture.image),f=new Bw(g,i.texture.wrapping),v=new Ne((h=i.alpha)!=null?h:1),y=new Pt((c=i.mode)!=null?c:0),x=new RT(f,v,y),b=new zt(x.calpha,"f");return new Li(e,t,i,{texture:f,alpha:v,mode:y},x,y,b)}else if(i.type==="displace")if(i.displacementType==="noise"){let g=new Ar(new M(...i.offset)),f=new Ne((u=i.scale)!=null?u:10),v=new Ne((d=i.intensity)!=null?d:8),y=new Ne((p=i.movement)!=null?p:1),x=new Pt((m=i.noiseType)!=null?m:0),b=new _T(v,y,g,f,x);return new NT(e,t,i,{offset:g,scale:f,intensity:v,movement:y,noiseType:x},b)}else throw new Error;else return e7(e,t,i,r)}updateByOp(e,t,i){let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props?!0:Q9(r.props,i,this,t)}else if(r.path[0]==="texture")return"texture"in t?LT(r.props,i,this):!0;return!1}dispose(){}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},Li=class extends Ja{constructor(e,t,i,r,n,s,a){super(e,t,i,r),this.color=n,this.mode=s,this.alpha=a}},NT=class extends Ja{constructor(e,t,i,r,n){super(e,t,i,r),this.position=n}},sl=class extends Ja{constructor(e,t,i,r,n){super(e,t,i,n),this.data=i,this.node=r}static createLigherLayer(e,t,i,r){var l,h,c,u,d,p,m,g;let n,s=new Ne(i.alpha),a=new Pt(i.mode),o;if(i.category==="lambert"){n=new O9;let f=new Zt((l=r.color(i.emissive))!=null?l:0);o={emissive:f},n.emissive=f}else if(i.category==="phong"){n=new L9;let f=new Ne((h=i.shininess)!=null?h:30),v=new Zt((c=r.color(i.specular))!=null?c:1118481);o={shininess:f,specular:v},n.shininess=f,n.specular=v}else if(i.category==="toon"){n=new I9;let f=new Ne((u=i.shininess)!=null?u:30),v=new Zt((d=r.color(i.specular))!=null?d:1118481);o={shininess:f,specular:v},n.shininess=f,n.specular=v}else if(i.category==="physical"){n=new R9;let f=new Ne((p=i.roughness)!=null?p:.3),v=new Ne((m=i.metalness)!=null?m:0),y=new Ne((g=i.reflectivity)!=null?g:.5);o={roughness:f,metalness:v,reflectivity:y},n.roughness=f,n.metalness=v,n.reflectivity=y}else n=new hT,o={};return n.alpha=new Ne(1),n.shadingAlpha=s,n.shadingBlend=a,o.alpha=n.shadingAlpha,o.mode=n.shadingBlend,new sl(e,t,i,n,o)}};function J9(e){let t=e instanceof Ja?e.type:e;return t==="texture"||t==="displace_map"||t==="matcap"}function $9(e,t,i,r){var n,s,a,o,l,h,c,u,d,p,m,g,f,v,y,x,b,S,_,A,w,E,T,C,P,k,D,R,G,N,L,H,F,z,U,W,Y,K,V,ie,Q,J,Z,ue,de,he,ge,pe,ve,Re,Te,Me,yt,Ge,B,O,ne,fe,ye,Ae,Xe,se,je,_e,Se,j,Ee,be,Je,Ie,et,xe,We;switch(e.type){case"color":{let Pe=new Zt((n=r.color)!=null?n:5855577),Ce=new Ne((s=r.alpha)!=null?s:1),Ve=new zt("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");Ve.keywords.alpha=Ce;let nt=new Pt((a=r.mode)!=null?a:0);return Pe.alpha=Ce,new Li(t,i,e,{color:Pe,alpha:Ce,mode:nt},Pe,nt,Ve)}case"fresnel":{let Pe=new Zt((o=r.color)!=null?o:16777215),Ce=new Ne((l=r.bias)!=null?l:.1),Ve=new Ne((h=r.scale)!=null?h:1),nt=new Ne((c=r.intensity)!=null?c:2),xt=new Ne((u=r.factor)!=null?u:1),Ht=new Ne((d=r.alpha)!=null?d:1),St=new Pt((p=r.mode)!=null?p:0),Bt=new pT(Pe,Ce,Ve,nt,xt,Ht,St),Dt=new zt(Bt.calpha,"f");return new Li(t,i,e,{color:Pe,bias:Ce,scale:Ve,intensity:nt,factor:xt,alpha:Ht,mode:St},Bt,St,Dt)}case"rainbow":{let Pe=new Ne((m=r.filmThickness)!=null?m:30),Ce=new Ne((g=r.movement)!=null?g:0),Ve=new Ar((f=r.wavelengths)!=null?f:new M(0,0,0)),nt=new Ne((v=r.noiseStrength)!=null?v:0),xt=new Ne((y=r.noiseScale)!=null?y:1),Ht=new Ar((x=r.offset)!=null?x:new M(0,0,0)),St=new Ne((b=r.alpha)!=null?b:1),Bt=new mT(Pe,Ce,Ve,nt,xt,Ht,St),Dt=new zt(Bt.calpha,"f"),Nt=new Pt((S=r.mode)!=null?S:0);return new Li(t,i,e,{filmThickness:Pe,movement:Ce,wavelengths:Ve,noiseStrength:nt,noiseScale:xt,offset:Ht,alpha:St,mode:Nt},Bt,Nt,Dt)}case"transmission":{let Pe=new Ne((_=r.thickness)!=null?_:10),Ce=new Ne((A=r.ior)!=null?A:1.5),Ve=new Ne((w=r.roughness)!=null?w:.5),nt=Vt.transmissionSize,xt=Vt.transmissionRenderTarget,Ht=Vt.transmissionRenderTargetDepth,St=window.innerWidth,Bt=window.innerHeight,Dt=St>=Bt?new Mr(Bt/St,1):new Mr(1,St/Bt),Nt=new Ne((E=r.alpha)!=null?E:1),mi=new xT(Pe,Ce,Ve,nt,xt,Ht,Dt,Nt),ir=new zt(mi.calpha,"f"),Ni=new Pt((T=r.mode)!=null?T:0);return new Li(t,i,e,{thickness:Pe,ior:Ce,roughness:Ve,aspectRatio:Dt,alpha:Nt,mode:Ni},mi,Ni,ir)}case"toon":{let Pe=new Pt((C=r.positioning)!=null?C:0),Ce;r.colors?Ce=new Ba(r.colors.length,r.colors):(Ce=new Ba(10,new ht(0,0,0,1)),Ce.value[1]=new ht(1,1,1,1));let Ve;r.steps?Ve=new Ia(r.steps.length,r.steps):(Ve=new Ia(10,1),Ve.value[0]=0);let nt=new Ar((P=r.source)!=null?P:new M(0,0,0)),xt=new xh((k=r.isWorldSpace)!=null?k:!0),Ht=new Ne((D=r.noiseStrength)!=null?D:0),St=new Ne((R=r.noiseScale)!=null?R:1),Bt=new ka(r.shadowColor),Dt=new Ar((G=r.offset)!=null?G:new M(0,0,0)),Nt=new Ne((N=r.alpha)!=null?N:1),mi=new BT(Pe,Ce,Ve,nt,xt,Ht,St,Bt,Dt,Nt),ir=new zt(mi.calpha,"f"),Ni=new Pt((L=r.mode)!=null?L:0);return new Li(t,i,e,{positioning:Pe,colors:Ce,steps:Ve,source:nt,isWorldSpace:xt,noiseStrength:Ht,noiseScale:St,shadowColor:Bt,offset:Dt,alpha:Nt,mode:Ni},mi,Ni,ir)}case"outline":{let Pe=new Zt((H=r.outlineColor)!=null?H:16777215),Ce=new Zt((F=r.contourColor)!=null?F:16777215),Ve=new Ne((z=r.outlineWidth)!=null?z:.1),nt=new Ne((U=r.contourWidth)!=null?U:.1),xt=new Ne((W=r.outlineThreshold)!=null?W:.1),Ht=new Ne((Y=r.contourThreshold)!=null?Y:.1),St=new Ne((K=r.outlineSmoothing)!=null?K:.1),Bt=new Ne((V=r.contourFrequency)!=null?V:.1),Dt=new Ar((ie=r.contourDirections)!=null?ie:new M(0,1,0)),Nt=new xh((Q=r.positionalLines)!=null?Q:!1),mi=new xh((J=r.compensation)!=null?J:!0),ir=Vt.normalRenderTarget,Ni=Vt.normalRenderTargetDepth,I=Vt.pixelRatioNode,$=Vt.resolution,ae=new Ne((Z=r.alpha)!=null?Z:1),re=new vT(Pe,Ce,Ve,nt,xt,Ht,St,Bt,Dt,Nt,mi,$,ir,Ni,I,ae),ce=new zt(re.calpha,"f"),Ye=new Pt((ue=r.mode)!=null?ue:0);return new Li(t,i,e,{outlineColor:Pe,contourColor:Ce,outlineWidth:Ve,contourWidth:nt,outlineThreshold:xt,contourThreshold:Ht,outlineSmoothing:St,contourFrequency:Bt,contourDirection:Dt,positionalLines:Nt,compensation:mi,alpha:ae,mode:Ye},re,Ye,ce)}case"depth":{let Pe=new Pt((de=r.gradientType)!=null?de:0),Ce=new xh((he=r.smooth)!=null?he:!1),Ve=new Ne((ge=r.near)!=null?ge:50),nt=new Ne((pe=r.far)!=null?pe:200),xt=new Ne((ve=r.isVector)!=null?ve:1),Ht=new Ne((Re=r.isWorldSpace)!=null?Re:0),St=new Ar((Te=r.origin)!=null?Te:new M),Bt=new Ar((Me=r.direction)!=null?Me:new M),Dt;r.colors?Dt=new Ba(r.colors.length,r.colors):(Dt=new Ba(2,new ht(0,0,0,1)),Dt.value[1]=new ht(1,1,1,1));let Nt;r.steps?Nt=new Ia(r.steps.length,r.steps):(Nt=new Ia(2,1),Nt.value[0]=0);let mi=new Ne((yt=r.alpha)!=null?yt:1),ir=new Pt((Ge=r.mode)!=null?Ge:0),Ni=new bT(Pe,Ce,Ve,nt,xt,Ht,St,Bt,Dt,Nt,mi),I=new zt(Ni.calpha,"f");return new Li(t,i,e,{gradientType:Pe,smooth:Ce,near:Ve,far:nt,isVector:xt,isWorldSpace:Ht,origin:St,direction:Bt,colors:Dt,steps:Nt,alpha:mi,mode:ir},Ni,ir,I)}case"noise":{let Pe=new Ne((B=r.scale)!=null?B:1),Ce=new Ar((O=r.size)!=null?O:new M(100,100,100)),Ve=new Ne((ne=r.move)!=null?ne:1),nt=new Mr((fe=r.fA)!=null?fe:new q(1.7,9.2)),xt=new Mr((ye=r.fB)!=null?ye:new q(8.3,2.8)),Ht=new Mr((Ae=r.distortion)!=null?Ae:new q(1,1)),St=new ka(r.colorA),Bt=new ka(r.colorB),Dt=new ka(r.colorC),Nt=new ka(r.colorD),mi=new Ne((Xe=r.alpha)!=null?Xe:1),ir=new Pt((se=r.mode)!=null?se:0),Ni=new Pt((je=r.noiseType)!=null?je:0),I=new cT(Pe,Ce,Ve,nt,xt,Ht,St,Bt,Dt,Nt,mi,Ni),$=new zt(I.calpha,"f");return new Li(t,i,e,{scale:Pe,size:Ce,move:Ve,fA:nt,fB:xt,distortion:Ht,colorA:St,colorB:Bt,colorC:Dt,colorD:Nt,alpha:mi,mode:ir,noiseType:Ni},I,ir,$)}case"normal":{let Pe=new Ar((_e=r.cnormal)!=null?_e:new M(1,1,1)),Ce=new Ne((Se=r.alpha)!=null?Se:1),Ve=new Pt((j=r.mode)!=null?j:0),nt=new MT(Pe,Ce),xt=new zt("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");return xt.keywords.alpha=Ce,new Li(t,i,e,{cnormal:Pe,alpha:Ce,mode:Ve},nt,Ve,xt)}case"gradient":{let Pe=new Pt((Ee=r.gradientType)!=null?Ee:0),Ce=new xh((be=r.smooth)!=null?be:!1),Ve;r.colors?Ve=new Ba(r.colors.length,r.colors):(Ve=new Ba(10,new ht(0,0,0,1)),Ve.value[1]=new ht(1,1,1,1));let nt;r.steps?nt=new Ia(r.steps.length,r.steps):(nt=new Ia(10,1),nt.value[0]=0);let xt=new Mr((Je=r.offset)!=null?Je:new q(0,0)),Ht=new Mr((Ie=r.morph)!=null?Ie:new q(0,0)),St=new Ne((et=r.angle)!=null?et:0),Bt=new Ne((xe=r.alpha)!=null?xe:1),Dt=new Pt((We=r.mode)!=null?We:0),Nt=new AT(Pe,Ce,Ve,nt,xt,Ht,St,Bt),mi=new zt(Nt.calpha,"f");return new Li(t,i,e,{gradientType:Pe,smooth:Ce,colors:Ve,steps:nt,offset:xt,morph:Ht,angle:St,alpha:Bt,mode:Dt},Nt,Dt,mi)}default:{let Pe=new Zt(1,0,0,1),Ce=new Ne(1),Ve=new zt("alpha / clamp(alpha + accumAlpha, 0.00001, 1.0 )","f");Ve.keywords.alpha=Ce;let nt=new Pt(0);return Pe.alpha=Ce,new Li(t,i,e,{color:Pe,alpha:Ce,mode:nt},Pe,nt,Ve)}}}function e7(e,t,i,r){let n=B9(i,r);return $9(i,e,t,n)}function kT(e,t,i){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let r=t.uniforms[`f${t.id}_intensity`];return r?(r.value=i.intensity*(i.visible?1:0),r):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let r=t.uniforms[`f${t.id}_alpha`];if(!r)return;if(r.value=i.alpha*(i.visible?1:0),i.type==="outline"&&e=="visible"){let n=t.uniforms[`f${t.id}_compensation`];n&&(n.value=i.compensation&&i.visible)}return r}}var Ol=class extends ci{constructor(e,t){super(void 0),this.data=e,this.layerIdGen=0,this.type="NodeMaterial",this.uniformsBackup={},this.fog=!0,this.updaters=[],this.dithering=!0,this.vertexColors=!0,this.onBeforeCompile=this._onBeforeCompile,this.transparent=!0,this.reset(e,t)}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.data.category}reset(e,t){var r,n;let i=(r=e.layers)!=null?r:Br.defaultTwoLayerData("phong").layers;this.layers=i.map(s=>Ja.create(this.layerIdGen++,s.id,s.data,t)),this.layers.reverse(),this.name=(n=e.name)!=null?n:"Untitled Material",this.onUpdate(t)}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof sl),this.lightLayer===void 0&&(this.lightLayer=new sl(0,"",ja.defaultData("light","basic"),new hT,{})),this.dispose(),this.needsUpdate=!0,this.blendColors(),this.blendAfterColors(),this.blendPositions()}updateByOp(e,t,i){if(this.data=t,e.path[0]==="layers"){let r=e.path[1];if(r===void 0){if(this.layers.reverse(),e.type===4){let n=Ja.create(this.layerIdGen++,e.id,e.data,i);this.layers.splice(e.localIndex,0,n)}else if(e.type===5)this.layers.splice(e.localIndex,1)[0].dispose();else if(e.type===6){let n=this.layers.findIndex(a=>a.uuid===e.id),s=this.layers[n];this.layers.splice(n,1),this.layers.splice(e.localIndex,0,s)}this.layers.reverse(),this.onUpdate(i)}else{let n=this.layers.find(s=>s.uuid===r);if(n){let s=t.layers.data(r);if(n.updateByOp({...e,path:e.path.slice(2)},s,i)){let a=Ja.create(this.layerIdGen++,r,s,i);this.layers.splice(this.layers.findIndex(o=>o.uuid===r),1,a),this.onUpdate(i)}}}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof Li),t=this.layers.findIndex(i=>i instanceof sl);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let n=this.layers[r];n instanceof Li&&(i=new Rw(i,n.color,n.alpha,n.mode))}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new zt("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof sl);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];r instanceof Li&&(e=new Rw(e,r.color,r.alpha,r.mode))}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof NT);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Ln(t,e[i].position,Ln.ADD),t=new Ln(t,new Ne(.5).setReadonly(!0),Ln.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}_onBeforeCompile(e,t){this.build({renderer:t}),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){this.uniformsBackup[`f${r.id}_intensity`]=r.uniforms[`f${r.id}_intensity`].value;let n=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=n}}restoreClampedUniforms(){for(let e of this.layers)e.type==="displace"&&(e.uniforms[`f${e.id}_intensity`].value=this.uniformsBackup[`f${e.id}_intensity`])}customProgramCacheKey(){var t,i;let e="[";for(let{data:r}of this.data.layers)if(r.type==="light")e+=`"${r.category.toUpperCase()}",`;else{let n=((t=DT[r.type])!=null?t:[]).map(o=>r[o]),s=((i=PT[r.type])!=null?i:[]).map(o=>{var l,h;return(h=(l=r[o])==null?void 0:l.length)!=null?h:0}),a=[...n,...s];a.length?e+=`["${r.type}", "${a.join('","')}"],`:e+=`"${r.type}",`}return e=e.slice(0,-1)+"]",e}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(e){var i;e=e!=null?e:{};let t=(i=e.builder)!=null?i:new P9;return this.lights=this.lightLayer.data.category!=="basic",t.setMaterial(this,e.renderer),t.build(this.fragment,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters,this.transparent=t.requires.transparent||this.blending>qa,this}dispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}getHash(){let e="{";return e+='"fragment":'+this.fragment.getHash(),e+="}",e}};Object.defineProperties(Ol.prototype,{properties:{get:function(){return this.fragment.properties}},needsUpdate:{set:function(e){e===!0&&this.version++,this.needsCompile=e},get:function(){return this.needsCompile}}});var t7=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

vec2 vogelDiskSample(int sample_index, int sample_count, float angle)
{
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sample_index) + 0.5f) / sqrt(float(sample_count));
  float theta = float(sample_index) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// NOTE: For now we aren't using this screen-space noise. But we should enable
// it again once we do some sort of temporal AA. Then we could potentially lower
// the number of samples needed and still get a pretty smooth result.
// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos)
{
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, ${5} - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

vec4 shadowmod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}
vec4 shadowperm(vec4 x){return shadowmod289(((x * 34.0) + 1.0) * x);}
float shadowNoise(vec3 p){
            vec3 a = floor(p);
            vec3 d = p - a;
            d = d * d * (3.0 - 2.0 * d);
            vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
            vec4 k1 = shadowperm(b.xyxy);
            vec4 k2 = shadowperm(k1.xyxy + b.zzww);
            vec4 c = k2 + a.zzzz;
            vec4 k3 = shadowperm(c);
            vec4 k4 = shadowperm(c + 1.0);
            vec4 o1 = fract(k3 * (1.0 / 41.0));
            vec4 o2 = fract(k4 * (1.0 / 41.0));
            vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
            vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
            return o4.y * d.y + o4.x * (1.0 - d.y);
        }

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;
    float temporalOffset = shadowNoise(floor(vWPosition * 10.));

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    //float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        float temporalOffset = shadowNoise(floor(vWPosition * 10.));
        float temporalAngle  = temporalOffset * PI2;


        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,i7=ot.lights_fragment_begin,r7=ot.shadowmask_pars_fragment,kw=!1,n7=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},s7=(e="medium")=>{if(kw)return;kw=!0;let t=n7(e);ot.shadowmap_pars_fragment=t7(t);let i=i7.slice();i=i.replace("getShadow( spotShadowMap[ i ]",`getShadow( UNROLLED_LOOP_INDEX + ${3}, spotShadowMap[ i ]`),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),ot.lights_fragment_begin=i;let r=r7.slice();r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),ot.shadowmask_pars_fragment=r},a7=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;

void main()
{
vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
}
`,o7=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,um=new ci({vertexShader:a7,fragmentShader:o7,uniforms:{depthContrast:{value:1}}});function l7(e){var s,a;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position)return;let t=new Map,i=e.geometry.attributes.position.array,r=e.geometry.attributes.normal.array,n=new Float32Array(i.length);for(let o=0;o<i.length;o+=3){let l=`${i[o]}_${i[o+1]}_${i[o+2]}`,h=new M(r[o],r[o+1],r[o+2]);t.has(l)?(s=t.get(l))==null||s.normals.push(h):t.set(l,{normals:[h],result:new M})}t.forEach((o,l)=>{for(let h of o.normals)o.result.add(h);o.result.divideScalar(o.normals.length)});for(let o=0;o<i.length;o+=3){let l=`${i[o]}_${i[o+1]}_${i[o+2]}`,h=(a=t.get(l))==null?void 0:a.result;h&&(n[o]=h.x,n[o+1]=h.y,n[o+2]=h.z)}e.geometry.setAttribute("extrudeNormal",new Be(n,3))}function h7(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new M;for(let n=0;n<t.length;n+=3)r.set(t[n],t[n+1],t[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;e.geometry.setAttribute("extrudeNormal",new Be(i,3))}function Ru(e){var t,i;if(Array.isArray(e.material)){for(let r of e.material)if(r.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof Ol)||e.material.getLayersOfType("outline").length===0)return;e.objectType==="Mesh2D"||e.objectType==="TextFrame"&&((i=(t=e.data)==null?void 0:t.geometry)==null?void 0:i.depth)===0?h7(e):l7(e)}function Iu(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),n=[lt.seededRandom(r),lt.seededRandom(r+1e4),lt.seededRandom(r+2e4)];for(let s=0;s<t.length;s++)i[s]=n[s%3];e.geometry.setAttribute("randomColor",new at(i,3))}var Qi=class extends Zl(Gi){constructor(e,t){super(e,t),this.isAbstractMesh=!0,this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new Fe,this.booleanExclude=null,Array.isArray(t)&&e.groups.length===0&&e.addGroup(0,e.getAttribute("position").count,0)}get isGroup(){var e;return((e=this._cloner)==null?void 0:e.parameters.hideBase)===!0}get isMesh(){return!this.isGroup}set isMesh(e){}get cloner(){return this._cloner}set cloner(e){this._cloner&&this.remove(this._cloner),e&&this.add(e),this._cloner=e}updateGeometry(e,t){let i=this.geometry,r=eT[i.userData.type],n=this.objectType==="NonParametric"?Object.assign({},i.userData,{geometry:i}):i.userData,s=r.build(r.normalizeInputs(e,n)),a=i.uuid;this.geometry.dispose(),this.geometry=s,this.geometry.uuid=a,this.geometry.computeBoundingSphere(),Ru(this),i.getAttribute("randomColor")&&Iu(this)}clone(e){let t=this.objectType==="NonParametric"?Object.assign({},this.geometry.userData,{geometry:this.geometry.clone()}):this.geometry.userData,i=rv(t),r=this.material;return new this.constructor(i,r).copy(this,e)}copy(e,t=!0){return super.copy(e,t),e.cloner&&(this.cloner=new ow(e,e.cloner.parameters),this.add(this.cloner)),this}setFromClonerState(e){e===null?this.cloner=void 0:(this.cloner===void 0&&(this.cloner=new ow(this)),this.cloner.fromClonerState(e))}fromState(e,t){var i,r,n;return super.fromState(e),e.type==="Mesh"&&(this.setFromClonerState(e.cloner),this.castShadow=(i=e.castShadow)!=null?i:!0,this.receiveShadow=(r=e.receiveShadow)!=null?r:!0,this.booleanExclude=(n=e.booleanExclude)!=null?n:null),this}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(Vs.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),Xi(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)xi(e)&&(e.freeBooleanPointer(),Xi(e)&&e.invalidateUpstreamBooleanData())}},u7=new M(0,0,1),Uw=new M,Fw=new M,zw=new Ri,UT=class extends Qi{constructor(e=ws.create({}),t){var i;super(e,t),this.recursiveSelection=!1,this.objectType="VectorObject",this.eventDispatcher=new Bi,this._onShapeUpdate=()=>{this.updateGeometry({}),this.geometry.computeBoundingSphere(),this.geometry.computeBoundingBox()},this.castShadow=!0,this.receiveShadow=!0,this.forceComputeSize=!0,this.shape=e.userData.shape,(i=this.shape.eventDispatcher)==null||i.addEventListener("update",this._onShapeUpdate)}fromState(e){return super.fromState(e),this.shape.update(),this}setHelperVisibility(){}updateGeometry(e,t){if(super.updateGeometry(e,t),"userData"in this.geometry){let i=this.geometry.userData.parameters;this.eventDispatcher.dispatchEvent({type:"geometryUpdate",parameters:i})}}setShape(e){var t,i;this.shape&&((t=this.shape.eventDispatcher)==null||t.removeEventListener("update",this._onShapeUpdate)),this.shape=e,(i=this.shape.eventDispatcher)==null||i.addEventListener("update",this._onShapeUpdate)}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),zw.getNormalMatrix(this.matrixWorld),Uw.copy(u7).applyMatrix3(zw).normalize(),Fw.setFromMatrixPosition(this.matrixWorld),this.shape.plane.setFromNormalAndCoplanarPoint(Uw,Fw)}clone(e){let t=this.shape.clone(),i=this.material,r=this.geometry.userData,n=ws.create(Object.assign({},r,{shape:t})),s=new UT(n,i).copy(this,e);return s.shape=t,t.update(),s}raycast(e,t){Qi.prototype.raycast.call(this,e,t)}},Bu=(e,t)=>class extends e{constructor(){super(...arguments),this.objectHelper=new t(this)}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}fromLightState(i,r){if(this.objectType==="LightDirectional"||this.objectType==="LightPoint"||this.objectType==="LightSpot"){let n=this;i.color!==void 0&&(n.color=$i(i.color,r)),i.intensity!==void 0&&(n.intensity=i.intensity),i.depth!==void 0&&(n.shadow.camera.far=i.depth,n.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}return this}},Fo=new M,cm=new M,da=class extends Bu(Zl(zl),q8){constructor(e=window.innerWidth,t=window.innerHeight,i=45,r,n=1e5){super(),this.objectType="CombinedCamera",this._cameraType="OrthographicCamera",this.targetOffset=ou.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.width=e,this.height=t,this.orthoCamera=new e0(e*-.5,e*.5,t*.5,t*-.5,r!=null?r:-5e4,n),this.perspCamera=new Oi(i,e/t,r!=null?r:50,n),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.fov=this.perspCamera.fov,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.toOrthographic()}static createFromState(e,t){let i=new da().fromState(t);return i.objectHelper.update(),i.uuid=e,i}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e){super.lookAt(e),this.getWorldPosition(Fo),this.targetOffset=Fo.distanceTo(e)}getTarget(e=new M){return this.getWorldDirection(cm),this.getWorldPosition(Fo),cm.multiplyScalar(this.targetOffset),e.copy(Fo).add(cm),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(Fo),Fo.distanceTo(e)}updateUp(){let e=this.getWorldQuaternion(new Lt),t=new M(0,0,1).applyQuaternion(e),i=new M().copy(Ut.DefaultUp);this.isUpVectorFlipped&&i.negate(),i.applyQuaternion(e);let r=new M().copy(Ut.DefaultUp).projectOnPlane(t),n=new M().crossVectors(r,i).dot(t)>=0?1:-1;this.angleOffsetFromUp=r.angleTo(i)*n}getViewFrontToObject(e){let t=e.getWorldPosition(new M),i=e.getWorldDirection(new M).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToObject(e){let t=e.getWorldPosition(new M),i=this.getWorldDirection(new M).multiplyScalar(this.targetOffset);return{position:t.clone().sub(i),target:t}}setViewplaneSize(e,t){this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5,this.aspect=e/t,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,n,s):this.orthoCamera.setViewOffset(e,t,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return Eg(t,e)}fromCameraState(e){let{orthographic:t,perspective:i}=e;return e.type!==void 0&&(this.cameraType=e.type),e.far!==void 0&&(this.far=e.far),t!==void 0&&(t.near!==void 0&&(this.orthoCamera.near=t.near),t.zoom!==void 0&&(this.orthoCamera.zoom=t.zoom)),i!==void 0&&(i.near!==void 0&&(this.perspCamera.near=i.near),i.fov!==void 0&&(this.perspCamera.fov=i.fov),i.zoom!==void 0&&(this.perspCamera.zoom=i.zoom)),e.type==="PerspectiveCamera"?(this.zoom=this.perspCamera.zoom,this.fov=this.perspCamera.fov,this.near=this.perspCamera.near):(this.near=this.orthoCamera.near,this.zoom=this.orthoCamera.zoom),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix(),this}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}fromState(e){return super.fromState(e),this.fromCameraState(e),this}},Gw=new Fe;function Hw(e){let t=!1;return e.scene.objects.traverse((i,r)=>{var n;((n=r.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(t=!0)}),t}var c7=class extends Qi{constructor(e=new it,t){super(e,t),this.booleanOp=2,this.phongAngle=35,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.objectType="BooleanObject",this.castShadow=!0,this.receiveShadow=!0,this.geometry.userData.parameters={width:0,height:0,depth:0},this.onAfterRender=this.recomputeBoolean.bind(this)}reInit(){this.objectType="BooleanObject",this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry.userData.parameters={width:0,height:0,depth:0},this.onAfterRender=this.recomputeBoolean.bind(this)}recomputeBoolean(e,t=!0){var r,n;if(this.booleanMeshSetAddress!==-1)return;for(let s=0;s<this.children.length;s++){let a=this.children[s];Xi(a)&&a.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let s=0;s<this.children.length;s++){let a=this.children[s];if(x9(a)&&a.booleanExclude===!1&&((r=a.geometry.attributes.position)==null?void 0:r.count)>0&&a.geometry.drawRange.count>0){if(a.booleanMeshSetAddress===-1){if(((n=a.geometry.index)!=null?n:a.geometry.getAttribute("position")).count/3<15e5&&(a.booleanMeshSetAddress=Vs.getMeshSet(a.geometry,e===!0,t)),a.booleanMeshSetAddress===-1)return;Vs.transformMeshSet(a.booleanMeshSetAddress,a.matrix),a.booleanMatrixInvOld.copy(a.matrix).invert(),a.booleanWasTransformed=!1}else Xi(a)&&a.needsTransformForDownstream===!0?(Vs.transformMeshSet(a.booleanMeshSetAddress,a.matrix),a.needsTransformForDownstream=!1):a.booleanWasTransformed===!0&&(Gw.multiplyMatrices(a.matrix,a.booleanMatrixInvOld),Vs.transformMeshSet(a.booleanMeshSetAddress,Gw),a.booleanMatrixInvOld.copy(a.matrix).invert(),a.booleanWasTransformed=!1);this.meshSetAddresses.push(a.booleanMeshSetAddress)}}if(this.meshSetAddresses.length===0){this.geometry.setDrawRange(0,0);return}if(e===!0)return Vs.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new it,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=Vs.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(s){this.booleanMeshSetAddress=0,console.error(s)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,Ru(this),Iu(this)}updateGeometry(e,t){let i=e.parameters;i.operation!==void 0&&(this.booleanOp=i.operation),i.phongAngle!==void 0&&(this.phongAngle=i.phongAngle),this.invalidateDownstreamBooleanData().recomputeBoolean()}},ov=class extends Bu(Zl(Ch),D2){constructor(){super(...arguments),this.objectType="EmptyObject"}static createFromState(e,t){let i=new ov().fromState(t);return i.uuid=e,i.objectHelper.update(),i}},FT=class extends Bu(Zl(TU),C2){constructor(...e){super(...e),this.objectType="LightDirectional",this._gizmos={},this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let t=this.shadow.camera;t.top=1250,t.bottom=-1250,t.right=1250,t.left=-1250,t.near=-1e4,t.far=2500;let i=new Xs(this.shadow.camera);i.visible=!1,this._gizmos.shadowmap=i,this.update()}static createFromState(e,t,i){let r=new FT().fromState(t,i);return r.uuid=e,r}get gizmos(){return this._gizmos}showGizmos(){for(let e in this._gizmos){let t=this._gizmos[e];t instanceof Xs&&(t.visible=!0)}}hideGizmos(){for(let e in this._gizmos){let t=this._gizmos[e];t instanceof Xs&&(t.visible=!1)}}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this._gizmos){let t=this._gizmos[e];t instanceof Xs&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}fromDirectionalLightState(e,t){let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;return super.fromLightState(e,t),e.size!==void 0&&m9(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),i&&this.update(),this}fromState(e,t){return super.fromState(e),this.fromDirectionalLightState(e,t),this}},zT=class extends Bu(Zl(AU),P2){constructor(...e){super(...e),this.objectType="LightPoint",this._gizmos={},this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let t=this.shadow.camera;t.fov=90,t.aspect=1,t.near=100,t.far=2500;let i=new M(-t.far+this.position.x,-t.far+this.position.y,-t.far+this.position.z),r=new M(t.far+this.position.x,t.far+this.position.y,t.far+this.position.z),n=new fi(i,r),s=new Ac(n,new Ze(16755200));s.visible=!1,this._gizmos.shadowmap=s,this.update()}static createFromState(e,t,i){let r=new zT().fromState(t,i);return r.uuid=e,r}get gizmos(){return this._gizmos}showGizmos(){for(let e in this._gizmos){let t=this._gizmos[e];t instanceof Ac&&(t.visible=!0)}}hideGizmos(){for(let e in this._gizmos){let t=this._gizmos[e];t instanceof Ac&&(t.visible=!1)}}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this._gizmos))for(let e in this._gizmos){let t=this._gizmos[e];if(t instanceof Ac){let i=this.shadow.camera,r=new M(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new M(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}fromPointLightState(e,t){return super.fromLightState(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),this}fromState(e,t){return super.fromState(e),this.fromPointLightState(e,t),this}},Vw=new M,jw=new M,Ww=new Lt,GT=class extends Bu(Zl(_U),L2){constructor(...e){super(...e),this.objectType="LightSpot",this._gizmos={},this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let t=this.shadow.camera;t.fov=lt.RAD2DEG*2*this.angle,t.aspect=1,t.near=100,t.far=2500;let i=new Xs(this.shadow.camera);i.visible=!1,this._gizmos.shadowmap=i,this.update()}static createFromState(e,t,i){let r=new GT().fromState(t,i);return r.uuid=e,r}get gizmos(){return this._gizmos}showGizmos(){for(let e in this._gizmos){let t=this._gizmos[e];t instanceof Xs&&(t.visible=!0)}}hideGizmos(){for(let e in this._gizmos){let t=this._gizmos[e];t instanceof Xs&&(t.visible=!1)}}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this._gizmos){let t=this._gizmos[e];t instanceof Xs&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),jw.setFromMatrixPosition(this.matrixWorld),Ww.setFromRotationMatrix(this.matrixWorld),Vw.copy(this.up).applyQuaternion(Ww).negate().multiplyScalar(this.distance),this.target.position.copy(jw).add(Vw),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}fromSpotLightState(e,t){return super.fromLightState(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),this}fromState(e,t){return super.fromState(e),this.fromSpotLightState(e,t),this}},qw=e=>e.tagName==="VIDEO",HT=class{static resize(e,t,i){let r=e/t,n;if(!i.image)return;let s=i.image;qw(s)?n=s.videoWidth/s.videoHeight:n=s.width/s.height,r>n&&(i.imageType=="WEBCAM"?i.repeat.set(-1,1*n/r):i.repeat.set(1,1*n/r)),r<n&&(i.imageType=="WEBCAM"?i.repeat.set(1*r/n*-1,1):i.repeat.set(1*r/n,1)),r==n&&(i.imageType=="WEBCAM"?i.repeat.set(-1,1):i.repeat.set(1,1))}static resizeTextureLayer(e,t,i){let r=e/t,n=i.image!==void 0?i.image.width/i.image.height:1,s;r>n?s={x:1,y:n/r}:r<n?s={x:r/n,y:1}:s={x:1,y:1},i.repeat.set(s.x,s.y),i.updateMatrix()}static resizeTextureLayers(e,t,i){let r=i.layers;for(let n=0;n<r.length;n++){let s=r[n];J9(s)&&HT.resizeTextureLayer(e,t,s.uniforms[`f${s.id}_texture`].value)}}static resizeComplex(e,t,i,r){let n=e/t,s,a=i.image;qw(a)?s=a.videoWidth/a.videoHeight:s=a.width/a.height,r.geometry.type.includes("Shape")?(n>s&&(i.imageType=="WEBCAM"?i.repeat.set(1/e*-1,1/t*s/n):i.repeat.set(1/e,1/t*s/n)),n<s&&(i.imageType=="WEBCAM"?i.repeat.set(1/e*n/s*-1,1/t):i.repeat.set(1/e*n/s,1/t)),n==s&&(i.imageType=="WEBCAM"?i.repeat.set(1/e*-1,1/t):i.repeat.set(1/e,1/t))):(n>s&&(i.imageType=="WEBCAM"?i.repeat.set(-1,1*s/n):i.repeat.set(1,1*s/n)),n<s&&(i.imageType=="WEBCAM"?i.repeat.set(1*n/s*-1,1):i.repeat.set(1*n/s,1)),n==s&&(i.imageType=="WEBCAM"?i.repeat.set(-1,1):i.repeat.set(1,1)))}},d7=class extends Qi{constructor(e,t){super(e,t),this.objectType="Mesh2D",this.castShadow=!0,this.receiveShadow=!0}updateGeometry(e,t){super.updateGeometry(e,t),this.material.layers&&HT.resizeTextureLayers(this.geometry.userData.parameters.width,this.geometry.userData.parameters.height,this.material)}},VT=class extends Qi{constructor(e,t){super(e,t),this.objectType="Mesh3D",this.castShadow=!0,this.receiveShadow=!0}},p7=class extends VT{constructor(e,t){super(e,t),this.objectType="NonParametric"}};String.prototype.codePointAt||function(){var e=function(){try{var i={},r=Object.defineProperty,n=r(i,i,i)&&r}catch{}return n}(),t=function(i){if(this==null)throw TypeError();var r=String(this),n=r.length,s=i?Number(i):0;if(s!=s&&(s=0),!(s<0||s>=n)){var a=r.charCodeAt(s),o;return a>=55296&&a<=56319&&n>s+1&&(o=r.charCodeAt(s+1),o>=56320&&o<=57343)?(a-55296)*1024+o-56320+65536:a}};e?e(String.prototype,"codePointAt",{value:t,configurable:!0,writable:!0}):String.prototype.codePointAt=t}();var j0=0,jT=-3;function pu(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function f7(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new pu,this.dtree=new pu}var WT=new pu,qT=new pu,W0=new Uint8Array(30),q0=new Uint16Array(30),YT=new Uint8Array(30),XT=new Uint16Array(30),m7=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yw=new pu,bn=new Uint8Array(288+32);function QT(e,t,i,r){var n,s;for(n=0;n<i;++n)e[n]=0;for(n=0;n<30-i;++n)e[n+i]=n/i|0;for(s=r,n=0;n<30;++n)t[n]=s,s+=1<<e[n]}function g7(e,t){var i;for(i=0;i<7;++i)e.table[i]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,i=0;i<24;++i)e.trans[i]=256+i;for(i=0;i<144;++i)e.trans[24+i]=i;for(i=0;i<8;++i)e.trans[24+144+i]=280+i;for(i=0;i<112;++i)e.trans[24+144+8+i]=144+i;for(i=0;i<5;++i)t.table[i]=0;for(t.table[5]=32,i=0;i<32;++i)t.trans[i]=i}var Xw=new Uint16Array(16);function dm(e,t,i,r){var n,s;for(n=0;n<16;++n)e.table[n]=0;for(n=0;n<r;++n)e.table[t[i+n]]++;for(e.table[0]=0,s=0,n=0;n<16;++n)Xw[n]=s,s+=e.table[n];for(n=0;n<r;++n)t[i+n]&&(e.trans[Xw[t[i+n]]++]=n)}function v7(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=e.tag&1;return e.tag>>>=1,t}function Sn(e,t,i){if(!t)return i;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,r+i}function lv(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var i=0,r=0,n=0,s=e.tag;do r=2*r+(s&1),s>>>=1,++n,i+=t.table[n],r-=t.table[n];while(r>=0);return e.tag=s,e.bitcount-=n,t.trans[i+r]}function y7(e,t,i){var r,n,s,a,o,l;for(r=Sn(e,5,257),n=Sn(e,5,1),s=Sn(e,4,4),a=0;a<19;++a)bn[a]=0;for(a=0;a<s;++a){var h=Sn(e,3,0);bn[m7[a]]=h}for(dm(Yw,bn,0,19),o=0;o<r+n;){var c=lv(e,Yw);switch(c){case 16:var u=bn[o-1];for(l=Sn(e,2,3);l;--l)bn[o++]=u;break;case 17:for(l=Sn(e,3,3);l;--l)bn[o++]=0;break;case 18:for(l=Sn(e,7,11);l;--l)bn[o++]=0;break;default:bn[o++]=c;break}}dm(t,bn,0,r),dm(i,bn,r,n)}function Qw(e,t,i){for(;;){var r=lv(e,t);if(r===256)return j0;if(r<256)e.dest[e.destLen++]=r;else{var n,s,a,o;for(r-=257,n=Sn(e,W0[r],q0[r]),s=lv(e,i),a=e.destLen-Sn(e,YT[s],XT[s]),o=a;o<a+n;++o)e.dest[e.destLen++]=e.dest[o]}}}function x7(e){for(var t,i,r;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if(t=e.source[e.sourceIndex+1],t=256*t+e.source[e.sourceIndex],i=e.source[e.sourceIndex+3],i=256*i+e.source[e.sourceIndex+2],t!==(~i&65535))return jT;for(e.sourceIndex+=4,r=t;r;--r)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,j0}function b7(e,t){var i=new f7(e,t),r,n,s;do{switch(r=v7(i),n=Sn(i,2,0),n){case 0:s=x7(i);break;case 1:s=Qw(i,WT,qT);break;case 2:y7(i,i.ltree,i.dtree),s=Qw(i,i.ltree,i.dtree);break;default:s=jT}if(s!==j0)throw new Error("Data error")}while(!r);return i.destLen<i.dest.length?typeof i.dest.slice=="function"?i.dest.slice(0,i.destLen):i.dest.subarray(0,i.destLen):i.dest}g7(WT,qT);QT(W0,q0,4,3);QT(YT,XT,2,1);W0[28]=0;q0[28]=258;var w7=b7;function zo(e,t,i,r,n){return Math.pow(1-n,3)*e+3*Math.pow(1-n,2)*n*t+3*(1-n)*Math.pow(n,2)*i+Math.pow(n,3)*r}function wa(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}wa.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};wa.prototype.addPoint=function(e,t){typeof e=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),typeof t=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))};wa.prototype.addX=function(e){this.addPoint(e,null)};wa.prototype.addY=function(e){this.addPoint(null,e)};wa.prototype.addBezier=function(e,t,i,r,n,s,a,o){var l=[e,t],h=[i,r],c=[n,s],u=[a,o];this.addPoint(e,t),this.addPoint(a,o);for(var d=0;d<=1;d++){var p=6*l[d]-12*h[d]+6*c[d],m=-3*l[d]+9*h[d]-9*c[d]+3*u[d],g=3*h[d]-3*l[d];if(m===0){if(p===0)continue;var f=-g/p;0<f&&f<1&&(d===0&&this.addX(zo(l[d],h[d],c[d],u[d],f)),d===1&&this.addY(zo(l[d],h[d],c[d],u[d],f)));continue}var v=Math.pow(p,2)-4*g*m;if(!(v<0)){var y=(-p+Math.sqrt(v))/(2*m);0<y&&y<1&&(d===0&&this.addX(zo(l[d],h[d],c[d],u[d],y)),d===1&&this.addY(zo(l[d],h[d],c[d],u[d],y)));var x=(-p-Math.sqrt(v))/(2*m);0<x&&x<1&&(d===0&&this.addX(zo(l[d],h[d],c[d],u[d],x)),d===1&&this.addY(zo(l[d],h[d],c[d],u[d],x)))}}};wa.prototype.addQuad=function(e,t,i,r,n,s){var a=e+.6666666666666666*(i-e),o=t+2/3*(r-t),l=a+1/3*(n-e),h=o+1/3*(s-t);this.addBezier(e,t,a,o,l,h,n,s)};function di(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}di.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})};di.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})};di.prototype.curveTo=di.prototype.bezierCurveTo=function(e,t,i,r,n,s){this.commands.push({type:"C",x1:e,y1:t,x2:i,y2:r,x:n,y:s})};di.prototype.quadTo=di.prototype.quadraticCurveTo=function(e,t,i,r){this.commands.push({type:"Q",x1:e,y1:t,x:i,y:r})};di.prototype.close=di.prototype.closePath=function(){this.commands.push({type:"Z"})};di.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof wa){var t=e;this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),this.close();return}Array.prototype.push.apply(this.commands,e)};di.prototype.getBoundingBox=function(){for(var e=new wa,t=0,i=0,r=0,n=0,s=0;s<this.commands.length;s++){var a=this.commands[s];switch(a.type){case"M":e.addPoint(a.x,a.y),t=r=a.x,i=n=a.y;break;case"L":e.addPoint(a.x,a.y),r=a.x,n=a.y;break;case"Q":e.addQuad(r,n,a.x1,a.y1,a.x,a.y),r=a.x,n=a.y;break;case"C":e.addBezier(r,n,a.x1,a.y1,a.x2,a.y2,a.x,a.y),r=a.x,n=a.y;break;case"Z":r=t,n=i;break;default:throw new Error("Unexpected path command "+a.type)}}return e.isEmpty()&&e.addPoint(0,0),e};di.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var i=this.commands[t];i.type==="M"?e.moveTo(i.x,i.y):i.type==="L"?e.lineTo(i.x,i.y):i.type==="C"?e.bezierCurveTo(i.x1,i.y1,i.x2,i.y2,i.x,i.y):i.type==="Q"?e.quadraticCurveTo(i.x1,i.y1,i.x,i.y):i.type==="Z"&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())};di.prototype.toPathData=function(e){e=e!==void 0?e:2;function t(a){return Math.round(a)===a?""+Math.round(a):a.toFixed(e)}function i(){for(var a=arguments,o="",l=0;l<arguments.length;l+=1){var h=a[l];h>=0&&l>0&&(o+=" "),o+=t(h)}return o}for(var r="",n=0;n<this.commands.length;n+=1){var s=this.commands[n];s.type==="M"?r+="M"+i(s.x,s.y):s.type==="L"?r+="L"+i(s.x,s.y):s.type==="C"?r+="C"+i(s.x1,s.y1,s.x2,s.y2,s.x,s.y):s.type==="Q"?r+="Q"+i(s.x1,s.y1,s.x,s.y):s.type==="Z"&&(r+="Z")}return r};di.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&this.fill!=="black"&&(this.fill===null?t+=' fill="none"':t+=' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>",t};di.prototype.toDOMElement=function(e){var t=this.toPathData(e),i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d",t),i};function KT(e){throw new Error(e)}function Kw(e,t){e||KT(t)}var tt={fail:KT,argument:Kw,assert:Kw},Zw=32768,Jw=2147483648,Rl={},De={},rt={};function un(e){return function(){return e}}De.BYTE=function(e){return tt.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]};rt.BYTE=un(1);De.CHAR=function(e){return[e.charCodeAt(0)]};rt.CHAR=un(1);De.CHARARRAY=function(e){typeof e>"u"&&(e="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var t=[],i=0;i<e.length;i+=1)t[i]=e.charCodeAt(i);return t};rt.CHARARRAY=function(e){return typeof e>"u"?0:e.length};De.USHORT=function(e){return[e>>8&255,e&255]};rt.USHORT=un(2);De.SHORT=function(e){return e>=Zw&&(e=-(2*Zw-e)),[e>>8&255,e&255]};rt.SHORT=un(2);De.UINT24=function(e){return[e>>16&255,e>>8&255,e&255]};rt.UINT24=un(3);De.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,e&255]};rt.ULONG=un(4);De.LONG=function(e){return e>=Jw&&(e=-(2*Jw-e)),[e>>24&255,e>>16&255,e>>8&255,e&255]};rt.LONG=un(4);De.FIXED=De.ULONG;rt.FIXED=rt.ULONG;De.FWORD=De.SHORT;rt.FWORD=rt.SHORT;De.UFWORD=De.USHORT;rt.UFWORD=rt.USHORT;De.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,e&255]};rt.LONGDATETIME=un(8);De.TAG=function(e){return tt.argument(e.length===4,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]};rt.TAG=un(4);De.Card8=De.BYTE;rt.Card8=rt.BYTE;De.Card16=De.USHORT;rt.Card16=rt.USHORT;De.OffSize=De.BYTE;rt.OffSize=rt.BYTE;De.SID=De.USHORT;rt.SID=rt.USHORT;De.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?(e=e-108,[(e>>8)+247,e&255]):e>=-1131&&e<=-108?(e=-e-108,[(e>>8)+251,e&255]):e>=-32768&&e<=32767?De.NUMBER16(e):De.NUMBER32(e)};rt.NUMBER=function(e){return De.NUMBER(e).length};De.NUMBER16=function(e){return[28,e>>8&255,e&255]};rt.NUMBER16=un(3);De.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,e&255]};rt.NUMBER32=un(5);De.REAL=function(e){var t=e.toString(),i=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(i){var r=parseFloat("1e"+((i[2]?+i[2]:0)+i[1].length));t=(Math.round(e*r)/r).toString()}for(var n="",s=0,a=t.length;s<a;s+=1){var o=t[s];o==="e"?n+=t[++s]==="-"?"c":"b":o==="."?n+="a":o==="-"?n+="e":n+=o}n+=n.length&1?"f":"ff";for(var l=[30],h=0,c=n.length;h<c;h+=2)l.push(parseInt(n.substr(h,2),16));return l};rt.REAL=function(e){return De.REAL(e).length};De.NAME=De.CHARARRAY;rt.NAME=rt.CHARARRAY;De.STRING=De.CHARARRAY;rt.STRING=rt.CHARARRAY;Rl.UTF8=function(e,t,i){for(var r=[],n=i,s=0;s<n;s++,t+=1)r[s]=e.getUint8(t);return String.fromCharCode.apply(null,r)};Rl.UTF16=function(e,t,i){for(var r=[],n=i/2,s=0;s<n;s++,t+=2)r[s]=e.getUint16(t);return String.fromCharCode.apply(null,r)};De.UTF16=function(e){for(var t=[],i=0;i<e.length;i+=1){var r=e.charCodeAt(i);t[t.length]=r>>8&255,t[t.length]=r&255}return t};rt.UTF16=function(e){return e.length*2};var hv={"x-mac-croatian":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\u0160\u2122\xB4\xA8\u2260\u017D\xD8\u221E\xB1\u2264\u2265\u2206\xB5\u2202\u2211\u220F\u0161\u222B\xAA\xBA\u03A9\u017E\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u0106\xAB\u010C\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u0110\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\uF8FF\xA9\u2044\u20AC\u2039\u203A\xC6\xBB\u2013\xB7\u201A\u201E\u2030\xC2\u0107\xC1\u010D\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u0111\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u03C0\xCB\u02DA\xB8\xCA\xE6\u02C7","x-mac-cyrillic":"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u2020\xB0\u0490\xA3\xA7\u2022\xB6\u0406\xAE\xA9\u2122\u0402\u0452\u2260\u0403\u0453\u221E\xB1\u2264\u2265\u0456\xB5\u0491\u0408\u0404\u0454\u0407\u0457\u0409\u0459\u040A\u045A\u0458\u0405\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\u040B\u045B\u040C\u045C\u0455\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u201E\u040E\u045E\u040F\u045F\u2116\u0401\u0451\u044F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E","x-mac-gaelic":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u1E02\xB1\u2264\u2265\u1E03\u010A\u010B\u1E0A\u1E0B\u1E1E\u1E1F\u0120\u0121\u1E40\xE6\xF8\u1E41\u1E56\u1E57\u027C\u0192\u017F\u1E60\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\u1E61\u1E9B\xFF\u0178\u1E6A\u20AC\u2039\u203A\u0176\u0177\u1E6B\xB7\u1EF2\u1EF3\u204A\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\u2663\xD2\xDA\xDB\xD9\u0131\xDD\xFD\u0174\u0175\u1E84\u1E85\u1E80\u1E81\u1E82\u1E83","x-mac-greek":"\xC4\xB9\xB2\xC9\xB3\xD6\xDC\u0385\xE0\xE2\xE4\u0384\xA8\xE7\xE9\xE8\xEA\xEB\xA3\u2122\xEE\xEF\u2022\xBD\u2030\xF4\xF6\xA6\u20AC\xF9\xFB\xFC\u2020\u0393\u0394\u0398\u039B\u039E\u03A0\xDF\xAE\xA9\u03A3\u03AA\xA7\u2260\xB0\xB7\u0391\xB1\u2264\u2265\xA5\u0392\u0395\u0396\u0397\u0399\u039A\u039C\u03A6\u03AB\u03A8\u03A9\u03AC\u039D\xAC\u039F\u03A1\u2248\u03A4\xAB\xBB\u2026\xA0\u03A5\u03A7\u0386\u0388\u0153\u2013\u2015\u201C\u201D\u2018\u2019\xF7\u0389\u038A\u038C\u038E\u03AD\u03AE\u03AF\u03CC\u038F\u03CD\u03B1\u03B2\u03C8\u03B4\u03B5\u03C6\u03B3\u03B7\u03B9\u03BE\u03BA\u03BB\u03BC\u03BD\u03BF\u03C0\u03CE\u03C1\u03C3\u03C4\u03B8\u03C9\u03C2\u03C7\u03C5\u03B6\u03CA\u03CB\u0390\u03B0\xAD","x-mac-icelandic":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\xDD\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\xD0\xF0\xDE\xFE\xFD\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-inuit":"\u1403\u1404\u1405\u1406\u140A\u140B\u1431\u1432\u1433\u1434\u1438\u1439\u1449\u144E\u144F\u1450\u1451\u1455\u1456\u1466\u146D\u146E\u146F\u1470\u1472\u1473\u1483\u148B\u148C\u148D\u148E\u1490\u1491\xB0\u14A1\u14A5\u14A6\u2022\xB6\u14A7\xAE\xA9\u2122\u14A8\u14AA\u14AB\u14BB\u14C2\u14C3\u14C4\u14C5\u14C7\u14C8\u14D0\u14EF\u14F0\u14F1\u14F2\u14F4\u14F5\u1505\u14D5\u14D6\u14D7\u14D8\u14DA\u14DB\u14EA\u1528\u1529\u152A\u152B\u152D\u2026\xA0\u152E\u153E\u1555\u1556\u1557\u2013\u2014\u201C\u201D\u2018\u2019\u1558\u1559\u155A\u155D\u1546\u1547\u1548\u1549\u154B\u154C\u1550\u157F\u1580\u1581\u1582\u1583\u1584\u1585\u158F\u1590\u1591\u1592\u1593\u1594\u1595\u1671\u1672\u1673\u1674\u1675\u1676\u1596\u15A0\u15A1\u15A2\u15A3\u15A4\u15A5\u15A6\u157C\u0141\u0142","x-mac-ce":"\xC4\u0100\u0101\xC9\u0104\xD6\xDC\xE1\u0105\u010C\xE4\u010D\u0106\u0107\xE9\u0179\u017A\u010E\xED\u010F\u0112\u0113\u0116\xF3\u0117\xF4\xF6\xF5\xFA\u011A\u011B\xFC\u2020\xB0\u0118\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\u0119\xA8\u2260\u0123\u012E\u012F\u012A\u2264\u2265\u012B\u0136\u2202\u2211\u0142\u013B\u013C\u013D\u013E\u0139\u013A\u0145\u0146\u0143\xAC\u221A\u0144\u0147\u2206\xAB\xBB\u2026\xA0\u0148\u0150\xD5\u0151\u014C\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\u014D\u0154\u0155\u0158\u2039\u203A\u0159\u0156\u0157\u0160\u201A\u201E\u0161\u015A\u015B\xC1\u0164\u0165\xCD\u017D\u017E\u016A\xD3\xD4\u016B\u016E\xDA\u016F\u0170\u0171\u0172\u0173\xDD\xFD\u0137\u017B\u0141\u017C\u0122\u02C7",macintosh:"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\u2039\u203A\uFB01\uFB02\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-romanian":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\u0102\u0218\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\u0103\u0219\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u2044\u20AC\u2039\u203A\u021A\u021B\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\u0131\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7","x-mac-turkish":"\xC4\xC5\xC7\xC9\xD1\xD6\xDC\xE1\xE0\xE2\xE4\xE3\xE5\xE7\xE9\xE8\xEA\xEB\xED\xEC\xEE\xEF\xF1\xF3\xF2\xF4\xF6\xF5\xFA\xF9\xFB\xFC\u2020\xB0\xA2\xA3\xA7\u2022\xB6\xDF\xAE\xA9\u2122\xB4\xA8\u2260\xC6\xD8\u221E\xB1\u2264\u2265\xA5\xB5\u2202\u2211\u220F\u03C0\u222B\xAA\xBA\u03A9\xE6\xF8\xBF\xA1\xAC\u221A\u0192\u2248\u2206\xAB\xBB\u2026\xA0\xC0\xC3\xD5\u0152\u0153\u2013\u2014\u201C\u201D\u2018\u2019\xF7\u25CA\xFF\u0178\u011E\u011F\u0130\u0131\u015E\u015F\u2021\xB7\u201A\u201E\u2030\xC2\xCA\xC1\xCB\xC8\xCD\xCE\xCF\xCC\xD3\xD4\uF8FF\xD2\xDA\xDB\xD9\uF8A0\u02C6\u02DC\xAF\u02D8\u02D9\u02DA\xB8\u02DD\u02DB\u02C7"};Rl.MACSTRING=function(e,t,i,r){var n=hv[r];if(n!==void 0){for(var s="",a=0;a<i;a++){var o=e.getUint8(t+a);o<=127?s+=String.fromCharCode(o):s+=n[o&127]}return s}};var qc=typeof WeakMap=="function"&&new WeakMap,Yc,_7=function(e){if(!Yc){Yc={};for(var t in hv)Yc[t]=new String(t)}var i=Yc[e];if(i!==void 0){if(qc){var r=qc.get(i);if(r!==void 0)return r}var n=hv[e];if(n!==void 0){for(var s={},a=0;a<n.length;a++)s[n.charCodeAt(a)]=a+128;return qc&&qc.set(i,s),s}}};De.MACSTRING=function(e,t){var i=_7(t);if(i!==void 0){for(var r=[],n=0;n<e.length;n++){var s=e.charCodeAt(n);if(s>=128&&(s=i[s],s===void 0))return;r[n]=s}return r}};rt.MACSTRING=function(e,t){var i=De.MACSTRING(e,t);return i!==void 0?i.length:0};function uv(e){return e>=-128&&e<=127}function S7(e,t,i){for(var r=0,n=e.length;t<n&&r<64&&e[t]===0;)++t,++r;return i.push(128|r-1),t}function A7(e,t,i){for(var r=0,n=e.length,s=t;s<n&&r<64;){var a=e[s];if(!uv(a)||a===0&&s+1<n&&e[s+1]===0)break;++s,++r}i.push(r-1);for(var o=t;o<s;++o)i.push(e[o]+256&255);return s}function E7(e,t,i){for(var r=0,n=e.length,s=t;s<n&&r<64;){var a=e[s];if(a===0||uv(a)&&s+1<n&&uv(e[s+1]))break;++s,++r}i.push(64|r-1);for(var o=t;o<s;++o){var l=e[o];i.push(l+65536>>8&255,l+256&255)}return s}De.VARDELTAS=function(e){for(var t=0,i=[];t<e.length;){var r=e[t];r===0?t=S7(e,t,i):r>=-128&&r<=127?t=A7(e,t,i):t=E7(e,t,i)}return i};De.INDEX=function(e){for(var t=1,i=[t],r=[],n=0;n<e.length;n+=1){var s=De.OBJECT(e[n]);Array.prototype.push.apply(r,s),t+=s.length,i.push(t)}if(r.length===0)return[0,0];for(var a=[],o=1+Math.floor(Math.log(t)/Math.log(2))/8|0,l=[void 0,De.BYTE,De.USHORT,De.UINT24,De.ULONG][o],h=0;h<i.length;h+=1){var c=l(i[h]);Array.prototype.push.apply(a,c)}return Array.prototype.concat(De.Card16(e.length),De.OffSize(o),a,r)};rt.INDEX=function(e){return De.INDEX(e).length};De.DICT=function(e){for(var t=[],i=Object.keys(e),r=i.length,n=0;n<r;n+=1){var s=parseInt(i[n],0),a=e[s];t=t.concat(De.OPERAND(a.value,a.type)),t=t.concat(De.OPERATOR(s))}return t};rt.DICT=function(e){return De.DICT(e).length};De.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]};De.OPERAND=function(e,t){var i=[];if(Array.isArray(t))for(var r=0;r<t.length;r+=1)tt.argument(e.length===t.length,"Not enough arguments given for type"+t),i=i.concat(De.OPERAND(e[r],t[r]));else if(t==="SID")i=i.concat(De.NUMBER(e));else if(t==="offset")i=i.concat(De.NUMBER32(e));else if(t==="number")i=i.concat(De.NUMBER(e));else if(t==="real")i=i.concat(De.REAL(e));else throw new Error("Unknown operand type "+t);return i};De.OP=De.BYTE;rt.OP=rt.BYTE;var Xc=typeof WeakMap=="function"&&new WeakMap;De.CHARSTRING=function(e){if(Xc){var t=Xc.get(e);if(t!==void 0)return t}for(var i=[],r=e.length,n=0;n<r;n+=1){var s=e[n];i=i.concat(De[s.type](s.value))}return Xc&&Xc.set(e,i),i};rt.CHARSTRING=function(e){return De.CHARSTRING(e).length};De.OBJECT=function(e){var t=De[e.type];return tt.argument(t!==void 0,"No encoding function for type "+e.type),t(e.value)};rt.OBJECT=function(e){var t=rt[e.type];return tt.argument(t!==void 0,"No sizeOf function for type "+e.type),t(e.value)};De.TABLE=function(e){for(var t=[],i=e.fields.length,r=[],n=[],s=0;s<i;s+=1){var a=e.fields[s],o=De[a.type];tt.argument(o!==void 0,"No encoding function for field type "+a.type+" ("+a.name+")");var l=e[a.name];l===void 0&&(l=a.value);var h=o(l);a.type==="TABLE"?(n.push(t.length),t=t.concat([0,0]),r.push(h)):t=t.concat(h)}for(var c=0;c<r.length;c+=1){var u=n[c],d=t.length;tt.argument(d<65536,"Table "+e.tableName+" too big."),t[u]=d>>8,t[u+1]=d&255,t=t.concat(r[c])}return t};rt.TABLE=function(e){for(var t=0,i=e.fields.length,r=0;r<i;r+=1){var n=e.fields[r],s=rt[n.type];tt.argument(s!==void 0,"No sizeOf function for field type "+n.type+" ("+n.name+")");var a=e[n.name];a===void 0&&(a=n.value),t+=s(a),n.type==="TABLE"&&(t+=2)}return t};De.RECORD=De.TABLE;rt.RECORD=rt.TABLE;De.LITERAL=function(e){return e};rt.LITERAL=function(e){return e.length};function bi(e,t,i){if(t.length&&(t[0].name!=="coverageFormat"||t[0].value===1))for(var r=0;r<t.length;r+=1){var n=t[r];this[n.name]=n.value}if(this.tableName=e,this.fields=t,i)for(var s=Object.keys(i),a=0;a<s.length;a+=1){var o=s[a],l=i[o];this[o]!==void 0&&(this[o]=l)}}bi.prototype.encode=function(){return De.TABLE(this)};bi.prototype.sizeOf=function(){return rt.TABLE(this)};function fu(e,t,i){i===void 0&&(i=t.length);var r=new Array(t.length+1);r[0]={name:e+"Count",type:"USHORT",value:i};for(var n=0;n<t.length;n++)r[n+1]={name:e+n,type:"USHORT",value:t[n]};return r}function cv(e,t,i){var r=t.length,n=new Array(r+1);n[0]={name:e+"Count",type:"USHORT",value:r};for(var s=0;s<r;s++)n[s+1]={name:e+s,type:"TABLE",value:i(t[s],s)};return n}function mu(e,t,i){var r=t.length,n=[];n[0]={name:e+"Count",type:"USHORT",value:r};for(var s=0;s<r;s++)n=n.concat(i(t[s],s));return n}function qd(e){e.format===1?bi.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(fu("glyph",e.glyphs))):e.format===2?bi.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(mu("rangeRecord",e.ranges,function(t){return[{name:"startGlyphID",type:"USHORT",value:t.start},{name:"endGlyphID",type:"USHORT",value:t.end},{name:"startCoverageIndex",type:"USHORT",value:t.index}]}))):tt.assert(!1,"Coverage format must be 1 or 2.")}qd.prototype=Object.create(bi.prototype);qd.prototype.constructor=qd;function Yd(e){bi.call(this,"scriptListTable",mu("scriptRecord",e,function(t,i){var r=t.script,n=r.defaultLangSys;return tt.assert(!!n,"Unable to write GSUB: script "+t.tag+" has no default language system."),[{name:"scriptTag"+i,type:"TAG",value:t.tag},{name:"script"+i,type:"TABLE",value:new bi("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new bi("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:n.reqFeatureIndex}].concat(fu("featureIndex",n.featureIndexes)))}].concat(mu("langSys",r.langSysRecords,function(s,a){var o=s.langSys;return[{name:"langSysTag"+a,type:"TAG",value:s.tag},{name:"langSys"+a,type:"TABLE",value:new bi("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:o.reqFeatureIndex}].concat(fu("featureIndex",o.featureIndexes)))}]})))}]}))}Yd.prototype=Object.create(bi.prototype);Yd.prototype.constructor=Yd;function Xd(e){bi.call(this,"featureListTable",mu("featureRecord",e,function(t,i){var r=t.feature;return[{name:"featureTag"+i,type:"TAG",value:t.tag},{name:"feature"+i,type:"TABLE",value:new bi("featureTable",[{name:"featureParams",type:"USHORT",value:r.featureParams}].concat(fu("lookupListIndex",r.lookupListIndexes)))}]}))}Xd.prototype=Object.create(bi.prototype);Xd.prototype.constructor=Xd;function Qd(e,t){bi.call(this,"lookupListTable",cv("lookup",e,function(i){var r=t[i.lookupType];return tt.assert(!!r,"Unable to write GSUB lookup type "+i.lookupType+" tables."),new bi("lookupTable",[{name:"lookupType",type:"USHORT",value:i.lookupType},{name:"lookupFlag",type:"USHORT",value:i.lookupFlag}].concat(cv("subtable",i.subtables,r)))}))}Qd.prototype=Object.create(bi.prototype);Qd.prototype.constructor=Qd;var Oe={Table:bi,Record:bi,Coverage:qd,ScriptList:Yd,FeatureList:Xd,LookupList:Qd,ushortList:fu,tableList:cv,recordList:mu};function $w(e,t){return e.getUint8(t)}function Kd(e,t){return e.getUint16(t,!1)}function T7(e,t){return e.getInt16(t,!1)}function Y0(e,t){return e.getUint32(t,!1)}function ZT(e,t){var i=e.getInt16(t,!1),r=e.getUint16(t+2,!1);return i+r/65535}function M7(e,t){for(var i="",r=t;r<t+4;r+=1)i+=String.fromCharCode(e.getInt8(r));return i}function C7(e,t,i){for(var r=0,n=0;n<i;n+=1)r<<=8,r+=e.getUint8(t+n);return r}function D7(e,t,i){for(var r=[],n=t;n<i;n+=1)r.push(e.getUint8(n));return r}function P7(e){for(var t="",i=0;i<e.length;i+=1)t+=String.fromCharCode(e[i]);return t}var L7={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function te(e,t){this.data=e,this.offset=t,this.relativeOffset=0}te.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e};te.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e};te.prototype.parseCard8=te.prototype.parseByte;te.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e};te.prototype.parseCard16=te.prototype.parseUShort;te.prototype.parseSID=te.prototype.parseUShort;te.prototype.parseOffset16=te.prototype.parseUShort;te.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e};te.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e};te.prototype.parseULong=function(){var e=Y0(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e};te.prototype.parseOffset32=te.prototype.parseULong;te.prototype.parseFixed=function(){var e=ZT(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e};te.prototype.parseString=function(e){var t=this.data,i=this.offset+this.relativeOffset,r="";this.relativeOffset+=e;for(var n=0;n<e;n++)r+=String.fromCharCode(t.getUint8(i+n));return r};te.prototype.parseTag=function(){return this.parseString(4)};te.prototype.parseLongDateTime=function(){var e=Y0(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e};te.prototype.parseVersion=function(e){var t=Kd(this.data,this.offset+this.relativeOffset),i=Kd(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,e===void 0&&(e=4096),t+i/e/10};te.prototype.skip=function(e,t){t===void 0&&(t=1),this.relativeOffset+=L7[e]*t};te.prototype.parseULongList=function(e){e===void 0&&(e=this.parseULong());for(var t=new Array(e),i=this.data,r=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=i.getUint32(r),r+=4;return this.relativeOffset+=e*4,t};te.prototype.parseOffset16List=te.prototype.parseUShortList=function(e){e===void 0&&(e=this.parseUShort());for(var t=new Array(e),i=this.data,r=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=i.getUint16(r),r+=2;return this.relativeOffset+=e*2,t};te.prototype.parseShortList=function(e){for(var t=new Array(e),i=this.data,r=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=i.getInt16(r),r+=2;return this.relativeOffset+=e*2,t};te.prototype.parseByteList=function(e){for(var t=new Array(e),i=this.data,r=this.offset+this.relativeOffset,n=0;n<e;n++)t[n]=i.getUint8(r++);return this.relativeOffset+=e,t};te.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var i=new Array(e),r=0;r<e;r++)i[r]=t.call(this);return i};te.prototype.parseList32=function(e,t){t||(t=e,e=this.parseULong());for(var i=new Array(e),r=0;r<e;r++)i[r]=t.call(this);return i};te.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var i=new Array(e),r=Object.keys(t),n=0;n<e;n++){for(var s={},a=0;a<r.length;a++){var o=r[a],l=t[o];s[o]=l.call(this)}i[n]=s}return i};te.prototype.parseRecordList32=function(e,t){t||(t=e,e=this.parseULong());for(var i=new Array(e),r=Object.keys(t),n=0;n<e;n++){for(var s={},a=0;a<r.length;a++){var o=r[a],l=t[o];s[o]=l.call(this)}i[n]=s}return i};te.prototype.parseStruct=function(e){if(typeof e=="function")return e.call(this);for(var t=Object.keys(e),i={},r=0;r<t.length;r++){var n=t[r],s=e[n];i[n]=s.call(this)}return i};te.prototype.parseValueRecord=function(e){if(e===void 0&&(e=this.parseUShort()),e!==0){var t={};return e&1&&(t.xPlacement=this.parseShort()),e&2&&(t.yPlacement=this.parseShort()),e&4&&(t.xAdvance=this.parseShort()),e&8&&(t.yAdvance=this.parseShort()),e&16&&(t.xPlaDevice=void 0,this.parseShort()),e&32&&(t.yPlaDevice=void 0,this.parseShort()),e&64&&(t.xAdvDevice=void 0,this.parseShort()),e&128&&(t.yAdvDevice=void 0,this.parseShort()),t}};te.prototype.parseValueRecordList=function(){for(var e=this.parseUShort(),t=this.parseUShort(),i=new Array(t),r=0;r<t;r++)i[r]=this.parseValueRecord(e);return i};te.prototype.parsePointer=function(e){var t=this.parseOffset16();if(t>0)return new te(this.data,this.offset+t).parseStruct(e)};te.prototype.parsePointer32=function(e){var t=this.parseOffset32();if(t>0)return new te(this.data,this.offset+t).parseStruct(e)};te.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),i=t.length,r=this.relativeOffset,n=new Array(i),s=0;s<i;s++){var a=t[s];if(a===0){n[s]=void 0;continue}if(this.relativeOffset=a,e){for(var o=this.parseOffset16List(),l=new Array(o.length),h=0;h<o.length;h++)this.relativeOffset=a+o[h],l[h]=e.call(this);n[s]=l}else n[s]=this.parseUShortList()}return this.relativeOffset=r,n};te.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),i=this.parseUShort();if(t===1)return{format:1,glyphs:this.parseUShortList(i)};if(t===2){for(var r=new Array(i),n=0;n<i;n++)r[n]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:r}}throw new Error("0x"+e.toString(16)+": Coverage format must be 1 or 2.")};te.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(t===2)return{format:2,ranges:this.parseRecordList({start:te.uShort,end:te.uShort,classId:te.uShort})};throw new Error("0x"+e.toString(16)+": ClassDef format must be 1 or 2.")};te.list=function(e,t){return function(){return this.parseList(e,t)}};te.list32=function(e,t){return function(){return this.parseList32(e,t)}};te.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}};te.recordList32=function(e,t){return function(){return this.parseRecordList32(e,t)}};te.pointer=function(e){return function(){return this.parsePointer(e)}};te.pointer32=function(e){return function(){return this.parsePointer32(e)}};te.tag=te.prototype.parseTag;te.byte=te.prototype.parseByte;te.uShort=te.offset16=te.prototype.parseUShort;te.uShortList=te.prototype.parseUShortList;te.uLong=te.offset32=te.prototype.parseULong;te.uLongList=te.prototype.parseULongList;te.struct=te.prototype.parseStruct;te.coverage=te.prototype.parseCoverage;te.classDef=te.prototype.parseClassDef;var e_={reserved:te.uShort,reqFeatureIndex:te.uShort,featureIndexes:te.uShortList};te.prototype.parseScriptList=function(){return this.parsePointer(te.recordList({tag:te.tag,script:te.pointer({defaultLangSys:te.pointer(e_),langSysRecords:te.recordList({tag:te.tag,langSys:te.pointer(e_)})})}))||[]};te.prototype.parseFeatureList=function(){return this.parsePointer(te.recordList({tag:te.tag,feature:te.pointer({featureParams:te.offset16,lookupListIndexes:te.uShortList})}))||[]};te.prototype.parseLookupList=function(e){return this.parsePointer(te.list(te.pointer(function(){var t=this.parseUShort();tt.argument(1<=t&&t<=9,"GPOS/GSUB lookup type "+t+" unknown.");var i=this.parseUShort(),r=i&16;return{lookupType:t,lookupFlag:i,subtables:this.parseList(te.pointer(e[t])),markFilteringSet:r?this.parseUShort():void 0}})))||[]};te.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var e=this.parseUShort(),t=this.parseUShort();tt.argument(e===1&&t<1,"GPOS/GSUB feature variations table unknown.");var i=this.parseRecordList32({conditionSetOffset:te.offset32,featureTableSubstitutionOffset:te.offset32});return i})||[]};var Ue={getByte:$w,getCard8:$w,getUShort:Kd,getCard16:Kd,getShort:T7,getULong:Y0,getFixed:ZT,getTag:M7,getOffset:C7,getBytes:D7,bytesToString:P7,Parser:te};function O7(e,t){t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong();var i;e.groupCount=i=t.parseULong(),e.glyphIndexMap={};for(var r=0;r<i;r+=1)for(var n=t.parseULong(),s=t.parseULong(),a=t.parseULong(),o=n;o<=s;o+=1)e.glyphIndexMap[o]=a,a++}function R7(e,t,i,r,n){e.length=t.parseUShort(),e.language=t.parseUShort();var s;e.segCount=s=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};for(var a=new Ue.Parser(i,r+n+14),o=new Ue.Parser(i,r+n+16+s*2),l=new Ue.Parser(i,r+n+16+s*4),h=new Ue.Parser(i,r+n+16+s*6),c=r+n+16+s*8,u=0;u<s-1;u+=1)for(var d=void 0,p=a.parseUShort(),m=o.parseUShort(),g=l.parseShort(),f=h.parseUShort(),v=m;v<=p;v+=1)f!==0?(c=h.offset+h.relativeOffset-2,c+=f,c+=(v-m)*2,d=Ue.getUShort(i,c),d!==0&&(d=d+g&65535)):d=v+g&65535,e.glyphIndexMap[v]=d}function I7(e,t){var i={};i.version=Ue.getUShort(e,t),tt.argument(i.version===0,"cmap table version should be 0."),i.numTables=Ue.getUShort(e,t+2);for(var r=-1,n=i.numTables-1;n>=0;n-=1){var s=Ue.getUShort(e,t+4+n*8),a=Ue.getUShort(e,t+4+n*8+2);if(s===3&&(a===0||a===1||a===10)||s===0&&(a===0||a===1||a===2||a===3||a===4)){r=Ue.getULong(e,t+4+n*8+4);break}}if(r===-1)throw new Error("No valid cmap sub-tables found.");var o=new Ue.Parser(e,t+r);if(i.format=o.parseUShort(),i.format===12)O7(i,o);else if(i.format===4)R7(i,o,e,t,r);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+i.format+").");return i}function B7(e,t,i){e.segments.push({end:t,start:t,delta:-(t-i),offset:0,glyphIndex:i})}function N7(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}function k7(e){var t=!0,i;for(i=e.length-1;i>0;i-=1){var r=e.get(i);if(r.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),t=!1;break}}var n=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:t?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:t?12:12+8}];t||(n=n.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),n=n.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var s=new Oe.Table("cmap",n);for(s.segments=[],i=0;i<e.length;i+=1){for(var a=e.get(i),o=0;o<a.unicodes.length;o+=1)B7(s,a.unicodes[o],i);s.segments=s.segments.sort(function(y,x){return y.start-x.start})}N7(s);var l=s.segments.length,h=0,c=[],u=[],d=[],p=[],m=[],g=[];for(i=0;i<l;i+=1){var f=s.segments[i];f.end<=65535&&f.start<=65535?(c=c.concat({name:"end_"+i,type:"USHORT",value:f.end}),u=u.concat({name:"start_"+i,type:"USHORT",value:f.start}),d=d.concat({name:"idDelta_"+i,type:"SHORT",value:f.delta}),p=p.concat({name:"idRangeOffset_"+i,type:"USHORT",value:f.offset}),f.glyphId!==void 0&&(m=m.concat({name:"glyph_"+i,type:"USHORT",value:f.glyphId}))):h+=1,!t&&f.glyphIndex!==void 0&&(g=g.concat({name:"cmap12Start_"+i,type:"ULONG",value:f.start}),g=g.concat({name:"cmap12End_"+i,type:"ULONG",value:f.end}),g=g.concat({name:"cmap12Glyph_"+i,type:"ULONG",value:f.glyphIndex}))}if(s.segCountX2=(l-h)*2,s.searchRange=Math.pow(2,Math.floor(Math.log(l-h)/Math.log(2)))*2,s.entrySelector=Math.log(s.searchRange/2)/Math.log(2),s.rangeShift=s.segCountX2-s.searchRange,s.fields=s.fields.concat(c),s.fields.push({name:"reservedPad",type:"USHORT",value:0}),s.fields=s.fields.concat(u),s.fields=s.fields.concat(d),s.fields=s.fields.concat(p),s.fields=s.fields.concat(m),s.cmap4Length=14+c.length*2+2+u.length*2+d.length*2+p.length*2+m.length*2,!t){var v=16+g.length*4;s.cmap12Offset=12+2*2+4+s.cmap4Length,s.fields=s.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:v},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:g.length/3}]),s.fields=s.fields.concat(g)}return s}var JT={parse:I7,make:k7},hd=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],U7=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],F7=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Ua=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function $T(e){this.font=e}$T.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),i=this.font.glyphs;if(i){for(var r=0;r<i.length;r+=1)for(var n=i.get(r),s=0;s<n.unicodes.length;s+=1)if(n.unicodes[s]===t)return r}return null};function eM(e){this.cmap=e}eM.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.codePointAt(0)]||0};function Zd(e,t){this.encoding=e,this.charset=t}Zd.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),i=this.encoding[t];return this.charset.indexOf(i)};function X0(e){switch(e.version){case 1:this.names=Ua.slice();break;case 2:this.names=new Array(e.numberOfGlyphs);for(var t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<Ua.length?this.names[t]=Ua[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-Ua.length];break;case 2.5:this.names=new Array(e.numberOfGlyphs);for(var i=0;i<e.numberOfGlyphs;i++)this.names[i]=Ua[i+e.glyphNameIndex[i]];break;case 3:this.names=[];break;default:this.names=[];break}}X0.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)};X0.prototype.glyphIndexToName=function(e){return this.names[e]};function z7(e){for(var t,i=e.tables.cmap.glyphIndexMap,r=Object.keys(i),n=0;n<r.length;n+=1){var s=r[n],a=i[s];t=e.glyphs.get(a),t.addUnicode(parseInt(s))}for(var o=0;o<e.glyphs.length;o+=1)t=e.glyphs.get(o),e.cffEncoding?e.isCIDFont?t.name="gid"+o:t.name=e.cffEncoding.charset[o]:e.glyphNames.names&&(t.name=e.glyphNames.glyphIndexToName(o))}function G7(e){e._IndexToUnicodeMap={};for(var t=e.tables.cmap.glyphIndexMap,i=Object.keys(t),r=0;r<i.length;r+=1){var n=i[r],s=t[n];e._IndexToUnicodeMap[s]===void 0?e._IndexToUnicodeMap[s]={unicodes:[parseInt(n)]}:e._IndexToUnicodeMap[s].unicodes.push(parseInt(n))}}function H7(e,t){t.lowMemory?G7(e):z7(e)}function V7(e,t,i,r,n){e.beginPath(),e.moveTo(t,i),e.lineTo(r,n),e.stroke()}var Ca={line:V7};function j7(e,t){var i=t||new di;return{configurable:!0,get:function(){return typeof i=="function"&&(i=i()),i},set:function(r){i=r}}}function Fr(e){this.bindConstructorValues(e)}Fr.prototype.bindConstructorValues=function(e){this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||e.unicode!==void 0?[e.unicode]:[],"xMin"in e&&(this.xMin=e.xMin),"yMin"in e&&(this.yMin=e.yMin),"xMax"in e&&(this.xMax=e.xMax),"yMax"in e&&(this.yMax=e.yMax),"advanceWidth"in e&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",j7(this,e.path))};Fr.prototype.addUnicode=function(e){this.unicodes.length===0&&(this.unicode=e),this.unicodes.push(e)};Fr.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};Fr.prototype.getPath=function(e,t,i,r,n){e=e!==void 0?e:0,t=t!==void 0?t:0,i=i!==void 0?i:72;var s,a;r||(r={});var o=r.xScale,l=r.yScale;if(r.hinting&&n&&n.hinting&&(a=this.path&&n.hinting.exec(this,i)),a)s=n.hinting.getCommands(a),e=Math.round(e),t=Math.round(t),o=l=1;else{s=this.path.commands;var h=1/(this.path.unitsPerEm||1e3)*i;o===void 0&&(o=h),l===void 0&&(l=h)}for(var c=new di,u=0;u<s.length;u+=1){var d=s[u];d.type==="M"?c.moveTo(e+d.x*o,t+-d.y*l):d.type==="L"?c.lineTo(e+d.x*o,t+-d.y*l):d.type==="Q"?c.quadraticCurveTo(e+d.x1*o,t+-d.y1*l,e+d.x*o,t+-d.y*l):d.type==="C"?c.curveTo(e+d.x1*o,t+-d.y1*l,e+d.x2*o,t+-d.y2*l,e+d.x*o,t+-d.y*l):d.type==="Z"&&c.closePath()}return c};Fr.prototype.getContours=function(){if(this.points===void 0)return[];for(var e=[],t=[],i=0;i<this.points.length;i+=1){var r=this.points[i];t.push(r),r.lastPointOfContour&&(e.push(t),t=[])}return tt.argument(t.length===0,"There are still points left in the current contour."),e};Fr.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],i=[],r=0;r<e.length;r+=1){var n=e[r];n.type!=="Z"&&(t.push(n.x),i.push(n.y)),(n.type==="Q"||n.type==="C")&&(t.push(n.x1),i.push(n.y1)),n.type==="C"&&(t.push(n.x2),i.push(n.y2))}var s={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,i),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,i),leftSideBearing:this.leftSideBearing};return isFinite(s.xMin)||(s.xMin=0),isFinite(s.xMax)||(s.xMax=this.advanceWidth),isFinite(s.yMin)||(s.yMin=0),isFinite(s.yMax)||(s.yMax=0),s.rightSideBearing=this.advanceWidth-s.leftSideBearing-(s.xMax-s.xMin),s};Fr.prototype.draw=function(e,t,i,r,n){this.getPath(t,i,r,n).draw(e)};Fr.prototype.drawPoints=function(e,t,i,r){function n(u,d,p,m){e.beginPath();for(var g=0;g<u.length;g+=1)e.moveTo(d+u[g].x*m,p+u[g].y*m),e.arc(d+u[g].x*m,p+u[g].y*m,2,0,Math.PI*2,!1);e.closePath(),e.fill()}t=t!==void 0?t:0,i=i!==void 0?i:0,r=r!==void 0?r:24;for(var s=1/this.path.unitsPerEm*r,a=[],o=[],l=this.path,h=0;h<l.commands.length;h+=1){var c=l.commands[h];c.x!==void 0&&a.push({x:c.x,y:-c.y}),c.x1!==void 0&&o.push({x:c.x1,y:-c.y1}),c.x2!==void 0&&o.push({x:c.x2,y:-c.y2})}e.fillStyle="blue",n(a,t,i,s),e.fillStyle="red",n(o,t,i,s)};Fr.prototype.drawMetrics=function(e,t,i,r){var n;t=t!==void 0?t:0,i=i!==void 0?i:0,r=r!==void 0?r:24,n=1/this.path.unitsPerEm*r,e.lineWidth=1,e.strokeStyle="black",Ca.line(e,t,-1e4,t,1e4),Ca.line(e,-1e4,i,1e4,i);var s=this.xMin||0,a=this.yMin||0,o=this.xMax||0,l=this.yMax||0,h=this.advanceWidth||0;e.strokeStyle="blue",Ca.line(e,t+s*n,-1e4,t+s*n,1e4),Ca.line(e,t+o*n,-1e4,t+o*n,1e4),Ca.line(e,-1e4,i+-a*n,1e4,i+-a*n),Ca.line(e,-1e4,i+-l*n,1e4,i+-l*n),e.strokeStyle="green",Ca.line(e,t+h*n,-1e4,t+h*n,1e4)};function Qc(e,t,i){Object.defineProperty(e,t,{get:function(){return e.path,e[i]},set:function(r){e[i]=r},enumerable:!0,configurable:!0})}function Q0(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var i=0;i<t.length;i++){var r=t[i];r.path.unitsPerEm=e.unitsPerEm,this.glyphs[i]=r}this.length=t&&t.length||0}Q0.prototype.get=function(e){if(this.glyphs[e]===void 0){this.font._push(e),typeof this.glyphs[e]=="function"&&(this.glyphs[e]=this.glyphs[e]());var t=this.glyphs[e],i=this.font._IndexToUnicodeMap[e];if(i)for(var r=0;r<i.unicodes.length;r++)t.addUnicode(i.unicodes[r]);this.font.cffEncoding?this.font.isCIDFont?t.name="gid"+e:t.name=this.font.cffEncoding.charset[e]:this.font.glyphNames.names&&(t.name=this.font.glyphNames.glyphIndexToName(e)),this.glyphs[e].advanceWidth=this.font._hmtxTableData[e].advanceWidth,this.glyphs[e].leftSideBearing=this.font._hmtxTableData[e].leftSideBearing}else typeof this.glyphs[e]=="function"&&(this.glyphs[e]=this.glyphs[e]());return this.glyphs[e]};Q0.prototype.push=function(e,t){this.glyphs[e]=t,this.length++};function W7(e,t){return new Fr({index:t,font:e})}function q7(e,t,i,r,n,s){return function(){var a=new Fr({index:t,font:e});return a.path=function(){i(a,r,n);var o=s(e.glyphs,a);return o.unitsPerEm=e.unitsPerEm,o},Qc(a,"xMin","_xMin"),Qc(a,"xMax","_xMax"),Qc(a,"yMin","_yMin"),Qc(a,"yMax","_yMax"),a}}function Y7(e,t,i,r){return function(){var n=new Fr({index:t,font:e});return n.path=function(){var s=i(e,n,r);return s.unitsPerEm=e.unitsPerEm,s},n}}var zn={GlyphSet:Q0,glyphLoader:W7,ttfGlyphLoader:q7,cffGlyphLoader:Y7};function tM(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i+=1)if(!tM(e[i],t[i]))return!1;return!0}else return!1}function dv(e){var t;return e.length<1240?t=107:e.length<33900?t=1131:t=32768,t}function Hs(e,t,i){var r=[],n=[],s=Ue.getCard16(e,t),a,o;if(s!==0){var l=Ue.getByte(e,t+2);a=t+(s+1)*l+2;for(var h=t+3,c=0;c<s+1;c+=1)r.push(Ue.getOffset(e,h,l)),h+=l;o=a+r[s]}else o=t+2;for(var u=0;u<r.length-1;u+=1){var d=Ue.getBytes(e,a+r[u],a+r[u+1]);i&&(d=i(d)),n.push(d)}return{objects:n,startOffset:t,endOffset:o}}function X7(e,t){var i=[],r=Ue.getCard16(e,t),n,s;if(r!==0){var a=Ue.getByte(e,t+2);n=t+(r+1)*a+2;for(var o=t+3,l=0;l<r+1;l+=1)i.push(Ue.getOffset(e,o,a)),o+=a;s=n+i[r]}else s=t+2;return{offsets:i,startOffset:t,endOffset:s}}function Q7(e,t,i,r,n){var s=Ue.getCard16(i,r),a=0;if(s!==0){var o=Ue.getByte(i,r+2);a=r+(s+1)*o+2}var l=Ue.getBytes(i,a+t[e],a+t[e+1]);return n&&(l=n(l)),l}function K7(e){for(var t="",i=15,r=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var n=e.parseByte(),s=n>>4,a=n&15;if(s===i||(t+=r[s],a===i))break;t+=r[a]}return parseFloat(t)}function Z7(e,t){var i,r,n,s;if(t===28)return i=e.parseByte(),r=e.parseByte(),i<<8|r;if(t===29)return i=e.parseByte(),r=e.parseByte(),n=e.parseByte(),s=e.parseByte(),i<<24|r<<16|n<<8|s;if(t===30)return K7(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return i=e.parseByte(),(t-247)*256+i+108;if(t>=251&&t<=254)return i=e.parseByte(),-(t-251)*256-i-108;throw new Error("Invalid b0 "+t)}function J7(e){for(var t={},i=0;i<e.length;i+=1){var r=e[i][0],n=e[i][1],s=void 0;if(n.length===1?s=n[0]:s=n,t.hasOwnProperty(r)&&!isNaN(t[r]))throw new Error("Object "+t+" already has key "+r);t[r]=s}return t}function iM(e,t,i){t=t!==void 0?t:0;var r=new Ue.Parser(e,t),n=[],s=[];for(i=i!==void 0?i:e.length;r.relativeOffset<i;){var a=r.parseByte();a<=21?(a===12&&(a=1200+r.parseByte()),n.push([a,s]),s=[]):s.push(Z7(r,a))}return J7(n)}function qh(e,t){return t<=390?t=hd[t]:t=e[t-391],t}function rM(e,t,i){for(var r={},n,s=0;s<t.length;s+=1){var a=t[s];if(Array.isArray(a.type)){var o=[];o.length=a.type.length;for(var l=0;l<a.type.length;l++)n=e[a.op]!==void 0?e[a.op][l]:void 0,n===void 0&&(n=a.value!==void 0&&a.value[l]!==void 0?a.value[l]:null),a.type[l]==="SID"&&(n=qh(i,n)),o[l]=n;r[a.name]=o}else n=e[a.op],n===void 0&&(n=a.value!==void 0?a.value:null),a.type==="SID"&&(n=qh(i,n)),r[a.name]=n}return r}function $7(e,t){var i={};return i.formatMajor=Ue.getCard8(e,t),i.formatMinor=Ue.getCard8(e,t+1),i.size=Ue.getCard8(e,t+2),i.offsetSize=Ue.getCard8(e,t+3),i.startOffset=t,i.endOffset=t+4,i}var nM=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],sM=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function eq(e,t){var i=iM(e,0,e.byteLength);return rM(i,nM,t)}function aM(e,t,i,r){var n=iM(e,t,i);return rM(n,sM,r)}function t_(e,t,i,r){for(var n=[],s=0;s<i.length;s+=1){var a=new DataView(new Uint8Array(i[s]).buffer),o=eq(a,r);o._subrs=[],o._subrsBias=0,o._defaultWidthX=0,o._nominalWidthX=0;var l=o.private[0],h=o.private[1];if(l!==0&&h!==0){var c=aM(e,h+t,l,r);if(o._defaultWidthX=c.defaultWidthX,o._nominalWidthX=c.nominalWidthX,c.subrs!==0){var u=h+c.subrs,d=Hs(e,u+t);o._subrs=d.objects,o._subrsBias=dv(o._subrs)}o._privateDict=c}n.push(o)}return n}function tq(e,t,i,r){var n,s,a=new Ue.Parser(e,t);i-=1;var o=[".notdef"],l=a.parseCard8();if(l===0)for(var h=0;h<i;h+=1)n=a.parseSID(),o.push(qh(r,n));else if(l===1)for(;o.length<=i;){n=a.parseSID(),s=a.parseCard8();for(var c=0;c<=s;c+=1)o.push(qh(r,n)),n+=1}else if(l===2)for(;o.length<=i;){n=a.parseSID(),s=a.parseCard16();for(var u=0;u<=s;u+=1)o.push(qh(r,n)),n+=1}else throw new Error("Unknown charset format "+l);return o}function iq(e,t,i){var r,n={},s=new Ue.Parser(e,t),a=s.parseCard8();if(a===0)for(var o=s.parseCard8(),l=0;l<o;l+=1)r=s.parseCard8(),n[r]=l;else if(a===1){var h=s.parseCard8();r=1;for(var c=0;c<h;c+=1)for(var u=s.parseCard8(),d=s.parseCard8(),p=u;p<=u+d;p+=1)n[p]=r,r+=1}else throw new Error("Unknown encoding format "+a);return new Zd(n,i)}function i_(e,t,i){var r,n,s,a,o=new di,l=[],h=0,c=!1,u=!1,d=0,p=0,m,g,f,v;if(e.isCIDFont){var y=e.tables.cff.topDict._fdSelect[t.index],x=e.tables.cff.topDict._fdArray[y];m=x._subrs,g=x._subrsBias,f=x._defaultWidthX,v=x._nominalWidthX}else m=e.tables.cff.topDict._subrs,g=e.tables.cff.topDict._subrsBias,f=e.tables.cff.topDict._defaultWidthX,v=e.tables.cff.topDict._nominalWidthX;var b=f;function S(w,E){u&&o.closePath(),o.moveTo(w,E),u=!0}function _(){var w;w=l.length%2!==0,w&&!c&&(b=l.shift()+v),h+=l.length>>1,l.length=0,c=!0}function A(w){for(var E,T,C,P,k,D,R,G,N,L,H,F,z=0;z<w.length;){var U=w[z];switch(z+=1,U){case 1:_();break;case 3:_();break;case 4:l.length>1&&!c&&(b=l.shift()+v,c=!0),p+=l.pop(),S(d,p);break;case 5:for(;l.length>0;)d+=l.shift(),p+=l.shift(),o.lineTo(d,p);break;case 6:for(;l.length>0&&(d+=l.shift(),o.lineTo(d,p),l.length!==0);)p+=l.shift(),o.lineTo(d,p);break;case 7:for(;l.length>0&&(p+=l.shift(),o.lineTo(d,p),l.length!==0);)d+=l.shift(),o.lineTo(d,p);break;case 8:for(;l.length>0;)r=d+l.shift(),n=p+l.shift(),s=r+l.shift(),a=n+l.shift(),d=s+l.shift(),p=a+l.shift(),o.curveTo(r,n,s,a,d,p);break;case 10:k=l.pop()+g,D=m[k],D&&A(D);break;case 11:return;case 12:switch(U=w[z],z+=1,U){case 35:r=d+l.shift(),n=p+l.shift(),s=r+l.shift(),a=n+l.shift(),R=s+l.shift(),G=a+l.shift(),N=R+l.shift(),L=G+l.shift(),H=N+l.shift(),F=L+l.shift(),d=H+l.shift(),p=F+l.shift(),l.shift(),o.curveTo(r,n,s,a,R,G),o.curveTo(N,L,H,F,d,p);break;case 34:r=d+l.shift(),n=p,s=r+l.shift(),a=n+l.shift(),R=s+l.shift(),G=a,N=R+l.shift(),L=a,H=N+l.shift(),F=p,d=H+l.shift(),o.curveTo(r,n,s,a,R,G),o.curveTo(N,L,H,F,d,p);break;case 36:r=d+l.shift(),n=p+l.shift(),s=r+l.shift(),a=n+l.shift(),R=s+l.shift(),G=a,N=R+l.shift(),L=a,H=N+l.shift(),F=L+l.shift(),d=H+l.shift(),o.curveTo(r,n,s,a,R,G),o.curveTo(N,L,H,F,d,p);break;case 37:r=d+l.shift(),n=p+l.shift(),s=r+l.shift(),a=n+l.shift(),R=s+l.shift(),G=a+l.shift(),N=R+l.shift(),L=G+l.shift(),H=N+l.shift(),F=L+l.shift(),Math.abs(H-d)>Math.abs(F-p)?d=H+l.shift():p=F+l.shift(),o.curveTo(r,n,s,a,R,G),o.curveTo(N,L,H,F,d,p);break;default:console.log("Glyph "+t.index+": unknown operator "+1200+U),l.length=0}break;case 14:l.length>0&&!c&&(b=l.shift()+v,c=!0),u&&(o.closePath(),u=!1);break;case 18:_();break;case 19:case 20:_(),z+=h+7>>3;break;case 21:l.length>2&&!c&&(b=l.shift()+v,c=!0),p+=l.pop(),d+=l.pop(),S(d,p);break;case 22:l.length>1&&!c&&(b=l.shift()+v,c=!0),d+=l.pop(),S(d,p);break;case 23:_();break;case 24:for(;l.length>2;)r=d+l.shift(),n=p+l.shift(),s=r+l.shift(),a=n+l.shift(),d=s+l.shift(),p=a+l.shift(),o.curveTo(r,n,s,a,d,p);d+=l.shift(),p+=l.shift(),o.lineTo(d,p);break;case 25:for(;l.length>6;)d+=l.shift(),p+=l.shift(),o.lineTo(d,p);r=d+l.shift(),n=p+l.shift(),s=r+l.shift(),a=n+l.shift(),d=s+l.shift(),p=a+l.shift(),o.curveTo(r,n,s,a,d,p);break;case 26:for(l.length%2&&(d+=l.shift());l.length>0;)r=d,n=p+l.shift(),s=r+l.shift(),a=n+l.shift(),d=s,p=a+l.shift(),o.curveTo(r,n,s,a,d,p);break;case 27:for(l.length%2&&(p+=l.shift());l.length>0;)r=d+l.shift(),n=p,s=r+l.shift(),a=n+l.shift(),d=s+l.shift(),p=a,o.curveTo(r,n,s,a,d,p);break;case 28:E=w[z],T=w[z+1],l.push((E<<24|T<<16)>>16),z+=2;break;case 29:k=l.pop()+e.gsubrsBias,D=e.gsubrs[k],D&&A(D);break;case 30:for(;l.length>0&&(r=d,n=p+l.shift(),s=r+l.shift(),a=n+l.shift(),d=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(r,n,s,a,d,p),l.length!==0);)r=d+l.shift(),n=p,s=r+l.shift(),a=n+l.shift(),p=a+l.shift(),d=s+(l.length===1?l.shift():0),o.curveTo(r,n,s,a,d,p);break;case 31:for(;l.length>0&&(r=d+l.shift(),n=p,s=r+l.shift(),a=n+l.shift(),p=a+l.shift(),d=s+(l.length===1?l.shift():0),o.curveTo(r,n,s,a,d,p),l.length!==0);)r=d,n=p+l.shift(),s=r+l.shift(),a=n+l.shift(),d=s+l.shift(),p=a+(l.length===1?l.shift():0),o.curveTo(r,n,s,a,d,p);break;default:U<32?console.log("Glyph "+t.index+": unknown operator "+U):U<247?l.push(U-139):U<251?(E=w[z],z+=1,l.push((U-247)*256+E+108)):U<255?(E=w[z],z+=1,l.push(-(U-251)*256-E-108)):(E=w[z],T=w[z+1],C=w[z+2],P=w[z+3],z+=4,l.push((E<<24|T<<16|C<<8|P)/65536))}}}return A(i),t.advanceWidth=b,o}function rq(e,t,i,r){var n=[],s,a=new Ue.Parser(e,t),o=a.parseCard8();if(o===0)for(var l=0;l<i;l++){if(s=a.parseCard8(),s>=r)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+r+")");n.push(s)}else if(o===3){var h=a.parseCard16(),c=a.parseCard16();if(c!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+c);for(var u,d=0;d<h;d++){if(s=a.parseCard8(),u=a.parseCard16(),s>=r)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+r+")");if(u>i)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+u);for(;c<u;c++)n.push(s);c=u}if(u!==i)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+u)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+o);return n}function nq(e,t,i,r){i.tables.cff={};var n=$7(e,t),s=Hs(e,n.endOffset,Ue.bytesToString),a=Hs(e,s.endOffset),o=Hs(e,a.endOffset,Ue.bytesToString),l=Hs(e,o.endOffset);i.gsubrs=l.objects,i.gsubrsBias=dv(i.gsubrs);var h=t_(e,t,a.objects,o.objects);if(h.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+h.length);var c=h[0];if(i.tables.cff.topDict=c,c._privateDict&&(i.defaultWidthX=c._privateDict.defaultWidthX,i.nominalWidthX=c._privateDict.nominalWidthX),c.ros[0]!==void 0&&c.ros[1]!==void 0&&(i.isCIDFont=!0),i.isCIDFont){var u=c.fdArray,d=c.fdSelect;if(u===0||d===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");u+=t;var p=Hs(e,u),m=t_(e,t,p.objects,o.objects);c._fdArray=m,d+=t,c._fdSelect=rq(e,d,i.numGlyphs,m.length)}var g=t+c.private[1],f=aM(e,g,c.private[0],o.objects);if(i.defaultWidthX=f.defaultWidthX,i.nominalWidthX=f.nominalWidthX,f.subrs!==0){var v=g+f.subrs,y=Hs(e,v);i.subrs=y.objects,i.subrsBias=dv(i.subrs)}else i.subrs=[],i.subrsBias=0;var x;r.lowMemory?(x=X7(e,t+c.charStrings),i.nGlyphs=x.offsets.length):(x=Hs(e,t+c.charStrings),i.nGlyphs=x.objects.length);var b=tq(e,t+c.charset,i.nGlyphs,o.objects);if(c.encoding===0?i.cffEncoding=new Zd(U7,b):c.encoding===1?i.cffEncoding=new Zd(F7,b):i.cffEncoding=iq(e,t+c.encoding,b),i.encoding=i.encoding||i.cffEncoding,i.glyphs=new zn.GlyphSet(i),r.lowMemory)i._push=function(A){var w=Q7(A,x.offsets,e,t+c.charStrings);i.glyphs.push(A,zn.cffGlyphLoader(i,A,i_,w))};else for(var S=0;S<i.nGlyphs;S+=1){var _=x.objects[S];i.glyphs.push(S,zn.cffGlyphLoader(i,S,i_,_))}}function oM(e,t){var i,r=hd.indexOf(e);return r>=0&&(i=r),r=t.indexOf(e),r>=0?i=r+hd.length:(i=hd.length+t.length,t.push(e)),i}function sq(){return new Oe.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function aq(e){var t=new Oe.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var i=0;i<e.length;i+=1)t.names.push({name:"name_"+i,type:"NAME",value:e[i]});return t}function lM(e,t,i){for(var r={},n=0;n<e.length;n+=1){var s=e[n],a=t[s.name];a!==void 0&&!tM(a,s.value)&&(s.type==="SID"&&(a=oM(a,i)),r[s.op]={name:s.name,type:s.type,value:a})}return r}function r_(e,t){var i=new Oe.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return i.dict=lM(nM,e,t),i}function n_(e){var t=new Oe.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function oq(e){var t=new Oe.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var i=0;i<e.length;i+=1)t.strings.push({name:"string_"+i,type:"STRING",value:e[i]});return t}function lq(){return new Oe.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function hq(e,t){for(var i=new Oe.Record("Charsets",[{name:"format",type:"Card8",value:0}]),r=0;r<e.length;r+=1){var n=e[r],s=oM(n,t);i.fields.push({name:"glyph_"+r,type:"SID",value:s})}return i}function uq(e){var t=[],i=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var r=0,n=0,s=0;s<i.commands.length;s+=1){var a=void 0,o=void 0,l=i.commands[s];if(l.type==="Q"){var h=.3333333333333333,c=2/3;l={type:"C",x:l.x,y:l.y,x1:Math.round(h*r+c*l.x1),y1:Math.round(h*n+c*l.y1),x2:Math.round(h*l.x+c*l.x1),y2:Math.round(h*l.y+c*l.y1)}}if(l.type==="M")a=Math.round(l.x-r),o=Math.round(l.y-n),t.push({name:"dx",type:"NUMBER",value:a}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rmoveto",type:"OP",value:21}),r=Math.round(l.x),n=Math.round(l.y);else if(l.type==="L")a=Math.round(l.x-r),o=Math.round(l.y-n),t.push({name:"dx",type:"NUMBER",value:a}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rlineto",type:"OP",value:5}),r=Math.round(l.x),n=Math.round(l.y);else if(l.type==="C"){var u=Math.round(l.x1-r),d=Math.round(l.y1-n),p=Math.round(l.x2-l.x1),m=Math.round(l.y2-l.y1);a=Math.round(l.x-l.x2),o=Math.round(l.y-l.y2),t.push({name:"dx1",type:"NUMBER",value:u}),t.push({name:"dy1",type:"NUMBER",value:d}),t.push({name:"dx2",type:"NUMBER",value:p}),t.push({name:"dy2",type:"NUMBER",value:m}),t.push({name:"dx",type:"NUMBER",value:a}),t.push({name:"dy",type:"NUMBER",value:o}),t.push({name:"rrcurveto",type:"OP",value:8}),r=Math.round(l.x),n=Math.round(l.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}function cq(e){for(var t=new Oe.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),i=0;i<e.length;i+=1){var r=e.get(i),n=uq(r);t.charStrings.push({name:r.name,type:"CHARSTRING",value:n})}return t}function dq(e,t){var i=new Oe.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return i.dict=lM(sM,e,t),i}function pq(e,t){for(var i=new Oe.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),r=1/t.unitsPerEm,n={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[r,0,0,r,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},s={},a=[],o,l=1;l<e.length;l+=1)o=e.get(l),a.push(o.name);var h=[];i.header=sq(),i.nameIndex=aq([t.postScriptName]);var c=r_(n,h);i.topDictIndex=n_(c),i.globalSubrIndex=lq(),i.charsets=hq(a,h),i.charStringsIndex=cq(e),i.privateDict=dq(s,h),i.stringIndex=oq(h);var u=i.header.sizeOf()+i.nameIndex.sizeOf()+i.topDictIndex.sizeOf()+i.stringIndex.sizeOf()+i.globalSubrIndex.sizeOf();return n.charset=u,n.encoding=0,n.charStrings=n.charset+i.charsets.sizeOf(),n.private[1]=n.charStrings+i.charStringsIndex.sizeOf(),c=r_(n,h),i.topDictIndex=n_(c),i}var hM={parse:nq,make:pq};function fq(e,t){var i={},r=new Ue.Parser(e,t);return i.version=r.parseVersion(),i.fontRevision=Math.round(r.parseFixed()*1e3)/1e3,i.checkSumAdjustment=r.parseULong(),i.magicNumber=r.parseULong(),tt.argument(i.magicNumber===1594834165,"Font header has wrong magic number."),i.flags=r.parseUShort(),i.unitsPerEm=r.parseUShort(),i.created=r.parseLongDateTime(),i.modified=r.parseLongDateTime(),i.xMin=r.parseShort(),i.yMin=r.parseShort(),i.xMax=r.parseShort(),i.yMax=r.parseShort(),i.macStyle=r.parseUShort(),i.lowestRecPPEM=r.parseUShort(),i.fontDirectionHint=r.parseShort(),i.indexToLocFormat=r.parseShort(),i.glyphDataFormat=r.parseShort(),i}function mq(e){var t=Math.round(new Date().getTime()/1e3)+2082844800,i=t;return e.createdTimestamp&&(i=e.createdTimestamp+2082844800),new Oe.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:i},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}var uM={parse:fq,make:mq};function gq(e,t){var i={},r=new Ue.Parser(e,t);return i.version=r.parseVersion(),i.ascender=r.parseShort(),i.descender=r.parseShort(),i.lineGap=r.parseShort(),i.advanceWidthMax=r.parseUShort(),i.minLeftSideBearing=r.parseShort(),i.minRightSideBearing=r.parseShort(),i.xMaxExtent=r.parseShort(),i.caretSlopeRise=r.parseShort(),i.caretSlopeRun=r.parseShort(),i.caretOffset=r.parseShort(),r.relativeOffset+=8,i.metricDataFormat=r.parseShort(),i.numberOfHMetrics=r.parseUShort(),i}function vq(e){return new Oe.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}var cM={parse:gq,make:vq};function yq(e,t,i,r,n){for(var s,a,o=new Ue.Parser(e,t),l=0;l<r;l+=1){l<i&&(s=o.parseUShort(),a=o.parseShort());var h=n.get(l);h.advanceWidth=s,h.leftSideBearing=a}}function xq(e,t,i,r,n){e._hmtxTableData={};for(var s,a,o=new Ue.Parser(t,i),l=0;l<n;l+=1)l<r&&(s=o.parseUShort(),a=o.parseShort()),e._hmtxTableData[l]={advanceWidth:s,leftSideBearing:a}}function bq(e,t,i,r,n,s,a){a.lowMemory?xq(e,t,i,r,n):yq(t,i,r,n,s)}function wq(e){for(var t=new Oe.Table("hmtx",[]),i=0;i<e.length;i+=1){var r=e.get(i),n=r.advanceWidth||0,s=r.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+i,type:"USHORT",value:n}),t.fields.push({name:"leftSideBearing_"+i,type:"SHORT",value:s})}return t}var dM={parse:bq,make:wq};function _q(e){for(var t=new Oe.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),i="",r=12+e.length*4,n=0;n<e.length;++n){var s=i.indexOf(e[n]);s<0&&(s=i.length,i+=e[n]),t.fields.push({name:"offset "+n,type:"USHORT",value:r+s}),t.fields.push({name:"length "+n,type:"USHORT",value:e[n].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:i}),t}function Sq(e,t){var i=new Ue.Parser(e,t),r=i.parseULong();tt.argument(r===1,"Unsupported ltag table version."),i.skip("uLong",1);for(var n=i.parseULong(),s=[],a=0;a<n;a++){for(var o="",l=t+i.parseUShort(),h=i.parseUShort(),c=l;c<l+h;++c)o+=String.fromCharCode(e.getInt8(c));s.push(o)}return s}var pM={make:_q,parse:Sq};function Aq(e,t){var i={},r=new Ue.Parser(e,t);return i.version=r.parseVersion(),i.numGlyphs=r.parseUShort(),i.version===1&&(i.maxPoints=r.parseUShort(),i.maxContours=r.parseUShort(),i.maxCompositePoints=r.parseUShort(),i.maxCompositeContours=r.parseUShort(),i.maxZones=r.parseUShort(),i.maxTwilightPoints=r.parseUShort(),i.maxStorage=r.parseUShort(),i.maxFunctionDefs=r.parseUShort(),i.maxInstructionDefs=r.parseUShort(),i.maxStackElements=r.parseUShort(),i.maxSizeOfInstructions=r.parseUShort(),i.maxComponentElements=r.parseUShort(),i.maxComponentDepth=r.parseUShort()),i}function Eq(e){return new Oe.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}var fM={parse:Aq,make:Eq},mM=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],gM={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Tq={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},vM={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Mq(e,t,i){switch(e){case 0:if(t===65535)return"und";if(i)return i[t];break;case 1:return gM[t];case 3:return vM[t]}}var pv="utf-16",Cq={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Dq={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function yM(e,t,i){switch(e){case 0:return pv;case 1:return Dq[i]||Cq[t];case 3:if(t===1||t===10)return pv;break}}function Pq(e,t,i){for(var r={},n=new Ue.Parser(e,t),s=n.parseUShort(),a=n.parseUShort(),o=n.offset+n.parseUShort(),l=0;l<a;l++){var h=n.parseUShort(),c=n.parseUShort(),u=n.parseUShort(),d=n.parseUShort(),p=mM[d]||d,m=n.parseUShort(),g=n.parseUShort(),f=Mq(h,u,i),v=yM(h,c,u);if(v!==void 0&&f!==void 0){var y=void 0;if(v===pv?y=Rl.UTF16(e,o+g,m):y=Rl.MACSTRING(e,o+g,m,v),y){var x=r[p];x===void 0&&(x=r[p]={}),x[f]=y}}}return s===1&&n.parseUShort(),r}function pm(e){var t={};for(var i in e)t[e[i]]=parseInt(i);return t}function s_(e,t,i,r,n,s){return new Oe.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:i},{name:"nameID",type:"USHORT",value:r},{name:"length",type:"USHORT",value:n},{name:"offset",type:"USHORT",value:s}])}function Lq(e,t){var i=e.length,r=t.length-i+1;e:for(var n=0;n<r;n++)for(;n<r;n++){for(var s=0;s<i;s++)if(t[n+s]!==e[s])continue e;return n}return-1}function a_(e,t){var i=Lq(e,t);if(i<0){i=t.length;for(var r=0,n=e.length;r<n;++r)t.push(e[r])}return i}function Oq(e,t){var i,r=[],n={},s=pm(mM);for(var a in e){var o=s[a];if(o===void 0&&(o=a),i=parseInt(o),isNaN(i))throw new Error('Name table entry "'+a+'" does not exist, see nameTableNames for complete list.');n[i]=e[a],r.push(i)}for(var l=pm(gM),h=pm(vM),c=[],u=[],d=0;d<r.length;d++){i=r[d];var p=n[i];for(var m in p){var g=p[m],f=1,v=l[m],y=Tq[v],x=yM(f,y,v),b=De.MACSTRING(g,x);b===void 0&&(f=0,v=t.indexOf(m),v<0&&(v=t.length,t.push(m)),y=4,b=De.UTF16(g));var S=a_(b,u);c.push(s_(f,y,v,i,b.length,S));var _=h[m];if(_!==void 0){var A=De.UTF16(g),w=a_(A,u);c.push(s_(3,1,_,i,A.length,w))}}}c.sort(function(C,P){return C.platformID-P.platformID||C.encodingID-P.encodingID||C.languageID-P.languageID||C.nameID-P.nameID});for(var E=new Oe.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:c.length},{name:"stringOffset",type:"USHORT",value:6+c.length*12}]),T=0;T<c.length;T++)E.fields.push({name:"record_"+T,type:"RECORD",value:c[T]});return E.fields.push({name:"strings",type:"LITERAL",value:u}),E}var xM={parse:Pq,make:Oq},fv=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function Rq(e){for(var t=0;t<fv.length;t+=1){var i=fv[t];if(e>=i.begin&&e<i.end)return t}return-1}function Iq(e,t){var i={},r=new Ue.Parser(e,t);i.version=r.parseUShort(),i.xAvgCharWidth=r.parseShort(),i.usWeightClass=r.parseUShort(),i.usWidthClass=r.parseUShort(),i.fsType=r.parseUShort(),i.ySubscriptXSize=r.parseShort(),i.ySubscriptYSize=r.parseShort(),i.ySubscriptXOffset=r.parseShort(),i.ySubscriptYOffset=r.parseShort(),i.ySuperscriptXSize=r.parseShort(),i.ySuperscriptYSize=r.parseShort(),i.ySuperscriptXOffset=r.parseShort(),i.ySuperscriptYOffset=r.parseShort(),i.yStrikeoutSize=r.parseShort(),i.yStrikeoutPosition=r.parseShort(),i.sFamilyClass=r.parseShort(),i.panose=[];for(var n=0;n<10;n++)i.panose[n]=r.parseByte();return i.ulUnicodeRange1=r.parseULong(),i.ulUnicodeRange2=r.parseULong(),i.ulUnicodeRange3=r.parseULong(),i.ulUnicodeRange4=r.parseULong(),i.achVendID=String.fromCharCode(r.parseByte(),r.parseByte(),r.parseByte(),r.parseByte()),i.fsSelection=r.parseUShort(),i.usFirstCharIndex=r.parseUShort(),i.usLastCharIndex=r.parseUShort(),i.sTypoAscender=r.parseShort(),i.sTypoDescender=r.parseShort(),i.sTypoLineGap=r.parseShort(),i.usWinAscent=r.parseUShort(),i.usWinDescent=r.parseUShort(),i.version>=1&&(i.ulCodePageRange1=r.parseULong(),i.ulCodePageRange2=r.parseULong()),i.version>=2&&(i.sxHeight=r.parseShort(),i.sCapHeight=r.parseShort(),i.usDefaultChar=r.parseUShort(),i.usBreakChar=r.parseUShort(),i.usMaxContent=r.parseUShort()),i}function Bq(e){return new Oe.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)}var mv={parse:Iq,make:Bq,unicodeRanges:fv,getUnicodeRange:Rq};function Nq(e,t){var i={},r=new Ue.Parser(e,t);switch(i.version=r.parseVersion(),i.italicAngle=r.parseFixed(),i.underlinePosition=r.parseShort(),i.underlineThickness=r.parseShort(),i.isFixedPitch=r.parseULong(),i.minMemType42=r.parseULong(),i.maxMemType42=r.parseULong(),i.minMemType1=r.parseULong(),i.maxMemType1=r.parseULong(),i.version){case 1:i.names=Ua.slice();break;case 2:i.numberOfGlyphs=r.parseUShort(),i.glyphNameIndex=new Array(i.numberOfGlyphs);for(var n=0;n<i.numberOfGlyphs;n++)i.glyphNameIndex[n]=r.parseUShort();i.names=[];for(var s=0;s<i.numberOfGlyphs;s++)if(i.glyphNameIndex[s]>=Ua.length){var a=r.parseChar();i.names.push(r.parseString(a))}break;case 2.5:i.numberOfGlyphs=r.parseUShort(),i.offset=new Array(i.numberOfGlyphs);for(var o=0;o<i.numberOfGlyphs;o++)i.offset[o]=r.parseChar();break}return i}function kq(){return new Oe.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var bM={parse:Nq,make:kq},rn=new Array(9);rn[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{substFormat:1,coverage:this.parsePointer(te.coverage),deltaGlyphId:this.parseUShort()};if(t===2)return{substFormat:2,coverage:this.parsePointer(te.coverage),substitute:this.parseOffset16List()};tt.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")};rn[2]=function(){var e=this.parseUShort();return tt.argument(e===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(te.coverage),sequences:this.parseListOfLists()}};rn[3]=function(){var e=this.parseUShort();return tt.argument(e===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(te.coverage),alternateSets:this.parseListOfLists()}};rn[4]=function(){var e=this.parseUShort();return tt.argument(e===1,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(te.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var yl={sequenceIndex:te.uShort,lookupListIndex:te.uShort};rn[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{substFormat:t,coverage:this.parsePointer(te.coverage),ruleSets:this.parseListOfLists(function(){var n=this.parseUShort(),s=this.parseUShort();return{input:this.parseUShortList(n-1),lookupRecords:this.parseRecordList(s,yl)}})};if(t===2)return{substFormat:t,coverage:this.parsePointer(te.coverage),classDef:this.parsePointer(te.classDef),classSets:this.parseListOfLists(function(){var n=this.parseUShort(),s=this.parseUShort();return{classes:this.parseUShortList(n-1),lookupRecords:this.parseRecordList(s,yl)}})};if(t===3){var i=this.parseUShort(),r=this.parseUShort();return{substFormat:t,coverages:this.parseList(i,te.pointer(te.coverage)),lookupRecords:this.parseRecordList(r,yl)}}tt.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};rn[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{substFormat:1,coverage:this.parsePointer(te.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(yl)}})};if(t===2)return{substFormat:2,coverage:this.parsePointer(te.coverage),backtrackClassDef:this.parsePointer(te.classDef),inputClassDef:this.parsePointer(te.classDef),lookaheadClassDef:this.parsePointer(te.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(yl)}})};if(t===3)return{substFormat:3,backtrackCoverage:this.parseList(te.pointer(te.coverage)),inputCoverage:this.parseList(te.pointer(te.coverage)),lookaheadCoverage:this.parseList(te.pointer(te.coverage)),lookupRecords:this.parseRecordList(yl)};tt.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};rn[7]=function(){var e=this.parseUShort();tt.argument(e===1,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),i=new te(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:rn[t].call(i)}};rn[8]=function(){var e=this.parseUShort();return tt.argument(e===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(te.coverage),backtrackCoverage:this.parseList(te.pointer(te.coverage)),lookaheadCoverage:this.parseList(te.pointer(te.coverage)),substitutes:this.parseUShortList()}};function Uq(e,t){t=t||0;var i=new te(e,t),r=i.parseVersion(1);return tt.argument(r===1||r===1.1,"Unsupported GSUB table version."),r===1?{version:r,scripts:i.parseScriptList(),features:i.parseFeatureList(),lookups:i.parseLookupList(rn)}:{version:r,scripts:i.parseScriptList(),features:i.parseFeatureList(),lookups:i.parseLookupList(rn),variations:i.parseFeatureVariationsList()}}var Jl=new Array(9);Jl[1]=function(e){return e.substFormat===1?new Oe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Oe.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new Oe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new Oe.Coverage(e.coverage)}].concat(Oe.ushortList("substitute",e.substitute)))};Jl[2]=function(e){return tt.assert(e.substFormat===1,"Lookup type 2 substFormat must be 1."),new Oe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Oe.Coverage(e.coverage)}].concat(Oe.tableList("seqSet",e.sequences,function(t){return new Oe.Table("sequenceSetTable",Oe.ushortList("sequence",t))})))};Jl[3]=function(e){return tt.assert(e.substFormat===1,"Lookup type 3 substFormat must be 1."),new Oe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Oe.Coverage(e.coverage)}].concat(Oe.tableList("altSet",e.alternateSets,function(t){return new Oe.Table("alternateSetTable",Oe.ushortList("alternate",t))})))};Jl[4]=function(e){return tt.assert(e.substFormat===1,"Lookup type 4 substFormat must be 1."),new Oe.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new Oe.Coverage(e.coverage)}].concat(Oe.tableList("ligSet",e.ligatureSets,function(t){return new Oe.Table("ligatureSetTable",Oe.tableList("ligature",t,function(i){return new Oe.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:i.ligGlyph}].concat(Oe.ushortList("component",i.components,i.components.length+1)))}))})))};Jl[6]=function(e){if(e.substFormat===1){var t=new Oe.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:e.substFormat},{name:"coverage",type:"TABLE",value:new Oe.Coverage(e.coverage)}].concat(Oe.tableList("chainRuleSet",e.chainRuleSets,function(n){return new Oe.Table("chainRuleSetTable",Oe.tableList("chainRule",n,function(s){var a=Oe.ushortList("backtrackGlyph",s.backtrack,s.backtrack.length).concat(Oe.ushortList("inputGlyph",s.input,s.input.length+1)).concat(Oe.ushortList("lookaheadGlyph",s.lookahead,s.lookahead.length)).concat(Oe.ushortList("substitution",[],s.lookupRecords.length));return s.lookupRecords.forEach(function(o,l){a=a.concat({name:"sequenceIndex"+l,type:"USHORT",value:o.sequenceIndex}).concat({name:"lookupListIndex"+l,type:"USHORT",value:o.lookupListIndex})}),new Oe.Table("chainRuleTable",a)}))})));return t}else if(e.substFormat===2)tt.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(e.substFormat===3){var i=[{name:"substFormat",type:"USHORT",value:e.substFormat}];i.push({name:"backtrackGlyphCount",type:"USHORT",value:e.backtrackCoverage.length}),e.backtrackCoverage.forEach(function(n,s){i.push({name:"backtrackCoverage"+s,type:"TABLE",value:new Oe.Coverage(n)})}),i.push({name:"inputGlyphCount",type:"USHORT",value:e.inputCoverage.length}),e.inputCoverage.forEach(function(n,s){i.push({name:"inputCoverage"+s,type:"TABLE",value:new Oe.Coverage(n)})}),i.push({name:"lookaheadGlyphCount",type:"USHORT",value:e.lookaheadCoverage.length}),e.lookaheadCoverage.forEach(function(n,s){i.push({name:"lookaheadCoverage"+s,type:"TABLE",value:new Oe.Coverage(n)})}),i.push({name:"substitutionCount",type:"USHORT",value:e.lookupRecords.length}),e.lookupRecords.forEach(function(n,s){i=i.concat({name:"sequenceIndex"+s,type:"USHORT",value:n.sequenceIndex}).concat({name:"lookupListIndex"+s,type:"USHORT",value:n.lookupListIndex})});var r=new Oe.Table("chainContextTable",i);return r}tt.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function Fq(e){return new Oe.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Oe.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new Oe.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new Oe.LookupList(e.lookups,Jl)}])}var wM={parse:Uq,make:Fq};function zq(e,t){var i=new Ue.Parser(e,t),r=i.parseULong();tt.argument(r===1,"Unsupported META table version."),i.parseULong(),i.parseULong();for(var n=i.parseULong(),s={},a=0;a<n;a++){var o=i.parseTag(),l=i.parseULong(),h=i.parseULong(),c=Rl.UTF8(e,t+l,h);s[o]=c}return s}function Gq(e){var t=Object.keys(e).length,i="",r=16+t*12,n=new Oe.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:r},{name:"numTags",type:"ULONG",value:t}]);for(var s in e){var a=i.length;i+=e[s],n.fields.push({name:"tag "+s,type:"TAG",value:s}),n.fields.push({name:"offset "+s,type:"ULONG",value:r+a}),n.fields.push({name:"length "+s,type:"ULONG",value:e[s].length})}return n.fields.push({name:"stringPool",type:"CHARARRAY",value:i}),n}var _M={parse:zq,make:Gq};function o_(e){return Math.log(e)/Math.log(2)|0}function K0(e){for(;e.length%4!==0;)e.push(0);for(var t=0,i=0;i<e.length;i+=4)t+=(e[i]<<24)+(e[i+1]<<16)+(e[i+2]<<8)+e[i+3];return t%=Math.pow(2,32),t}function l_(e,t,i,r){return new Oe.Record("Table Record",[{name:"tag",type:"TAG",value:e!==void 0?e:""},{name:"checkSum",type:"ULONG",value:t!==void 0?t:0},{name:"offset",type:"ULONG",value:i!==void 0?i:0},{name:"length",type:"ULONG",value:r!==void 0?r:0}])}function SM(e){var t=new Oe.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var i=Math.pow(2,o_(t.numTables));t.searchRange=16*i,t.entrySelector=o_(i),t.rangeShift=t.numTables*16-t.searchRange;for(var r=[],n=[],s=t.sizeOf()+l_().sizeOf()*t.numTables;s%4!==0;)s+=1,n.push({name:"padding",type:"BYTE",value:0});for(var a=0;a<e.length;a+=1){var o=e[a];tt.argument(o.tableName.length===4,"Table name"+o.tableName+" is invalid.");var l=o.sizeOf(),h=l_(o.tableName,K0(o.encode()),s,l);for(r.push({name:h.tag+" Table Record",type:"RECORD",value:h}),n.push({name:o.tableName+" table",type:"RECORD",value:o}),s+=l,tt.argument(!isNaN(s),"Something went wrong calculating the offset.");s%4!==0;)s+=1,n.push({name:"padding",type:"BYTE",value:0})}return r.sort(function(c,u){return c.value.tag>u.value.tag?1:-1}),t.fields=t.fields.concat(r),t.fields=t.fields.concat(n),t}function h_(e,t,i){for(var r=0;r<t.length;r+=1){var n=e.charToGlyphIndex(t[r]);if(n>0){var s=e.glyphs.get(n);return s.getMetrics()}}return i}function Hq(e){for(var t=0,i=0;i<e.length;i+=1)t+=e[i];return t/e.length}function Vq(e){for(var t=[],i=[],r=[],n=[],s=[],a=[],o=[],l,h=0,c=0,u=0,d=0,p=0,m=0;m<e.glyphs.length;m+=1){var g=e.glyphs.get(m),f=g.unicode|0;if(isNaN(g.advanceWidth))throw new Error("Glyph "+g.name+" ("+m+"): advanceWidth is not a number.");(l>f||l===void 0)&&f>0&&(l=f),h<f&&(h=f);var v=mv.getUnicodeRange(f);if(v<32)c|=1<<v;else if(v<64)u|=1<<v-32;else if(v<96)d|=1<<v-64;else if(v<123)p|=1<<v-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(g.name!==".notdef"){var y=g.getMetrics();t.push(y.xMin),i.push(y.yMin),r.push(y.xMax),n.push(y.yMax),a.push(y.leftSideBearing),o.push(y.rightSideBearing),s.push(g.advanceWidth)}}var x={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,i),xMax:Math.max.apply(null,r),yMax:Math.max.apply(null,n),advanceWidthMax:Math.max.apply(null,s),advanceWidthAvg:Hq(s),minLeftSideBearing:Math.min.apply(null,a),maxLeftSideBearing:Math.max.apply(null,a),minRightSideBearing:Math.min.apply(null,o)};x.ascender=e.ascender,x.descender=e.descender;var b=uM.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:x.xMin,yMin:x.yMin,xMax:x.xMax,yMax:x.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),S=cM.make({ascender:x.ascender,descender:x.descender,advanceWidthMax:x.advanceWidthMax,minLeftSideBearing:x.minLeftSideBearing,minRightSideBearing:x.minRightSideBearing,xMaxExtent:x.maxLeftSideBearing+(x.xMax-x.xMin),numberOfHMetrics:e.glyphs.length}),_=fM.make(e.glyphs.length),A=mv.make(Object.assign({xAvgCharWidth:Math.round(x.advanceWidthAvg),usFirstCharIndex:l,usLastCharIndex:h,ulUnicodeRange1:c,ulUnicodeRange2:u,ulUnicodeRange3:d,ulUnicodeRange4:p,sTypoAscender:x.ascender,sTypoDescender:x.descender,sTypoLineGap:0,usWinAscent:x.yMax,usWinDescent:Math.abs(x.yMin),ulCodePageRange1:1,sxHeight:h_(e,"xyvw",{yMax:Math.round(x.ascender/2)}).yMax,sCapHeight:h_(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",x).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0},e.tables.os2)),w=dM.make(e.glyphs),E=JT.make(e.glyphs),T=e.getEnglishName("fontFamily"),C=e.getEnglishName("fontSubfamily"),P=T+" "+C,k=e.getEnglishName("postScriptName");k||(k=T.replace(/\s/g,"")+"-"+C);var D={};for(var R in e.names)D[R]=e.names[R];D.uniqueID||(D.uniqueID={en:e.getEnglishName("manufacturer")+":"+P}),D.postScriptName||(D.postScriptName={en:k}),D.preferredFamily||(D.preferredFamily=e.names.fontFamily),D.preferredSubfamily||(D.preferredSubfamily=e.names.fontSubfamily);var G=[],N=xM.make(D,G),L=G.length>0?pM.make(G):void 0,H=bM.make(),F=hM.make(e.glyphs,{version:e.getEnglishName("version"),fullName:P,familyName:T,weightName:C,postScriptName:k,unitsPerEm:e.unitsPerEm,fontBBox:[0,x.yMin,x.ascender,x.advanceWidthMax]}),z=e.metas&&Object.keys(e.metas).length>0?_M.make(e.metas):void 0,U=[b,S,_,A,N,E,H,F,w];L&&U.push(L),e.tables.gsub&&U.push(wM.make(e.tables.gsub)),z&&U.push(z);for(var W=SM(U),Y=W.encode(),K=K0(Y),V=W.fields,ie=!1,Q=0;Q<V.length;Q+=1)if(V[Q].name==="head table"){V[Q].value.checkSumAdjustment=2981146554-K,ie=!0;break}if(!ie)throw new Error("Could not find head table with checkSum to adjust.");return W}var jq={make:SM,fontToTable:Vq,computeCheckSum:K0};function fm(e,t){for(var i=0,r=e.length-1;i<=r;){var n=i+r>>>1,s=e[n].tag;if(s===t)return n;s<t?i=n+1:r=n-1}return-i-1}function u_(e,t){for(var i=0,r=e.length-1;i<=r;){var n=i+r>>>1,s=e[n];if(s===t)return n;s<t?i=n+1:r=n-1}return-i-1}function c_(e,t){for(var i,r=0,n=e.length-1;r<=n;){var s=r+n>>>1;i=e[s];var a=i.start;if(a===t)return i;a<t?r=s+1:n=s-1}if(r>0)return i=e[r-1],t>i.end?0:i}function Nu(e,t){this.font=e,this.tableName=t}Nu.prototype={searchTag:fm,binSearch:u_,getTable:function(e){var t=this.font.tables[this.tableName];return!t&&e&&(t=this.font.tables[this.tableName]=this.createDefaultTable()),t},getScriptNames:function(){var e=this.getTable();return e?e.scripts.map(function(t){return t.tag}):[]},getDefaultScriptName:function(){var e=this.getTable();if(e){for(var t=!1,i=0;i<e.scripts.length;i++){var r=e.scripts[i].tag;if(r==="DFLT")return r;r==="latn"&&(t=!0)}if(t)return"latn"}},getScriptTable:function(e,t){var i=this.getTable(t);if(i){e=e||"DFLT";var r=i.scripts,n=fm(i.scripts,e);if(n>=0)return r[n].script;if(t){var s={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return r.splice(-1-n,0,s),s.script}}},getLangSysTable:function(e,t,i){var r=this.getScriptTable(e,i);if(r){if(!t||t==="dflt"||t==="DFLT")return r.defaultLangSys;var n=fm(r.langSysRecords,t);if(n>=0)return r.langSysRecords[n].langSys;if(i){var s={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return r.langSysRecords.splice(-1-n,0,s),s.langSys}}},getFeatureTable:function(e,t,i,r){var n=this.getLangSysTable(e,t,r);if(n){for(var s,a=n.featureIndexes,o=this.font.tables[this.tableName].features,l=0;l<a.length;l++)if(s=o[a[l]],s.tag===i)return s.feature;if(r){var h=o.length;return tt.assert(h===0||i>=o[h-1].tag,"Features must be added in alphabetical order."),s={tag:i,feature:{params:0,lookupListIndexes:[]}},o.push(s),a.push(h),s.feature}}},getLookupTables:function(e,t,i,r,n){var s=this.getFeatureTable(e,t,i,n),a=[];if(s){for(var o,l=s.lookupListIndexes,h=this.font.tables[this.tableName].lookups,c=0;c<l.length;c++)o=h[l[c]],o.lookupType===r&&a.push(o);if(a.length===0&&n){o={lookupType:r,lookupFlag:0,subtables:[],markFilteringSet:void 0};var u=h.length;return h.push(o),l.push(u),[o]}}return a},getGlyphClass:function(e,t){switch(e.format){case 1:return e.startGlyph<=t&&t<e.startGlyph+e.classes.length?e.classes[t-e.startGlyph]:0;case 2:var i=c_(e.ranges,t);return i?i.classId:0}},getCoverageIndex:function(e,t){switch(e.format){case 1:var i=u_(e.glyphs,t);return i>=0?i:-1;case 2:var r=c_(e.ranges,t);return r?r.index+t-r.start:-1}},expandCoverage:function(e){if(e.format===1)return e.glyphs;for(var t=[],i=e.ranges,r=0;r<i.length;r++)for(var n=i[r],s=n.start,a=n.end,o=s;o<=a;o++)t.push(o);return t}};function ku(e){Nu.call(this,e,"gpos")}ku.prototype=Nu.prototype;ku.prototype.init=function(){var e=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(e)};ku.prototype.getKerningValue=function(e,t,i){for(var r=0;r<e.length;r++)for(var n=e[r].subtables,s=0;s<n.length;s++){var a=n[s],o=this.getCoverageIndex(a.coverage,t);if(!(o<0))switch(a.posFormat){case 1:for(var l=a.pairSets[o],h=0;h<l.length;h++){var c=l[h];if(c.secondGlyph===i)return c.value1&&c.value1.xAdvance||0}break;case 2:var u=this.getGlyphClass(a.classDef1,t),d=this.getGlyphClass(a.classDef2,i),p=a.classRecords[u][d];return p.value1&&p.value1.xAdvance||0}}return 0};ku.prototype.getKerningTables=function(e,t){if(this.font.tables.gpos)return this.getLookupTables(e,t,"kern",2)};function gr(e){Nu.call(this,e,"gsub")}function Wq(e,t){var i=e.length;if(i!==t.length)return!1;for(var r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}function Z0(e,t,i){for(var r=e.subtables,n=0;n<r.length;n++){var s=r[n];if(s.substFormat===t)return s}if(i)return r.push(i),i}gr.prototype=Nu.prototype;gr.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};gr.prototype.getSingle=function(e,t,i){for(var r=[],n=this.getLookupTables(t,i,e,1),s=0;s<n.length;s++)for(var a=n[s].subtables,o=0;o<a.length;o++){var l=a[o],h=this.expandCoverage(l.coverage),c=void 0;if(l.substFormat===1){var u=l.deltaGlyphId;for(c=0;c<h.length;c++){var d=h[c];r.push({sub:d,by:d+u})}}else{var p=l.substitute;for(c=0;c<h.length;c++)r.push({sub:h[c],by:p[c]})}}return r};gr.prototype.getMultiple=function(e,t,i){for(var r=[],n=this.getLookupTables(t,i,e,2),s=0;s<n.length;s++)for(var a=n[s].subtables,o=0;o<a.length;o++){var l=a[o],h=this.expandCoverage(l.coverage),c=void 0;for(c=0;c<h.length;c++){var u=h[c],d=l.sequences[c];r.push({sub:u,by:d})}}return r};gr.prototype.getAlternates=function(e,t,i){for(var r=[],n=this.getLookupTables(t,i,e,3),s=0;s<n.length;s++)for(var a=n[s].subtables,o=0;o<a.length;o++)for(var l=a[o],h=this.expandCoverage(l.coverage),c=l.alternateSets,u=0;u<h.length;u++)r.push({sub:h[u],by:c[u]});return r};gr.prototype.getLigatures=function(e,t,i){for(var r=[],n=this.getLookupTables(t,i,e,4),s=0;s<n.length;s++)for(var a=n[s].subtables,o=0;o<a.length;o++)for(var l=a[o],h=this.expandCoverage(l.coverage),c=l.ligatureSets,u=0;u<h.length;u++)for(var d=h[u],p=c[u],m=0;m<p.length;m++){var g=p[m];r.push({sub:[d].concat(g.components),by:g.ligGlyph})}return r};gr.prototype.addSingle=function(e,t,i,r){var n=this.getLookupTables(i,r,e,1,!0)[0],s=Z0(n,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});tt.assert(s.coverage.format===1,"Single: unable to modify coverage table format "+s.coverage.format);var a=t.sub,o=this.binSearch(s.coverage.glyphs,a);o<0&&(o=-1-o,s.coverage.glyphs.splice(o,0,a),s.substitute.splice(o,0,0)),s.substitute[o]=t.by};gr.prototype.addMultiple=function(e,t,i,r){tt.assert(t.by instanceof Array&&t.by.length>1,'Multiple: "by" must be an array of two or more ids');var n=this.getLookupTables(i,r,e,2,!0)[0],s=Z0(n,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});tt.assert(s.coverage.format===1,"Multiple: unable to modify coverage table format "+s.coverage.format);var a=t.sub,o=this.binSearch(s.coverage.glyphs,a);o<0&&(o=-1-o,s.coverage.glyphs.splice(o,0,a),s.sequences.splice(o,0,0)),s.sequences[o]=t.by};gr.prototype.addAlternate=function(e,t,i,r){var n=this.getLookupTables(i,r,e,3,!0)[0],s=Z0(n,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});tt.assert(s.coverage.format===1,"Alternate: unable to modify coverage table format "+s.coverage.format);var a=t.sub,o=this.binSearch(s.coverage.glyphs,a);o<0&&(o=-1-o,s.coverage.glyphs.splice(o,0,a),s.alternateSets.splice(o,0,0)),s.alternateSets[o]=t.by};gr.prototype.addLigature=function(e,t,i,r){var n=this.getLookupTables(i,r,e,4,!0)[0],s=n.subtables[0];s||(s={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},n.subtables[0]=s),tt.assert(s.coverage.format===1,"Ligature: unable to modify coverage table format "+s.coverage.format);var a=t.sub[0],o=t.sub.slice(1),l={ligGlyph:t.by,components:o},h=this.binSearch(s.coverage.glyphs,a);if(h>=0){for(var c=s.ligatureSets[h],u=0;u<c.length;u++)if(Wq(c[u].components,o))return;c.push(l)}else h=-1-h,s.coverage.glyphs.splice(h,0,a),s.ligatureSets.splice(h,0,[l])};gr.prototype.getFeature=function(e,t,i){if(/ss\d\d/.test(e))return this.getSingle(e,t,i);switch(e){case"aalt":case"salt":return this.getSingle(e,t,i).concat(this.getAlternates(e,t,i));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,i);case"ccmp":return this.getMultiple(e,t,i).concat(this.getLigatures(e,t,i));case"stch":return this.getMultiple(e,t,i)}};gr.prototype.add=function(e,t,i,r){if(/ss\d\d/.test(e))return this.addSingle(e,t,i,r);switch(e){case"aalt":case"salt":return typeof t.by=="number"?this.addSingle(e,t,i,r):this.addAlternate(e,t,i,r);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,i,r);case"ccmp":return t.by instanceof Array?this.addMultiple(e,t,i,r):this.addLigature(e,t,i,r)}};function qq(){return typeof window<"u"}function Yq(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),r=0;r<e.length;++r)i[r]=e[r];return t}function Xq(e){for(var t=new Buffer(e.byteLength),i=new Uint8Array(e),r=0;r<t.length;++r)t[r]=i[r];return t}function bh(e,t){if(!e)throw t}function d_(e,t,i,r,n){var s;return(t&r)>0?(s=e.parseByte(),(t&n)===0&&(s=-s),s=i+s):(t&n)>0?s=i:s=i+e.parseShort(),s}function AM(e,t,i){var r=new Ue.Parser(t,i);e.numberOfContours=r.parseShort(),e._xMin=r.parseShort(),e._yMin=r.parseShort(),e._xMax=r.parseShort(),e._yMax=r.parseShort();var n,s;if(e.numberOfContours>0){for(var a=e.endPointIndices=[],o=0;o<e.numberOfContours;o+=1)a.push(r.parseUShort());e.instructionLength=r.parseUShort(),e.instructions=[];for(var l=0;l<e.instructionLength;l+=1)e.instructions.push(r.parseByte());var h=a[a.length-1]+1;n=[];for(var c=0;c<h;c+=1)if(s=r.parseByte(),n.push(s),(s&8)>0)for(var u=r.parseByte(),d=0;d<u;d+=1)n.push(s),c+=1;if(tt.argument(n.length===h,"Bad flags."),a.length>0){var p=[],m;if(h>0){for(var g=0;g<h;g+=1)s=n[g],m={},m.onCurve=!!(s&1),m.lastPointOfContour=a.indexOf(g)>=0,p.push(m);for(var f=0,v=0;v<h;v+=1)s=n[v],m=p[v],m.x=d_(r,s,f,2,16),f=m.x;for(var y=0,x=0;x<h;x+=1)s=n[x],m=p[x],m.y=d_(r,s,y,4,32),y=m.y}e.points=p}else e.points=[]}else if(e.numberOfContours===0)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var b=!0;b;){n=r.parseUShort();var S={glyphIndex:r.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(n&1)>0?(n&2)>0?(S.dx=r.parseShort(),S.dy=r.parseShort()):S.matchedPoints=[r.parseUShort(),r.parseUShort()]:(n&2)>0?(S.dx=r.parseChar(),S.dy=r.parseChar()):S.matchedPoints=[r.parseByte(),r.parseByte()],(n&8)>0?S.xScale=S.yScale=r.parseF2Dot14():(n&64)>0?(S.xScale=r.parseF2Dot14(),S.yScale=r.parseF2Dot14()):(n&128)>0&&(S.xScale=r.parseF2Dot14(),S.scale01=r.parseF2Dot14(),S.scale10=r.parseF2Dot14(),S.yScale=r.parseF2Dot14()),e.components.push(S),b=!!(n&32)}if(n&256){e.instructionLength=r.parseUShort(),e.instructions=[];for(var _=0;_<e.instructionLength;_+=1)e.instructions.push(r.parseByte())}}}function mm(e,t){for(var i=[],r=0;r<e.length;r+=1){var n=e[r],s={x:t.xScale*n.x+t.scale01*n.y+t.dx,y:t.scale10*n.x+t.yScale*n.y+t.dy,onCurve:n.onCurve,lastPointOfContour:n.lastPointOfContour};i.push(s)}return i}function Qq(e){for(var t=[],i=[],r=0;r<e.length;r+=1){var n=e[r];i.push(n),n.lastPointOfContour&&(t.push(i),i=[])}return tt.argument(i.length===0,"There are still points left in the current contour."),t}function EM(e){var t=new di;if(!e)return t;for(var i=Qq(e),r=0;r<i.length;++r){var n=i[r],s=null,a=n[n.length-1],o=n[0];if(a.onCurve)t.moveTo(a.x,a.y);else if(o.onCurve)t.moveTo(o.x,o.y);else{var l={x:(a.x+o.x)*.5,y:(a.y+o.y)*.5};t.moveTo(l.x,l.y)}for(var h=0;h<n.length;++h)if(s=a,a=o,o=n[(h+1)%n.length],a.onCurve)t.lineTo(a.x,a.y);else{var c=o;s.onCurve||((a.x+s.x)*.5,(a.y+s.y)*.5),o.onCurve||(c={x:(a.x+o.x)*.5,y:(a.y+o.y)*.5}),t.quadraticCurveTo(a.x,a.y,c.x,c.y)}t.closePath()}return t}function TM(e,t){if(t.isComposite)for(var i=0;i<t.components.length;i+=1){var r=t.components[i],n=e.get(r.glyphIndex);if(n.getPath(),n.points){var s=void 0;if(r.matchedPoints===void 0)s=mm(n.points,r);else{if(r.matchedPoints[0]>t.points.length-1||r.matchedPoints[1]>n.points.length-1)throw Error("Matched points out of range in "+t.name);var a=t.points[r.matchedPoints[0]],o=n.points[r.matchedPoints[1]],l={xScale:r.xScale,scale01:r.scale01,scale10:r.scale10,yScale:r.yScale,dx:0,dy:0};o=mm([o],l)[0],l.dx=a.x-o.x,l.dy=a.y-o.y,s=mm(n.points,l)}t.points=t.points.concat(s)}}return EM(t.points)}function Kq(e,t,i,r){for(var n=new zn.GlyphSet(r),s=0;s<i.length-1;s+=1){var a=i[s],o=i[s+1];a!==o?n.push(s,zn.ttfGlyphLoader(r,s,AM,e,t+a,TM)):n.push(s,zn.glyphLoader(r,s))}return n}function Zq(e,t,i,r){var n=new zn.GlyphSet(r);return r._push=function(s){var a=i[s],o=i[s+1];a!==o?n.push(s,zn.ttfGlyphLoader(r,s,AM,e,t+a,TM)):n.push(s,zn.glyphLoader(r,s))},n}function Jq(e,t,i,r,n){return n.lowMemory?Zq(e,t,i,r):Kq(e,t,i,r)}var MM={getPath:EM,parse:Jq},CM,no,DM,gv;function PM(e){this.font=e,this.getCommands=function(t){return MM.getPath(t).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function $q(e){return e}function LM(e){return Math.sign(e)*Math.round(Math.abs(e))}function eY(e){return Math.sign(e)*Math.round(Math.abs(e*2))/2}function tY(e){return Math.sign(e)*(Math.round(Math.abs(e)+.5)-.5)}function iY(e){return Math.sign(e)*Math.ceil(Math.abs(e))}function rY(e){return Math.sign(e)*Math.floor(Math.abs(e))}var OM=function(e){var t=this.srPeriod,i=this.srPhase,r=this.srThreshold,n=1;return e<0&&(e=-e,n=-1),e+=r-i,e=Math.trunc(e/t)*t,e+=i,e<0?i*n:e*n},On={x:1,y:0,axis:"x",distance:function(e,t,i,r){return(i?e.xo:e.x)-(r?t.xo:t.x)},interpolate:function(e,t,i,r){var n,s,a,o,l,h,c;if(!r||r===this){if(n=e.xo-t.xo,s=e.xo-i.xo,l=t.x-t.xo,h=i.x-i.xo,a=Math.abs(n),o=Math.abs(s),c=a+o,c===0){e.x=e.xo+(l+h)/2;return}e.x=e.xo+(l*o+h*a)/c;return}if(n=r.distance(e,t,!0,!0),s=r.distance(e,i,!0,!0),l=r.distance(t,t,!1,!0),h=r.distance(i,i,!1,!0),a=Math.abs(n),o=Math.abs(s),c=a+o,c===0){On.setRelative(e,e,(l+h)/2,r,!0);return}On.setRelative(e,e,(l*o+h*a)/c,r,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(e,t,i,r,n){if(!r||r===this){e.x=(n?t.xo:t.x)+i;return}var s=n?t.xo:t.x,a=n?t.yo:t.y,o=s+i*r.x,l=a+i*r.y;e.x=o+(e.y-l)/r.normalSlope},slope:0,touch:function(e){e.xTouched=!0},touched:function(e){return e.xTouched},untouch:function(e){e.xTouched=!1}},ls={x:0,y:1,axis:"y",distance:function(e,t,i,r){return(i?e.yo:e.y)-(r?t.yo:t.y)},interpolate:function(e,t,i,r){var n,s,a,o,l,h,c;if(!r||r===this){if(n=e.yo-t.yo,s=e.yo-i.yo,l=t.y-t.yo,h=i.y-i.yo,a=Math.abs(n),o=Math.abs(s),c=a+o,c===0){e.y=e.yo+(l+h)/2;return}e.y=e.yo+(l*o+h*a)/c;return}if(n=r.distance(e,t,!0,!0),s=r.distance(e,i,!0,!0),l=r.distance(t,t,!1,!0),h=r.distance(i,i,!1,!0),a=Math.abs(n),o=Math.abs(s),c=a+o,c===0){ls.setRelative(e,e,(l+h)/2,r,!0);return}ls.setRelative(e,e,(l*o+h*a)/c,r,!0)},normalSlope:0,setRelative:function(e,t,i,r,n){if(!r||r===this){e.y=(n?t.yo:t.y)+i;return}var s=n?t.xo:t.x,a=n?t.yo:t.y,o=s+i*r.x,l=a+i*r.y;e.y=l+r.normalSlope*(e.x-o)},slope:Number.POSITIVE_INFINITY,touch:function(e){e.yTouched=!0},touched:function(e){return e.yTouched},untouch:function(e){e.yTouched=!1}};Object.freeze(On);Object.freeze(ls);function Uu(e,t){this.x=e,this.y=t,this.axis=void 0,this.slope=t/e,this.normalSlope=-e/t,Object.freeze(this)}Uu.prototype.distance=function(e,t,i,r){return this.x*On.distance(e,t,i,r)+this.y*ls.distance(e,t,i,r)};Uu.prototype.interpolate=function(e,t,i,r){var n,s,a,o,l,h,c;if(a=r.distance(e,t,!0,!0),o=r.distance(e,i,!0,!0),n=r.distance(t,t,!1,!0),s=r.distance(i,i,!1,!0),l=Math.abs(a),h=Math.abs(o),c=l+h,c===0){this.setRelative(e,e,(n+s)/2,r,!0);return}this.setRelative(e,e,(n*h+s*l)/c,r,!0)};Uu.prototype.setRelative=function(e,t,i,r,n){r=r||this;var s=n?t.xo:t.x,a=n?t.yo:t.y,o=s+i*r.x,l=a+i*r.y,h=r.normalSlope,c=this.slope,u=e.x,d=e.y;e.x=(c*u-h*o+l-d)/(c-h),e.y=c*(e.x-u)+d};Uu.prototype.touch=function(e){e.xTouched=!0,e.yTouched=!0};function Fu(e,t){var i=Math.sqrt(e*e+t*t);return e/=i,t/=i,e===1&&t===0?On:e===0&&t===1?ls:new Uu(e,t)}function ms(e,t,i,r){this.x=this.xo=Math.round(e*64)/64,this.y=this.yo=Math.round(t*64)/64,this.lastPointOfContour=i,this.onCurve=r,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}ms.prototype.nextTouched=function(e){for(var t=this.nextPointOnContour;!e.touched(t)&&t!==this;)t=t.nextPointOnContour;return t};ms.prototype.prevTouched=function(e){for(var t=this.prevPointOnContour;!e.touched(t)&&t!==this;)t=t.prevPointOnContour;return t};var gu=Object.freeze(new ms(0,0)),nY={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Js(e,t){switch(this.env=e,this.stack=[],this.prog=t,e){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=On,this.round=LM}}PM.prototype.exec=function(e,t){if(typeof t!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var i=this.font,r=this._prepState;if(!r||r.ppem!==t){var n=this._fpgmState;if(!n){Js.prototype=nY,n=this._fpgmState=new Js("fpgm",i.tables.fpgm),n.funcs=[],n.font=i,oe.DEBUG&&(console.log("---EXEC FPGM---"),n.step=-1);try{no(n)}catch(h){console.log("Hinting error in FPGM:"+h),this._errorState=3;return}}Js.prototype=n,r=this._prepState=new Js("prep",i.tables.prep),r.ppem=t;var s=i.tables.cvt;if(s)for(var a=r.cvt=new Array(s.length),o=t/i.unitsPerEm,l=0;l<s.length;l++)a[l]=s[l]*o;else r.cvt=[];oe.DEBUG&&(console.log("---EXEC PREP---"),r.step=-1);try{no(r)}catch(h){this._errorState<2&&console.log("Hinting error in PREP:"+h),this._errorState=2}}if(!(this._errorState>1))try{return DM(e,r)}catch(h){this._errorState<1&&(console.log("Hinting error:"+h),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};DM=function(e,t){var i=t.ppem/t.font.unitsPerEm,r=i,n=e.components,s,a,o;if(Js.prototype=t,!n)o=new Js("glyf",e.instructions),oe.DEBUG&&(console.log("---EXEC GLYPH---"),o.step=-1),gv(e,o,i,r),a=o.gZone;else{var l=t.font;a=[],s=[];for(var h=0;h<n.length;h++){var c=n[h],u=l.glyphs.get(c.glyphIndex);o=new Js("glyf",u.instructions),oe.DEBUG&&(console.log("---EXEC COMP "+h+"---"),o.step=-1),gv(u,o,i,r);for(var d=Math.round(c.dx*i),p=Math.round(c.dy*r),m=o.gZone,g=o.contours,f=0;f<m.length;f++){var v=m[f];v.xTouched=v.yTouched=!1,v.xo=v.x=v.x+d,v.yo=v.y=v.y+p}var y=a.length;a.push.apply(a,m);for(var x=0;x<g.length;x++)s.push(g[x]+y)}e.instructions&&!o.inhibitGridFit&&(o=new Js("glyf",e.instructions),o.gZone=o.z0=o.z1=o.z2=a,o.contours=s,a.push(new ms(0,0),new ms(Math.round(e.advanceWidth*i),0)),oe.DEBUG&&(console.log("---EXEC COMPOSITE---"),o.step=-1),no(o),a.length-=2)}return a};gv=function(e,t,i,r){for(var n=e.points||[],s=n.length,a=t.gZone=t.z0=t.z1=t.z2=[],o=t.contours=[],l,h=0;h<s;h++)l=n[h],a[h]=new ms(l.x*i,l.y*r,l.lastPointOfContour,l.onCurve);for(var c,u,d=0;d<s;d++)l=a[d],c||(c=l,o.push(d)),l.lastPointOfContour?(l.nextPointOnContour=c,c.prevPointOnContour=l,c=void 0):(u=a[d+1],l.nextPointOnContour=u,u.prevPointOnContour=l);if(!t.inhibitGridFit){if(oe.DEBUG){console.log("PROCESSING GLYPH",t.stack);for(var p=0;p<s;p++)console.log(p,a[p].x,a[p].y)}if(a.push(new ms(0,0),new ms(Math.round(e.advanceWidth*i),0)),no(t),a.length-=2,oe.DEBUG){console.log("FINISHED GLYPH",t.stack);for(var m=0;m<s;m++)console.log(m,a[m].x,a[m].y)}}};no=function(e){var t=e.prog;if(t){var i=t.length,r;for(e.ip=0;e.ip<i;e.ip++){if(oe.DEBUG&&e.step++,r=CM[t[e.ip]],!r)throw new Error("unknown instruction: 0x"+Number(t[e.ip]).toString(16));r(e)}}};function Dp(e){for(var t=e.tZone=new Array(e.gZone.length),i=0;i<t.length;i++)t[i]=new ms(0,0)}function RM(e,t){var i=e.prog,r=e.ip,n=1,s;do if(s=i[++r],s===88)n++;else if(s===89)n--;else if(s===64)r+=i[r+1]+1;else if(s===65)r+=2*i[r+1]+1;else if(s>=176&&s<=183)r+=s-176+1;else if(s>=184&&s<=191)r+=(s-184+1)*2;else if(t&&n===1&&s===27)break;while(n>0);e.ip=r}function p_(e,t){oe.DEBUG&&console.log(t.step,"SVTCA["+e.axis+"]"),t.fv=t.pv=t.dpv=e}function f_(e,t){oe.DEBUG&&console.log(t.step,"SPVTCA["+e.axis+"]"),t.pv=t.dpv=e}function m_(e,t){oe.DEBUG&&console.log(t.step,"SFVTCA["+e.axis+"]"),t.fv=e}function g_(e,t){var i=t.stack,r=i.pop(),n=i.pop(),s=t.z2[r],a=t.z1[n];oe.DEBUG&&console.log("SPVTL["+e+"]",r,n);var o,l;e?(o=s.y-a.y,l=a.x-s.x):(o=a.x-s.x,l=a.y-s.y),t.pv=t.dpv=Fu(o,l)}function v_(e,t){var i=t.stack,r=i.pop(),n=i.pop(),s=t.z2[r],a=t.z1[n];oe.DEBUG&&console.log("SFVTL["+e+"]",r,n);var o,l;e?(o=s.y-a.y,l=a.x-s.x):(o=a.x-s.x,l=a.y-s.y),t.fv=Fu(o,l)}function sY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"SPVFS[]",i,r),e.pv=e.dpv=Fu(r,i)}function aY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"SPVFS[]",i,r),e.fv=Fu(r,i)}function oY(e){var t=e.stack,i=e.pv;oe.DEBUG&&console.log(e.step,"GPV[]"),t.push(i.x*16384),t.push(i.y*16384)}function lY(e){var t=e.stack,i=e.fv;oe.DEBUG&&console.log(e.step,"GFV[]"),t.push(i.x*16384),t.push(i.y*16384)}function hY(e){e.fv=e.pv,oe.DEBUG&&console.log(e.step,"SFVTPV[]")}function uY(e){var t=e.stack,i=t.pop(),r=t.pop(),n=t.pop(),s=t.pop(),a=t.pop(),o=e.z0,l=e.z1,h=o[i],c=o[r],u=l[n],d=l[s],p=e.z2[a];oe.DEBUG&&console.log("ISECT[], ",i,r,n,s,a);var m=h.x,g=h.y,f=c.x,v=c.y,y=u.x,x=u.y,b=d.x,S=d.y,_=(m-f)*(x-S)-(g-v)*(y-b),A=m*v-g*f,w=y*S-x*b;p.x=(A*(y-b)-w*(m-f))/_,p.y=(A*(x-S)-w*(g-v))/_}function cY(e){e.rp0=e.stack.pop(),oe.DEBUG&&console.log(e.step,"SRP0[]",e.rp0)}function dY(e){e.rp1=e.stack.pop(),oe.DEBUG&&console.log(e.step,"SRP1[]",e.rp1)}function pY(e){e.rp2=e.stack.pop(),oe.DEBUG&&console.log(e.step,"SRP2[]",e.rp2)}function fY(e){var t=e.stack.pop();switch(oe.DEBUG&&console.log(e.step,"SZP0[]",t),e.zp0=t,t){case 0:e.tZone||Dp(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function mY(e){var t=e.stack.pop();switch(oe.DEBUG&&console.log(e.step,"SZP1[]",t),e.zp1=t,t){case 0:e.tZone||Dp(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function gY(e){var t=e.stack.pop();switch(oe.DEBUG&&console.log(e.step,"SZP2[]",t),e.zp2=t,t){case 0:e.tZone||Dp(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function vY(e){var t=e.stack.pop();switch(oe.DEBUG&&console.log(e.step,"SZPS[]",t),e.zp0=e.zp1=e.zp2=t,t){case 0:e.tZone||Dp(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}}function yY(e){e.loop=e.stack.pop(),oe.DEBUG&&console.log(e.step,"SLOOP[]",e.loop)}function xY(e){oe.DEBUG&&console.log(e.step,"RTG[]"),e.round=LM}function bY(e){oe.DEBUG&&console.log(e.step,"RTHG[]"),e.round=tY}function wY(e){var t=e.stack.pop();oe.DEBUG&&console.log(e.step,"SMD[]",t),e.minDis=t/64}function _Y(e){oe.DEBUG&&console.log(e.step,"ELSE[]"),RM(e,!1)}function SY(e){var t=e.stack.pop();oe.DEBUG&&console.log(e.step,"JMPR[]",t),e.ip+=t-1}function AY(e){var t=e.stack.pop();oe.DEBUG&&console.log(e.step,"SCVTCI[]",t),e.cvCutIn=t/64}function EY(e){var t=e.stack;oe.DEBUG&&console.log(e.step,"DUP[]"),t.push(t[t.length-1])}function gm(e){oe.DEBUG&&console.log(e.step,"POP[]"),e.stack.pop()}function TY(e){oe.DEBUG&&console.log(e.step,"CLEAR[]"),e.stack.length=0}function MY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"SWAP[]"),t.push(i),t.push(r)}function CY(e){var t=e.stack;oe.DEBUG&&console.log(e.step,"DEPTH[]"),t.push(t.length)}function DY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"LOOPCALL[]",i,r);var n=e.ip,s=e.prog;e.prog=e.funcs[i];for(var a=0;a<r;a++)no(e),oe.DEBUG&&console.log(++e.step,a+1<r?"next loopcall":"done loopcall",a);e.ip=n,e.prog=s}function PY(e){var t=e.stack.pop();oe.DEBUG&&console.log(e.step,"CALL[]",t);var i=e.ip,r=e.prog;e.prog=e.funcs[t],no(e),e.ip=i,e.prog=r,oe.DEBUG&&console.log(++e.step,"returning from",t)}function LY(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"CINDEX[]",i),t.push(t[t.length-i])}function OY(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"MINDEX[]",i),t.push(t.splice(t.length-i,1)[0])}function RY(e){if(e.env!=="fpgm")throw new Error("FDEF not allowed here");var t=e.stack,i=e.prog,r=e.ip,n=t.pop(),s=r;for(oe.DEBUG&&console.log(e.step,"FDEF[]",n);i[++r]!==45;);e.ip=r,e.funcs[n]=i.slice(s+1,r)}function y_(e,t){var i=t.stack.pop(),r=t.z0[i],n=t.fv,s=t.pv;oe.DEBUG&&console.log(t.step,"MDAP["+e+"]",i);var a=s.distance(r,gu);e&&(a=t.round(a)),n.setRelative(r,gu,a,s),n.touch(r),t.rp0=t.rp1=i}function x_(e,t){var i=t.z2,r=i.length-2,n,s,a;oe.DEBUG&&console.log(t.step,"IUP["+e.axis+"]");for(var o=0;o<r;o++)n=i[o],!e.touched(n)&&(s=n.prevTouched(e),s!==n&&(a=n.nextTouched(e),s===a&&e.setRelative(n,n,e.distance(s,s,!1,!0),e,!0),e.interpolate(n,s,a,e)))}function b_(e,t){for(var i=t.stack,r=e?t.rp1:t.rp2,n=(e?t.z0:t.z1)[r],s=t.fv,a=t.pv,o=t.loop,l=t.z2;o--;){var h=i.pop(),c=l[h],u=a.distance(n,n,!1,!0);s.setRelative(c,c,u,a),s.touch(c),oe.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-o)+": ":"")+"SHP["+(e?"rp1":"rp2")+"]",h)}t.loop=1}function w_(e,t){var i=t.stack,r=e?t.rp1:t.rp2,n=(e?t.z0:t.z1)[r],s=t.fv,a=t.pv,o=i.pop(),l=t.z2[t.contours[o]],h=l;oe.DEBUG&&console.log(t.step,"SHC["+e+"]",o);var c=a.distance(n,n,!1,!0);do h!==n&&s.setRelative(h,h,c,a),h=h.nextPointOnContour;while(h!==l)}function __(e,t){var i=t.stack,r=e?t.rp1:t.rp2,n=(e?t.z0:t.z1)[r],s=t.fv,a=t.pv,o=i.pop();oe.DEBUG&&console.log(t.step,"SHZ["+e+"]",o);var l;switch(o){case 0:l=t.tZone;break;case 1:l=t.gZone;break;default:throw new Error("Invalid zone")}for(var h,c=a.distance(n,n,!1,!0),u=l.length-2,d=0;d<u;d++)h=l[d],s.setRelative(h,h,c,a)}function IY(e){for(var t=e.stack,i=e.loop,r=e.fv,n=t.pop()/64,s=e.z2;i--;){var a=t.pop(),o=s[a];oe.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-i)+": ":"")+"SHPIX[]",a,n),r.setRelative(o,o,n),r.touch(o)}e.loop=1}function BY(e){for(var t=e.stack,i=e.rp1,r=e.rp2,n=e.loop,s=e.z0[i],a=e.z1[r],o=e.fv,l=e.dpv,h=e.z2;n--;){var c=t.pop(),u=h[c];oe.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-n)+": ":"")+"IP[]",c,i,"<->",r),o.interpolate(u,s,a,l),o.touch(u)}e.loop=1}function S_(e,t){var i=t.stack,r=i.pop()/64,n=i.pop(),s=t.z1[n],a=t.z0[t.rp0],o=t.fv,l=t.pv;o.setRelative(s,a,r,l),o.touch(s),oe.DEBUG&&console.log(t.step,"MSIRP["+e+"]",r,n),t.rp1=t.rp0,t.rp2=n,e&&(t.rp0=n)}function NY(e){for(var t=e.stack,i=e.rp0,r=e.z0[i],n=e.loop,s=e.fv,a=e.pv,o=e.z1;n--;){var l=t.pop(),h=o[l];oe.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-n)+": ":"")+"ALIGNRP[]",l),s.setRelative(h,r,0,a),s.touch(h)}e.loop=1}function kY(e){oe.DEBUG&&console.log(e.step,"RTDG[]"),e.round=eY}function A_(e,t){var i=t.stack,r=i.pop(),n=i.pop(),s=t.z0[n],a=t.fv,o=t.pv,l=t.cvt[r];oe.DEBUG&&console.log(t.step,"MIAP["+e+"]",r,"(",l,")",n);var h=o.distance(s,gu);e&&(Math.abs(h-l)<t.cvCutIn&&(h=l),h=t.round(h)),a.setRelative(s,gu,h,o),t.zp0===0&&(s.xo=s.x,s.yo=s.y),a.touch(s),t.rp0=t.rp1=n}function UY(e){var t=e.prog,i=e.ip,r=e.stack,n=t[++i];oe.DEBUG&&console.log(e.step,"NPUSHB[]",n);for(var s=0;s<n;s++)r.push(t[++i]);e.ip=i}function FY(e){var t=e.ip,i=e.prog,r=e.stack,n=i[++t];oe.DEBUG&&console.log(e.step,"NPUSHW[]",n);for(var s=0;s<n;s++){var a=i[++t]<<8|i[++t];a&32768&&(a=-((a^65535)+1)),r.push(a)}e.ip=t}function zY(e){var t=e.stack,i=e.store;i||(i=e.store=[]);var r=t.pop(),n=t.pop();oe.DEBUG&&console.log(e.step,"WS",r,n),i[n]=r}function GY(e){var t=e.stack,i=e.store,r=t.pop();oe.DEBUG&&console.log(e.step,"RS",r);var n=i&&i[r]||0;t.push(n)}function HY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"WCVTP",i,r),e.cvt[r]=i/64}function VY(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"RCVT",i),t.push(e.cvt[i]*64)}function E_(e,t){var i=t.stack,r=i.pop(),n=t.z2[r];oe.DEBUG&&console.log(t.step,"GC["+e+"]",r),i.push(t.dpv.distance(n,gu,e,!1)*64)}function T_(e,t){var i=t.stack,r=i.pop(),n=i.pop(),s=t.z1[r],a=t.z0[n],o=t.dpv.distance(a,s,e,e);oe.DEBUG&&console.log(t.step,"MD["+e+"]",r,n,"->",o),t.stack.push(Math.round(o*64))}function jY(e){oe.DEBUG&&console.log(e.step,"MPPEM[]"),e.stack.push(e.ppem)}function WY(e){oe.DEBUG&&console.log(e.step,"FLIPON[]"),e.autoFlip=!0}function qY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"LT[]",i,r),t.push(r<i?1:0)}function YY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"LTEQ[]",i,r),t.push(r<=i?1:0)}function XY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"GT[]",i,r),t.push(r>i?1:0)}function QY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"GTEQ[]",i,r),t.push(r>=i?1:0)}function KY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"EQ[]",i,r),t.push(i===r?1:0)}function ZY(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"NEQ[]",i,r),t.push(i!==r?1:0)}function JY(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"ODD[]",i),t.push(Math.trunc(i)%2?1:0)}function $Y(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"EVEN[]",i),t.push(Math.trunc(i)%2?0:1)}function eX(e){var t=e.stack.pop();oe.DEBUG&&console.log(e.step,"IF[]",t),t||(RM(e,!0),oe.DEBUG&&console.log(e.step,"EIF[]"))}function tX(e){oe.DEBUG&&console.log(e.step,"EIF[]")}function iX(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"AND[]",i,r),t.push(i&&r?1:0)}function rX(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"OR[]",i,r),t.push(i||r?1:0)}function nX(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"NOT[]",i),t.push(i?0:1)}function vm(e,t){var i=t.stack,r=i.pop(),n=t.fv,s=t.pv,a=t.ppem,o=t.deltaBase+(e-1)*16,l=t.deltaShift,h=t.z0;oe.DEBUG&&console.log(t.step,"DELTAP["+e+"]",r,i);for(var c=0;c<r;c++){var u=i.pop(),d=i.pop(),p=o+((d&240)>>4);if(p===a){var m=(d&15)-8;m>=0&&m++,oe.DEBUG&&console.log(t.step,"DELTAPFIX",u,"by",m*l);var g=h[u];n.setRelative(g,g,m*l,s)}}}function sX(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"SDB[]",i),e.deltaBase=i}function aX(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"SDS[]",i),e.deltaShift=Math.pow(.5,i)}function oX(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"ADD[]",i,r),t.push(r+i)}function lX(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"SUB[]",i,r),t.push(r-i)}function hX(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"DIV[]",i,r),t.push(r*64/i)}function uX(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"MUL[]",i,r),t.push(r*i/64)}function cX(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"ABS[]",i),t.push(Math.abs(i))}function dX(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"NEG[]",i),t.push(-i)}function pX(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"FLOOR[]",i),t.push(Math.floor(i/64)*64)}function fX(e){var t=e.stack,i=t.pop();oe.DEBUG&&console.log(e.step,"CEILING[]",i),t.push(Math.ceil(i/64)*64)}function Kc(e,t){var i=t.stack,r=i.pop();oe.DEBUG&&console.log(t.step,"ROUND[]"),i.push(t.round(r/64)*64)}function mX(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"WCVTF[]",i,r),e.cvt[r]=i*e.ppem/e.font.unitsPerEm}function ym(e,t){var i=t.stack,r=i.pop(),n=t.ppem,s=t.deltaBase+(e-1)*16,a=t.deltaShift;oe.DEBUG&&console.log(t.step,"DELTAC["+e+"]",r,i);for(var o=0;o<r;o++){var l=i.pop(),h=i.pop(),c=s+((h&240)>>4);if(c===n){var u=(h&15)-8;u>=0&&u++;var d=u*a;oe.DEBUG&&console.log(t.step,"DELTACFIX",l,"by",d),t.cvt[l]+=d}}}function gX(e){var t=e.stack.pop();oe.DEBUG&&console.log(e.step,"SROUND[]",t),e.round=OM;var i;switch(t&192){case 0:i=.5;break;case 64:i=1;break;case 128:i=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=i,t&48){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*i;break;case 32:e.srPhase=.5*i;break;case 48:e.srPhase=.75*i;break;default:throw new Error("invalid SROUND value")}t&=15,t===0?e.srThreshold=0:e.srThreshold=(t/8-.5)*i}function vX(e){var t=e.stack.pop();oe.DEBUG&&console.log(e.step,"S45ROUND[]",t),e.round=OM;var i;switch(t&192){case 0:i=Math.sqrt(2)/2;break;case 64:i=Math.sqrt(2);break;case 128:i=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=i,t&48){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*i;break;case 32:e.srPhase=.5*i;break;case 48:e.srPhase=.75*i;break;default:throw new Error("invalid S45ROUND value")}t&=15,t===0?e.srThreshold=0:e.srThreshold=(t/8-.5)*i}function yX(e){oe.DEBUG&&console.log(e.step,"ROFF[]"),e.round=$q}function xX(e){oe.DEBUG&&console.log(e.step,"RUTG[]"),e.round=iY}function bX(e){oe.DEBUG&&console.log(e.step,"RDTG[]"),e.round=rY}function wX(e){var t=e.stack.pop();oe.DEBUG&&console.log(e.step,"SCANCTRL[]",t)}function M_(e,t){var i=t.stack,r=i.pop(),n=i.pop(),s=t.z2[r],a=t.z1[n];oe.DEBUG&&console.log(t.step,"SDPVTL["+e+"]",r,n);var o,l;e?(o=s.y-a.y,l=a.x-s.x):(o=a.x-s.x,l=a.y-s.y),t.dpv=Fu(o,l)}function _X(e){var t=e.stack,i=t.pop(),r=0;oe.DEBUG&&console.log(e.step,"GETINFO[]",i),i&1&&(r=35),i&32&&(r|=4096),t.push(r)}function SX(e){var t=e.stack,i=t.pop(),r=t.pop(),n=t.pop();oe.DEBUG&&console.log(e.step,"ROLL[]"),t.push(r),t.push(i),t.push(n)}function AX(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"MAX[]",i,r),t.push(Math.max(r,i))}function EX(e){var t=e.stack,i=t.pop(),r=t.pop();oe.DEBUG&&console.log(e.step,"MIN[]",i,r),t.push(Math.min(r,i))}function TX(e){var t=e.stack.pop();oe.DEBUG&&console.log(e.step,"SCANTYPE[]",t)}function MX(e){var t=e.stack.pop(),i=e.stack.pop();switch(oe.DEBUG&&console.log(e.step,"INSTCTRL[]",t,i),t){case 1:e.inhibitGridFit=!!i;return;case 2:e.ignoreCvt=!!i;return;default:throw new Error("invalid INSTCTRL[] selector")}}function Ns(e,t){var i=t.stack,r=t.prog,n=t.ip;oe.DEBUG&&console.log(t.step,"PUSHB["+e+"]");for(var s=0;s<e;s++)i.push(r[++n]);t.ip=n}function ks(e,t){var i=t.ip,r=t.prog,n=t.stack;oe.DEBUG&&console.log(t.ip,"PUSHW["+e+"]");for(var s=0;s<e;s++){var a=r[++i]<<8|r[++i];a&32768&&(a=-((a^65535)+1)),n.push(a)}t.ip=i}function ke(e,t,i,r,n,s){var a=s.stack,o=e&&a.pop(),l=a.pop(),h=s.rp0,c=s.z0[h],u=s.z1[l],d=s.minDis,p=s.fv,m=s.dpv,g,f,v,y;f=g=m.distance(u,c,!0,!0),v=f>=0?1:-1,f=Math.abs(f),e&&(y=s.cvt[o],r&&Math.abs(f-y)<s.cvCutIn&&(f=y)),i&&f<d&&(f=d),r&&(f=s.round(f)),p.setRelative(u,c,v*f,m),p.touch(u),oe.DEBUG&&console.log(s.step,(e?"MIRP[":"MDRP[")+(t?"M":"m")+(i?">":"_")+(r?"R":"_")+(n===0?"Gr":n===1?"Bl":n===2?"Wh":"")+"]",e?o+"("+s.cvt[o]+","+y+")":"",l,"(d =",g,"->",v*f,")"),s.rp1=s.rp0,s.rp2=l,t&&(s.rp0=l)}CM=[p_.bind(void 0,ls),p_.bind(void 0,On),f_.bind(void 0,ls),f_.bind(void 0,On),m_.bind(void 0,ls),m_.bind(void 0,On),g_.bind(void 0,0),g_.bind(void 0,1),v_.bind(void 0,0),v_.bind(void 0,1),sY,aY,oY,lY,hY,uY,cY,dY,pY,fY,mY,gY,vY,yY,xY,bY,wY,_Y,SY,AY,void 0,void 0,EY,gm,TY,MY,CY,LY,OY,void 0,void 0,void 0,DY,PY,RY,void 0,y_.bind(void 0,0),y_.bind(void 0,1),x_.bind(void 0,ls),x_.bind(void 0,On),b_.bind(void 0,0),b_.bind(void 0,1),w_.bind(void 0,0),w_.bind(void 0,1),__.bind(void 0,0),__.bind(void 0,1),IY,BY,S_.bind(void 0,0),S_.bind(void 0,1),NY,kY,A_.bind(void 0,0),A_.bind(void 0,1),UY,FY,zY,GY,HY,VY,E_.bind(void 0,0),E_.bind(void 0,1),void 0,T_.bind(void 0,0),T_.bind(void 0,1),jY,void 0,WY,void 0,void 0,qY,YY,XY,QY,KY,ZY,JY,$Y,eX,tX,iX,rX,nX,vm.bind(void 0,1),sX,aX,oX,lX,hX,uX,cX,dX,pX,fX,Kc.bind(void 0,0),Kc.bind(void 0,1),Kc.bind(void 0,2),Kc.bind(void 0,3),void 0,void 0,void 0,void 0,mX,vm.bind(void 0,2),vm.bind(void 0,3),ym.bind(void 0,1),ym.bind(void 0,2),ym.bind(void 0,3),gX,vX,void 0,void 0,yX,void 0,xX,bX,gm,gm,void 0,void 0,void 0,void 0,void 0,wX,M_.bind(void 0,0),M_.bind(void 0,1),_X,void 0,SX,AX,EX,TX,MX,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Ns.bind(void 0,1),Ns.bind(void 0,2),Ns.bind(void 0,3),Ns.bind(void 0,4),Ns.bind(void 0,5),Ns.bind(void 0,6),Ns.bind(void 0,7),Ns.bind(void 0,8),ks.bind(void 0,1),ks.bind(void 0,2),ks.bind(void 0,3),ks.bind(void 0,4),ks.bind(void 0,5),ks.bind(void 0,6),ks.bind(void 0,7),ks.bind(void 0,8),ke.bind(void 0,0,0,0,0,0),ke.bind(void 0,0,0,0,0,1),ke.bind(void 0,0,0,0,0,2),ke.bind(void 0,0,0,0,0,3),ke.bind(void 0,0,0,0,1,0),ke.bind(void 0,0,0,0,1,1),ke.bind(void 0,0,0,0,1,2),ke.bind(void 0,0,0,0,1,3),ke.bind(void 0,0,0,1,0,0),ke.bind(void 0,0,0,1,0,1),ke.bind(void 0,0,0,1,0,2),ke.bind(void 0,0,0,1,0,3),ke.bind(void 0,0,0,1,1,0),ke.bind(void 0,0,0,1,1,1),ke.bind(void 0,0,0,1,1,2),ke.bind(void 0,0,0,1,1,3),ke.bind(void 0,0,1,0,0,0),ke.bind(void 0,0,1,0,0,1),ke.bind(void 0,0,1,0,0,2),ke.bind(void 0,0,1,0,0,3),ke.bind(void 0,0,1,0,1,0),ke.bind(void 0,0,1,0,1,1),ke.bind(void 0,0,1,0,1,2),ke.bind(void 0,0,1,0,1,3),ke.bind(void 0,0,1,1,0,0),ke.bind(void 0,0,1,1,0,1),ke.bind(void 0,0,1,1,0,2),ke.bind(void 0,0,1,1,0,3),ke.bind(void 0,0,1,1,1,0),ke.bind(void 0,0,1,1,1,1),ke.bind(void 0,0,1,1,1,2),ke.bind(void 0,0,1,1,1,3),ke.bind(void 0,1,0,0,0,0),ke.bind(void 0,1,0,0,0,1),ke.bind(void 0,1,0,0,0,2),ke.bind(void 0,1,0,0,0,3),ke.bind(void 0,1,0,0,1,0),ke.bind(void 0,1,0,0,1,1),ke.bind(void 0,1,0,0,1,2),ke.bind(void 0,1,0,0,1,3),ke.bind(void 0,1,0,1,0,0),ke.bind(void 0,1,0,1,0,1),ke.bind(void 0,1,0,1,0,2),ke.bind(void 0,1,0,1,0,3),ke.bind(void 0,1,0,1,1,0),ke.bind(void 0,1,0,1,1,1),ke.bind(void 0,1,0,1,1,2),ke.bind(void 0,1,0,1,1,3),ke.bind(void 0,1,1,0,0,0),ke.bind(void 0,1,1,0,0,1),ke.bind(void 0,1,1,0,0,2),ke.bind(void 0,1,1,0,0,3),ke.bind(void 0,1,1,0,1,0),ke.bind(void 0,1,1,0,1,1),ke.bind(void 0,1,1,0,1,2),ke.bind(void 0,1,1,0,1,3),ke.bind(void 0,1,1,1,0,0),ke.bind(void 0,1,1,1,0,1),ke.bind(void 0,1,1,1,0,2),ke.bind(void 0,1,1,1,0,3),ke.bind(void 0,1,1,1,1,0),ke.bind(void 0,1,1,1,1,1),ke.bind(void 0,1,1,1,1,2),ke.bind(void 0,1,1,1,1,3)];function $l(e){this.char=e,this.state={},this.activeState=null}function J0(e,t,i){this.contextName=i,this.startIndex=e,this.endOffset=t}function CX(e,t,i){this.contextName=e,this.openRange=null,this.ranges=[],this.checkStart=t,this.checkEnd=i}function nn(e,t){this.context=e,this.index=t,this.length=e.length,this.current=e[t],this.backtrack=e.slice(0,t),this.lookahead=e.slice(t+1)}function Pp(e){this.eventId=e,this.subscribers=[]}function DX(e){var t=this,i=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];i.forEach(function(n){Object.defineProperty(t.events,n,{value:new Pp(n)})}),e&&i.forEach(function(n){var s=e[n];typeof s=="function"&&t.events[n].subscribe(s)});var r=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];r.forEach(function(n){t.events[n].subscribe(t.updateContextsRanges)})}function Jt(e){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],DX.call(this,e)}$l.prototype.setState=function(e,t){return this.state[e]=t,this.activeState={key:e,value:this.state[e]},this.activeState};$l.prototype.getState=function(e){return this.state[e]||null};Jt.prototype.inboundIndex=function(e){return e>=0&&e<this.tokens.length};Jt.prototype.composeRUD=function(e){var t=this,i=!0,r=e.map(function(s){return t[s[0]].apply(t,s.slice(1).concat(i))}),n=function(s){return typeof s=="object"&&s.hasOwnProperty("FAIL")};if(r.every(n))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:r.filter(n)};this.dispatch("composeRUD",[r.filter(function(s){return!n(s)})])};Jt.prototype.replaceRange=function(e,t,i,r){t=t!==null?t:this.tokens.length;var n=i.every(function(a){return a instanceof $l});if(!isNaN(e)&&this.inboundIndex(e)&&n){var s=this.tokens.splice.apply(this.tokens,[e,t].concat(i));return r||this.dispatch("replaceToken",[e,t,i]),[s,i]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};Jt.prototype.replaceToken=function(e,t,i){if(!isNaN(e)&&this.inboundIndex(e)&&t instanceof $l){var r=this.tokens.splice(e,1,t);return i||this.dispatch("replaceToken",[e,t]),[r[0],t]}else return{FAIL:"replaceToken: invalid token or index."}};Jt.prototype.removeRange=function(e,t,i){t=isNaN(t)?this.tokens.length:t;var r=this.tokens.splice(e,t);return i||this.dispatch("removeRange",[r,e,t]),r};Jt.prototype.removeToken=function(e,t){if(!isNaN(e)&&this.inboundIndex(e)){var i=this.tokens.splice(e,1);return t||this.dispatch("removeToken",[i,e]),i}else return{FAIL:"removeToken: invalid token index."}};Jt.prototype.insertToken=function(e,t,i){var r=e.every(function(n){return n instanceof $l});return r?(this.tokens.splice.apply(this.tokens,[t,0].concat(e)),i||this.dispatch("insertToken",[e,t]),e):{FAIL:"insertToken: invalid token(s)."}};Jt.prototype.registerModifier=function(e,t,i){this.events.newToken.subscribe(function(r,n){var s=[r,n],a=t===null||t.apply(this,s)===!0,o=[r,n];if(a){var l=i.apply(this,o);r.setState(e,l)}}),this.registeredModifiers.push(e)};Pp.prototype.subscribe=function(e){return typeof e=="function"?this.subscribers.push(e)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Pp.prototype.unsubscribe=function(e){this.subscribers.splice(e,1)};nn.prototype.setCurrentIndex=function(e){this.index=e,this.current=this.context[e],this.backtrack=this.context.slice(0,e),this.lookahead=this.context.slice(e+1)};nn.prototype.get=function(e){switch(!0){case e===0:return this.current;case(e<0&&Math.abs(e)<=this.backtrack.length):return this.backtrack.slice(e)[0];case(e>0&&e<=this.lookahead.length):return this.lookahead[e-1];default:return null}};Jt.prototype.rangeToText=function(e){if(e instanceof J0)return this.getRangeTokens(e).map(function(t){return t.char}).join("")};Jt.prototype.getText=function(){return this.tokens.map(function(e){return e.char}).join("")};Jt.prototype.getContext=function(e){var t=this.registeredContexts[e];return t||null};Jt.prototype.on=function(e,t){var i=this.events[e];return i?i.subscribe(t):null};Jt.prototype.dispatch=function(e,t){var i=this,r=this.events[e];r instanceof Pp&&r.subscribers.forEach(function(n){n.apply(i,t||[])})};Jt.prototype.registerContextChecker=function(e,t,i){if(this.getContext(e))return{FAIL:"context name '"+e+"' is already registered."};if(typeof t!="function")return{FAIL:"missing context start check."};if(typeof i!="function")return{FAIL:"missing context end check."};var r=new CX(e,t,i);return this.registeredContexts[e]=r,this.contextCheckers.push(r),r};Jt.prototype.getRangeTokens=function(e){var t=e.startIndex+e.endOffset;return[].concat(this.tokens.slice(e.startIndex,t))};Jt.prototype.getContextRanges=function(e){var t=this.getContext(e);return t?t.ranges:{FAIL:"context checker '"+e+"' is not registered."}};Jt.prototype.resetContextsRanges=function(){var e=this.registeredContexts;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];i.ranges=[]}};Jt.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var e=this.tokens.map(function(r){return r.char}),t=0;t<e.length;t++){var i=new nn(e,t);this.runContextCheck(i)}this.dispatch("updateContextsRanges",[this.registeredContexts])};Jt.prototype.setEndOffset=function(e,t){var i=this.getContext(t).openRange.startIndex,r=new J0(i,e,t),n=this.getContext(t).ranges;return r.rangeId=t+"."+n.length,n.push(r),this.getContext(t).openRange=null,r};Jt.prototype.runContextCheck=function(e){var t=this,i=e.index;this.contextCheckers.forEach(function(r){var n=r.contextName,s=t.getContext(n).openRange;if(!s&&r.checkStart(e)&&(s=new J0(i,null,n),t.getContext(n).openRange=s,t.dispatch("contextStart",[n,i])),!!s&&r.checkEnd(e)){var a=i-s.startIndex+1,o=t.setEndOffset(a,n);t.dispatch("contextEnd",[n,o])}})};Jt.prototype.tokenize=function(e){this.tokens=[],this.resetContextsRanges();var t=Array.from(e);this.dispatch("start");for(var i=0;i<t.length;i++){var r=t[i],n=new nn(t,i);this.dispatch("next",[n]),this.runContextCheck(n);var s=new $l(r);this.tokens.push(s),this.dispatch("newToken",[s,n])}return this.dispatch("end",[this.tokens]),this.tokens};function ra(e){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(e)}function IM(e){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(e)}function pa(e){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(e)}function ud(e){return/[A-z]/.test(e)}function PX(e){return/\s/.test(e)}function vr(e){this.font=e,this.features={}}function Fa(e){this.id=e.id,this.tag=e.tag,this.substitution=e.substitution}function zu(e,t){if(!e)return-1;switch(t.format){case 1:return t.glyphs.indexOf(e);case 2:for(var i=t.ranges,r=0;r<i.length;r++){var n=i[r];if(e>=n.start&&e<=n.end){var s=e-n.start;return n.index+s}}break;default:return-1}return-1}function LX(e,t){var i=zu(e,t.coverage);return i===-1?null:e+t.deltaGlyphId}function OX(e,t){var i=zu(e,t.coverage);return i===-1?null:t.substitute[i]}function xm(e,t){for(var i=[],r=0;r<e.length;r++){var n=e[r],s=t.current;s=Array.isArray(s)?s[0]:s;var a=zu(s,n);a!==-1&&i.push(a)}return i.length!==e.length?-1:i}function RX(e,t){var i=t.inputCoverage.length+t.lookaheadCoverage.length+t.backtrackCoverage.length;if(e.context.length<i)return[];var r=xm(t.inputCoverage,e);if(r===-1)return[];var n=t.inputCoverage.length-1;if(e.lookahead.length<t.lookaheadCoverage.length)return[];for(var s=e.lookahead.slice(n);s.length&&pa(s[0].char);)s.shift();var a=new nn(s,0),o=xm(t.lookaheadCoverage,a),l=[].concat(e.backtrack);for(l.reverse();l.length&&pa(l[0].char);)l.shift();if(l.length<t.backtrackCoverage.length)return[];var h=new nn(l,0),c=xm(t.backtrackCoverage,h),u=r.length===t.inputCoverage.length&&o.length===t.lookaheadCoverage.length&&c.length===t.backtrackCoverage.length,d=[];if(u)for(var p=0;p<t.lookupRecords.length;p++)for(var m=t.lookupRecords[p],g=m.lookupListIndex,f=this.getLookupByIndex(g),v=0;v<f.subtables.length;v++){var y=f.subtables[v],x=this.getLookupMethod(f,y),b=this.getSubstitutionType(f,y);if(b==="12")for(var S=0;S<r.length;S++){var _=e.get(S),A=x(_);A&&d.push(A)}}return d}function IX(e,t){var i=e.current,r=zu(i,t.coverage);if(r===-1)return null;for(var n,s=t.ligatureSets[r],a=0;a<s.length;a++){n=s[a];for(var o=0;o<n.components.length;o++){var l=e.lookahead[o],h=n.components[o];if(l!==h)break;if(o===n.components.length-1)return n}}return null}function BX(e,t){var i=zu(e,t.coverage);return i===-1?null:t.sequences[i]}vr.prototype.getDefaultScriptFeaturesIndexes=function(){for(var e=this.font.tables.gsub.scripts,t=0;t<e.length;t++){var i=e[t];if(i.tag==="DFLT")return i.script.defaultLangSys.featureIndexes}return[]};vr.prototype.getScriptFeaturesIndexes=function(e){var t=this.font.tables;if(!t.gsub)return[];if(!e)return this.getDefaultScriptFeaturesIndexes();for(var i=this.font.tables.gsub.scripts,r=0;r<i.length;r++){var n=i[r];if(n.tag===e&&n.script.defaultLangSys)return n.script.defaultLangSys.featureIndexes;var s=n.langSysRecords;if(s)for(var a=0;a<s.length;a++){var o=s[a];if(o.tag===e){var l=o.langSys;return l.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};vr.prototype.mapTagsToFeatures=function(e,t){for(var i={},r=0;r<e.length;r++){var n=e[r].tag,s=e[r].feature;i[n]=s}this.features[t].tags=i};vr.prototype.getScriptFeatures=function(e){var t=this.features[e];if(this.features.hasOwnProperty(e))return t;var i=this.getScriptFeaturesIndexes(e);if(!i)return null;var r=this.font.tables.gsub;return t=i.map(function(n){return r.features[n]}),this.features[e]=t,this.mapTagsToFeatures(t,e),t};vr.prototype.getSubstitutionType=function(e,t){var i=e.lookupType.toString(),r=t.substFormat.toString();return i+r};vr.prototype.getLookupMethod=function(e,t){var i=this,r=this.getSubstitutionType(e,t);switch(r){case"11":return function(n){return LX.apply(i,[n,t])};case"12":return function(n){return OX.apply(i,[n,t])};case"63":return function(n){return RX.apply(i,[n,t])};case"41":return function(n){return IX.apply(i,[n,t])};case"21":return function(n){return BX.apply(i,[n,t])};default:throw new Error("lookupType: "+e.lookupType+" - substFormat: "+t.substFormat+" is not yet supported")}};vr.prototype.lookupFeature=function(e){var t=e.contextParams,i=t.index,r=this.getFeature({tag:e.tag,script:e.script});if(!r)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+e.tag+"' for script '"+e.script+"'.");for(var n=this.getFeatureLookups(r),s=[].concat(t.context),a=0;a<n.length;a++)for(var o=n[a],l=this.getLookupSubtables(o),h=0;h<l.length;h++){var c=l[h],u=this.getSubstitutionType(o,c),d=this.getLookupMethod(o,c),p=void 0;switch(u){case"11":p=d(t.current),p&&s.splice(i,1,new Fa({id:11,tag:e.tag,substitution:p}));break;case"12":p=d(t.current),p&&s.splice(i,1,new Fa({id:12,tag:e.tag,substitution:p}));break;case"63":p=d(t),Array.isArray(p)&&p.length&&s.splice(i,1,new Fa({id:63,tag:e.tag,substitution:p}));break;case"41":p=d(t),p&&s.splice(i,1,new Fa({id:41,tag:e.tag,substitution:p}));break;case"21":p=d(t.current),p&&s.splice(i,1,new Fa({id:21,tag:e.tag,substitution:p}));break}t=new nn(s,i),!(Array.isArray(p)&&!p.length)&&(p=null)}return s.length?s:null};vr.prototype.supports=function(e){if(!e.script)return!1;this.getScriptFeatures(e.script);var t=this.features.hasOwnProperty(e.script);if(!e.tag)return t;var i=this.features[e.script].some(function(r){return r.tag===e.tag});return t&&i};vr.prototype.getLookupSubtables=function(e){return e.subtables||null};vr.prototype.getLookupByIndex=function(e){var t=this.font.tables.gsub.lookups;return t[e]||null};vr.prototype.getFeatureLookups=function(e){return e.lookupListIndexes.map(this.getLookupByIndex.bind(this))};vr.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};function NX(e){var t=e.current,i=e.get(-1);return i===null&&ra(t)||!ra(i)&&ra(t)}function kX(e){var t=e.get(1);return t===null||!ra(t)}var UX={startCheck:NX,endCheck:kX};function FX(e){var t=e.current,i=e.get(-1);return(ra(t)||pa(t))&&!ra(i)}function zX(e){var t=e.get(1);switch(!0){case t===null:return!0;case(!ra(t)&&!pa(t)):var i=PX(t);if(!i)return!0;if(i){var r=!1;if(r=e.lookahead.some(function(n){return ra(n)||pa(n)}),!r)return!0}break;default:return!1}}var GX={startCheck:FX,endCheck:zX};function HX(e,t,i){t[i].setState(e.tag,e.substitution)}function VX(e,t,i){t[i].setState(e.tag,e.substitution)}function jX(e,t,i){e.substitution.forEach(function(r,n){var s=t[i+n];s.setState(e.tag,r)})}function WX(e,t,i){var r=t[i];r.setState(e.tag,e.substitution.ligGlyph);for(var n=e.substitution.components.length,s=0;s<n;s++)r=t[i+s+1],r.setState("deleted",!0)}var C_={11:HX,12:VX,63:jX,41:WX};function $0(e,t,i){e instanceof Fa&&C_[e.id]&&C_[e.id](e,t,i)}function qX(e){for(var t=[].concat(e.backtrack),i=t.length-1;i>=0;i--){var r=t[i],n=IM(r),s=pa(r);if(!n&&!s)return!0;if(n)return!1}return!1}function YX(e){if(IM(e.current))return!1;for(var t=0;t<e.lookahead.length;t++){var i=e.lookahead[t],r=pa(i);if(!r)return!0}return!1}function XX(e){var t=this,i="arab",r=this.featuresTags[i],n=this.tokenizer.getRangeTokens(e);if(n.length!==1){var s=new nn(n.map(function(o){return o.getState("glyphIndex")}),0),a=new nn(n.map(function(o){return o.char}),0);n.forEach(function(o,l){if(!pa(o.char)){s.setCurrentIndex(l),a.setCurrentIndex(l);var h=0;qX(a)&&(h|=1),YX(a)&&(h|=2);var c;switch(h){case 1:c="fina";break;case 2:c="init";break;case 3:c="medi";break}if(r.indexOf(c)!==-1){var u=t.query.lookupFeature({tag:c,script:i,contextParams:s});if(u instanceof Error)return console.info(u.message);u.forEach(function(d,p){d instanceof Fa&&($0(d,n,p),s.context[p]=d.substitution)})}}})}}function D_(e,t){var i=e.map(function(r){return r.activeState.value});return new nn(i,t||0)}function QX(e){var t=this,i="arab",r=this.tokenizer.getRangeTokens(e),n=D_(r);n.context.forEach(function(s,a){n.setCurrentIndex(a);var o=t.query.lookupFeature({tag:"rlig",script:i,contextParams:n});o.length&&(o.forEach(function(l){return $0(l,r,a)}),n=D_(r))})}function KX(e){var t=e.current,i=e.get(-1);return i===null&&ud(t)||!ud(i)&&ud(t)}function ZX(e){var t=e.get(1);return t===null||!ud(t)}var JX={startCheck:KX,endCheck:ZX};function P_(e,t){var i=e.map(function(r){return r.activeState.value});return new nn(i,t||0)}function $X(e){var t=this,i="latn",r=this.tokenizer.getRangeTokens(e),n=P_(r);n.context.forEach(function(s,a){n.setCurrentIndex(a);var o=t.query.lookupFeature({tag:"liga",script:i,contextParams:n});o.length&&(o.forEach(function(l){return $0(l,r,a)}),n=P_(r))})}function cn(e){this.baseDir=e||"ltr",this.tokenizer=new Jt,this.featuresTags={}}cn.prototype.setText=function(e){this.text=e};cn.prototype.contextChecks={latinWordCheck:JX,arabicWordCheck:UX,arabicSentenceCheck:GX};function bm(e){var t=this.contextChecks[e+"Check"];return this.tokenizer.registerContextChecker(e,t.startCheck,t.endCheck)}function eQ(){return bm.call(this,"latinWord"),bm.call(this,"arabicWord"),bm.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function tQ(){var e=this,t=this.tokenizer.getContextRanges("arabicSentence");t.forEach(function(i){var r=e.tokenizer.getRangeTokens(i);e.tokenizer.replaceRange(i.startIndex,i.endOffset,r.reverse())})}cn.prototype.registerFeatures=function(e,t){var i=this,r=t.filter(function(n){return i.query.supports({script:e,tag:n})});this.featuresTags.hasOwnProperty(e)?this.featuresTags[e]=this.featuresTags[e].concat(r):this.featuresTags[e]=r};cn.prototype.applyFeatures=function(e,t){if(!e)throw new Error("No valid font was provided to apply features");this.query||(this.query=new vr(e));for(var i=0;i<t.length;i++){var r=t[i];!this.query.supports({script:r.script})||this.registerFeatures(r.script,r.tags)}};cn.prototype.registerModifier=function(e,t,i){this.tokenizer.registerModifier(e,t,i)};function ey(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function iQ(){var e=this,t="arab";if(this.featuresTags.hasOwnProperty(t)){ey.call(this);var i=this.tokenizer.getContextRanges("arabicWord");i.forEach(function(r){XX.call(e,r)})}}function rQ(){var e=this,t="arab";if(this.featuresTags.hasOwnProperty(t)){var i=this.featuresTags[t];if(i.indexOf("rlig")!==-1){ey.call(this);var r=this.tokenizer.getContextRanges("arabicWord");r.forEach(function(n){QX.call(e,n)})}}}function nQ(){var e=this,t="latn";if(this.featuresTags.hasOwnProperty(t)){var i=this.featuresTags[t];if(i.indexOf("liga")!==-1){ey.call(this);var r=this.tokenizer.getContextRanges("latinWord");r.forEach(function(n){$X.call(e,n)})}}}cn.prototype.checkContextReady=function(e){return!!this.tokenizer.getContext(e)};cn.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(iQ.call(this),rQ.call(this)),this.checkContextReady("latinWord")&&nQ.call(this),this.checkContextReady("arabicSentence")&&tQ.call(this)};cn.prototype.processText=function(e){(!this.text||this.text!==e)&&(this.setText(e),eQ.call(this),this.applyFeaturesToContexts())};cn.prototype.getBidiText=function(e){return this.processText(e),this.tokenizer.getText()};cn.prototype.getTextGlyphs=function(e){this.processText(e);for(var t=[],i=0;i<this.tokenizer.tokens.length;i++){var r=this.tokenizer.tokens[i];if(!r.state.deleted){var n=r.activeState.value;t.push(Array.isArray(n)?n[0]:n)}}return t};function It(e){e=e||{},e.tables=e.tables||{},e.empty||(bh(e.familyName,"When creating a new Font object, familyName is required."),bh(e.styleName,"When creating a new Font object, styleName is required."),bh(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),bh(e.ascender,"When creating a new Font object, ascender is required."),bh(e.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||(e.familyName+e.styleName).replace(/\s/g,"")},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables=Object.assign(e.tables,{os2:Object.assign({usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR},e.tables.os2)})),this.supported=!0,this.glyphs=new zn.GlyphSet(this,e.glyphs||[]),this.encoding=new $T(this),this.position=new ku(this),this.substitution=new gr(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new PM(this)}})}It.prototype.hasChar=function(e){return this.encoding.charToGlyphIndex(e)!==null};It.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)};It.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),i=this.glyphs.get(t);return i||(i=this.glyphs.get(0)),i};It.prototype.updateFeatures=function(e){return this.defaultRenderOptions.features.map(function(t){return t.script==="latn"?{script:"latn",tags:t.tags.filter(function(i){return e[i]})}:t})};It.prototype.stringToGlyphs=function(e,t){var i=this,r=new cn,n=function(u){return i.charToGlyphIndex(u.char)};r.registerModifier("glyphIndex",null,n);var s=t?this.updateFeatures(t.features):this.defaultRenderOptions.features;r.applyFeatures(this,s);for(var a=r.getTextGlyphs(e),o=a.length,l=new Array(o),h=this.glyphs.get(0),c=0;c<o;c+=1)l[c]=this.glyphs.get(a[c])||h;return l};It.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)};It.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e),i=this.glyphs.get(t);return i||(i=this.glyphs.get(0)),i};It.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""};It.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var i=this.position.defaultKerningTables;return i?this.position.getKerningValue(i,e,t):this.kerningPairs[e+","+t]||0};It.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};It.prototype.forEachGlyph=function(e,t,i,r,n,s){t=t!==void 0?t:0,i=i!==void 0?i:0,r=r!==void 0?r:72,n=Object.assign({},this.defaultRenderOptions,n);var a=1/this.unitsPerEm*r,o=this.stringToGlyphs(e,n),l;if(n.kerning){var h=n.script||this.position.getDefaultScriptName();l=this.position.getKerningTables(h,n.language)}for(var c=0;c<o.length;c+=1){var u=o[c];if(s.call(this,u,t,i,r,n),u.advanceWidth&&(t+=u.advanceWidth*a),n.kerning&&c<o.length-1){var d=l?this.position.getKerningValue(l,u.index,o[c+1].index):this.getKerningValue(u,o[c+1]);t+=d*a}n.letterSpacing?t+=n.letterSpacing*r:n.tracking&&(t+=n.tracking/1e3*r)}return t};It.prototype.getPath=function(e,t,i,r,n){var s=new di;return this.forEachGlyph(e,t,i,r,n,function(a,o,l,h){var c=a.getPath(o,l,h,n,this);s.extend(c)}),s};It.prototype.getPaths=function(e,t,i,r,n){var s=[];return this.forEachGlyph(e,t,i,r,n,function(a,o,l,h){var c=a.getPath(o,l,h,n,this);s.push(c)}),s};It.prototype.getAdvanceWidth=function(e,t,i){return this.forEachGlyph(e,0,0,t,i,function(){})};It.prototype.draw=function(e,t,i,r,n,s){this.getPath(t,i,r,n,s).draw(e)};It.prototype.drawPoints=function(e,t,i,r,n,s){this.forEachGlyph(t,i,r,n,s,function(a,o,l,h){a.drawPoints(e,o,l,h)})};It.prototype.drawMetrics=function(e,t,i,r,n,s){this.forEachGlyph(t,i,r,n,s,function(a,o,l,h){a.drawMetrics(e,o,l,h)})};It.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en};It.prototype.validate=function(){var e=this;function t(i){var r=e.getEnglishName(i);r&&r.trim().length>0}t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),this.unitsPerEm>0};It.prototype.toTables=function(){return jq.fontToTable(this)};It.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};It.prototype.toArrayBuffer=function(){for(var e=this.toTables(),t=e.encode(),i=new ArrayBuffer(t.length),r=new Uint8Array(i),n=0;n<t.length;n++)r[n]=t[n];return i};It.prototype.download=function(e){var t=this.getEnglishName("fontFamily"),i=this.getEnglishName("fontSubfamily");e=e||t.replace(/\s/g,"")+"-"+i+".otf";var r=this.toArrayBuffer();if(qq())if(window.URL=window.URL||window.webkitURL,window.URL){var n=new DataView(r),s=new Blob([n],{type:"font/opentype"}),a=document.createElement("a");a.href=window.URL.createObjectURL(s),a.download=e;var o=document.createEvent("MouseEvents");o.initEvent("click",!0,!1),a.dispatchEvent(o)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var l=PA(),h=Xq(r);l.writeFileSync(e,h)}};It.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};It.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};It.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function BM(e,t){var i=JSON.stringify(e),r=256;for(var n in t){var s=parseInt(n);if(!(!s||s<256)){if(JSON.stringify(t[n])===i)return s;r<=s&&(r=s+1)}}return t[r]=e,r}function sQ(e,t,i){var r=BM(t.name,i);return[{name:"tag_"+e,type:"TAG",value:t.tag},{name:"minValue_"+e,type:"FIXED",value:t.minValue<<16},{name:"defaultValue_"+e,type:"FIXED",value:t.defaultValue<<16},{name:"maxValue_"+e,type:"FIXED",value:t.maxValue<<16},{name:"flags_"+e,type:"USHORT",value:0},{name:"nameID_"+e,type:"USHORT",value:r}]}function aQ(e,t,i){var r={},n=new Ue.Parser(e,t);return r.tag=n.parseTag(),r.minValue=n.parseFixed(),r.defaultValue=n.parseFixed(),r.maxValue=n.parseFixed(),n.skip("uShort",1),r.name=i[n.parseUShort()]||{},r}function oQ(e,t,i,r){for(var n=BM(t.name,r),s=[{name:"nameID_"+e,type:"USHORT",value:n},{name:"flags_"+e,type:"USHORT",value:0}],a=0;a<i.length;++a){var o=i[a].tag;s.push({name:"axis_"+e+" "+o,type:"FIXED",value:t.coordinates[o]<<16})}return s}function lQ(e,t,i,r){var n={},s=new Ue.Parser(e,t);n.name=r[s.parseUShort()]||{},s.skip("uShort",1),n.coordinates={};for(var a=0;a<i.length;++a)n.coordinates[i[a].tag]=s.parseFixed();return n}function hQ(e,t){var i=new Oe.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+e.axes.length*4}]);i.offsetToData=i.sizeOf();for(var r=0;r<e.axes.length;r++)i.fields=i.fields.concat(sQ(r,e.axes[r],t));for(var n=0;n<e.instances.length;n++)i.fields=i.fields.concat(oQ(n,e.instances[n],e.axes,t));return i}function uQ(e,t,i){var r=new Ue.Parser(e,t),n=r.parseULong();tt.argument(n===65536,"Unsupported fvar table version.");var s=r.parseOffset16();r.skip("uShort",1);for(var a=r.parseUShort(),o=r.parseUShort(),l=r.parseUShort(),h=r.parseUShort(),c=[],u=0;u<a;u++)c.push(aQ(e,t+s+u*o,i));for(var d=[],p=t+s+a*o,m=0;m<l;m++)d.push(lQ(e,p+m*h,c,i));return{axes:c,instances:d}}var cQ={make:hQ,parse:uQ},dQ=function(){return{coverage:this.parsePointer(te.coverage),attachPoints:this.parseList(te.pointer(te.uShortList))}},pQ=function(){var e=this.parseUShort();if(tt.argument(e===1||e===2||e===3,"Unsupported CaretValue table version."),e===1)return{coordinate:this.parseShort()};if(e===2)return{pointindex:this.parseShort()};if(e===3)return{coordinate:this.parseShort()}},fQ=function(){return this.parseList(te.pointer(pQ))},mQ=function(){return{coverage:this.parsePointer(te.coverage),ligGlyphs:this.parseList(te.pointer(fQ))}},gQ=function(){return this.parseUShort(),this.parseList(te.pointer(te.coverage))};function vQ(e,t){t=t||0;var i=new te(e,t),r=i.parseVersion(1);tt.argument(r===1||r===1.2||r===1.3,"Unsupported GDEF table version.");var n={version:r,classDef:i.parsePointer(te.classDef),attachList:i.parsePointer(dQ),ligCaretList:i.parsePointer(mQ),markAttachClassDef:i.parsePointer(te.classDef)};return r>=1.2&&(n.markGlyphSets=i.parsePointer(gQ)),n}var yQ={parse:vQ},sn=new Array(10);sn[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(t===1)return{posFormat:1,coverage:this.parsePointer(te.coverage),value:this.parseValueRecord()};if(t===2)return{posFormat:2,coverage:this.parsePointer(te.coverage),values:this.parseValueRecordList()};tt.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};sn[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();tt.assert(t===1||t===2,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var i=this.parsePointer(te.coverage),r=this.parseUShort(),n=this.parseUShort();if(t===1)return{posFormat:t,coverage:i,valueFormat1:r,valueFormat2:n,pairSets:this.parseList(te.pointer(te.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(r),value2:this.parseValueRecord(n)}})))};if(t===2){var s=this.parsePointer(te.classDef),a=this.parsePointer(te.classDef),o=this.parseUShort(),l=this.parseUShort();return{posFormat:t,coverage:i,valueFormat1:r,valueFormat2:n,classDef1:s,classDef2:a,class1Count:o,class2Count:l,classRecords:this.parseList(o,te.list(l,function(){return{value1:this.parseValueRecord(r),value2:this.parseValueRecord(n)}}))}}};sn[3]=function(){return{error:"GPOS Lookup 3 not supported"}};sn[4]=function(){return{error:"GPOS Lookup 4 not supported"}};sn[5]=function(){return{error:"GPOS Lookup 5 not supported"}};sn[6]=function(){return{error:"GPOS Lookup 6 not supported"}};sn[7]=function(){return{error:"GPOS Lookup 7 not supported"}};sn[8]=function(){return{error:"GPOS Lookup 8 not supported"}};sn[9]=function(){return{error:"GPOS Lookup 9 not supported"}};function xQ(e,t){t=t||0;var i=new te(e,t),r=i.parseVersion(1);return tt.argument(r===1||r===1.1,"Unsupported GPOS table version "+r),r===1?{version:r,scripts:i.parseScriptList(),features:i.parseFeatureList(),lookups:i.parseLookupList(sn)}:{version:r,scripts:i.parseScriptList(),features:i.parseFeatureList(),lookups:i.parseLookupList(sn),variations:i.parseFeatureVariationsList()}}var bQ=new Array(10);function wQ(e){return new Oe.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new Oe.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new Oe.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new Oe.LookupList(e.lookups,bQ)}])}var _Q={parse:xQ,make:wQ};function SQ(e){var t={};e.skip("uShort");var i=e.parseUShort();tt.argument(i===0,"Unsupported kern sub-table version."),e.skip("uShort",2);var r=e.parseUShort();e.skip("uShort",3);for(var n=0;n<r;n+=1){var s=e.parseUShort(),a=e.parseUShort(),o=e.parseShort();t[s+","+a]=o}return t}function AQ(e){var t={};e.skip("uShort");var i=e.parseULong();i>1&&console.warn("Only the first kern subtable is supported."),e.skip("uLong");var r=e.parseUShort(),n=r&255;if(e.skip("uShort"),n===0){var s=e.parseUShort();e.skip("uShort",3);for(var a=0;a<s;a+=1){var o=e.parseUShort(),l=e.parseUShort(),h=e.parseShort();t[o+","+l]=h}}return t}function EQ(e,t){var i=new Ue.Parser(e,t),r=i.parseUShort();if(r===0)return SQ(i);if(r===1)return AQ(i);throw new Error("Unsupported kern table version ("+r+").")}var TQ={parse:EQ};function MQ(e,t,i,r){for(var n=new Ue.Parser(e,t),s=r?n.parseUShort:n.parseULong,a=[],o=0;o<i+1;o+=1){var l=s.call(n);r&&(l*=2),a.push(l)}return a}var CQ={parse:MQ};function DQ(e,t){var i=PA();i.readFile(e,function(r,n){if(r)return t(r.message);t(null,Yq(n))})}function PQ(e,t){var i=new XMLHttpRequest;i.open("get",e,!0),i.responseType="arraybuffer",i.onload=function(){return i.response?t(null,i.response):t("Font could not be loaded: "+i.statusText)},i.onerror=function(){t("Font could not be loaded")},i.send()}function L_(e,t){for(var i=[],r=12,n=0;n<t;n+=1){var s=Ue.getTag(e,r),a=Ue.getULong(e,r+4),o=Ue.getULong(e,r+8),l=Ue.getULong(e,r+12);i.push({tag:s,checksum:a,offset:o,length:l,compression:!1}),r+=16}return i}function LQ(e,t){for(var i=[],r=44,n=0;n<t;n+=1){var s=Ue.getTag(e,r),a=Ue.getULong(e,r+4),o=Ue.getULong(e,r+8),l=Ue.getULong(e,r+12),h=void 0;o<l?h="WOFF":h=!1,i.push({tag:s,offset:a,compression:h,compressedLength:o,length:l}),r+=20}return i}function ii(e,t){if(t.compression==="WOFF"){var i=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),r=new Uint8Array(t.length);if(w7(i,r),r.byteLength!==t.length)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");var n=new DataView(r.buffer,0);return{data:n,offset:0}}else return{data:e,offset:t.offset}}function NM(e,t){t=t!=null?t:{};var i,r,n=new It({empty:!0}),s=new DataView(e,0),a,o=[],l=Ue.getTag(s,0);if(l===String.fromCharCode(0,1,0,0)||l==="true"||l==="typ1")n.outlinesFormat="truetype",a=Ue.getUShort(s,4),o=L_(s,a);else if(l==="OTTO")n.outlinesFormat="cff",a=Ue.getUShort(s,4),o=L_(s,a);else if(l==="wOFF"){var h=Ue.getTag(s,4);if(h===String.fromCharCode(0,1,0,0))n.outlinesFormat="truetype";else if(h==="OTTO")n.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+l);a=Ue.getUShort(s,12),o=LQ(s,a)}else throw new Error("Unsupported OpenType signature "+l);for(var c,u,d,p,m,g,f,v,y,x,b,S,_=0;_<a;_+=1){var A=o[_],w=void 0;switch(A.tag){case"cmap":w=ii(s,A),n.tables.cmap=JT.parse(w.data,w.offset),n.encoding=new eM(n.tables.cmap);break;case"cvt ":w=ii(s,A),S=new Ue.Parser(w.data,w.offset),n.tables.cvt=S.parseShortList(A.length/2);break;case"fvar":u=A;break;case"fpgm":w=ii(s,A),S=new Ue.Parser(w.data,w.offset),n.tables.fpgm=S.parseByteList(A.length);break;case"head":w=ii(s,A),n.tables.head=uM.parse(w.data,w.offset),n.unitsPerEm=n.tables.head.unitsPerEm,i=n.tables.head.indexToLocFormat;break;case"hhea":w=ii(s,A),n.tables.hhea=cM.parse(w.data,w.offset),n.ascender=n.tables.hhea.ascender,n.descender=n.tables.hhea.descender,n.numberOfHMetrics=n.tables.hhea.numberOfHMetrics;break;case"hmtx":f=A;break;case"ltag":w=ii(s,A),r=pM.parse(w.data,w.offset);break;case"maxp":w=ii(s,A),n.tables.maxp=fM.parse(w.data,w.offset),n.numGlyphs=n.tables.maxp.numGlyphs;break;case"name":x=A;break;case"OS/2":w=ii(s,A),n.tables.os2=mv.parse(w.data,w.offset);break;case"post":w=ii(s,A),n.tables.post=bM.parse(w.data,w.offset),n.glyphNames=new X0(n.tables.post);break;case"prep":w=ii(s,A),S=new Ue.Parser(w.data,w.offset),n.tables.prep=S.parseByteList(A.length);break;case"glyf":d=A;break;case"loca":y=A;break;case"CFF ":c=A;break;case"kern":v=A;break;case"GDEF":p=A;break;case"GPOS":m=A;break;case"GSUB":g=A;break;case"meta":b=A;break}}var E=ii(s,x);if(n.tables.name=xM.parse(E.data,E.offset,r),n.names=n.tables.name,d&&y){var T=i===0,C=ii(s,y),P=CQ.parse(C.data,C.offset,n.numGlyphs,T),k=ii(s,d);n.glyphs=MM.parse(k.data,k.offset,P,n,t)}else if(c){var D=ii(s,c);hM.parse(D.data,D.offset,n,t)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var R=ii(s,f);if(dM.parse(n,R.data,R.offset,n.numberOfHMetrics,n.numGlyphs,n.glyphs,t),H7(n,t),v){var G=ii(s,v);n.kerningPairs=TQ.parse(G.data,G.offset)}else n.kerningPairs={};if(p){var N=ii(s,p);n.tables.gdef=yQ.parse(N.data,N.offset)}if(m){var L=ii(s,m);n.tables.gpos=_Q.parse(L.data,L.offset),n.position.init()}if(g){var H=ii(s,g);n.tables.gsub=wM.parse(H.data,H.offset)}if(u){var F=ii(s,u);n.tables.fvar=cQ.parse(F.data,F.offset,n.names)}if(b){var z=ii(s,b);n.tables.meta=_M.parse(z.data,z.offset),n.metas=n.tables.meta}return n}function OQ(e,t,i){i=i!=null?i:{};var r=typeof window>"u",n=r&&!i.isUrl?DQ:PQ;return new Promise(function(s,a){n(e,function(o,l){if(o){if(t)return t(o);a(o)}var h;try{h=NM(l,i)}catch(c){if(t)return t(c,null);a(c)}if(t)return t(null,h);s(h)})})}var RQ=class{load(e,t,i=()=>{}){OQ(e,(r,n)=>{r||!n?i(r!=null?r:"Something went wrong"):t(n)})}parse(e){try{return NM(e)}catch(t){console.error(t)}}};async function IQ(e){return await(await fetch(e)).arrayBuffer()}var BQ=new RQ;async function O_(e){let t,i,r=!1;if(e.url?(t=await IQ(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer),t){let n=BQ.parse(t);if(n)return{font:n,url:i,intercepted:r,arr:t}}}var R_=new M,I_=new Fe,B_=new Ul,NQ=class extends Qi{constructor(e,t,i){super(new q2(t.geometry,i),i.material(t.material)),this.data=t,this.objectType="TextFrame",this.wrappedText=[""],this.charWidths=[],this.charCoords=[],this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.name=t.name,this.uuid=e,this.updateState(t,i)}async updateGeometry(e,t){var l;let i=e.parameters,r=this.geometry.getAttribute("randomColor"),n={...this.geometry.userData.parameters,...i};this.geometry.userData={parameters:n,type:"TextGeometry"},t&&(i.font||!this.geometry.font&&t.getFont(n.font))&&await this.geometry.updateFont((l=i.font)!=null?l:n.font,t),await this.geometry.update(n),Ru(this),r&&Iu(this);let{wrappedText:s,charCoords:a,charWidths:o}=this.geometry;this.wrappedText=s,this.charWidths=o,this.charCoords=a,this.resetBBoxNeedsUpdate()}updateState(e,t){this.data=e,this.material=t.material(e.material),this.fromState(e,t),this.updateGeometry({parameters:e.geometry},t)}get font(){return this.geometry.font}get initialOffsetY(){var e,t;return(t=(e=this.font)==null?void 0:e.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,this.geometry.userData.parameters.height,this.fontScale,this.geometry.userData.parameters.verticalAlign))!=null?t:0}get fontScale(){return this.font?this.geometry.userData.parameters.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e,t;return((t=(e=this.font)==null?void 0:e.ascender)!=null?t:1)*this.fontScale}get descender(){var e,t;return((t=(e=this.font)==null?void 0:e.descender)!=null?t:1)*this.fontScale}get lineHeight(){return this.geometry.userData.parameters.fontSize*this.geometry.userData.parameters.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(I_.copy(i).invert(),B_.copy(e.ray).applyMatrix4(I_),B_.intersectBox(this.singleBBox,R_)){let r=R_.applyMatrix4(i),n=e.ray.origin.distanceTo(r);t.push({distance:n,point:r.clone(),object:this})}}},kQ=DA(kO()),vv;X2.then(e=>{vv=e});var kM=new Fe,UQ=new Fe,FQ=new Fe,qr=new fi,Us=new M,zQ=new Fe,GQ=new Fe,ty=class extends Qi{constructor(e,t,i,r){super(i!=null?i:t,r),this.subdivPointer=e,this.originalGeometry=t,this.subdividedGeometry=i,this.objectType="SubdivObject",this.hiddenMatrixOld=new Fe,this.smoothShading=!0,this.phongAngle=35,this.matrixWorldRigid=new Fe,this.castShadow=!0,this.receiveShadow=!0,this.forceComputeSize=!1}static createFromState(e,t,i){let{subdivPointer:r,originalGeometry:n,subdividedGeometry:s}=Kr.build(t.geometry,void 0,void 0,!t.flatShading),a=i.material(t.material),o=new ty(r,n,s||void 0,a);return t.geometry.phongAngle!==void 0&&(o.phongAngle=t.geometry.phongAngle),o.calcBoundingBox(),o.freeSubdivPointer(),o.uuid=e,o.fromState(t),o}buildFromStore(e,t){var s,a,o;let{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=Kr.build(e,t,this.subdivPointer,this.smoothShading,this.shearScale);e.phongAngle!==void 0&&(this.phongAngle=e.phongAngle),this.subdivPointer=n,i!==void 0&&((s=this.originalGeometry)==null||s.dispose(),this.originalGeometry=i),r!==void 0&&((a=this.subdividedGeometry)==null||a.dispose(),this.subdividedGeometry=r!=null?r:void 0),this.geometry=(o=this.subdividedGeometry)!=null?o:this.originalGeometry,Ru(this),Iu(this),e.width&&(this.geometry.userData.parameters={width:e.width,height:e.height,depth:e.depth})}updateMesh(e=!1){Kr.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e?this.shearScaleInv:void 0),this.subdividedGeometry&&Kr.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e?this.shearScaleInv:void 0)}updateTopology(){var e;this.originalGeometry.dispose(),this.originalGeometry=Kr.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=Kr.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.geometry=(e=this.subdividedGeometry)!=null?e:this.originalGeometry}raycast(e,t){var i;this.geometry=this.originalGeometry,Qi.prototype.raycast.call(this,e,t),this.geometry=(i=this.subdividedGeometry)!=null?i:this.originalGeometry}updateMatrixWorldSVD(){let e=this.matrixWorld.elements,t=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],{u:i,v:r,q:n}=(0,kQ.SVD)(t),s=kM.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),a=UQ.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=FQ.copy(a).transpose();this.shearScale=zQ.makeScale(n[0],n[1],n[2]).multiply(o).premultiply(a),this.shearScaleInv=GQ.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(s,o),n.every(l=>Math.abs(n[0]-l)<.01)&&(this.shearScale=void 0,this.shearScaleInv=void 0)}activateSVDCompensation(){this.shearScale!==void 0&&(this.matrixAutoUpdate=!1,this.matrix.copy(this.matrixWorldRigid).copyPosition(this.matrixWorld),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){this.shearScale!==void 0&&(this.shearScale=void 0,this.shearScaleInv=void 0,this.matrixAutoUpdate=!0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new tn);let t=e.attributes.position,i=e.boundingSphere.center;qr.setFromBufferAttribute(t),qr.getCenter(i),e.boundingSphere.radius=i.distanceTo(qr.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),qr.getSize(Us);let r={width:Us.x,height:Us.y,depth:Us.z};return this.geometry.userData.parameters=r,r}updateBoundingBox(e){let t=this.originalGeometry;qr.min.set(e[0],e[2],e[4]),qr.max.set(e[1],e[3],e[5]),this.shearScaleInv&&(qr.min.applyMatrix4(this.shearScaleInv),qr.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new tn);let i=t.boundingSphere.center;qr.getCenter(i),t.boundingSphere.radius=i.distanceTo(qr.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),qr.getSize(Us);let r={width:Us.x,height:Us.y,depth:Us.z};return this.geometry.userData.parameters=r,r}freeSubdivPointer(){this.subdivPointer&&(vv.free_bvh(this.subdivPointer),vv.free_subdivision_surface(this.subdivPointer),this.subdivPointer=0)}updateGeometry(e,t){this.geometry.userData.scale||(this.geometry.userData.scale=Array(3)),this.geometry.userData.scale[0]=this.geometry.userData.parameters.width===0?1:e.parameters.width/this.geometry.userData.parameters.width,this.geometry.userData.scale[1]=this.geometry.userData.parameters.height===0?1:e.parameters.height/this.geometry.userData.parameters.height,this.geometry.userData.scale[2]=this.geometry.userData.parameters.depth===0?1:e.parameters.depth/this.geometry.userData.parameters.depth,N_(this.originalGeometry.attributes,...this.geometry.userData.scale),this.originalGeometry.attributes.position.needsUpdate=!0,this.originalGeometry.attributes.normal.needsUpdate=!0,this.subdividedGeometry&&(N_(this.subdividedGeometry.attributes,...this.subdividedGeometry.userData.scale),this.subdividedGeometry.attributes.position.needsUpdate=!0,this.subdividedGeometry.attributes.normal.needsUpdate=!0),this.geometry.userData.parameters={...e.parameters}}};function N_(e,t,i,r){let n=e.position.array,s=e.normal.array,a=kM.makeScale(t,i,r).invert().elements,o,l,h;for(var c=0,u=n.length;c<u;c+=3)n[c]*=t,n[c+1]*=i,n[c+2]*=r,o=s[c],l=s[c+1],h=s[c+2],s[c]=a[0]*o+a[4]*l+a[8]*h,s[c+1]=a[1]*o+a[5]*l+a[9]*h,s[c+2]=a[2]*o+a[6]*l+a[10]*h}function k_(e,t){t.flatShading!==void 0&&(e.flatShading=t.flatShading,e.needsUpdate=!0),t.wireframe!==void 0&&(e.wireframe=t.wireframe),t.side!==void 0&&(t.side===0?e.side=ys:t.side===1?e.side=Ai:e.side=Lr)}function HQ(e,t){if(Array.isArray(e.material))for(let i of e.material)k_(i,t);else{let i=e.material;k_(i,t)}e.objectType==="SubdivObject"&&t.flatShading!==void 0&&(e.material.flatShading=!1,e.smoothShading=!t.flatShading,e.updateMesh())}function VQ(e,t,i){let r;if(t.geometry.type==="SubdivGeometry")r=ty.createFromState(e,t,i);else{let n=t.geometry.type==="BooleanGeometry"?new it:Q2(t.geometry),s="materials"in t?t.materials.map(a=>i.material(a)):i.material(t.material);zg.is2DParametricMesh(n.userData.type)?r=new d7(n,s):(n==null?void 0:n.userData.type)==="VectorGeometry"?r=new UT(n,s):t.geometry.type==="NonParametricGeometry"?r=new p7(n,s):t.geometry.type==="BooleanGeometry"?(r=new c7(void 0,s),r.booleanOp=t.geometry.operation,t.geometry.phongAngle!==void 0&&(r.phongAngle=t.geometry.phongAngle)):r=new VT(n,s),r.uuid=e,r.fromState(t,i)}return HQ(r,t),r}function jQ(e,t,i){return t.type==="Mesh"?t.geometry.type==="TextGeometry"?new NQ(e,t,i):VQ(e,t,i):t.type==="Empty"?ov.createFromState(e,t):t.type==="PointLight"?zT.createFromState(e,t,i):t.type==="SpotLight"?GT.createFromState(e,t,i):t.type==="DirectionalLight"?FT.createFromState(e,t,i):Pl.is(t.type)?da.createFromState(e,t):(console.error(t),new ov)}var yv=class extends Ol{};function U_(e,t){let i=!1,r=t.getLayersOfType("transmission"),n=t.getLayersOfType("outline");return n.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),i=!0,Iu(e),Ru(e)),r.length===0&&n.length===0&&e.layers.set(0),i}function F_(e,t){if(!t.layers)return!1;let i=!1,r=t.getLayersOfType("transmission"),n=t.getLayersOfType("outline");return r.length>0&&(e.layers.set(3),n.length>0&&e.layers.enable(8),i=!0),r.length===0&&n.length===0&&e.layers.set(0),i}function WQ(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Gi)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)U_(i,i.material[r])&&(t=!0);else U_(i,i.material)&&(t=!0)}),t}function qQ(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof Gi)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)F_(i,i.material[r])&&(t=!0);else F_(i,i.material)&&(t=!0)}),t}function YQ(e){"material"in e&&XQ(e.material),"geometry"in e&&e.geometry.dispose()}function XQ(e){Qj(e).forEach(t=>{t instanceof yv||t.dispose()})}var QQ=new dE,KQ=new Fe,ZQ=new Ul;function JQ(e,t,i){let r=e.cloner;if(r)for(let n of r.children){let s=KQ.copy(n.matrixWorld).invert(),a=ZQ.copy(t.ray).applyMatrix4(s),o=e.matrixWorld;a.applyMatrix4(o);let l=QQ;l.set(a.origin,a.direction),l.near=t.near,l.far=t.far,l.intersectObject(e,!1).length>0&&i.push({object:e})}}var z_=new M,UM=class extends nT(Ka){constructor(e,t){super(),this.objectType="Scene",this.backupFog=new JA(16777215,.1,2e3),this.fogUseBGColor=!1,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.bgColor=new cr(1,1,1,1),this.entityByUuid={},this.ambientLight=new mg(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.personalCamera=this.createPersonalCamera(),this.activeCamera=this.personalCamera,this.postprocessing=e.postprocessing,this.init(e,t),this.matrixAutoUpdate=!1}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=qQ(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=WQ(this),this.needsNormalDirty=!1),this._needsNormal}find(e){if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}get enableFog(){return this.fog!==null}set enableFog(e){this.fog=e===!0?this.backupFog:null}init(e,t){if(this.createChildrenObjects(e.objects,this,t),this.personalCamera.removeFromParent(),this.add(this.personalCamera),this.ambientLight.removeFromParent(),this.add(this.ambientLight),this.setBackgroundColor($i(e.backgroundColor,t)),this.updateFog(e.fog,t),this.updateAmbientLight(e.environment.ambientLight,t),this.activeCamera=this.personalCamera,e.publish.playCamera!==null){let i=this.find(e.publish.playCamera);i instanceof da&&this.switchActiveCamera(i)}this.traverse(i=>{Xi(i)&&i.recomputeBoolean()})}clearScene(){this.traverseEntity(e=>{YQ(e)});for(let e of this.children)os(e)&&e.removeFromParent()}resetAfterClear(e,t){this.init(e,t)}createPersonalCamera(){let e=da.createFromState(UM.PERSONAL_CAMERA_ID,{...Hg.defaultData,name:"Personal Camera"});return e.objectHelper.visible=!1,delete e.isEntity,this.registerObjectCreatedInLegacy(e),e}raycast(e){let t=[],i=r=>{for(let n of r.children)os(n)&&!n.raycastLock&&n.visible&&((xi(n)||iT(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),JQ(n,e,t)),i(n))};return i(this),t}traverseEntity(e){for(let t of this.children)os(t)&&t.traverseEntity(e)}traverseVisibleEntity(e){for(let t of this.children)os(t)&&t.visible&&t.traverseVisibleEntity(e)}updateFog(e,t){this.enableFog=e.enabled,this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=$i(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}dispose(){this.clearScene()}updateAmbientLight(e,t){f9(this.ambientLight,e,t),e.groundColor!==void 0&&(this.ambientLight.groundColor=$i(e.groundColor,t)),e.enabled!==void 0&&(this.ambientLight.visible=e.enabled)}switchActiveCamera(e){this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}createChildrenObjects(e,t,i){for(let r of e)this.createChildObject(r.id,r.data,r.children,t,i)}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createChildObject(e,t,i,r,n){let s=jQ(e,t,n);return s&&(this.entityByUuid[e]=s,r.add(s),Xi(r)&&xi(s)&&(s.prevBooleanObjectParent=r),this.createChildrenObjects(i,s,n)),s}getCenter(e){let t=[];for(let r=0,n=e.length;r<n;++r){let{id:s,recursive:a}=e[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let i=new fi;return i.setFromPoints(t),i.getCenter(z_),z_}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof Qi)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof Ol&&e(t.material[i]);else t.material instanceof Ol&&e(t.material)})}updateCanvasSize(e,t){this.activeCamera.setViewplaneSize(e,t);let i,r;e>=t?(i=t/e,r=1):(i=1,r=e/t),this.traverseMaterial(n=>{n.getLayersOfType("transmission").forEach(s=>{s.uniforms[`f${s.id}_aspectRatio`].value.x=i,s.uniforms[`f${s.id}_aspectRatio`].value.y=r})})}},Lp=UM;Lp.PERSONAL_CAMERA_ID="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera";var cd=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},$Q=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return tK(Math.atan2(r,i))},eK=(e,t,i)=>{let r={x:0,y:0};return i=xv(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},xv=e=>e*(Math.PI/180),tK=e=>e*(180/Math.PI),iK=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,wm=new Map,G_=e=>{wm.has(e)&&clearTimeout(wm.get(e)),wm.set(e,setTimeout(e,100))},Jd=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},H_=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},FM=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),V_=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},bv=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},iy=(e,t,i)=>{let r=zM(e);for(let n in r)if(r.hasOwnProperty(n))if(typeof t=="string")r[n]=t+" "+i;else{let s="";for(let a=0,o=t.length;a<o;a+=1)s+=t[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},rK=(e,t)=>{let i=zM(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},zM=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},_m=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},nK=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},wv=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},sK=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(GM="ontouchstart"in window,HM=!!window.PointerEvent,VM=!!window.MSPointerEvent);var GM,HM,VM,wh={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},al,vu={};HM?al=wh.pointer:VM?al=wh.MSPointer:GM?(al=wh.touch,vu=wh.mouse):al=wh.mouse;function po(){}po.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i};po.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};po.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},t)})};po.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=nK(t.options,e))};po.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},Jd(e,al[t],i._domHandlers_[t]),vu[t]&&Jd(e,vu[t],i._domHandlers_[t]),i};po.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},H_(e,al[t],i._domHandlers_[t]),vu[t]&&H_(e,vu[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var ry=po;function pi(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=pi.id,pi.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}pi.prototype=new ry;pi.constructor=pi;pi.id=0;pi.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};pi.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=rK("borderRadius","50%"),i=iy("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},_m(r.el,i),this.options.shape==="circle"&&_m(r.back,t),_m(r.front,t),this.applyStyles(r),this};pi.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};pi.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};pi.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};pi.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};pi.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};pi.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};pi.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",n={};n.front=iy("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};pi.prototype.restCallback=function(){var e=this,t={};t.front=iy("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};pi.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};pi.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(t>i&&t<i*3&&!e.lockX?n="up":t>-i&&t<=i&&!e.lockY?n="left":t>-i*3&&t<=-i&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-r&&t<r?s="left":s="right"),e.lockX||(t>0?a="up":a="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var h={};this.direction={x:s,y:a,angle:n},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(h[l]=!0);if(h.x&&h.y&&h.angle)return e;(!h.x||!h.y)&&this.trigger("plain",e),h.x||this.trigger("plain:"+s,e),h.y||this.trigger("plain:"+a,e),h.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};var aK=pi;function ni(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=ni.id,ni.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}ni.prototype=new ry;ni.constructor=ni;ni.id=0;ni.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,n=t.length;r<n;r+=1)if(t[r].identifier===i)return t[r];return!1}};ni.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};ni.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};ni.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)n={x:e.x-a.x,y:e.y-a.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=e,e={x:l.left+r.x,y:l.top+r.y}}var h=new aK(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(bv(h.ui.el,n),bv(h.ui.front,h.frontPosition)),i.nipples.push(h),i.trigger("added "+h.identifier+":added",h),i.manager.trigger("added "+h.identifier+":added",h),i.bindNipple(h),h};ni.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};ni.prototype.bindNipple=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};ni.prototype.pressureFn=function(e,t,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval(function(){var s=e.force||e.pressure||e.webkitForce||0;s!==n&&(t.trigger("pressure",s),r.trigger("pressure "+t.identifier+":pressure",s),n=s)}.bind(r),100)};ni.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=FM(e),t.updateBox();var n=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[e[0]];o.identifier=a,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return wv(e,n),t.manager.bindDocument(),!1};ni.prototype.processOnStart=function(e){var t=this,i=t.options,r,n=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=t.getOrCreate(n,a);o.identifier!==n&&t.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(c){c.trigger("start",c),t.trigger("start "+c.id+":start",c),c.show(),s>0&&t.pressureFn(e,c,c.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(o))>=0&&t.idles.splice(r,1),t.actives.push(o),t.ids.push(o.identifier),i.mode!=="semi")l(o);else{var h=cd(a,o.position);if(h<=i.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};ni.prototype.getOrCreate=function(e,t){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(t,e),n)};ni.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.scroll;if(!iK(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var h=cd(l,n.position),c=$Q(l,n.position),u=xv(c),d=h/o,p={distance:h,position:l},m,g;if(n.options.shape==="circle"?(m=Math.min(h,o),g=eK(n.position,m,c)):(g=sK(l,n.position,o),m=cd(g,n.position)),i.follow){if(h>o){let x=l.x-g.x,b=l.y-g.y;n.position.x+=x,n.position.y+=b,n.el.style.top=n.position.y-(t.box.top+s.y)+"px",n.el.style.left=n.position.x-(t.box.left+s.x)+"px",h=cd(l,n.position)}}else l=g,h=m;var f=l.x-n.position.x,v=l.y-n.position.y;n.frontPosition={x:f,y:v},i.dataOnly||bv(n.ui.front,n.frontPosition);var y={identifier:n.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:h,angle:{radian:u,degree:c},vector:{x:f/o,y:-v/o},raw:p,instance:n,lockX:i.lockX,lockY:i.lockY};y=n.computeDirection(y),y.angle={radian:xv(180-c),degree:180-c},n.trigger("move",y),t.trigger("move "+n.id+":move",y)};ni.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};ni.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};ni.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var oK=ni;function wi(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=V_(),t.config(e),t.prepareCollections();var i=function(){var n;t.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};if(typeof window>"u")return t.collections;Jd(window,"resize",function(){G_(i)});var r=function(){t.scroll=V_()};return Jd(window,"scroll",function(){G_(r)}),t.collections}wi.prototype=new ry;wi.constructor=wi;wi.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};wi.prototype.create=function(e){return this.createCollection(e)};wi.prototype.createCollection=function(e){var t=this,i=new oK(t,e);return t.bindCollection(i),t.collections.push(i),i};wi.prototype.bindCollection=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};wi.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};wi.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};wi.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};wi.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};wi.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};wi.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};wi.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};wi.prototype.onAny=function(e,t){var i=this,r,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=FM(t);var s=function(o,l,h){h.ids.indexOf(l)>=0&&(h[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),wv(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return wv(t,a),!1};wi.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};wi.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var lK=wi,j_=new lK,hK={create:function(e){return j_.create(e)},factory:j_};function Da(e,t){let i=new it,{positions:r,triIndices:n}=z0(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new Be(r,3)),i.setIndex(n),t&&i.applyMatrix4(t),i}var uK=class extends dE{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new ya({color:65280,linewidth:10}),t=new M(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new M(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new M().addVectors(t,i.multiplyScalar(r)),s=new it;return s.setFromPoints([t,n]),new wd(s,e)}},cK=DA(UO()),W_=new Map;function dK(e){if(typeof e=="string")return e;let t=W_.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},W_.set(e,t)),t.url}var dd=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof e=="string"?n={src:e}:n={src:dK(e),format:"wav"},this.sound=new cK.Howl(n),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}};function eh(e){this.char=e,this.state={},this.activeState=null}function ny(e,t,i){this.contextName=i,this.startIndex=e,this.endOffset=t}function pK(e,t,i){this.contextName=e,this.openRange=null,this.ranges=[],this.checkStart=t,this.checkEnd=i}function an(e,t){this.context=e,this.index=t,this.length=e.length,this.current=e[t],this.backtrack=e.slice(0,t),this.lookahead=e.slice(t+1)}function Op(e){this.eventId=e,this.subscribers=[]}function fK(e){let t=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];t.forEach(i=>{Object.defineProperty(this.events,i,{value:new Op(i)})}),e&&t.forEach(i=>{let r=e[i];typeof r=="function"&&this.events[i].subscribe(r)}),["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"].forEach(i=>{this.events[i].subscribe(this.updateContextsRanges)})}function $t(e){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],fK.call(this,e)}eh.prototype.setState=function(e,t){return this.state[e]=t,this.activeState={key:e,value:this.state[e]},this.activeState};eh.prototype.getState=function(e){return this.state[e]||null};$t.prototype.inboundIndex=function(e){return e>=0&&e<this.tokens.length};$t.prototype.composeRUD=function(e){let t=e.map(r=>this[r[0]].apply(this,r.slice(1).concat(!0))),i=r=>typeof r=="object"&&r.hasOwnProperty("FAIL");if(t.every(i))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:t.filter(i)};this.dispatch("composeRUD",[t.filter(r=>!i(r))])};$t.prototype.replaceRange=function(e,t,i,r){t=t!==null?t:this.tokens.length;let n=i.every(s=>s instanceof eh);if(!isNaN(e)&&this.inboundIndex(e)&&n){let s=this.tokens.splice.apply(this.tokens,[e,t].concat(i));return r||this.dispatch("replaceToken",[e,t,i]),[s,i]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};$t.prototype.replaceToken=function(e,t,i){if(!isNaN(e)&&this.inboundIndex(e)&&t instanceof eh){let r=this.tokens.splice(e,1,t);return i||this.dispatch("replaceToken",[e,t]),[r[0],t]}else return{FAIL:"replaceToken: invalid token or index."}};$t.prototype.removeRange=function(e,t,i){t=isNaN(t)?this.tokens.length:t;let r=this.tokens.splice(e,t);return i||this.dispatch("removeRange",[r,e,t]),r};$t.prototype.removeToken=function(e,t){if(!isNaN(e)&&this.inboundIndex(e)){let i=this.tokens.splice(e,1);return t||this.dispatch("removeToken",[i,e]),i}else return{FAIL:"removeToken: invalid token index."}};$t.prototype.insertToken=function(e,t,i){return e.every(r=>r instanceof eh)?(this.tokens.splice.apply(this.tokens,[t,0].concat(e)),i||this.dispatch("insertToken",[e,t]),e):{FAIL:"insertToken: invalid token(s)."}};$t.prototype.registerModifier=function(e,t,i){this.events.newToken.subscribe(function(r,n){let s=[r,n],a=t===null||t.apply(this,s)===!0,o=[r,n];if(a){let l=i.apply(this,o);r.setState(e,l)}}),this.registeredModifiers.push(e)};Op.prototype.subscribe=function(e){return typeof e=="function"?this.subscribers.push(e)-1:{FAIL:`invalid '${this.eventId}' event handler`}};Op.prototype.unsubscribe=function(e){this.subscribers.splice(e,1)};an.prototype.setCurrentIndex=function(e){this.index=e,this.current=this.context[e],this.backtrack=this.context.slice(0,e),this.lookahead=this.context.slice(e+1)};an.prototype.get=function(e){switch(!0){case e===0:return this.current;case(e<0&&Math.abs(e)<=this.backtrack.length):return this.backtrack.slice(e)[0];case(e>0&&e<=this.lookahead.length):return this.lookahead[e-1];default:return null}};$t.prototype.rangeToText=function(e){if(e instanceof ny)return this.getRangeTokens(e).map(t=>t.char).join("")};$t.prototype.getText=function(){return this.tokens.map(e=>e.char).join("")};$t.prototype.getContext=function(e){return this.registeredContexts[e]||null};$t.prototype.on=function(e,t){let i=this.events[e];return i?i.subscribe(t):null};$t.prototype.dispatch=function(e,t){let i=this.events[e];i instanceof Op&&i.subscribers.forEach(r=>{r.apply(this,t||[])})};$t.prototype.registerContextChecker=function(e,t,i){if(this.getContext(e))return{FAIL:`context name '${e}' is already registered.`};if(typeof t!="function")return{FAIL:"missing context start check."};if(typeof i!="function")return{FAIL:"missing context end check."};let r=new pK(e,t,i);return this.registeredContexts[e]=r,this.contextCheckers.push(r),r};$t.prototype.getRangeTokens=function(e){let t=e.startIndex+e.endOffset;return[].concat(this.tokens.slice(e.startIndex,t))};$t.prototype.getContextRanges=function(e){let t=this.getContext(e);return t?t.ranges:{FAIL:`context checker '${e}' is not registered.`}};$t.prototype.resetContextsRanges=function(){let e=this.registeredContexts;for(let t in e)if(e.hasOwnProperty(t)){let i=e[t];i.ranges=[]}};$t.prototype.updateContextsRanges=function(){this.resetContextsRanges();let e=this.tokens.map(t=>t.char);for(let t=0;t<e.length;t++){let i=new an(e,t);this.runContextCheck(i)}this.dispatch("updateContextsRanges",[this.registeredContexts])};$t.prototype.setEndOffset=function(e,t){let i=this.getContext(t).openRange.startIndex,r=new ny(i,e,t),n=this.getContext(t).ranges;return r.rangeId=`${t}.${n.length}`,n.push(r),this.getContext(t).openRange=null,r};$t.prototype.runContextCheck=function(e){let t=e.index;this.contextCheckers.forEach(i=>{let r=i.contextName,n=this.getContext(r).openRange;if(!n&&i.checkStart(e)&&(n=new ny(t,null,r),this.getContext(r).openRange=n,this.dispatch("contextStart",[r,t])),!!n&&i.checkEnd(e)){let s=t-n.startIndex+1,a=this.setEndOffset(s,r);this.dispatch("contextEnd",[r,a])}})};$t.prototype.tokenize=function(e){this.tokens=[],this.resetContextsRanges();let t=Array.from(e);this.dispatch("start");for(let i=0;i<t.length;i++){let r=t[i],n=new an(t,i);this.dispatch("next",[n]),this.runContextCheck(n);let s=new eh(r);this.tokens.push(s),this.dispatch("newToken",[s,n])}return this.dispatch("end",[this.tokens]),this.tokens};var mK=$t;function na(e){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(e)}function jM(e){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(e)}function fa(e){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(e)}function pd(e){return/[A-z]/.test(e)}function gK(e){return/\s/.test(e)}function yr(e){this.font=e,this.features={}}function za(e){this.id=e.id,this.tag=e.tag,this.substitution=e.substitution}function Gu(e,t){if(!e)return-1;switch(t.format){case 1:return t.glyphs.indexOf(e);case 2:let i=t.ranges;for(let r=0;r<i.length;r++){let n=i[r];if(e>=n.start&&e<=n.end){let s=e-n.start;return n.index+s}}break;default:return-1}return-1}function vK(e,t){return Gu(e,t.coverage)===-1?null:e+t.deltaGlyphId}function yK(e,t){let i=Gu(e,t.coverage);return i===-1?null:t.substitute[i]}function Sm(e,t){let i=[];for(let r=0;r<e.length;r++){let n=e[r],s=t.current;s=Array.isArray(s)?s[0]:s;let a=Gu(s,n);a!==-1&&i.push(a)}return i.length!==e.length?-1:i}function xK(e,t){let i=t.inputCoverage.length+t.lookaheadCoverage.length+t.backtrackCoverage.length;if(e.context.length<i)return[];let r=Sm(t.inputCoverage,e);if(r===-1)return[];let n=t.inputCoverage.length-1;if(e.lookahead.length<t.lookaheadCoverage.length)return[];let s=e.lookahead.slice(n);for(;s.length&&fa(s[0].char);)s.shift();let a=new an(s,0),o=Sm(t.lookaheadCoverage,a),l=[].concat(e.backtrack);for(l.reverse();l.length&&fa(l[0].char);)l.shift();if(l.length<t.backtrackCoverage.length)return[];let h=new an(l,0),c=Sm(t.backtrackCoverage,h),u=r.length===t.inputCoverage.length&&o.length===t.lookaheadCoverage.length&&c.length===t.backtrackCoverage.length,d=[];if(u)for(let p=0;p<t.lookupRecords.length;p++){let m=t.lookupRecords[p].lookupListIndex,g=this.getLookupByIndex(m);for(let f=0;f<g.subtables.length;f++){let v=g.subtables[f],y=this.getLookupMethod(g,v);if(this.getSubstitutionType(g,v)==="12")for(let x=0;x<r.length;x++){let b=e.get(x),S=y(b);S&&d.push(S)}}}return d}function bK(e,t){let i=e.current,r=Gu(i,t.coverage);if(r===-1)return null;let n,s=t.ligatureSets[r];for(let a=0;a<s.length;a++){n=s[a];for(let o=0;o<n.components.length;o++){let l=e.lookahead[o],h=n.components[o];if(l!==h)break;if(o===n.components.length-1)return n}}return null}function wK(e,t){let i=Gu(e,t.coverage);return i===-1?null:t.sequences[i]}yr.prototype.getDefaultScriptFeaturesIndexes=function(){let e=this.font.tables.gsub.scripts;for(let t=0;t<e.length;t++){let i=e[t];if(i.tag==="DFLT")return i.script.defaultLangSys.featureIndexes}return[]};yr.prototype.getScriptFeaturesIndexes=function(e){if(!this.font.tables.gsub)return[];if(!e)return this.getDefaultScriptFeaturesIndexes();let t=this.font.tables.gsub.scripts;for(let i=0;i<t.length;i++){let r=t[i];if(r.tag===e&&r.script.defaultLangSys)return r.script.defaultLangSys.featureIndexes;{let n=r.langSysRecords;if(n)for(let s=0;s<n.length;s++){let a=n[s];if(a.tag===e)return a.langSys.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};yr.prototype.mapTagsToFeatures=function(e,t){let i={};for(let r=0;r<e.length;r++){let n=e[r].tag,s=e[r].feature;i[n]=s}this.features[t].tags=i};yr.prototype.getScriptFeatures=function(e){let t=this.features[e];if(this.features.hasOwnProperty(e))return t;let i=this.getScriptFeaturesIndexes(e);if(!i)return null;let r=this.font.tables.gsub;return t=i.map(n=>r.features[n]),this.features[e]=t,this.mapTagsToFeatures(t,e),t};yr.prototype.getSubstitutionType=function(e,t){let i=e.lookupType.toString(),r=t.substFormat.toString();return i+r};yr.prototype.getLookupMethod=function(e,t){switch(this.getSubstitutionType(e,t)){case"11":return i=>vK.apply(this,[i,t]);case"12":return i=>yK.apply(this,[i,t]);case"63":return i=>xK.apply(this,[i,t]);case"41":return i=>bK.apply(this,[i,t]);case"21":return i=>wK.apply(this,[i,t]);default:throw new Error(`lookupType: ${e.lookupType} - substFormat: ${t.substFormat} is not yet supported`)}};yr.prototype.lookupFeature=function(e){let t=e.contextParams,i=t.index,r=this.getFeature({tag:e.tag,script:e.script});if(!r)return new Error(`font '${this.font.names.fullName.en}' doesn't support feature '${e.tag}' for script '${e.script}'.`);let n=this.getFeatureLookups(r),s=[].concat(t.context);for(let a=0;a<n.length;a++){let o=n[a],l=this.getLookupSubtables(o);for(let h=0;h<l.length;h++){let c=l[h],u=this.getSubstitutionType(o,c),d=this.getLookupMethod(o,c),p;switch(u){case"11":p=d(t.current),p&&s.splice(i,1,new za({id:11,tag:e.tag,substitution:p}));break;case"12":p=d(t.current),p&&s.splice(i,1,new za({id:12,tag:e.tag,substitution:p}));break;case"63":p=d(t),Array.isArray(p)&&p.length&&s.splice(i,1,new za({id:63,tag:e.tag,substitution:p}));break;case"41":p=d(t),p&&s.splice(i,1,new za({id:41,tag:e.tag,substitution:p}));break;case"21":p=d(t.current),p&&s.splice(i,1,new za({id:21,tag:e.tag,substitution:p}));break}t=new an(s,i),!(Array.isArray(p)&&!p.length)&&(p=null)}}return s.length?s:null};yr.prototype.supports=function(e){if(!e.script)return!1;this.getScriptFeatures(e.script);let t=this.features.hasOwnProperty(e.script);if(!e.tag)return t;let i=this.features[e.script].some(r=>r.tag===e.tag);return t&&i};yr.prototype.getLookupSubtables=function(e){return e.subtables||null};yr.prototype.getLookupByIndex=function(e){return this.font.tables.gsub.lookups[e]||null};yr.prototype.getFeatureLookups=function(e){return e.lookupListIndexes.map(this.getLookupByIndex.bind(this))};yr.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);let t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:`No feature for script ${e.script}`}};var _K=yr;function SK(e){let t=e.current,i=e.get(-1);return i===null&&na(t)||!na(i)&&na(t)}function AK(e){let t=e.get(1);return t===null||!na(t)}var EK={startCheck:SK,endCheck:AK};function TK(e){let t=e.current,i=e.get(-1);return(na(t)||fa(t))&&!na(i)}function MK(e){let t=e.get(1);switch(!0){case t===null:return!0;case(!na(t)&&!fa(t)):let i=gK(t);if(!i)return!0;if(i){let r=!1;if(r=e.lookahead.some(n=>na(n)||fa(n)),!r)return!0}break;default:return!1}}var CK={startCheck:TK,endCheck:MK};function DK(e,t,i){t[i].setState(e.tag,e.substitution)}function PK(e,t,i){t[i].setState(e.tag,e.substitution)}function LK(e,t,i){e.substitution.forEach((r,n)=>{t[i+n].setState(e.tag,r)})}function OK(e,t,i){let r=t[i];r.setState(e.tag,e.substitution.ligGlyph);let n=e.substitution.components.length;for(let s=0;s<n;s++)r=t[i+s+1],r.setState("deleted",!0)}var q_={11:DK,12:PK,63:LK,41:OK};function RK(e,t,i){e instanceof za&&q_[e.id]&&q_[e.id](e,t,i)}var sy=RK;function IK(e){let t=[].concat(e.backtrack);for(let i=t.length-1;i>=0;i--){let r=t[i],n=jM(r),s=fa(r);if(!n&&!s)return!0;if(n)return!1}return!1}function BK(e){if(jM(e.current))return!1;for(let t=0;t<e.lookahead.length;t++){let i=e.lookahead[t];if(!fa(i))return!0}return!1}function NK(e){let t="arab",i=this.featuresTags[t],r=this.tokenizer.getRangeTokens(e);if(r.length===1)return;let n=new an(r.map(a=>a.getState("glyphIndex")),0),s=new an(r.map(a=>a.char),0);r.forEach((a,o)=>{if(fa(a.char))return;n.setCurrentIndex(o),s.setCurrentIndex(o);let l=0;IK(s)&&(l|=1),BK(s)&&(l|=2);let h;switch(l){case 1:h="fina";break;case 2:h="init";break;case 3:h="medi";break}if(i.indexOf(h)===-1)return;let c=this.query.lookupFeature({tag:h,script:t,contextParams:n});if(c instanceof Error)return console.info(c.message);c.forEach((u,d)=>{u instanceof za&&(sy(u,r,d),n.context[d]=u.substitution)})})}var kK=NK;function Y_(e,t){let i=e.map(r=>r.activeState.value);return new an(i,t||0)}function UK(e){let t="arab",i=this.tokenizer.getRangeTokens(e),r=Y_(i);r.context.forEach((n,s)=>{r.setCurrentIndex(s);let a=this.query.lookupFeature({tag:"rlig",script:t,contextParams:r});a.length&&(a.forEach(o=>sy(o,i,s)),r=Y_(i))})}var FK=UK;function zK(e){let t=e.current,i=e.get(-1);return i===null&&pd(t)||!pd(i)&&pd(t)}function GK(e){let t=e.get(1);return t===null||!pd(t)}var HK={startCheck:zK,endCheck:GK};function X_(e,t){let i=e.map(r=>r.activeState.value);return new an(i,t||0)}function VK(e){let t="latn",i=this.tokenizer.getRangeTokens(e),r=X_(i);r.context.forEach((n,s)=>{r.setCurrentIndex(s);let a=this.query.lookupFeature({tag:"liga",script:t,contextParams:r});a.length&&(a.forEach(o=>sy(o,i,s)),r=X_(i))})}var jK=VK;function dn(e){this.baseDir=e||"ltr",this.tokenizer=new mK,this.featuresTags={}}dn.prototype.setText=function(e){this.text=e};dn.prototype.contextChecks={latinWordCheck:HK,arabicWordCheck:EK,arabicSentenceCheck:CK};function Am(e){let t=this.contextChecks[`${e}Check`];return this.tokenizer.registerContextChecker(e,t.startCheck,t.endCheck)}function WK(){return Am.call(this,"latinWord"),Am.call(this,"arabicWord"),Am.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function qK(){this.tokenizer.getContextRanges("arabicSentence").forEach(e=>{let t=this.tokenizer.getRangeTokens(e);this.tokenizer.replaceRange(e.startIndex,e.endOffset,t.reverse())})}dn.prototype.registerFeatures=function(e,t){let i=t.filter(r=>this.query.supports({script:e,tag:r}));this.featuresTags.hasOwnProperty(e)?this.featuresTags[e]=this.featuresTags[e].concat(i):this.featuresTags[e]=i};dn.prototype.applyFeatures=function(e,t){if(!e)throw new Error("No valid font was provided to apply features");this.query||(this.query=new _K(e));for(let i=0;i<t.length;i++){let r=t[i];!this.query.supports({script:r.script})||this.registerFeatures(r.script,r.tags)}};dn.prototype.registerModifier=function(e,t,i){this.tokenizer.registerModifier(e,t,i)};function ay(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function YK(){let e="arab";!this.featuresTags.hasOwnProperty(e)||(ay.call(this),this.tokenizer.getContextRanges("arabicWord").forEach(t=>{kK.call(this,t)}))}function XK(){let e="arab";!this.featuresTags.hasOwnProperty(e)||this.featuresTags[e].indexOf("rlig")===-1||(ay.call(this),this.tokenizer.getContextRanges("arabicWord").forEach(t=>{FK.call(this,t)}))}function QK(){let e="latn";!this.featuresTags.hasOwnProperty(e)||this.featuresTags[e].indexOf("liga")===-1||(ay.call(this),this.tokenizer.getContextRanges("latinWord").forEach(t=>{jK.call(this,t)}))}dn.prototype.checkContextReady=function(e){return!!this.tokenizer.getContext(e)};dn.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(YK.call(this),XK.call(this)),this.checkContextReady("latinWord")&&QK.call(this),this.checkContextReady("arabicSentence")&&qK.call(this)};dn.prototype.processText=function(e){(!this.text||this.text!==e)&&(this.setText(e),WK.call(this),this.applyFeaturesToContexts())};dn.prototype.getBidiText=function(e){return this.processText(e),this.tokenizer.getText()};dn.prototype.getTextGlyphs=function(e){this.processText(e);let t=[];for(let i=0;i<this.tokenizer.tokens.length;i++){let r=this.tokenizer.tokens[i];if(r.state.deleted)continue;let n=r.activeState.value;t.push(Array.isArray(n)?n[0]:n)}return t};var KK=dn,ZK=class{constructor(){this.type="ShapePath",this.color=new Ze,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new _d,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(e,t,i,r,n,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,m,g,f){let v=p.x,y=m.x,x=g.x,b=f.x,S=p.y,_=m.y,A=g.y,w=f.y,E=(b-x)*(S-A)-(w-A)*(v-x),T=(y-v)*(S-A)-(_-S)*(v-x),C=(w-A)*(y-v)-(b-x)*(_-S),P=E/C,k=T/C;if(C===0&&E!==0||P<=0||P>=1||k<0||k>1)return null;if(E===0&&C===0){for(let D=0;D<2;D++)if(r(D===0?g:f,p,m),t.loc===e.ORIGIN){let R=D===0?g:f;return{x:R.x,y:R.y,t:t.t}}else if(t.loc===e.BETWEEN){let R=+(v+t.t*(y-v)).toPrecision(10),G=+(S+t.t*(_-S)).toPrecision(10);return{x:R,y:G,t:t.t}}return null}else{for(let G=0;G<2;G++)if(r(G===0?g:f,p,m),t.loc===e.ORIGIN){let N=G===0?g:f;return{x:N.x,y:N.y,t:t.t}}let D=+(v+P*(y-v)).toPrecision(10),R=+(S+P*(_-S)).toPrecision(10);return{x:D,y:R,t:P}}}function r(p,m,g){let f=g.x-m.x,v=g.y-m.y,y=p.x-m.x,x=p.y-m.y,b=f*x-y*v;if(p.x===m.x&&p.y===m.y){t.loc=e.ORIGIN,t.t=0;return}if(p.x===g.x&&p.y===g.y){t.loc=e.DESTINATION,t.t=1;return}if(b<-Number.EPSILON){t.loc=e.LEFT;return}if(b>Number.EPSILON){t.loc=e.RIGHT;return}if(f*y<0||v*x<0){t.loc=e.BEHIND;return}if(Math.sqrt(f*f+v*v)<Math.sqrt(y*y+x*x)){t.loc=e.BEYOND;return}let S;f!==0?S=y/f:S=x/v,t.loc=e.BETWEEN,t.t=S}function n(p,m){let g=[],f=[];for(let v=1;v<p.length;v++){let y=p[v-1],x=p[v];for(let b=1;b<m.length;b++){let S=m[b-1],_=m[b],A=i(y,x,S,_);A!==null&&g.find(w=>w.t<=A.t+Number.EPSILON&&w.t>=A.t-Number.EPSILON)===void 0&&(g.push(A),f.push(new q(A.x,A.y)))}}return f}function s(p,m,g){let f=new q;m.getCenter(f);let v=[];return g.forEach(y=>{y.boundingBox.containsPoint(f)&&n(p,y.points).forEach(x=>{v.push({identifier:y.identifier,isCW:y.isCW,point:x})})}),v.sort((y,x)=>y.point.x-x.point.x),v}function a(p,m,g,f,v){(v==null||v==="")&&(v="nonzero");let y=new q;p.boundingBox.getCenter(y);let x=[new q(g,y.y),new q(f,y.y)],b=s(x,p.boundingBox,m);b.sort((T,C)=>T.point.x-C.point.x);let S=[],_=[];b.forEach(T=>{T.identifier===p.identifier?S.push(T):_.push(T)});let A=S[0].point.x,w=[],E=0;for(;E<_.length&&_[E].point.x<A;)w.length>0&&w[w.length-1]===_[E].identifier?w.pop():w.push(_[E].identifier),E++;if(w.push(p.identifier),v==="evenodd"){let T=w.length%2===0,C=w[w.length-2];return{identifier:p.identifier,isHole:T,for:C}}else if(v==="nonzero"){let T=!0,C=null,P=null;for(let k=0;k<w.length;k++){let D=w[k];m[D]&&(T?(P=m[D].isCW,T=!1,C=D):P!==m[D].isCW&&(P=m[D].isCW,T=!0))}return{identifier:p.identifier,isHole:T,for:C}}else console.warn('fill-rule: "'+v+'" is currently not implemented.')}let o=0,l=999999999,h=-999999999,c=[];this.subPaths.forEach(p=>{let m=p.getPoints(),g=-999999999,f=999999999,v=-999999999,y=999999999;for(let x=0;x<m.length;x++){let b=m[x];b.y>g&&(g=b.y),b.y<f&&(f=b.y),b.x>v&&(v=b.x),b.x<y&&(y=b.x)}h<=v&&(h=v+1),l>=y&&(l=y-1),m.length&&c.push({curves:p.curves,points:m,isCW:aE.isClockWise(m),identifier:o++,boundingBox:new PU(new q(y,f),new q(v,g))})});let u=c.map(p=>{var m;return a(p,c,l,h,(m=this.userData)==null?void 0:m.style.fillRule)}),d=[];return c.forEach(p=>{let m=u[p.identifier];if(m&&!m.isHole){let g=new Sd;g.curves=p.curves,u.filter(f=>(f==null?void 0:f.isHole)&&f.for===p.identifier).forEach(f=>{if(f){let v=c[f.identifier],y=new _d;y.curves=v.curves,g.holes.push(y)}}),d.push(g)}}),d}};function JK(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var $K=class{constructor(e,t){var i;this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=(i=e.isUserFont)!=null?i:!1,this._loadingPromise=O_(e).then(r=>{r&&(this._arrayBuffer=r.arr,this._url=r.url,this.font=r.font,this._intercepted=r.intercepted,this._isLoaded=!0,t())})}update(e,t){var i;this._isLoaded=!1,this._isUserFont=(i=e.isUserFont)!=null?i:!1,this._loadingPromise=O_(e).then(r=>{r&&(this._arrayBuffer=r.arr,this._url=r.url,this.font=r.font,this._intercepted=r.intercepted,this._isLoaded=!0,t())})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){let r=new KK,n=h=>e.charToGlyphIndex(h.char);r.registerModifier("glyphIndex",null,n),r.applyFeatures(e,e.defaultRenderOptions.features),r.getTextGlyphs(t);let s=r.tokenizer.tokens,a=[],o=0,l=i.length===s.length;for(let h=0;h<i.length;h++){let c=i[h].index,u=String.fromCharCode(i[h].unicode),d=s[o];if(JK(c,d)||l)a.push({char:u,index:c,replacements:[d.state.glyphIndex],replacementChars:[d.char]}),o++;else{let p=d.char,m="",g=[d.state.glyphIndex],f=[],v=!1;for(;!v;)o++,m=t.charAt(o),p+=m,g.push(e.charToGlyphIndex(m)),f=e.stringToGlyphs(p),f.length===1&&f[0].index===c&&(v=!0),o>t.length&&(v=!0);a.push({char:u,index:c,replacements:g,replacementChars:Array.from(p)}),o++}}return a}async generateShapes(e,t){await this._loadingPromise;let i=this.font,r=t.fontSize/this.unitsPerEm,n=t.fontSize*t.lineHeight,s=e.map(f=>this.getTextWidth(f,t)),a=t.width,o=this.getLineInitialOffsetX(s[0],a,t.horizontalAlign),l=this.getLineInitialOffsetY(n,e.length,t.height,r,t.verticalAlign),h=this.computeSpaceWidthForLine(e,0,t),c=this.getCharWidth(`
`,t),u=[],d=e.map(f=>[]),p=e.map(f=>[]),m;for(let f=0;f<e.length;f++){let v=e[f],y={features:{liga:!0}},x=[];try{x=i.stringToGlyphs(v,y)}catch(S){console.warn(S)}o=this.getLineInitialOffsetX(s[f],a,t.horizontalAlign);let b=[];try{b=this.reverseLigaturesTable(i,v,x)}catch(S){console.warn(S)}h=this.computeSpaceWidthForLine(e,f,t);for(let S=0;S<x.length;S++){let _=x[S],A=_.index===0?`
`:_.unicode?String.fromCharCode(_.unicode):void 0,w=b[S],E=0,T=0;S===0&&t.horizontalAlign===2&&_.leftSideBearing!==void 0&&(T=-_.leftSideBearing*r),m&&(E=i.getKerningValue(_,m)*r),o+=T+E;let C=0;if(A===`
`)C=c;else if(A===" ")C=h;else{let P=this.createPath(_,r,o,l,t);P&&(C=P.offsetX-(E+T),u.push(P.path))}if(w.replacements.length===1)p[f].push([o,l]),d[f].push(C);else{let P=w.replacements.map(G=>{var N;return((N=i.glyphs.get(G).advanceWidth)!=null?N:0)*r}),k=P.reduce((G,N)=>G+=N,0),D=P.map(G=>G/k),R=o;for(let G=0;G<D.length;G++){let N=C*D[G];p[f].push([R,l]),d[f].push(N),R+=N}}o+=C,m=_}l-=n}let g=[];for(let f=0,v=u.length;f<v;f++)g.push(...u[f].toShapes());return{shapes:g,charWidths:d,lineWidths:s,charCoords:p}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e,t;return(t=(e=this.font)==null?void 0:e.ascender)!=null?t:0}get descender(){var e,t;return(t=(e=this.font)==null?void 0:e.descender)!=null?t:0}get familyName(){var e,t;return(t=(e=this.font)==null?void 0:e.names.fontFamily)!=null?t:""}get subfamilyName(){var e,t;return(t=(e=this.font)==null?void 0:e.names.fontSubfamily)!=null?t:""}get unitsPerEm(){var e,t;return(t=(e=this.font)==null?void 0:e.unitsPerEm)!=null?t:1}getLineInitialOffsetX(e,t,i){return i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,n){let s=t*e,a=Math.abs(this.ascender-this.descender)*r,o=e-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(e,t,i,r,n){var l,h;let s=e.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let a=new ZK,o=((l=e.advanceWidth)!=null?l:1)*t;if(e)for(let c of s.commands){let u=(h=a.currentPath)==null?void 0:h.currentPoint;if(!(u&&c.type!=="Z"&&u.x===c.x&&-u.y===c.y))switch(c.type){case"M":a.moveTo(c.x,-c.y);break;case"L":a.lineTo(c.x,-c.y);break;case"Q":a.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":a.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return a.subPaths.forEach(c=>{let u=eZ(c.curves);u!==void 0&&c.currentPoint.distanceTo(u)>0&&c.lineTo(u.x,u.y)}),{offsetX:o+n.fontSize*n.letterSpacing,path:a}}getCharWidth(e,t){var i,r;return(r=(i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))!=null?r:0}getTextWidth(e,t){var i,r;return(r=(i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))!=null?r:0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),n=e[t];if(n){let s=this.countSpaces(n.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&s){let a=i.width,o=this.getTextWidth(n,i);return(a-(o-s*r))/s}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function eZ(e){if(e.length){let t=e[0];if(t instanceof en)return t.v1;if(t instanceof Zr||t instanceof ha)return t.v0}}var oy=class{constructor(e,t={}){if(this.deletedMaterial=new yv(Br.defaultTwoLayerData("basic"),this),this.deletedImage=new av(Yg.emptyImage),this.materials={},this.images={},this.colors={},this.audios={},this.fonts={},this.penumbraSize=[],this.onImageLoad=()=>{this._onImageLoad&&this._onImageLoad()},this.onFontLoad=()=>{this._onFontLoad&&this._onFontLoad()},t.images)for(let[i,r]of Object.entries(t.images))this.addImage(i,r);if(t.audios)for(let[i,r]of Object.entries(t.audios))this.addAudio(i,r.data);this.reset(e)}setOnImageLoad(e){this._onImageLoad=e}setOnFontLoad(e){this._onFontLoad=e}reset(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,new yv(i,this));for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.data);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i);this.penumbraSize=e.penumbraSize}addMaterial(e,t){t.uuid=e,this.materials[e]=t}deleteMaterial(e){this.materials[e]&&(this.materials[e].dispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){var t;return(t=this.materials[e])!=null?t:this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):new Ol(e,this)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.images[e].updateSrc(t.data),!0):(this.images[e]=new av(t,this.onImageLoad),!1)}deleteImage(e){this.images[e]&&delete this.images[e]}getDefaultImage(){return this.images.image_0}getImage(e){var t;return(t=this.images[e])!=null?t:this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):new CT(e,this.onImageLoad)}getImages(){return this.images}addColor(e,t){return this.colors[e]?("a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new Wd(t.r,t.g,t.b,t.a):this.colors[e]=new Wd(t.r,t.g,t.b,1),!1)}updateColor(e,t){var i,r,n,s;if(this.colors[e]){let a=this.colors[e];return this.colors[e].r=(i=t.r)!=null?i:a.r,this.colors[e].g=(r=t.g)!=null?r:a.g,this.colors[e].b=(n=t.b)!=null?n:a.b,this.colors[e].a=(s=t.a)!=null?s:a.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new cr(0,0,0,0))}else return"a"in e?new cr(e.r,e.g,e.b,e.a):new cr(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof dd)return t;{let i=new dd({src:t});return this.audios[e]=i,i}}deleteAudio(e){this.audios[e]&&delete this.audios[e]}addFont(e,t){this.fonts[e]=new $K(t,this.onFontLoad)}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._onImageLoad=void 0,Object.values(this.audios).forEach(e=>{e instanceof dd&&e.dispose()}),this.audios={}}};new oy(Gd.emptyData());function tZ(e,t){return e.distance-t.distance}function WM(e,t,i){if(fs(t)&&t.visible&&!t.raycastLock)t.raycast(e,i);else return;for(let r of t.children)WM(e,r,i)}function qM(e,t,i){if(!i.some(n=>ly(e,n)!==void 0))return[];let r=[];return t.children.forEach(n=>WM(e,n,r)),r.sort(tZ),r}function YM(e){let t=[];if(e.length){let i=e[0].object;fs(i)&&t.push(i);let r=i.parent;for(;r;)tT(r)&&t.push(r),r=r.parent}return t}function ly(e,t){if(xi(t)){if(!t.raycastLock&&t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(tT(t))return XM(e,t)}function XM(e,t){if(xi(t)&&!t.raycastLock&&t.visible){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children)if(fs(i)){let r=XM(e,i);if(r)return r}}function iZ(e){if(e.style.transform!==""){let t=getComputedStyle(e).getPropertyValue("transform");if(t!=="none"){let i=t.replace("matrix(","").split(",");return{x:parseFloat(i[0]),y:parseFloat(i[3])}}}return{x:1,y:1}}function Q_(e){let t=e.getViewport(new ht),i=iZ(e.domElement);return{left:t.x*i.x,top:t.y*i.y,width:t.z*i.x,height:t.w*i.y}}function rZ(e,t,i,r){let n=i.height-r.height,s=(e-r.left-i.left)*(i.width/r.width),a=(t-n+r.top-i.top)*(i.height/r.height);return{x:s/i.width*2-1,y:-(a/i.height)*2+1}}var nZ=class{constructor(e,t,i,r,n,s){this.isExport=s,this.raycaster=new uK,this.raycasterNeedsUpdate=!0,this.stopRaycast=!1,this.sharedAssets=new oy(Gd.emptyData()),this.scene=new Lp({...Wg.defaultData},this.sharedAssets),this.camera=new da,this.renderer=e,this.domElement=e.domElement,this._domRect=this.domElement.getBoundingClientRect(),this._viewRect=Q_(this.renderer),this.stopRaycast=n,this.sharedAssets=r,this.scene=t,this.camera=i}get domRect(){return this._domRect}get viewRect(){return this._viewRect}updaterRect(){this._domRect=this.domElement.getBoundingClientRect(),this._viewRect=Q_(this.renderer)}updateRaycaster(e){if(!this.raycasterNeedsUpdate)return;this.raycasterNeedsUpdate=!1;let{clientX:t,clientY:i}=e.touches!==void 0&&e.touches.length>0?e.touches[0]:e;this.raycaster.setFromCamera(rZ(t,i,this._domRect,this._viewRect),this.camera)}},QM=(e=>(e[e.keydown=0]="keydown",e[e.keyup=1]="keyup",e[e.pointerdown=2]="pointerdown",e[e.pointerup=3]="pointerup",e[e.pointermove=4]="pointermove",e[e.wheel=5]="wheel",e))(QM||{}),fo=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set}connect(){}disconnect(){}},KM=new Map,Yh=new Map,Bh=class{constructor(e,t,i,r){this.data=t;let{audio:n,volume:s,delay:a,loop:o}=t;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new dd({src:l,volume:s,delay:a,loop:o}),Yh.has(i.uuid)?Yh.get(i.uuid).push(this):Yh.set(i.uuid,[this]),KM.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.dispose()}},ZM=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=KM.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=Yh.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...Yh.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},ol=class{constructor(e,t,i,r){if(this.data=t,t.interaction==="play")this.interaction=new Bh(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new ZM(t);else throw new Error("Missing property")}dispatchBasic(){this.interaction instanceof Bh?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){this.interaction instanceof Bh?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){this.interaction instanceof Bh&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},sZ="text/plain",aZ="us-ascii",K_=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),oZ=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=t?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),h=[...a.map(c=>{let[u,d=""]=c.split("=").map(p=>p.trim());return u==="charset"&&(d=d.toLowerCase(),d===aZ)?"":`${u}${d?`=${d}`:""}`}).filter(Boolean)];return o&&h.push("base64"),(h.length>0||l&&l!==sZ)&&h.unshift(l),`data:${h.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function lZ(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return oZ(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let l=s.exec(r.pathname);if(!l)break;let h=l[0],c=l.index;o+=r.pathname.slice(a,c).replace(/\/{2,}/g,"/"),o+=h,a=c+h.length}o+=r.pathname.slice(a,r.pathname.length).replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];K_(a,t.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...r.searchParams.keys()])K_(s,t.removeQueryParameters)&&r.searchParams.delete(s);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var hZ=class{constructor({url:e}){if(!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:lZ(e)}dispatch(){qg?window.location.assign(this.url):window.open(this.url,"_blank")}},JM={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},hy={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},uZ=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],$d={CSS:{},springs:{}};function Rn(e,t,i){return Math.min(Math.max(e,t),i)}function Xh(e,t){return e.indexOf(t)>-1}function Em(e,t){return e.apply(null,t)}var Ke={arr:function(e){return Array.isArray(e)},obj:function(e){return Xh(Object.prototype.toString.call(e),"Object")},pth:function(e){return Ke.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||Ke.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return Ke.hex(e)||Ke.rgb(e)||Ke.hsl(e)},key:function(e){return!JM.hasOwnProperty(e)&&!hy.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function $M(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function eC(e,t){var i=$M(e),r=Rn(Ke.und(i[0])?1:i[0],.1,100),n=Rn(Ke.und(i[1])?100:i[1],.1,100),s=Rn(Ke.und(i[2])?10:i[2],.1,100),a=Rn(Ke.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),h=l<1?o*Math.sqrt(1-l*l):0,c=1,u=l<1?(l*o+-a)/h:-a+o;function d(m){var g=t?t*m/1e3:m;return l<1?g=Math.exp(-g*l*o)*(c*Math.cos(h*g)+u*Math.sin(h*g)):g=(c+u*g)*Math.exp(-g*o),m===0||m===1?m:1-g}function p(){var m=$d.springs[e];if(m)return m;for(var g=1/6,f=0,v=0;;)if(f+=g,d(f)===1){if(v++,v>=16)break}else v=0;var y=f*g*1e3;return $d.springs[e]=y,y}return t?d:p}function cZ(e){return e===void 0&&(e=10),function(t){return Math.ceil(Rn(t,1e-6,1)*e)*(1/e)}}var dZ=function(){var e=11,t=1/(e-1);function i(c,u){return 1-3*u+3*c}function r(c,u){return 3*u-6*c}function n(c){return 3*c}function s(c,u,d){return((i(u,d)*c+r(u,d))*c+n(u))*c}function a(c,u,d){return 3*i(u,d)*c*c+2*r(u,d)*c+n(u)}function o(c,u,d,p,m){var g,f,v=0;do f=u+(d-u)/2,g=s(f,p,m)-c,g>0?d=f:u=f;while(Math.abs(g)>1e-7&&++v<10);return f}function l(c,u,d,p){for(var m=0;m<4;++m){var g=a(u,d,p);if(g===0)return u;var f=s(u,d,p)-c;u-=f/g}return u}function h(c,u,d,p){if(!(0<=c&&c<=1&&0<=d&&d<=1))return;var m=new Float32Array(e);if(c!==u||d!==p)for(var g=0;g<e;++g)m[g]=s(g*t,c,d);function f(v){for(var y=0,x=1,b=e-1;x!==b&&m[x]<=v;++x)y+=t;--x;var S=(v-m[x])/(m[x+1]-m[x]),_=y+S*t,A=a(_,c,d);return A>=.001?l(v,_,c,d):A===0?_:o(v,y,y+t,c,d)}return function(v){return c===u&&d===p||v===0||v===1?v:s(f(v),u,p)}}return h}(),tC=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=Rn(r,1,10),a=Rn(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){t[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(t).forEach(function(r){var n=t[r];e["easeIn"+r]=n,e["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},e["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),e}();function uy(e,t){if(Ke.fnc(e))return e;var i=e.split("(")[0],r=tC[i],n=$M(e);switch(i){case"spring":return eC(e,t);case"cubicBezier":return Em(dZ,n);case"steps":return Em(cZ,n);default:return Em(r,n)}}function iC(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function Rp(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in e){var a=e[s];t.call(r,a,s,e)&&n.push(a)}return n}function Ip(e){return e.reduce(function(t,i){return t.concat(Ke.arr(i)?Ip(i):i)},[])}function Z_(e){return Ke.arr(e)?e:(Ke.str(e)&&(e=iC(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function cy(e,t){return e.some(function(i){return i===t})}function dy(e){var t={};for(var i in e)t[i]=e[i];return t}function _v(e,t){var i=dy(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function Bp(e,t){var i=dy(e);for(var r in t)i[r]=Ke.und(e[r])?t[r]:e[r];return i}function pZ(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function fZ(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(o,l,h,c){return l+l+h+h+c+c}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function mZ(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100,s=t[4]||1;function a(d,p,m){return m<0&&(m+=1),m>1&&(m-=1),m<1/6?d+(p-d)*6*m:m<1/2?p:m<2/3?d+(p-d)*(2/3-m)*6:d}var o,l,h;if(r==0)o=l=h=n;else{var c=n<.5?n*(1+r):n+r-n*r,u=2*n-c;o=a(u,c,i+1/3),l=a(u,c,i),h=a(u,c,i-1/3)}return"rgba("+o*255+","+l*255+","+h*255+","+s+")"}function gZ(e){if(Ke.rgb(e))return pZ(e);if(Ke.hex(e))return fZ(e);if(Ke.hsl(e))return mZ(e)}function gs(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function vZ(e){if(Xh(e,"translate")||e==="perspective")return"px";if(Xh(e,"rotate")||Xh(e,"skew"))return"deg"}function Sv(e,t){return Ke.fnc(e)?e(t.target,t.id,t.total):e}function In(e,t){return e.getAttribute(t)}function py(e,t,i){var r=gs(t);if(cy([i,"deg","rad","turn"],r))return t;var n=$d.CSS[t+i];if(!Ke.und(n))return n;var s=100,a=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var h=l*parseFloat(t);return $d.CSS[t+i]=h,h}function rC(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?py(e,n,i):n}}function fy(e,t){if(Ke.dom(e)&&!Ke.inp(e)&&(In(e,t)||Ke.svg(e)&&e[t]))return"attribute";if(Ke.dom(e)&&cy(uZ,t))return"transform";if(Ke.dom(e)&&t!=="transform"&&rC(e,t))return"css";if(e[t]!=null)return"object"}function nC(e){if(Ke.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(t);)r.set(n[1],n[2]);return r}}function yZ(e,t,i,r){var n=Xh(t,"scale")?1:0+vZ(t),s=nC(e).get(t)||n;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),r?py(e,s,r):s}function my(e,t,i,r){switch(fy(e,t)){case"transform":return yZ(e,t,r,i);case"css":return rC(e,t,i);case"attribute":return In(e,t);default:return e[t]||0}}function gy(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=gs(e)||0,n=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function sC(e,t){if(Ke.col(e))return gZ(e);if(/\s/g.test(e))return e;var i=gs(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function vy(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function xZ(e){return Math.PI*2*In(e,"r")}function bZ(e){return In(e,"width")*2+In(e,"height")*2}function wZ(e){return vy({x:In(e,"x1"),y:In(e,"y1")},{x:In(e,"x2"),y:In(e,"y2")})}function aC(e){for(var t=e.points,i=0,r,n=0;n<t.numberOfItems;n++){var s=t.getItem(n);n>0&&(i+=vy(r,s)),r=s}return i}function _Z(e){var t=e.points;return aC(e)+vy(t.getItem(t.numberOfItems-1),t.getItem(0))}function oC(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return xZ(e);case"rect":return bZ(e);case"line":return wZ(e);case"polyline":return aC(e);case"polygon":return _Z(e)}}function SZ(e){var t=oC(e);return e.setAttribute("stroke-dasharray",t),t}function AZ(e){for(var t=e.parentNode;Ke.svg(t)&&Ke.svg(t.parentNode);)t=t.parentNode;return t}function lC(e,t){var i=t||{},r=i.el||AZ(e),n=r.getBoundingClientRect(),s=In(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function EZ(e,t){var i=Ke.str(e)?iC(e)[0]:e,r=t||100;return function(n){return{property:n,el:i,svg:lC(i),totalLength:oC(i)*(r/100)}}}function TZ(e,t){function i(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var r=lC(e.el,e.svg),n=i(),s=i(-1),a=i(1);switch(e.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function J_(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=sC(Ke.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:Ke.str(e)||t?r.split(i):[]}}function hC(e){var t=e?Ip(Ke.arr(e)?e.map(Z_):Z_(e)):[];return Rp(t,function(i,r,n){return n.indexOf(i)===r})}function uC(e){var t=hC(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:nC(i)}}})}function MZ(e,t){var i=dy(t);if(/^spring/.test(i.easing)&&(i.duration=eC(i.easing)),Ke.arr(e)){var r=e.length,n=r===2&&!Ke.obj(e[0]);n?e={value:e}:Ke.fnc(t.duration)||(i.duration=t.duration/r)}var s=Ke.arr(e)?e:[e];return s.map(function(a,o){var l=Ke.obj(a)&&!Ke.pth(a)?a:{value:a};return Ke.und(l.delay)&&(l.delay=o?0:t.delay),Ke.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(a){return Bp(a,i)})}function CZ(e){for(var t=Rp(Ip(e.map(function(s){return Object.keys(s)})),function(s){return Ke.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=t[s];i[a]=e.map(function(o){var l={};for(var h in o)Ke.key(h)?h==a&&(l.value=o[h]):l[h]=o[h];return l})},n=0;n<t.length;n++)r(n);return i}function DZ(e,t){var i=[],r=t.keyframes;r&&(t=Bp(CZ(r),t));for(var n in t)Ke.key(n)&&i.push({name:n,tweens:MZ(t[n],e)});return i}function PZ(e,t){var i={};for(var r in e){var n=Sv(e[r],t);Ke.arr(n)&&(n=n.map(function(s){return Sv(s,t)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function LZ(e,t){var i;return e.tweens.map(function(r){var n=PZ(r,t),s=n.value,a=Ke.arr(s)?s[1]:s,o=gs(a),l=my(t.target,e.name,o,t),h=i?i.to.original:l,c=Ke.arr(s)?s[0]:h,u=gs(c)||gs(l),d=o||u;return Ke.und(a)&&(a=h),n.from=J_(c,d),n.to=J_(gy(a,c),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=uy(n.easing,n.duration),n.isPath=Ke.pth(s),n.isColor=Ke.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var cC={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,n){if(r.list.set(t,i),t===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),e.style.transform=s}}};function dC(e,t){var i=uC(e);i.forEach(function(r){for(var n in t){var s=Sv(t[n],r),a=r.target,o=gs(s),l=my(a,n,o,r),h=o||gs(l),c=gy(sC(s,h),l),u=fy(a,n);cC[u](a,n,c,r.transforms,!0)}})}function OZ(e,t){var i=fy(e.target,t.name);if(i){var r=LZ(t,e),n=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function RZ(e,t){return Rp(Ip(e.map(function(i){return t.map(function(r){return OZ(i,r)})})),function(i){return!Ke.und(i)})}function pC(e,t){var i=e.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,e.map(function(s){return r(s)+s.duration})):t.duration,n.delay=i?Math.min.apply(Math,e.map(function(s){return r(s)+s.delay})):t.delay,n.endDelay=i?n.duration-Math.max.apply(Math,e.map(function(s){return r(s)+s.duration-s.endDelay})):t.endDelay,n}var $_=0;function IZ(e){var t=_v(JM,e),i=_v(hy,e),r=DZ(i,e),n=uC(e.targets),s=RZ(n,r),a=pC(s,i),o=$_;return $_++,Bp(t,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay})}var Ji=[],eS=[],fd,BZ=function(){function e(){fd=requestAnimationFrame(t)}function t(i){var r=Ji.length;if(r){for(var n=0;n<r;){var s=Ji[n];if(!s.paused)s.tick(i);else{var a=Ji.indexOf(s);a>-1&&(Ji.splice(a,1),r=Ji.length)}n++}e()}else fd=cancelAnimationFrame(fd)}return e}();function NZ(){document.hidden?(Ji.forEach(function(e){return e.pause()}),eS=Ji.slice(0),ai.running=Ji=[]):eS.forEach(function(e){return e.play()})}typeof document<"u"&&document.addEventListener("visibilitychange",NZ);function ai(e){e===void 0&&(e={});var t=0,i=0,r=0,n,s=0,a=null;function o(y){var x=window.Promise&&new Promise(function(b){return a=b});return y.finished=x,x}var l=IZ(e);o(l);function h(){var y=l.direction;y!=="alternate"&&(l.direction=y!=="normal"?"normal":"reverse"),l.reversed=!l.reversed,n.forEach(function(x){return x.reversed=l.reversed})}function c(y){return l.reversed?l.duration-y:y}function u(){t=0,i=c(l.currentTime)*(1/ai.speed)}function d(y,x){x&&x.seek(y-x.timelineOffset)}function p(y){if(l.reversePlayback)for(var x=s;x--;)d(y,n[x]);else for(var b=0;b<s;b++)d(y,n[b])}function m(y){var x=0,b=l.animations,S=b.length;for(l.reversePlayback===!0&&l.rewind===!1&&(y=l.duration+l.delay-l.endDelay-y);x<S;){var _=b[x],A=_.animatable,w=_.tweens,E=w.length-1,T=w[E];E&&(T=Rp(w,function(V){return y<V.end})[0]||T);for(var C=Rn(y-T.start-T.delay,0,T.duration)/T.duration,P=isNaN(C)?1:T.easing(C),k=T.to.strings,D=T.round,R=[],G=T.to.numbers.length,N=void 0,L=0;L<G;L++){var H=void 0;if(l.reversePlayback===!0&&l.rewind===!1)var z=T.to.numbers[L],F=T.from.numbers[L]||0;else var F=T.to.numbers[L],z=T.from.numbers[L]||0;T.isPath?H=TZ(T.value,P*F):H=z+P*(F-z),D&&(T.isColor&&L>2||(H=Math.round(H*D)/D)),R.push(H)}var U=k.length;if(!U)N=R[0];else{N=k[0];for(var W=0;W<U;W++){k[W];var Y=k[W+1],K=R[W];isNaN(K)||(Y?N+=K+Y:N+=K+" ")}}cC[_.type](A.target,_.property,N,A.transforms),_.currentValue=N,x++}}function g(y){l[y]&&!l.passThrough&&l[y](l)}function f(){l.remaining&&l.remaining!==!0&&l.remaining--}function v(y){var x=l.duration,b=l.delay,S=x-l.endDelay,_=c(y);l.progress=Rn(_/x*100,0,100),l.reversePlayback=_<l.currentTime,n&&p(_),!l.began&&l.currentTime>=0&&(l.began=!0,g("begin")),!l.loopBegan&&l.currentTime>0&&(l.loopBegan=!0,g("loopBegin")),_<=b&&l.currentTime!==0&&(m(0),g("change")),(_>=S&&l.currentTime!==x||!x)&&(m(x),g("change")),_>b&&_<S?(l.changeBegan||(l.changeBegan=!0,l.changeCompleted=!1,g("changeBegin")),g("change"),m(_)):l.changeBegan?(l.changeCompleted=!0,l.changeBegan=!1,g("change"),g("changeComplete")):l.began&&_>S&&(g("change"),g("changeComplete")),l.currentTime=Rn(_,0,x),l.began&&g("update"),y>=x&&(i=0,f(),l.remaining?(t=r,g("loopComplete"),l.loopBegan=!1,l.direction==="alternate"&&h()):(l.paused=!0,l.completed||(l.completed=!0,g("loopComplete"),g("complete"),!l.passThrough&&"Promise"in window&&(a(),o(l)))))}return l.reset=function(){var y=l.direction;l.passThrough=!1,l.currentTime=0,l.progress=0,l.paused=!0,l.began=!1,l.loopBegan=!1,l.changeBegan=!1,l.completed=!1,l.changeCompleted=!1,l.reversePlayback=!1,l.reversed=y==="reverse",l.remaining=l.loop,n=l.children,s=n.length;for(var x=s;x--;)l.children[x].reset();(l.reversed&&l.loop!==!0||y==="alternate"&&l.loop===1)&&l.remaining++,m(l.reversed?l.duration:0)},l.set=function(y,x){return dC(y,x),l},l.tick=function(y){r=y,t||(t=r),v((r+(i-t))*ai.speed)},l.seek=function(y){v(c(y))},l.pause=function(){l.paused=!0,u()},l.play=function(){!l.paused||(l.completed&&l.reset(),l.paused=!1,Ji.push(l),u(),fd||BZ())},l.reverse=function(){h(),l.completed=!l.reversed,u()},l.restart=function(){l.reset(),l.play()},l.reset(),l.autoplay&&l.play(),l}function tS(e,t){for(var i=t.length;i--;)cy(e,t[i].animatable.target)&&t.splice(i,1)}function kZ(e){for(var t=hC(e),i=Ji.length;i--;){var r=Ji[i],n=r.animations,s=r.children;tS(t,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;tS(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function UZ(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?uy(t.easing):null,n=t.grid,s=t.axis,a=t.from||0,o=a==="first",l=a==="center",h=a==="last",c=Ke.arr(e),u=parseFloat(c?e[0]:e),d=c?parseFloat(e[1]):0,p=gs(c?e[1]:e)||0,m=t.start||0+(c?u:0),g=[],f=0;return function(v,y,x){if(o&&(a=0),l&&(a=(x-1)/2),h&&(a=x-1),!g.length){for(var b=0;b<x;b++){if(!n)g.push(Math.abs(a-b));else{var S=l?(n[0]-1)/2:a%n[0],_=l?(n[1]-1)/2:Math.floor(a/n[0]),A=b%n[0],w=Math.floor(b/n[0]),E=S-A,T=_-w,C=Math.sqrt(E*E+T*T);s==="x"&&(C=-E),s==="y"&&(C=-T),g.push(C)}f=Math.max.apply(Math,g)}r&&(g=g.map(function(k){return r(k/f)*f})),i==="reverse"&&(g=g.map(function(k){return s?k<0?k*-1:-k:Math.abs(f-k)}))}var P=c?(d-u)/f:u;return m+P*(Math.round(g[y]*100)/100)+p}}function FZ(e){e===void 0&&(e={});var t=ai(e);return t.duration=0,t.add=function(i,r){var n=Ji.indexOf(t),s=t.children;n>-1&&Ji.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=Bp(i,_v(hy,e));l.targets=l.targets||e.targets;var h=t.duration;l.autoplay=!1,l.direction=t.direction,l.timelineOffset=Ke.und(r)?h:gy(r,h),a(t),l.rewind=t.rewind,t.seek(l.timelineOffset);var c=ai(l);a(c),s.push(c);var u=pC(s,e);return t.delay=u.delay,t.endDelay=u.endDelay,t.duration=u.duration,t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}ai.version="3.2.0";ai.speed=1;ai.running=Ji;ai.remove=kZ;ai.get=my;ai.set=dC;ai.convertPx=py;ai.path=EZ;ai.setDashoffset=SZ;ai.stagger=UZ;ai.timeline=FZ;ai.easing=uy;ai.penner=tC;ai.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var iS=ai,rS=new M,nS=new M,sS=new Lt;function zZ(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n>=1)return i.copy(e);let s=1-n*n;if(s<=Number.EPSILON){let c=1-r;return i.w=c*e.w+r*t.w,i.x=c*e.x+r*t.x,i.y=c*e.y+r*t.y,i.z=c*e.z+r*t.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,h=Math.sin(r*o)/a;return i.w=e.w*l+t.w*h,i.x=e.x*l+t.x*h,i.y=e.y*l+t.y*h,i.z=e.z*l+t.z*h,i}function fC(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let a=n!=null?n:t[e],o=s;if(a!==o)return{update:l=>{t[e]=lt.lerp(a,o,l)},start:()=>{t[e]=a},end:()=>{t[e]=o}}}function aS(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let a=t[e],o=n?new M().fromArray(n):a.clone(),l=new M().fromArray(s);if(!o.equals(l))return{update:h=>{a.lerpVectors(o,l,h)},start:()=>{a.copy(o)},end:()=>{a.copy(l)}}}function GZ(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let a=t[e],o=n?new Fe().fromArray(n):a.clone(),l=new M,h=new Lt,c=new M;o.decompose(l,h,c);let u=new Fe().fromArray(s),d=new M,p=new Lt,m=new M;if(u.decompose(d,p,m),!o.equals(u))return{update:g=>{sS.slerpQuaternions(h,p,g),rS.lerpVectors(l,d,g),nS.lerpVectors(c,m,g),a.compose(rS,sS,nS)},start:()=>{a.compose(l,h,c)},end:()=>{a.compose(d,p,m)}}}function HZ(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?typeof s=="string"?n.getColor(s).clone():new Ze().setRGB(s.r,s.g,s.b):o.clone(),h=typeof a=="string"?n.getColor(a).clone():new Ze().setRGB(a.r,a.g,a.b);if(l.equals(h))return;let c=o.clone();return t[e]=c,{update:u=>{c.lerpColors(l,h,u)},start:()=>{c.copy(l)},end:()=>{c.copy(h)}}}function VZ(e,t,i){var a,o,l,h;let r=[],n=e.cameraType==="OrthographicCamera"?(a=t.orthographic)==null?void 0:a.zoom:(o=t.perspective)==null?void 0:o.zoom,s=e.cameraType==="OrthographicCamera"?(l=i.orthographic)==null?void 0:l.zoom:(h=i.perspective)==null?void 0:h.zoom;if(s!==void 0){let c=n!=null?n:e.zoom,u=s;c!==u&&r.push({update:d=>{e.zoom=lt.lerp(c,u,d),e.updateProjectionMatrix()},start:()=>{e.zoom=c,e.updateProjectionMatrix()},end:()=>{e.zoom=u,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let c=fC("targetOffset",e,t,i);c&&r.push(c)}return r}function jZ(e,t,i){let r=[];if(!("geometry"in i))return r;let n="geometry"in t?t.geometry:{},s=i.geometry,{width:a,height:o,depth:l}=n,{width:h,height:c,depth:u}=s;if(h!==void 0||c!==void 0||u!==void 0){let{width:d,height:p,depth:m}=e.geometry.userData.parameters,g=a!=null?a:d,f=o!=null?o:p,v=l!=null?l:m,y=h!=null?h:d,x=c!=null?c:p,b=u!=null?u:m;(g!==y||f!==x||v!==b)&&!Xi(e)&&r.push({update:S=>{e.updateGeometry({parameters:{width:lt.lerp(g,y,S),height:lt.lerp(f,x,S),depth:lt.lerp(v,b,S)}}),e.invalidateDownstreamBooleanData()},start:()=>{e.updateGeometry({parameters:{width:g,height:f,depth:v}}),e.invalidateDownstreamBooleanData()},end:()=>{e.updateGeometry({parameters:{width:y,height:x,depth:b}}),e.invalidateDownstreamBooleanData()}})}return r}function WZ(e,t,i,r){let n=[];if(i.intensity!==void 0){let s=fC("intensity",e,t,i);s&&n.push(s)}if(i.color!==void 0){let s=HZ("color",e,t,i,r);s&&n.push(s)}return n}function qZ(e,t,i,r){var l,h;let n=[];if(!("material"in i||"materials"in i))return n;let s;if("materials"in t?s=(l=t.materials)==null?void 0:l[0]:"material"in t?s=t.material:s={},!s||typeof s=="string")return n;let a;if("materials"in i?a=(h=i.materials)==null?void 0:h[0]:"material"in i&&(a=i.material),!a||typeof a=="string")return n;let o=Array.isArray(e.material)?e.material[0]:e.material;return YZ(o,s,a,r)}function YZ(e,t,i,r){var s,a,o;let n=[];for(let l of e.layers){let h=(s=t.layers)==null?void 0:s.data(l.uuid),c=i.layers.data(l.uuid);if(!c||!((a=l.visible)==null||a)||!((o=c.visible)==null||o))continue;let u=l.getNames().filter(d=>!w2.some(p=>d.includes(p)));for(let d of u)try{let p=l.getValue(d),m;if(d==="colors")m=eJ(l,h,c,d);else if(Array.isArray(p))d==="steps"&&(m=$Z(l,h,c,d));else if(typeof p=="number")m=XZ(l,h,c,d);else{if(typeof p=="boolean")continue;p instanceof q?m=QZ(l,h,c,d):p instanceof M?m=KZ(l,h,c,d):p instanceof cr?m=JZ(l,h,c,d,r):p instanceof Ze?m=ZZ(l,h,c,d,r):"isTexture"in p&&(m=tJ(l,h,c,d))}m&&(Array.isArray(m)?n.push(...m):n.push(m))}catch(p){console.error(`lerpMaterial: unexpected material layer for ${d}`,p)}}return n}function XZ(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=t?t[r]:e.getValue(r),s=i[r];if(n!==s)return{update:a=>{e.setValue(r,lt.lerp(n,s,a))},start:()=>{e.setValue(r,n)},end:()=>{e.setValue(r,s)}}}function QZ(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new q().fromArray(t[r]):n.clone(),a=new q().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function KZ(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new M().fromArray(t[r]):n.clone(),a=new M().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function ZZ(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Ze().setRGB(s.r,s.g,s.b):o.clone(),h=typeof a=="string"?n.getColor(a).clone():new Ze().setRGB(a.r,a.g,a.b);if(l.equals(h))return;let c=o.clone();return e.setValue(r,c),{update:u=>{c.lerpColors(l,h,u)},start:()=>{c.copy(l)},end:()=>{c.copy(h)}}}function JZ(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Ze().setRGB(s.r,s.g,s.b):o.clone(),h=typeof a=="string"?n.getColor(a).clone():new cr(a.r,a.g,a.b,a.a);if(l.equals(h))return;let c=o.clone();return e.setValue(r,c),{update:u=>{c.lerpColors(l,h,u)},start:()=>{c.copy(l)},end:()=>{c.copy(h)}}}function $Z(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s,o=i[r];for(let l=0;l<s.length;++l){let h=a[l],c=o[l];h!==c&&n.push({update:u=>{s[l]=lt.lerp(h,c,u)},start:()=>{s[l]=h},end:()=>{s[l]=c}})}return n.length?n:void 0}function eJ(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let h=[...a[l]],c=[...o[l]];Od.isEqual(h,c)||n.push({update:u=>{s[l].fromArray(Od.lerp(h,c,u))},start:()=>{s[l].fromArray(h)},end:()=>{s[l].fromArray(c)}})}return n.length?n:void 0}function tJ(e,t,i,r="texture"){if(!e.hasValue(r)||!(r in i))return;let n=e.getNode("mat");if(!n)return;let s=t?t[r]:n,a=i[r],o=[...s.repeat],l=[...s.offset],h=[...a.repeat],c=[...a.offset];if(!tl.isEqual(o,h)||!tl.isEqual(l,c))return{update:u=>{n.repeat=tl.lerp(o,h,u),n.offset=tl.lerp(l,c,u),n.updateMatrix()},start:()=>{n.repeat=[...o],n.offset=[...l],n.updateMatrix()},end:()=>{n.repeat=[...h],n.offset=[...c],n.updateMatrix()}}}var Tm=new M,oS=new zi;function iJ(e,t,i,r){let n=[],s=aS("position",e,t,i);s&&n.push(s);let a=aS("scale",e,t,i);a&&n.push(a);let o=rJ(e,t,i,r);o&&n.push(o);let l=GZ("hiddenMatrix",e,t,i);if(l&&n.push(l),s||a||o||l){let h=()=>{var c;e.updateMatrix(),(c=e.parent)!=null&&c.matrixWorld0&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorld0,e.matrix),e.matrixWorldNeedsUpdate=!1),xi(e)&&Xi(e.parent)&&e.invalidateDownstreamBooleanData(!0)};n.push({update:h,start:h,end:h})}return n}function rJ(e,t,i,r){let n=t!=null&&t.rotation?t.rotation:void 0,s=i.rotation;if(!s)return;let a=n?new M().fromArray(n):new M().setFromEuler(e.rotation),o=new M().fromArray(s);if(a.equals(o))return;let l=Tm.subVectors(o,a);if(r&&l.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=new Lt().setFromEuler(oS.setFromVector3(a)),c=new Lt().setFromEuler(oS.setFromVector3(o));return{update:u=>{zZ(h,c,e.quaternion,u)},start:()=>{e.rotation.setFromVector3(a)},end:()=>{e.rotation.setFromVector3(o)}}}else return{update:h=>{Tm.lerpVectors(a,o,h),e.rotation.setFromVector3(Tm)},start:()=>{e.rotation.setFromVector3(a)},end:()=>{e.rotation.setFromVector3(o)}}}function Mm(e,t,i,r,n){let s=[];return(e.visible||Xi(e.parent))&&s.push(...iJ(e,t,i,n)),xi(e)?((e.visible||Xi(e.parent))&&s.push(...jZ(e,t,i)),e.visible&&s.push(...qZ(e,t,i,r))):d9(e)?e.visible&&s.push(...WZ(e,t,i,r)):c9(e)&&s.push(...VZ(e,t,i)),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}function nJ(e,t,i){let r=[];e.objects.traverse((n,s)=>{var o;let a=t.find(n);if(!!a&&(a.states={},!!s.states)){r.some(l=>e.objects.isDescendantOf(n,l))||((o=s.physics)==null?void 0:o.fusedBody)===!0&&s.physics.rigidBody==="dynamic"&&r.push(n),a.data=s,a.currentState=null;for(let l of s.states){if(e.environment.usePhysics===!0&&s.physics&&(s.physics.rigidBody==="dynamic"||r.some(h=>e.objects.isDescendantOf(n,h)))&&(l.data.position!==void 0||l.data.rotation!==void 0||l.data.hiddenMatrix!==void 0))return;a.states[l.id]=Id.patch(s,l.data)}mC(a,s,null,i,!0)}})}function lS(e,t,i){typeof t!="string"&&e.reset(t,i)}function mC(e,t,i,r,n=!1){let s=i===null?t:Id.patch(t,t.states.data(i));if(rT(e,s),e instanceof Qi&&s.type==="Mesh"){if(e instanceof ty?e.buildFromStore(s.geometry):e.updateGeometry({parameters:s.geometry},r),e.freeBooleanPointer(),Xi(e.parent)&&e.parent.invalidateDownstreamBooleanData().recomputeBoolean(),"material"in s){if(e.material instanceof Array)return;lS(e.material,s.material,r)}else if("materials"in s){if(!(e.material instanceof Array))return;var a=0;for(let o of s.materials)lS(e.material[a],o,r),a++}}else if(s.type==="DirectionalLight")e.fromDirectionalLightState(s,r);else if(s.type==="PointLight")e.fromPointLightState(s,r);else if(s.type==="SpotLight")e.fromSpotLightState(s,r);else if(e instanceof da&&Pl.is(s.type)){let o=s;e.setZoom("PerspectiveCamera",o.perspective.zoom),e.setZoom("OrthographicCamera",o.orthographic.zoom),e.isUpVectorFlipped=o.isUpVectorFlipped,e.targetOffset=o.targetOffset,e.fov=o.perspective.fov}}function sJ(e){let t={duration:e.duration,easing:"linear"};switch(e.easing){case 0:t.easing="cubicBezier( 0, 0, 1, 1 )";break;case 1:t.easing="cubicBezier( .25, .1, .25, 1 )";break;case 2:t.easing="cubicBezier( .42, 0, 1, 1 )";break;case 3:t.easing="cubicBezier( 0, 0, .58, 1 )";break;case 4:t.easing="cubicBezier( .42, 0, .58, 1 )";break;case 5:let{control1:i,control2:r}=e;t.easing=`cubicBezier(
				${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
			)`;break;case 6:let{mass:n,stiffness:s,damping:a,velocity:o}=e;t.easing=`spring( ${n}, ${s}, ${a}, ${o} )`}return t}function aJ(e){let t={startOnceDelay:0,delay:0,repeatDelay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=e.direction==="pingpong-rewind";else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(e.delayDirection){case"start-once":break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t}var oJ=class{constructor(e,t,i,r,n,s,a){this.object=e,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.id=a,this.targets={t:0},this.firstLoop=!0,this.firstReverse=!0,this.reversed=!1,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.dispatchEvent({type:"requestRender"})),this.targets.t===0?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{let h,c;this.reversed?(h=this.to,c=this.from):(h=this.from,c=this.to),this.object.currentState=c.id,this.object.dispatchEvent({type:"beginState",state:this.targets.t>.5?h.id:c.id})},this.onChangeComplete=()=>{let h,c;this.reversed?(h=this.to,c=this.from):(h=this.from,c=this.to),this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.currentState=c.id,this.object.dispatchEvent({type:"completeState",state:this.targets.t<.5?h.id:c.id})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=Mm(this.object,this.reversed?this.to.data:this.from.data,this.reversed?this.from.data:this.to.data,this.sharedAssets,this.allowSlerp))};let o=this.getState(t);if(!o)throw new Error("Missing property");this.from=o;let l=this.getState(i);if(!l)throw new Error("Missing property");this.to=l,this.useCurrentState=t===void 0||i===void 0,this.callback=Mm(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp),this.core={targets:this.targets,t:1,autoplay:!1,...aJ(r),...sJ(r),change:this.onChange},this.startOnceDelay=r.delayDirection==="start-once"?r.delay:0}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}getState(e){let t,i;if(typeof e=="string"?(t=e,i=this.object.states[t]):e===null?(t=null,i=this.object.data):e===void 0&&(t=this.object.currentState,i=t?this.object.states[t]:this.object.data),!(t===void 0||i===void 0))return{id:t,data:i}}toggle(e){this._changeBegan=!1,this._changeCompleted=!0,this.reversed=!e,this.targets.t=0,this.firstReverse?(this.firstReverse=!1,this.reversed=!1):this.callback=Mm(this.object,{},e?this.to.data:this.from.data,this.sharedAssets,this.allowSlerp)}},Cm=class{constructor(e,t,i,r){var n;if(this.object=t,this.id=r,this.tweens=[],this._finished=!1,e.tweens.length<1)throw new Error("Missing property");try{let s=new oJ(t,e.tweens[0].data.state,e.tweens[1].data.state,e.tweens[1].data,i,(n=e.allowSlerp)!=null?n:!1,"0");this.tween=s,this.core=iS({...s.core}),this.core.finished.then(()=>this._finished=!0),this.startOnceDelay=s.startOnceDelay}catch{throw new Error("Missing property")}}get finished(){return this._finished}get paused(){return this.core.paused}play(){this._finished||(clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>this.core.play(),this.startOnceDelay))}pause(){this.core.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}stop(){this.pause(),this.seek(0),this.core.reset(),this._finished=!1}seek(e){let t=e*this.core.duration;this.core.seek(t)}toggle(e){this.core.pause(),clearTimeout(this.timeoutId),this.tween.toggle(e),this.core=iS({...this.tween.core}),this.core.finished.then(()=>this._finished=!0),this.tween.changeCompleted?this.timeoutId=window.setTimeout(()=>this.core.play(),this.startOnceDelay):this.core.play()}dispose(){this.pause()}},ll=class extends Bi{constructor(e,t,i,r){if(super(),this.id=e,this.data=t,this.sharedAssets=r,!t.object)throw new Error("Missing property");let n=i.find(t.object);if(!n)throw new Error("Missing property");this.object=n;try{this.timeline=new Cm(this.data,this.object,this.sharedAssets,"0")}catch{throw new Error("Missing property")}}play(){var e;this.object.currentTransitionAction!==this&&((e=this.object.currentTransitionAction)==null||e.dispose(),this.object.currentTransitionAction=this,this.timeline=new Cm(this.data,this.object,this.sharedAssets,"0"),this.dispatchEvent({type:"reset"})),this.timeline.play()}stop(){this.timeline.stop()}seek(e){this.timeline.seek(e)}toggle(e){var t;this.object.currentTransitionAction!==this&&((t=this.object.currentTransitionAction)==null||t.dispose(),this.object.currentTransitionAction=this,this.timeline=new Cm(this.data,this.object,this.sharedAssets,"0"),this.dispatchEvent({type:"reset"})),this.timeline.toggle(e)}dispose(){this.timeline.dispose()}};function so(e,t,i,r,n){let s={Audio:[],Link:[],Transition:[]};return t.forEach(({id:a,data:o})=>{try{o.type==="Audio"?Gf[e.type].includes("Audio")&&s.Audio.push(new ol(a,o,i,n)):o.type==="Link"?Gf[e.type].includes("Link")&&s.Link.push(new hZ(o)):o.type==="Transition"&&Gf[e.type].includes("Transition")&&s.Transition.push(new ll(a,o,r,n))}catch{}}),s}function ao(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof ol||i instanceof ll)&&i.dispose()})})}var lJ=class{constructor(e,t,i,r){if(this.data=e,this.object=t,this.isToggleEnable=!1,this.onReset=()=>{this.isToggleEnable=!0},this.useToggle=e.toggle,(e.type==="KeyDown"||e.type==="KeyUp")&&!e.key)throw new Error("Missing property");this.actions=so(e,e.actions,t,i,r),this.actions.Transition.forEach(n=>{n.addEventListener("reset",this.onReset)})}disconnect(){ao(this.actions)}dispatch(){this.useToggle?(this.isToggleEnable=!this.isToggleEnable,this.actions.Transition.forEach(e=>{e.toggle(this.isToggleEnable)})):this.actions.Transition.forEach(e=>{e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.dispatchBasic()})}},hJ=class extends fo{constructor(e){super(e),this.objectsPerTypes={MouseDown:[],MouseUp:[],KeyDown:[],KeyUp:[]},this.eventsPerObjects={MouseDown:{},MouseUp:{},KeyDown:{},KeyUp:{}},this.heldKeys={},this.onMouseDown=r=>{dt.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{dt.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onKeyDown=r=>{this.heldKeys[r.key]||this.handleKeyEvent(r,"KeyDown"),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp")},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]};let{scene:t,sharedAssets:i}=this.eventContext;t.traverseEntity(r=>{var s,a;if(!((s=r.data)!=null&&s.events.length))return;let n=r.visible?["MouseDown","MouseUp","KeyDown","KeyUp"]:["KeyDown","KeyUp"];for(let o of n){let l=this.eventsPerObjects[o];r.data.events.filter(({data:h})=>h.type===o).forEach(({data:h})=>{try{let c=new lJ(h,r,t,i);l[r.uuid]?l[r.uuid].push(c):l[r.uuid]=[c]}catch{}}),(a=l[r.uuid])!=null&&a.length&&this.objectsPerTypes[o].push(r)}})}connect(){var t,i,r,n;let{domElement:e}=this.eventContext;this.heldKeys={},this.domEventsNeeded.clear(),(t=this.objectsPerTypes.MouseDown)!=null&&t.length&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown)),(i=this.objectsPerTypes.MouseUp)!=null&&i.length&&(this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),(r=this.objectsPerTypes.KeyDown)!=null&&r.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(n=this.objectsPerTypes.KeyUp)!=null&&n.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp))}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})})}handleMouseEvent(e){let{stopRaycast:t,raycaster:i,scene:r}=this.eventContext,n=this.objectsPerTypes[e];if(n.length)if(t){let s=qM(i,r,n);YM(s).forEach(a=>{this.eventsPerObjects[e][a.uuid]&&(a.dispatchEvent({type:"beginEvent",eventName:e}),this.eventsPerObjects[e][a.uuid].forEach(o=>{o.dispatch()}))})}else n.forEach(s=>{ly(i,s)&&(s.dispatchEvent({type:"beginEvent",eventName:e}),this.eventsPerObjects[e][s.uuid].forEach(a=>{a.dispatch()}))})}handleKeyEvent(e,t){this.objectsPerTypes[t].forEach(i=>{i.dispatchEvent({type:"beginEvent",eventName:t}),this.eventsPerObjects[t][i.uuid].forEach(r=>{"key"in r.data&&r.data.key===e.key&&r.dispatch()})})}},uJ=new M,cJ=new M,yy=class{constructor(e,t,i,r){this.actionsIn=so(e,e.inActions,t,i,r),this.actionsOut=so(e,e.outActions,t,i,r)}disconnect(){ao(this.actionsIn),ao(this.actionsOut)}},dJ=class extends yy{constructor(e,t,i,r){super(e,t,i,r),this.data=e,this.object=t,this.stage="out",this.operands=[],this.onUpdateMatrix=()=>{let o=[];for(let h of this.operands)if(Array.isArray(h)){let[c,u,d]=h,p=u==="rotation"?lt.RAD2DEG*c[u][d]:c[u][d];o.push(Math.trunc(p))}else o.push(Math.trunc(h));let l=(0,eval)(`${o[0]} ${this.operator} ${o[1]}`)?"in":"out";if(this.stage!==l){this.stage=l;let h=this.stage==="in"?this.actionsIn:this.actionsOut;h.Audio.forEach(c=>c.dispatchConditional()),h.Transition.forEach(c=>c.play())}};let{operator:n,lOperand:s,rOperand:a}=e.condition;this.operator=n;for(let o of[s,a])if(o.type==="Property"){let[l,h,c]=o.value;if(!l)throw new Error("Missing property");let u=i.find(l);if(!u)throw new Error("Missing property");this.operands.push([u,h,c])}else this.operands.push(o.value)}connect(){this.operands.forEach(e=>{if(Array.isArray(e)){let[t]=e;t.addEventListener("updateMatrix",this.onUpdateMatrix)}}),this.onUpdateMatrix()}disconnect(){super.disconnect(),this.operands.forEach(e=>{if(Array.isArray(e)){let[t]=e;t.removeEventListener("updateMatrix",this.onUpdateMatrix)}})}},pJ=class extends yy{constructor(e,t,i,r){super(e,t,i,r),this.data=e,this.object=t,this.stage="out",this.objects=[],this.onUpdateMatrix=()=>{let o=this.objects[0].getWorldPosition(uJ),l=this.objects[1].getWorldPosition(cJ),h=o.distanceTo(l)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let c=this.stage==="in"?this.actionsIn:this.actionsOut;c.Audio.forEach(u=>u.dispatchConditional()),c.Transition.forEach(u=>u.play())}};let{distance:n,fromObject:s,toObject:a}=e.condition;this.distance=n;for(let o of[s,a]){if(!o)throw new Error("Missing property");let l=i.find(o);if(!l)throw new Error("Missing property");this.objects.push(l)}}connect(){this.objects.forEach(e=>{e.addEventListener("updateMatrix",this.onUpdateMatrix)}),this.onUpdateMatrix()}disconnect(){super.disconnect(),this.objects.forEach(e=>{e.removeEventListener("updateMatrix",this.onUpdateMatrix)})}},fJ=class extends yy{constructor(e,t,i,r){super(e,t,i,r),this.data=e,this.object=t,this.onBegin=({target:a,state:o})=>{this.toState!==o&&(this.actionsOut.Audio.forEach(l=>l.dispatchConditional()),this.actionsOut.Transition.forEach(l=>l.play()))},this.onComplete=({target:a,state:o})=>{this.toState===o&&(this.actionsIn.Audio.forEach(l=>l.dispatchConditional()),this.actionsIn.Transition.forEach(l=>l.play()))};let{condition:n}=e;if(!n.object)throw new Error("Missing property");let s=i.find(n.object);if(!s)throw new Error("Missing property");if(this.toObject=s,n.state&&!this.toObject.states[n.state])throw new Error("Missing property");this.toState=n.state}connect(){(this.actionsOut.Audio.length||this.actionsOut.Transition.length)&&this.toObject.addEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Transition.length)&&this.toObject.addEventListener("completeState",this.onComplete)}disconnect(){super.disconnect(),(this.actionsOut.Audio.length||this.actionsOut.Transition.length)&&this.toObject.removeEventListener("beginState",this.onBegin),(this.actionsIn.Audio.length||this.actionsIn.Transition.length)&&this.toObject.removeEventListener("completeState",this.onComplete)}},mJ=class extends fo{constructor(e){super(e),this.eventsPerConditions={Comparison:[],Distance:[],State:[]};let{scene:t,sharedAssets:i}=this.eventContext;t.traverseEntity(r=>{var n;if((n=r.data)!=null&&n.events.length){for(let{data:s}of r.data.events)if(s.type==="Conditional")try{let a;s.condition.type==="Comparison"?a=new dJ(s,r,t,i):s.condition.type==="Distance"?a=new pJ(s,r,t,i):s.condition.type==="State"&&(a=new fJ(s,r,t,i)),a&&this.eventsPerConditions[s.condition.type].push(a)}catch{}}})}connect(){super.connect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},Dm=new M,hS=new Cr,uS=new Fe,Pm=new M,gJ=class{constructor(e,t){this.data=e,this.object=t}dispatch(e,t){hS.setFromNormalAndCoplanarPoint(e,this.object.getWorldPosition(Dm)),t.ray.intersectPlane(hS,Dm),this.object.position.copy(Dm),this.object.parent!==null&&this.object.position.applyMatrix4(uS.copy(this.object.parent.matrixWorld).invert()),this.object.position.applyMatrix4(uS.copy(this.object.hiddenMatrix).invert()),this.object.updateMatrix(),xi(this.object)&&Xi(this.object.parent)&&this.object.invalidateDownstreamBooleanData(!0),this.object.dispatchEvent({type:"requestRender"})}},vJ=class extends fo{constructor(e){super(e),this.events=[],this.onMouseMove=i=>{if(dt.length>1)return;let{camera:r,raycaster:n}=this.eventContext;this.eventContext.updateRaycaster(i),r.getWorldDirection(Pm),Pm.negate(),this.events.forEach(s=>s.dispatch(Pm,n))};let{scene:t}=this.eventContext;t.traverseEntity(i=>{var n;let r=(n=i.data)==null?void 0:n.events.find(s=>s.data.type==="Follow");r&&this.events.push(new gJ(r.data,i))})}connect(){if(!this.events.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),hr&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove)}disconnect(){if(!this.events.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),hr&&e.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove)}},cS=new M,dS=new Cr,Lm=new M,yJ=class{constructor(e,t){this.data=e,this.object=t}dispatch(e,t){dS.set(e,-this.data.distance),t.ray.intersectPlane(dS,cS),this.object.lookAt(cS),this.object.updateMatrix(),xi(this.object)&&Xi(this.object.parent)&&this.object.invalidateDownstreamBooleanData(!0),this.object.dispatchEvent({type:"requestRender"}),this.object.dispatchEvent({type:"changeRotation"})}},xJ=class extends fo{constructor(e){super(e),this.events=[],this.onMouseMove=i=>{if(dt.length>1)return;let{camera:r,raycaster:n}=this.eventContext;this.eventContext.updateRaycaster(i),r.getWorldDirection(Lm),Lm.negate(),this.events.forEach(s=>s.dispatch(Lm,n))};let{scene:t}=this.eventContext;t.traverseEntity(i=>{var n;let r=(n=i.data)==null?void 0:n.events.find(s=>s.data.type==="LookAt");r&&this.events.push(new yJ(r.data,i))})}connect(){if(!this.events.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),hr&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove)}disconnect(){if(!this.events.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),hr&&e.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove)}},bJ=class{constructor(e,t,i,r){this.data=e,this.object=t,this.entered=!1,this.actions=so(e,e.actions,t,i,r)}disconnect(){ao(this.actions)}dispatchEnter(){this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.toggle(!0)))}dispatchLeave(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.toggle(!1)))}},wJ=class extends fo{constructor(e){super(e),this.eventsPerObjects={},this.objects=[],this._prevObjects=[],this.onMouseDown=r=>{dt.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseHoverEvent())},this.onMouseUp=r=>{dt.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=r=>{dt.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseHoverEvent())};let{scene:t,sharedAssets:i}=this.eventContext;t.traverseEntity(r=>{var n,s;if(!(!r.visible||!((n=r.data)!=null&&n.events.length))){for(let{data:a}of r.data.events)if(a.type==="MouseHover")try{let o=new bJ(a,r,t,i);this.eventsPerObjects[r.uuid]?this.eventsPerObjects[r.uuid].push(o):this.eventsPerObjects[r.uuid]=[o]}catch{}(s=this.eventsPerObjects[r.uuid])!=null&&s.length&&this.objects.push(r)}})}connect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),hr&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove)}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),hr&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,scene:n}=this.eventContext;if(i){let s=qM(r,n,this.objects);t=YM(s)}else this.objects.forEach(s=>{ly(r,s)&&t.push(s)})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"mouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"mouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},_J=class{constructor(e,t,i,r){this.data=e,this.object=t,this.scrollCounter=0,this.actions=so(e,e.actions,t,i,r)}connect(){this.scrollCounter=0}disconnect(){ao(this.actions)}dispatch(e){let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i))}},SJ=class extends fo{constructor(e){super(e),this.events=[],this.onWheel=r=>{this.events.forEach(n=>n.dispatch(r.deltaY))};let{scene:t,sharedAssets:i}=this.eventContext;t.traverseEntity(r=>{var n;if((n=r.data)!=null&&n.events.length)for(let{data:s}of r.data.events)s.type==="Scroll"&&this.events.push(new _J(s,r,t,i))})}connect(){let{domElement:e}=this.eventContext;this.events.forEach(t=>t.connect()),this.domEventsNeeded.clear(),this.events.length&&(this.domEventsNeeded.add("wheel"),e.addEventListener("wheel",this.onWheel))}disconnect(){let{domElement:e}=this.eventContext;e.removeEventListener("wheel",this.onWheel),this.domEventsNeeded.clear()}},AJ=class{constructor(e,t,i,r){this.data=e,this.object=t,this.actions=so(e,e.actions,t,i,r)}disconnect(){ao(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{var i;((i=t.interaction.data.triggerAfter)!=null?i:"any")===e&&(t.interaction instanceof Bh?t.interaction.audioPlayer.play():t.interaction instanceof ZM&&t.interaction.dispatch())})}},EJ=class extends fo{constructor(e){super(e),this.events=[],this.eventsAfter=[],this.onMouseDown=()=>{this.eventsAfter.forEach(r=>r.dispatchAfter("mouseDown"))},this.onKeyDown=()=>{this.eventsAfter.forEach(r=>r.dispatchAfter("keyDown"))},this.onAny=()=>{let{domElement:r,isExport:n}=this.eventContext;(n?document:r).removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),this.eventsAfter.forEach(s=>s.dispatchAfter("any"))};let{scene:t,sharedAssets:i}=this.eventContext;t.traverseEntity(r=>{var n;if((n=r.data)!=null&&n.events.length)for(let{data:s}of r.data.events){if(s.type!=="Start")continue;let a=new AJ(s,r,t,i);a.actions.Transition.length&&this.events.push(a),a.actions.Audio.length&&this.eventsAfter.push(a)}})}connect(){if(this.eventsAfter.length){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.addEventListener("pointerdown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),i.addEventListener("pointerdown",this.onAny),document.addEventListener("keydown",this.onAny)}this.events.forEach(e=>e.dispatch())}disconnect(){if(this.eventsAfter.length){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),this.eventsAfter.forEach(r=>r.disconnect())}this.events.forEach(e=>e.disconnect())}},TJ=class{constructor(e,t,i,r){this.data=e,this.object=t,this.isToggleEnable=!1,this.actions=so(e,e.actions,t,i,r),this.target=e.target,this.useToggle=e.toggle}disconnect(){ao(this.actions)}dispatch(){this.useToggle?(this.isToggleEnable=!this.isToggleEnable,this.actions.Transition.forEach(e=>{e.toggle(this.isToggleEnable)})):this.actions.Transition.forEach(e=>{e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.dispatchBasic()})}},Yt;vj.then(e=>Yt=e);var _h=new Fe,MJ=new M(1,1,1),Ci=new M,_r=new Lt,Yr=new M,Om=new zi(0,0,0,"YXZ"),gC={type:"beginEvent",eventName:"Collision"},CJ=class{constructor(e,t,i,r,n,s=!1){var v,y,x,b;this.scene=t,this.sharedAssets=n,this.isExport=s,this.gameControls=[],this.gameControlStates=[],this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],eventsPerObjects:{},colliderToEntity:{}},this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.processRigidBody=S=>{!S.isSleeping()&&S.bodyType()===Yt.RigidBodyType.Dynamic&&this.nActiveRigidBodies++;let _=S.translation(),A=S.rotation(),w=this.rigidBodyToMesh.get(S.handle);if(w&&(Ci.set(_.x,_.y,_.z),Ci.multiplyScalar(this.pixelsPerMeter),_r.set(A.x,A.y,A.z,A.w),w[0].matrixWorld.compose(Ci,_r,w[1]),w[2]))for(let E of w[0].children)E.updateMatrixWorld(!0)},this.handleCollisionEvents=(S,_,A)=>{if(A!==!1)if(this.gameControls.some(w=>w.object===this.sharedGameControlGlobals.colliderToEntity[S])){let w=this.sharedGameControlGlobals.colliderToEntity[_],E=this.sharedGameControlGlobals.eventsPerObjects[w.uuid];if(E===void 0)return;for(let T of E)T.data.target==="character"&&this.dispatchCollisionEvent(T,w)}else if(this.gameControls.some(w=>w.object===this.sharedGameControlGlobals.colliderToEntity[_])){let w=this.sharedGameControlGlobals.colliderToEntity[S],E=this.sharedGameControlGlobals.eventsPerObjects[w.uuid];if(E===void 0)return;for(let T of E)T.data.target==="character"&&this.dispatchCollisionEvent(T,w)}else{let w=this.sharedGameControlGlobals.colliderToEntity[S],E=this.sharedGameControlGlobals.eventsPerObjects[w.uuid];if(E===void 0)return;for(let P of E)P.data.target==="scene"&&this.dispatchCollisionEvent(P,w);let T=this.sharedGameControlGlobals.colliderToEntity[_],C=this.sharedGameControlGlobals.eventsPerObjects[T==null?void 0:T.uuid];if(C===void 0)return;for(let P of C)P.data.target==="scene"&&this.dispatchCollisionEvent(P,T)}},this.domElement=i.domElement;let a;e.scene.publish.playCamera===null?a=Lp.PERSONAL_CAMERA_ID:a=e.scene.publish.playCamera;let o=this.scene.find(a),l=!1,h=!1,c,u=5,d=8,p=9,m="drag";if(this.usePhysics=(v=e.scene.environment.usePhysics)!=null?v:Fn.defaultData.usePhysics,this.pixelsPerMeter=(y=e.scene.environment.pixelsPerMeter)!=null?y:Fn.defaultData.pixelsPerMeter,this.sceneGraph=e.scene.objects,(x=e.scene.objects.data(e.scene.publish.gameControlObject))==null||x.events.forEach(S=>{S.data.type==="GameControl"&&(c=S.data.keyAssignments,u=S.data.joystickPosLoc,d=S.data.joystickRotLoc,p=S.data.jumpTouchButtonLoc,m=S.data.rotByTouch)}),this.sceneGraph.traverse((S,_)=>{_.events.forEach(A=>{var T,C,P;if(A.data.type!=="GameControl")return;let w=this.scene.find(S),E=w;for(;((T=E=E.parent)==null?void 0:T.parent)!==null;)if((P=(C=this.sceneGraph.data(E.uuid))==null?void 0:C.physics)!=null&&P.fusedBody)return;A.data.collisionEnabled&&(this.needsCollisionDetection=!0),this.gameControlStates.push([w,_,A.data])})}),this.usePhysics&&(this.gameControlStates.length===0||this.needsCollisionDetection)&&this.initPhysics((b=e.scene.environment.gravity)!=null?b:Fn.defaultData.gravity),this.gameControlStates.forEach(([S,_,A])=>{Pl.is(_.type)&&(h=!0),l=l||A.camera===o.uuid;let w=new vC(S,e.scene.objects,i.domElement,{...A,keyAssignments:c},e.scene.environment,this.sharedGameControlGlobals,A.camera===o.uuid,o,this.scene,n);w.addEventListener("change",r),w.addEventListener("end",r),w.addEventListener("start",r),this.gameControls.push(w),hr&&A.touchControl&&(this.joystickToGameControls[u]!==void 0?this.joystickToGameControls[u].push([w,"pos"]):this.joystickToGameControls[u]=[[w,"pos"]],A.moveMode==="walk"&&(this.joystickToGameControls[p]!==void 0?this.joystickToGameControls[p].push([w,"jmp"]):this.joystickToGameControls[p]=[[w,"jmp"]]),m==="joystick"&&(this.joystickToGameControls[d]!==void 0?this.joystickToGameControls[d].push([w,"rot"]):this.joystickToGameControls[d]=[[w,"rot"]]))}),l===!1){let{enableRotate:S,enablePan:_,enableZoom:A,autoRotate:w,hoverRotatePanMode:E}=e.scene.publish.orbitControls;h===!1&&(S||_||A||w||E!==0)&&!Object.keys(o.states).length&&(this.orbitControls=new yC(o,i.domElement,this.isExport),this.orbitControls.addEventListener("change",r),this.orbitControls.addEventListener("end",r),this.orbitControls.addEventListener("start",r),this.orbitControls.fromJSON(e.scene.publish.orbitControls),this.orbitControls.useKeyEvents=!1)}let g=i.domElement.width/i.getPixelRatio(),f=i.domElement.height/i.getPixelRatio();this.joystickToGameControls.forEach((S,_)=>{var N;let A=document.body.appendChild(document.createElement("div")),[w,E,T]=((N=e.scene.publish.joystickSizeAndXYOffset)!=null?N:Ll.defaultData.joystickSizeAndXYOffset)[_],C=(g-5*w)/4+w,P={},k=S.some(L=>L[1]==="jmp"),D=k?0:w;_<10?(_<5?P.top=D/2:P.bottom=D/2,P.left=D/2+_%5*C):_===10?(P.left=D/2,P.top=f/2):(P.right=D/2,P.top=f/2),P.top?P.top-=E[1]:P.bottom+=E[1],P.left?P.left+=E[0]:P.right-=E[0];for(let L in P)P[L]+="px";if(k){let L=A.appendChild(document.createElement("div"));Object.assign(L.style,P,{position:"absolute",width:w+"px",height:w+"px",backgroundColor:`rgba(255,255,255,${T==="show"?.4:0})`,zIndex:"9999",borderRadius:w+"px",border:"solid 2px rgba(0, 0, 0, .1)",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let H=w/16*16*.4;L.innerHTML=`
					<svg width="${H}" height="${w*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
					</svg>
				`,L.addEventListener("pointerdown",()=>{S.forEach(F=>{F[0].movementState.jump=1}),r()}),L.addEventListener("touchend",F=>F.preventDefault()),this.joysticks[_]=[void 0,A];return}let R={zone:A,mode:"static",position:P,size:w};T==="hide"&&(R.restOpacity=0);let G=hK.create(R);G.on("move",(L,H)=>{S.forEach(F=>{let z=F[0];F[1]==="pos"?H.force<.2?z.moveForce=0:(z.movementState.movePosZ=Math.sin(-H.angle.radian),z.movementState.movePosX=Math.cos(-H.angle.radian),H.force<.3?z.moveForce=(H.force-.2)/.1:z.moveForce=1):H.force<.2?z.rotForce=0:(z.movementState.rotPosX=H.vector.y,z.movementState.rotPosY=-H.vector.x,H.force<.3?z.rotForce=(H.force-.2)/.1:z.rotForce=1)}),r()}),G.on("end",(L,H)=>{S.forEach(F=>{let z=F[0];F[1]==="pos"?(z.movementState.movePosZ=0,z.movementState.movePosX=0,z.moveForce=1):(z.movementState.rotPosX=0,z.movementState.rotPosY=0,z.rotForce=1)})}),this.joysticks[_]=[G,A]}),this.usePhysics===!1&&this.needsCollisionDetection&&this.initBVH(),this.initializationCounter++}initBVH(){let e=[];this.scene.updateMatrixWorld(!0);let t=new Set;if(this.scene.traverse(i=>{var r;if(fs(i))if(!i.visible||t.has(i))i.children.forEach(n=>fs(n)&&t.add(n));else if(Object.keys(i.states).length||((r=i.data)==null?void 0:r.events.some(n=>n.data.type==="GameControl"))){let n=[];i.matrixWorld.decompose(Ci,_r,Yr);let s=new Fe().compose(Ci,_r,MJ);xi(i)&&n.push(Da(i.geometry,_h.makeScale(Yr.x,Yr.y,Yr.z))),i.updateMatrixWorld();let a=s.clone().invert();if(i.traverse(o=>{!xi(o)||(o.updateMatrixWorld(),_h.multiplyMatrices(a,o.matrixWorld),n.push(Da(o.geometry,_h)))}),n.length>0){let o=il(n,!1);i.boundsTree=new Ti(o),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(i)}}else xi(i)&&!this.sharedGameControlGlobals.entitiesWithTransformAnim.some(n=>i.isDescendantOf(n))&&e.push(Da(i.geometry,i.matrixWorld))}),e.length>0){let i=il(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new Ti(i)}}addCollider(e,t,i,r,n=!0){var l;let s=e.rigidBody,a;r!==void 0?r.collider.type==="sphere"?a=Yt.ColliderDesc.ball(r.collider.radius/this.pixelsPerMeter):r.collider.type==="capsule"?a=Yt.ColliderDesc.capsule((r.collider.height/2-r.collider.radius)/this.pixelsPerMeter,r.collider.radius/this.pixelsPerMeter):a=Yt.ColliderDesc.cuboid(r.collider.width/this.pixelsPerMeter/2,r.collider.height/this.pixelsPerMeter/2,r.collider.depth/this.pixelsPerMeter/2):i.colliderType==="trimesh"?a=Yt.ColliderDesc.trimesh(t.getAttribute("position").array,t.getIndex().array):a=Yt.ColliderDesc.convexMesh(t.getAttribute("position").array,n?t.getIndex().array:void 0),a.setFrictionCombineRule(Yt.CoefficientCombineRule.Average).setRestitutionCombineRule(Yt.CoefficientCombineRule.Average).setDensity(i.density).setFriction(i.friction).setRestitution(i.restitution);let o=this.sharedGameControlGlobals.rapierWorld.createCollider(a,s);if(this.sharedGameControlGlobals.colliderToEntity[o.handle]=e,r!==void 0){Ci.fromArray(r.collider.position).multiply(Yr.setFromMatrixScale(e.matrixWorld)).divideScalar(this.pixelsPerMeter),o.setTranslationWrtParent(Ci);let h=new Lt().setFromEuler(new zi().setFromVector3(new M().fromArray(r.collider.rotation)));o.setRotationWrtParent(h),o.setActiveEvents(Yt.ActiveEvents.COLLISION_EVENTS)}else i.rigidBody==="dynamic"&&((l=this.sharedGameControlGlobals.eventsPerObjects[e.uuid])==null?void 0:l.some(h=>h.target==="scene"))&&o.setActiveEvents(Yt.ActiveEvents.COLLISION_EVENTS)}initPhysics(e){this.sharedGameControlGlobals.rapierWorld=new Yt.World(new Yt.Vector3(0,e!=null?e:-10,0)),this.events=new Yt.EventQueue(!0);let t=[],i=[],r=[];if(this.sceneGraph.traverse((l,h)=>{let c=this.scene.find(l);if(c&&fs(c)&&c.visible){let u,d=h.states.some(m=>m.data.position!==void 0||m.data.rotation!==void 0||m.data.hiddenMatrix!==void 0),p=!1;for(let m of h.events)if(m.data.type==="GameControl")u=m.data;else if(m.data.type==="Collision"){p=!0;let g=new TJ(m.data,c,this.scene,this.sharedAssets);this.sharedGameControlGlobals.eventsPerObjects[c.uuid]?this.sharedGameControlGlobals.eventsPerObjects[c.uuid].push(g):this.sharedGameControlGlobals.eventsPerObjects[c.uuid]=[g]}if(i.some(m=>this.sceneGraph.isDescendantOf(l,m)))return;if(!h.physics){i.push(l);return}if(r.some(m=>this.sceneGraph.isDescendantOf(l,m)))return;if(h.physics.fusedBody===!0&&r.push(l),c.matrixWorld0=void 0,h.physics.rigidBody==="dynamic"&&h.physics.fusedBody===!1&&(c.matrixWorld0=c.matrixWorld.clone()),h.physics.rigidBody==="dynamic"||d||p||u!==void 0){let m=[];xi(c)&&m.push(Da(c.geometry));let g=c.matrixWorld.clone().invert();if(h.physics.fusedBody&&c.traverse(f=>{!xi(f)||f===c||(_h.multiplyMatrices(g,f.matrixWorld),m.push(Da(f.geometry,_h)))}),m.length>0){let f=il(m);f.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter),c.matrixWorld.decompose(Ci,_r,Yr),f.scale(Yr.x,Yr.y,Yr.z),Ci.divideScalar(this.pixelsPerMeter);let v;u!==void 0?v=Yt.RigidBodyDesc.kinematicPositionBased():h.physics.rigidBody==="dynamic"?(v=Yt.RigidBodyDesc.dynamic(),v.setLinearDamping(h.physics.damping).setAdditionalMass(0).setGravityScale(h.physics.gravityScale).enabledRotations(...h.physics.enabledRotation).enabledTranslations(...h.physics.enabledTranslation)):d?(v=Yt.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(c)):v=Yt.RigidBodyDesc.fixed(),v.setTranslation(Ci.x,Ci.y,Ci.z).setRotation({w:_r.w,x:_r.x,y:_r.y,z:_r.z});let y=this.sharedGameControlGlobals.rapierWorld.createRigidBody(v);u===void 0&&h.physics.rigidBody==="dynamic"&&this.rigidBodyToMesh.set(y.handle,[c,Yr.clone(),h.physics.fusedBody]),c.rigidBody=y;let x=!(h.geometry===void 0||h.geometry.type==="SubdivGeometry"||h.geometry.type==="NonParametricGeometry"||h.geometry.type==="BooleanGeometry"||h.geometry.type==="VectorGeometry"||h.geometry.type==="StarGeometry"||h.geometry.type==="TorusGeometry"||h.geometry.type==="HelixGeometry");this.addCollider(c,f,h.physics,u,x)}}else this.gameControlStates.some(([m])=>c.isDescendantOf(m))||(xi(c)&&t.push(Da(c.geometry,c.matrixWorld)),h.physics.fusedBody&&c.traverse(m=>{!xi(m)||m===c||t.push(Da(m.geometry,m.matrixWorld))}))}}),t.length===0)return;let n=il(t);n.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let s=Yt.RigidBodyDesc.fixed(),a=this.sharedGameControlGlobals.rapierWorld.createRigidBody(s),o=Yt.ColliderDesc.trimesh(n.getAttribute("position").array,n.getIndex().array).setFrictionCombineRule(Yt.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Yt.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(o,a)}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}dispose(){var e,t;(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.staticMeshBVH=void 0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.gameControls.forEach(i=>{i.reset(),i.dispose()}),this.gameControls=[],this.joysticks.forEach(([i,r])=>{i==null||i.destroy(),r.remove()}),this.joystickToGameControls=[],this.joysticks=[],(t=this.orbitControls)==null||t.dispose(),this.orbitControls=void 0;for(let i of Object.values(this.sharedGameControlGlobals.eventsPerObjects))i.forEach(r=>r.disconnect());this.sharedGameControlGlobals.eventsPerObjects={},this.scene.updateMatrixWorld(!0)}update(e){var i;let t=!0;if(this.orbitControls!==void 0&&(t=!this.orbitControls.update(e)),this.initializationCounter>=0&&this.initializationCounter<2)this.initializationCounter++,t=!1;else if(this.initializationCounter===2)for(let r of this.gameControls)t=!r.update(e)&&t;if(this.usePhysics&&(this.gameControls.length===0||this.needsCollisionDetection)){for(let r of this.sharedGameControlGlobals.entitiesWithTransformAnim){r.matrixWorld.decompose(Ci,_r,Yr),Om.setFromQuaternion(_r);let n=r;n.prevR===void 0?(n.prevR=Om.clone(),n.prevT=Ci.clone()):(n.prevR.copy(Om),n.prevT.copy(Ci)),r.rigidBody.setNextKinematicTranslation(Ci.divideScalar(this.pixelsPerMeter)),r.rigidBody.setNextKinematicRotation(_r)}this.sharedGameControlGlobals.rapierWorld.step(this.events),(i=this.events)==null||i.drainCollisionEvents(this.handleCollisionEvents),t=!this.updatePositions()&&t}return t}dispatchCollisionEvent(e,t){t.dispatchEvent(gC),e.dispatch()}},Rm={type:"change"},DJ={type:"lock"},PJ={type:"unlock"},LJ=new M,Pa=new M,OJ=new M,hi=new M,_i=new M,sr=new M,Sh=new Fe,pS=new Fe,RJ=new Fe,IJ=new Fe,Go=new Lt,Ah=new Lt,BJ=new zi(0,0,0,"YXZ"),La=new M(0,1,0),Im=new M(1,1,1),NJ=1,kJ=.025,UJ=16e-6,FJ=12,zJ=20,Di=new Rr,Sr=new fi,Av=class extends Bi{constructor(e,t,i,r,n,s,a,o,l,h){var d,p,m,g,f,v,y,x,b,S,_,A,w,E,T,C,P,k;if(super(),this.object=e,this.sceneGraph=t,this.domElement=i,this.sharedGameControlGlobals=s,this.cameraFollow=a,this.camera=o,this.scene=l,this.sharedAssets=h,this.enableDamping=!0,this.position0=new M,this.rotation0=new zi(0,0,0,"XYZ"),this.scale0=new M,this.hiddenMatrix0=new Fe,this.target0=new M,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.euler0=new zi(0,0,0,"YXZ"),this.position0Cam=new M,this.quat0Cam=new Lt,this.scale0Cam=new M,this.hiddenMatrix0Cam=new Fe,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.collider={radius:40,segment:new Rr(new M(0,-40,0),new M(0,40,0)),matrix:new Fe,position:new M,rotation:new Lt},this.euler=new zi(0,0,0,"YXZ"),this.eulerDelta=new M,this.lastQuaternion=new Lt,this.lastPosition=new M,this.lastCameraQuaternion=new Lt,this.lastCameraPosition=new M,this.PI_2=Math.PI/2,this.prevMouse=new q,this.velocityTarget=new M,this.velocity=new M,this.directionXZ=new M,this.rotVelocityStick=new M,this.rotVelocityTarget=new M,this.rotVelocity=new M,this.rotDirection=new M,this.objectRot={x:0,y:0},this.firstPointerId=-1,this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0},this.onObject=!1,this.actionState={},this.slopeAdjust=!1,this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new Fe,this.objectToTarget=new M,this.objectToTarget0=new M,this.objectToCamXZ=new M,this.objectToCamXZ0=new M,this.targetToCamera=new M,this.targetToCamera0=new M,this.cameraPolarAxis0=new M,this.targetPos=new M,this.targetQuat=new Lt,this.lerpFactorPos=new M().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Lt,this.objXZQuatInv=new Lt,this.objXZRotMat=new Fe,this.isFirstPerson=!1,this.actions={},this.lastDummyPos=new M,this.lastDummyPosDelta=new M,this.hit=null,this.groundVelocity=new M,this.pushedVelocity=new M,this.groundYRotation=0,this.objectRealQuat=new Lt,this.colliderWorldQuat=new Lt,this.groundNormal=new M,this.lastHitObj=null,this.isFirstFrame=!0,this.onPointerDown=D=>{D.target!==this.domElement||this.firstPointerId!==-1||(this.firstPointerId=D.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!hr&&(!kd||Ud>=15.5)&&this.domElement.requestPointerLock(),this.prevMouse.set(D.clientX,D.clientY))},this.onPointerUp=D=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),D.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=D=>{if(D.pointerId!==this.firstPointerId)return;let R=D.clientX-this.prevMouse.x,G=D.clientY-this.prevMouse.y;this.prevMouse.set(D.clientX,D.clientY),D.pointerType==="mouse"&&this.rotBy!=="keys"&&(kd&&Ud<15.5&&!hr?(this.eulerDelta.y=-R*this.mouseOrbitSensitivity,this.eulerDelta.x=-G*this.mouseOrbitSensitivity):(this.eulerDelta.y=-D.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-D.movementY*this.mouseOrbitSensitivity)),D.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-R*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-G*this.mouseOrbitSensitivity*5),this.dispatchEvent(Rm)},this.onPointerlockChange=D=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(DJ),Av.isLocked=!0):(this.dispatchEvent(PJ),Av.isLocked=!1)},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.onKeyDown=D=>{D.preventDefault();for(let R of this.keyAssignments)if(D.key.toUpperCase()===R[1]||D.key===R[1]){this.movementState[R[0]]=1;break}this.dispatchEvent(Rm)},this.onKeyUp=D=>{for(let R of this.keyAssignments)if(D.key.toUpperCase()===R[1]||D.key===R[1]||D.code.slice(3,D.code.length).toUpperCase()===R[1]){this.movementState[R[0]]=0;break}},this.resetChildrenToBaseState=(D,R)=>{if(D===this.object.uuid)return;let G=this.scene.find(D);G.currentState!==null&&mC(G,R,null,this.sharedAssets)},e.objectType==="CombinedCamera"&&(this.isFirstPerson=!0),this.position0.copy(this.object.position),this.rotation0.copy(this.object.rotation),this.scale0.copy(this.object.scale),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.rotation.reorder("YXZ"),this.euler0.copy(this.object.rotation),this.isFirstPerson===!1){let D=this.object.rotation.y;this.objectRealQuat.copy(this.object.quaternion),this.object.rotation.y=0,this.objXZQuat.copy(this.object.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.object.quaternion),this.object.rotation.set(0,D,0)}if(this.object.matrixAutoUpdate=!1,this.isFirstPerson){let D=this.object;this.target0.copy(D.getTarget()),this.zoom0=D.zoom}else this.cameraFollow===!0&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom);if(this.cameraFollow===!0){if(this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),(p=(d=this.camera)==null?void 0:d.parent)==null?void 0:p.parent){let L=this.camera.matrix.clone().invert().premultiply(this.camera.matrixWorld),H=L.clone().invert();this.camera.hiddenMatrix.multiply(H),this.camera.matrix.premultiply(L),this.camera.matrixWorld.decompose(this.camera.position,this.camera.quaternion,this.camera.scale)}this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let D=new M(0,0,-1).applyQuaternion(this.camera.quaternion),R=new M().subVectors(this.object.position,this.camera.position);this.objectToCamXZ.copy(R),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let G;if(Math.abs(D.y)<1e-6){R.y=0,D.y=0;let L=R.projectOnVector(D);this.targetToCamera0.copy(L).negate(),G=this.camera.position.clone().add(L)}else{let L=D.multiplyScalar(R.y/D.y);this.targetToCamera0.copy(L).negate(),G=L.clone().add(this.camera.position)}this.objectToTarget0.subVectors(G,this.object.position);let N=new zi().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-N.x,N.x=0,N.z=0,N.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(N)}if(this.isObjectCamera=this.object.objectType==="CombinedCamera",this.euler.setFromQuaternion(this.object.quaternion,"YXZ"),this.connect(),this.rotByTouch=(m=r.rotByTouch)!=null?m:"joystick",this.rotBy=(g=r.rotBy)!=null?g:"keys",this.rotationMode=(f=r.rotationMode)!=null?f:"normal",this.moveMode=(v=r.moveMode)!=null?v:"walk",this.collisionEnabled=r.collisionEnabled,this.speedTranslate=((y=r.speedTranslate)!=null?y:250)*NJ,this.speedOrbit=((x=r.speedRotate)!=null?x:100)*kJ,this.mouseOrbitSensitivity=((b=r.speedRotate)!=null?b:100)*UJ,this.keyAssignments=r.keyAssignments.map(D=>{let R=[D[0],D[1]];return R[1]==="\u25B2"?R[1]="ArrowUp":R[1]==="\u25C0"?R[1]="ArrowLeft":R[1]==="\u25BC"?R[1]="ArrowDown":R[1]==="\u25B6"?R[1]="ArrowRight":R[1]==="\u21E7"?R[1]="Shift":R[1]==="\u21B5"?R[1]="Enter":R[1]==="Space"?R[1]=" ":R[1]==="\u2318"?R[1]="Meta":R[1]==="Ctrl"?R[1]="Control":R[1]==="Esc"&&(R[1]="Escape"),R}),r.rotBy==="mouse"){let D;D=this.keyAssignments.findIndex(R=>R[0]==="rotNegX"),D!==-1&&(this.keyAssignments[D][1]=""),D=this.keyAssignments.findIndex(R=>R[0]==="rotPosX"),D!==-1&&(this.keyAssignments[D][1]=""),D=this.keyAssignments.findIndex(R=>R[0]==="rotPosY"),D!==-1&&(this.keyAssignments[D][1]=""),D=this.keyAssignments.findIndex(R=>R[0]==="rotNegY"),D!==-1&&(this.keyAssignments[D][1]="")}this.lerpFactorPosStart=1-.02**(1/(((S=r.delayPos[0])!=null?S:.3)*60)),this.lerpFactorPosEnd=1-.02**(1/(((_=r.delayPos[1])!=null?_:.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/(((A=r.delayRot[0])!=null?A:.3)*60)),this.lerpFactorRotEnd=1-.02**(1/(((w=r.delayRot[1])!=null?w:.3)*60)),this.lerpFactorPosCamera=1-.02**(1/(((E=r.delayPosCamera)!=null?E:.3)*60)),this.lerpFactorRotCamera=1-.02**(1/(((T=r.delayRotCamera)!=null?T:.3)*60)),this.gravity=((C=n.gravity)!=null?C:Fn.defaultData.gravity)*FJ,this.pixelsPerMeter=(P=n.pixelsPerMeter)!=null?P:Fn.defaultData.pixelsPerMeter,this.usePhysics=(k=n.usePhysics)!=null?k:Fn.defaultData.usePhysics,this.jumpPower=r.jumpPower*zJ,this.resetYPosition=r.resetYPosition,this.orientMode=r.autoOrientMove?r.orientMode:"none",r.collider.type==="capsule"?(this.collider.radius=r.collider.radius,this.collider.segment.start.y=r.collider.height/2-r.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y):r.collider.type==="sphere"&&(this.collider.radius=r.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0);let c=new M().fromArray(r.collider.position),u=new Lt().setFromEuler(new zi().fromArray([...r.collider.rotation,"XYZ"]));this.collider.position.copy(c).multiply(this.object.scale),this.collider.rotation.copy(u),this.collider.matrix.compose(c,u,Im),r.cameraXAxis!==void 0&&(this.cameraXAxis=r.cameraXAxis,this.cameraYAxis=r.cameraYAxis,this.minPolarAngle=r.cameraRotXLimits[0],this.maxPolarAngle=r.cameraRotXLimits[1],this.minAzimuthAngleRel=r.cameraRotYLimits[0],this.maxAzimuthAngleRel=r.cameraRotYLimits[1]),r.gameActions!==void 0&&Object.entries(r.gameActions).forEach(([D,R],G)=>{R.forEach(({id:N,data:L})=>{try{this.actions[D]===void 0&&(this.actions[D]=[]),L.type==="Transition"?this.actions[D].push(new ll(N,L,l,h)):L.type==="Audio"&&this.actions[D].push(new ol(N,L,e,h))}catch{}})}),this.dispatchStopEvent("move"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle")}reset(e=!1){if(this.object.rotation.copy(this.rotation0),this.object.position.copy(this.position0),this.object.scale.copy(this.scale0),this.object.hiddenMatrix.copy(this.hiddenMatrix0),e===!0){if(this.object.rotation.reorder("YXZ"),this.isFirstPerson===!1){let t=this.object.rotation.y;this.object.rotation.y=0,this.objXZQuat.copy(this.object.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.object.quaternion),this.object.rotation.set(0,t,0)}this.euler.setFromQuaternion(this.object.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}this.isObjectCamera?this.object.matrixAutoUpdate=!0:this.object.updateMatrix(),this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.dispatchEvent(Rm)}connect(){this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError)}dispose(){this.disconnect(),Object.values(this.actions).forEach(e=>{e.forEach(t=>{(t instanceof ll||t instanceof ol)&&t.dispose()})})}resetTo(e,t,i){}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].forEach(t=>{t instanceof ll?t.play():t instanceof ol&&t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].forEach(t=>{t instanceof ll?t.stop():t instanceof ol&&t.dispatchGameControl("stop")}),this.sceneGraph.traverseFrom(this.object.uuid,this.resetChildrenToBaseState)))}update(e){var n,s,a,o,l,h,c,u;if(this.gravity<0?this.object.position.y<this.resetYPosition:this.object.position.y>this.resetYPosition)return this.reset(!0),!0;let t=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let i=t*60;if(this.usePhysics){let d=_i.set(0,-(this.jumpPower+this.gravity*i)*t*.5,0).divideScalar(this.pixelsPerMeter),p=this.sharedGameControlGlobals.rapierWorld.castShape(hi.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.object.position).divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,d,(n=this.object.rigidBody)==null?void 0:n.collider(0).shape,1,void 0,void 0,void 0,this.object.rigidBody);if(this.slopeAdjust=!1,p){this.slopeAdjust=!1,this.groundNormal.set(p.normal2.x,p.normal2.y,p.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),Math.acos(this.groundNormal.y)*180/Math.PI>45?this.onObject=!0:(this.slopeAdjust=!0,this.onObject=!0);let m=p.collider._parent;this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let g of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(g.rigidBody===m){g.matrixWorld.decompose(hi,Ah,_i),this.groundVelocity.subVectors(hi,g.prevT),this.object.getWorldPosition(_i).add(this.collider.position).sub(g.position),this.groundYRotation=BJ.setFromQuaternion(Ah).y-g.prevR.y,sr.copy(_i).applyAxisAngle(La,this.groundYRotation),this.groundVelocity.add(sr.sub(_i)).divideScalar(t);break}}else this.onObject=!1}this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.velocityTarget.y+=this.onObject?0:this.gravity*i),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.directionXZ.normalize(),this.movementState.moveNegZ||this.movementState.movePosZ?this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce:this.velocityTarget.z=0,this.movementState.moveNegX||this.movementState.movePosX?this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce:this.velocityTarget.x=0,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.hit===null&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**i),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**i),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**i)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("move")));let r=OJ.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1&&this.cameraYAxis!=="Locked"){let d=_i.copy(r);d.y=0,r.set(0,r.y,d.length()*-1)}if(r.applyQuaternion(this.object.quaternion),this.slopeAdjust&&(Ah.setFromUnitVectors(La,this.groundNormal),r.applyQuaternion(Ah)),this.usePhysics===!0){let d=_i;this.pushedVelocity.set(0,0,0);for(let p of this.sharedGameControlGlobals.entitiesWithTransformAnim){(s=p.parent)!=null&&s.matrixWorld0?(Sh.multiplyMatrices((a=p.parent)==null?void 0:a.matrixWorld0,p.matrix),sr.setFromMatrixPosition(Sh)):sr.copy(p.position);let m=sr.sub(p.prevT).divideScalar(t);m.divideScalar(this.pixelsPerMeter);let g=p.rigidBody.collider(0).castCollider(m,this.object.rigidBody.collider(0),hi.copy(r).divideScalar(this.pixelsPerMeter),t);if(m.multiplyScalar(this.pixelsPerMeter),g!==null){this.pushedVelocity.copy(m),d.copy(g.normal1).applyQuaternion(p.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let p=d.dot(r);p<0&&r.addScaledVector(d,-p),r.add(this.pushedVelocity)}else r.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(t),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**i):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**i),this.euler.x+=this.rotVelocity.x*t,this.euler.y+=this.rotVelocity.y*t+this.groundYRotation,this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){let d=hi,p=_i.copy(this.directionXZ);p.x*=-1,this.camera.getWorldDirection(d);let m=sr.copy(La).multiplyScalar(d.dot(La));if(d.sub(m),sr.copy(this.collider.position).applyQuaternion(this.object.quaternion),this.object.rotation.y=d.angleTo(p)*(d.cross(p).y>0?-1:1),Pa.copy(this.collider.position).applyQuaternion(this.object.quaternion),Pa.sub(sr),this.object.position.sub(Pa),this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(La,this.euler.y-this.euler0.y);let g=_i.copy(this.objectToCamXZ).normalize(),f=sr.copy(r).multiplyScalar(t);f.y=0;let v=f.sub(hi.copy(g).multiplyScalar(f.dot(g))).cross(g).y;this.euler.y-=Math.atan2(v,this.objectToCamXZ.length())}}if(this.cameraFollow===!0&&this.moveMode==="walk"&&this.isFirstPerson===!1?this.cameraXAxis==="Limit"?this.euler.x=lt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=lt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):(this.cameraXAxis==="Limit"||this.isFirstPerson||this.cameraFollow===!0)&&(this.euler.x=lt.clamp(this.euler.x,-this.PI_2,this.PI_2)),(this.isFirstPerson||this.moveMode!=="walk")&&(this.object.rotation.x=this.euler.x),(this.isFirstPerson||this.orientMode==="none"||this.cameraYAxis==="Locked")&&(sr.copy(this.collider.position).applyQuaternion(this.object.quaternion),this.object.rotation.y=this.euler.y,Pa.copy(this.collider.position).applyQuaternion(this.object.quaternion),Pa.sub(sr),this.object.position.sub(Pa)),this.object.rotation.x=lt.clamp(this.object.rotation.x,-this.PI_2,this.PI_2),this.objectRot.x=this.euler.x,this.objectRot.y=this.euler.y,this.objectRealQuat.multiplyQuaternions(this.object.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){if(this.hit=this.sharedGameControlGlobals.rapierWorld.castShape(hi.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.object.position).divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,_i.copy(r).divideScalar(this.pixelsPerMeter),(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,t,8,void 0,void 0,this.object.rigidBody),this.hit!==null){let d=this.sharedGameControlGlobals.colliderToEntity[this.hit.collider.handle];if(d!==this.lastHitObj){this.lastHitObj=d;let m=this.sharedGameControlGlobals.eventsPerObjects[d==null?void 0:d.uuid];if(m)for(let g of m)g.data.target==="character"&&(d.dispatchEvent(gC),g.dispatch())}let p=hi.set(this.hit.normal2.x,this.hit.normal2.y,this.hit.normal2.z).applyQuaternion(this.colliderWorldQuat);if(this.hit.toi>0){let m=_i.copy(r).multiplyScalar((l=this.hit)==null?void 0:l.toi).dot(p),g=this.hit.toi;m>2&&(g=this.hit.toi*(m-2)/m,this.object.position.addScaledVector(r,g));let f=_i.copy(r).multiplyScalar(t-g);p.multiplyScalar(f.dot(p));let v=f.sub(p),y=this.sharedGameControlGlobals.rapierWorld.castShape(hi.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.object.position).divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,sr.copy(v).divideScalar(this.pixelsPerMeter),(h=this.object.rigidBody)==null?void 0:h.collider(0).shape,20,8,void 0,void 0,this.object.rigidBody);if(y===null)this.object.position.add(v);else if(y.toi>1){let x=hi.set(y.normal2.x,y.normal2.y,y.normal2.z).applyQuaternion(this.colliderWorldQuat);_i.copy(v).dot(x)>2&&this.object.position.add(v)}this.lastDummyPosDelta.subVectors(this.object.position,this.lastDummyPos),this.lastDummyPos.copy(this.object.position)}}else this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),this.object.position.addScaledVector(r,t);(c=this.object.rigidBody)==null||c.setTranslation(hi.copy(this.object.position).divideScalar(this.pixelsPerMeter),!0),(u=this.object.rigidBody)==null||u.setRotation(Go.copy(this.object.quaternion).multiply(this.objXZQuat),!0)}else{let d=this.onObject?1:5,p=r.multiplyScalar(t/d);for(let m=0;m<d;m++)this.object.position.add(p),this.collisionAdjustment(t/d)}else this.object.position.addScaledVector(r,t);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.isFirstPerson===!1&&this.object.quaternion.multiply(this.objXZQuat),this.isObjectCamera||this.object.updateMatrix(),this.isFirstPerson===!1&&this.object.quaternion.multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let d=this.objectToTarget.add(this.object.position),p=this.targetToCamera.add(d);Sh.lookAt(p,d,La).setPosition(p),Sh.decompose(this.targetPos,this.targetQuat,hi),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**i),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**i),this.camera.updateMatrix(),this.camera.matrixWorldNeedsUpdate=!0,this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=lt.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=lt.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.lastPosition.distanceToSquared(this.object.position)<this.threshEndTranslate&&8*(1-this.lastQuaternion.dot(this.object.quaternion))<this.threshEndRotate&&(!this.camera||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode!=="walk"||this.onObject===!0||this.collisionEnabled===!1)?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=Go.setFromAxisAngle(La,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?lt.clamp(this.objectRot.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.objectRot.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=lt.clamp(this.objectRot.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=lt.clamp(this.objectRot.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=hi.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=Ah.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}collisionAdjustment(e){var n;let t=Pa.set(0,0,0);this.object.updateMatrix();let i=Sh.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(hi,Go,_i).compose(hi,Go,Im);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;Sr.makeEmpty();let a=IJ.copy(s.matrixWorld).decompose(hi,Go,_i).compose(hi,Go,Im),o=pS.copy(a).invert(),l=RJ.copy(pS).multiply(i);Di.copy(this.collider.segment),Di.start.applyMatrix4(l),Di.end.applyMatrix4(l);let h=LJ.copy(this.object.position).applyMatrix4(o);Sr.expandByPoint(Di.start),Sr.expandByPoint(Di.end),Sr.min.addScalar(-this.collider.radius),Sr.max.addScalar(this.collider.radius),s.boundsTree.shapecast({intersectsBounds:c=>c.intersectsBox(Sr),intersectsTriangle:c=>{let u=hi,d=_i,p=c.closestPointToSegment(Di,u,d);if(p<this.collider.radius){let m=this.collider.radius-p,g=d.sub(u).normalize(),f=sr.copy(h);f.addScaledVector(g,m);let v=f.applyMatrix4(a).sub(this.object.position);t.add(v),Di.start.addScaledVector(g,m),Di.end.addScaledVector(g,m)}}})}),Sr.makeEmpty(),Di.copy(this.collider.segment),Di.start.applyMatrix4(i),Di.end.applyMatrix4(i),Sr.expandByPoint(Di.start),Sr.expandByPoint(Di.end),Sr.min.addScalar(-this.collider.radius),Sr.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({intersectsBounds:s=>s.intersectsBox(Sr),intersectsTriangle:s=>{let a=hi,o=_i,l=s.closestPointToSegment(Di,a,o);if(l<this.collider.radius){let h=this.collider.radius-l,c=o.sub(a).normalize();t.addScaledVector(c,h),Di.start.addScaledVector(c,h),Di.end.addScaledVector(c,h)}}}),this.onObject=t.y>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.object.position.add(t)}},vC=Av;vC.isLocked=!1;var Bm={type:"change"},fS={type:"changeZoom"},GJ={type:"changePan"},Ho={type:"start"},Eh={type:"end"},Nm=new Lt,HJ=new q,VJ=2*Math.PI,jJ=1e-8,WJ=.01,mS=2,km=.125,gS=2,Um=1,Fm=1,zm=.1,yC=class extends Bi{constructor(e,t,i=!1){super(),this.object=e,this.domElement=t,this.isExport=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,xr.DOLLY_ROTATE,xr.PAN],this.offset=new M,this.eye=new M,this.lastPosition=new M,this.lastQuaternion=new Lt,this.current=new q,this.overShoot=new q,this.overRatio=new q,this.spherical=new Dx,this.sphericalDelta=new Dx,this.panOffset=new M,this.panLeftV=new M,this.panUpV=new M,this.panV=new M,this.rotateStart=new q,this.rotateEnd=new q,this.rotateDelta=new q,this.panStart=new q,this.panEnd=new q,this.panDelta=new q,this.dollyStart=new q,this.dollyEnd=new q,this.dollyDelta=new q,this.rotationRangeFactor=new q,this.panRangeFactor=new q,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isFirstHover=!0,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.update=()=>{let r=this.object.position;this.offset.copy(r).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(Nm.copy(this.object.quaternion).invert()),this.panOffset.applyQuaternion(Nm),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(this.object.quaternion),this.panOffset.applyQuaternion(this.object.quaternion)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-km),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),r.copy(this.target).add(this.offset);let n=this.spherical.phi%VJ;return this.eye.copy(this.offset).normalize(),this.object.up.copy(Ut.DefaultUp).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),n>0&&n>Math.PI||n<0&&n>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0?(this.sphericalDelta.theta*=1-km,this.sphericalDelta.phi*=1-km):this.sphericalDelta.set(0,0,0),this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>WJ||8*(1-this.lastQuaternion.dot(this.object.quaternion))>jJ?(this.dispatchEvent(Bm),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(this.isPointerDown=!0,dt.length===1&&(this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)),r.pointerType==="touch"||r.pointerType==="pen"&&hr?this.onPointerDownTouch(r):this.onPointerDownMouse(r))},this.onPointerMove=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&hr?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r))},this.onPointerUp=r=>{this.isPointerDown=!1,dt.length===0&&(this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp)),this.dispatchEvent(Eh),this.state=-1},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!Dc(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(Dc(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(Dc(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}this.state!==-1&&this.dispatchEvent(Ho)},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}},this.onPointerDownTouch=r=>{switch(this.touches[dt.length-1]){case xr.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case xr.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case xr.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case xr.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}this.state!==-1&&this.dispatchEvent(Ho)},this.onPointerMoveTouch=r=>{switch(this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}},this.dispatchEndDebounced=$E(()=>this.dispatchEvent(Eh),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||(this.isExport===!1&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(Ho),this.handleMouseWheel(r),this.dispatchEndDebounced())},this.onGesture=r=>{if(this.enabled!==!1)if(r.preventDefault(),r.type==="gesturechange"){if(this.enableZoom===!1)return;this.dispatchEvent(Ho),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update()}else this.dispatchEvent(Eh)},this.onContextMenu=r=>{this.enabled!==!1&&r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key)},this.onKeyUp=()=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&this.onPointerUp(dt[0]))},this.onPointerHover=r=>{if(!(r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot)){if(window.clearTimeout(this.timerHover),this.isPointerDown=!0,this.isFirstHover){let n={clientX:window.innerWidth/2,clientY:window.innerHeight/2};this.hoverRotatePanMode===2?this.handleMouseDownPan(n):this.hoverRotatePanMode===1&&this.handleMouseDownRotate(n),this.isFirstHover=!1}this.hoverRotatePanMode===2?this.handleMouseMovePan(r,zm):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,zm),this.timerHover=window.setTimeout(()=>{this.isPointerDown=!1},30)}},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.connect(),this.update()}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.isUpVectorFlipped=this.isUpVectorFlipped0,this.object.updateProjectionMatrix(),this.dispatchEvent(Bm),this.isFirstHover=!0,this.update(),this.state=-1}resetTo(e,t,i,r=!1){this.target.copy(e),this.object.position.copy(t),this.object.zoom=i,this.object.isUpVectorFlipped=r,this.object.updateProjectionMatrix(),this.dispatchEvent(Bm),this.update(),this.state=-1}fromJSON(e){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.isFirstHover=!0,this.hoverRotatePanMode!==0&&this.domElement.addEventListener("pointermove",this.onPointerHover),zm=(e.hoverRotatePanStrength/100)**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,mS=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let t=this.object.getTarget().applyQuaternion(Nm.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+t.y,this.maxV=e.panVerticalOffset.max+t.y,this.minH=-e.panHorizontalOffset.min+t.x,this.maxH=e.panHorizontalOffset.max+t.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=Fs(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=Fs(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=Fs(this.spherical.theta-e.rotationHorizontalOffset.min),this.maxTheta=Fs(this.spherical.theta+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=xr.ROTATE),e.panTouches===1&&(this.touches[0]=xr.PAN),e.orbitTouches===2&&(this.touches[1]=xr.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=xr.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=xr.ROTATE),e.panTouches===3&&(this.touches[2]=xr.PAN)}connect(){this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),qg||(this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture)),this.domElement.addEventListener("touchend",this.onTouchEnd)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),qg||(this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture)),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,n,s,a,o){this.overShoot.set(0,0);let l,h,c;e instanceof M?(l=e.x,h=e.y,this.current.set(this.target.x,this.target.y),c=!0):(l=e.theta,h=e.phi,this.current.set(Fs(this.spherical.theta),Fs(this.spherical.phi)),c=!1),i===0&&(this.current.x+=l,this.current.y+=h),(t===3||t===2)&&(!c&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x),r===n&&(l=0)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y),s===a&&(h=0)),c||(this.overShoot.x=Fs(this.overShoot.x),this.overShoot.y=Fs(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=vS(Math.abs(this.overRatio.x)),this.overRatio.y=vS(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9||this.overRatio.y>.9)?this.isPointerDown=!1:(l*this.overShoot.x<0&&(l*=1-this.overRatio.x),h*this.overShoot.y<0&&(h*=1-this.overRatio.y)):i===2&&(!c&&(this.overRatio.x>.002||this.overRatio.y>.002)||c&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(l=this.overShoot.x*.05,h=this.overShoot.y*.05,c?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):c?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,h+=this.overShoot.y),e instanceof M?(e.x=l,e.y=h):(e.theta=l,e.phi=h)}setEnableDampingSpeed(e){this.enableDamping=e,Um=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*mS}getZoomScale(){return Math.pow(.95,gS)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*n/i.clientHeight,this.object.matrix),this.panUp(2*t*n/i.clientHeight,this.object.matrix)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix));this.dispatchEvent(GJ)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(fS)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(fS)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(Ho),this.dollyOut(e),this.dispatchEvent(Eh)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(Ho),this.dollyIn(e),this.dispatchEvent(Eh)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){kd&&Ud<15.5&&!hr?(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)):this.rotateDelta.set(e.movementX,e.movementY),this.rotateDelta.multiplyScalar(Um*t).rotateAround(HJ,-this.object.angleOffsetFromUp);let i=this.domElement;this.rotateLeft(2*Math.PI*this.rotateDelta.x/i.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/i.clientHeight),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){kd&&Ud<15.5&&!hr?(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)):this.panDelta.set(e.movementX,e.movementY),this.panDelta.multiplyScalar(Fm*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(Xj===!1&&Dc(e)===!1&&qJ(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(Fm),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(dt.length===2){let e=.5*(dt[0].pageX+dt[1].pageX),t=.5*(dt[0].pageY+dt[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(dt[0].pageX,dt[0].pageY)}handleTouchStartPan(){if(dt.length===2){let e=.5*(dt[0].pageX+dt[1].pageX),t=.5*(dt[0].pageY+dt[1].pageY);this.panStart.set(e,t)}else this.panStart.set(dt[0].pageX,dt[0].pageY)}handleTouchStartDolly(){let e=dt[0].pageX-dt[1].pageX,t=dt[0].pageY-dt[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(dt.length===2){let i=Hf(e),r=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this.rotateEnd.set(r,n)}else{if(e.pointerId!==dt[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(Um);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(dt.length===2){let t=Hf(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==dt[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(Fm),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=Hf(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,gS)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}};function Fs(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function vS(e){return 1-Math.pow(1-e,4)}function qJ(e){return e.wheelDeltaY===0||e.deltaY===0?Mp&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY:e.deltaMode===0}var Gm=new WeakMap,YJ=class extends l0{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let n=new fg(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,s=>{let a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(s,a).then(t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){for(let o in t.attributeTypes){let l=t.attributeTypes[o];l.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[o]=l.name)}let i=JSON.stringify(t);if(Gm.has(e)){let o=Gm.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,h)=>{r._callbacks[n]={resolve:l,reject:h},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),Gm.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new it;e.index&&t.setIndex(new at(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],n=r.name,s=r.array,a=r.itemSize;t.setAttribute(n,new at(s,a))}return t}_loadLibrary(e,t){let i=new fg(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(e,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let n=XJ.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}};function XJ(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(c){e.onModuleLoaded=function(u){c({draco:u})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,h=o.taskConfig;t.then(c=>{let u=c.draco,d=new u.Decoder,p=new u.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let m=i(u,d,p,h),g=m.attributes.map(f=>f.array.buffer);m.index&&g.push(m.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:m},g)}catch(m){console.error(m),self.postMessage({type:"error",id:o.id,error:m.message})}finally{u.destroy(p),u.destroy(d)}});break}};function i(a,o,l,h){let c=h.attributeIDs,u=h.attributeTypes,d,p,m=o.GetEncodedGeometryType(l);if(m===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeBufferToMesh(l,d);else if(m===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let g={index:null,attributes:[]};for(let f in c){let v=self[u[f]],y,x;if(h.useUniqueIDs)x=c[f],y=o.GetAttributeByUniqueId(d,x);else{if(x=o.GetAttributeId(d,a[c[f]]),x===-1)continue;y=o.GetAttribute(d,x)}g.attributes.push(n(a,o,d,f,v,y))}return m===a.TRIANGULAR_MESH&&(g.index=r(a,o,d)),a.destroy(d),g}function r(a,o,l){let h=l.num_faces()*3,c=h*4,u=a._malloc(c);o.GetTrianglesUInt32Array(l,c,u);let d=new Uint32Array(a.HEAPF32.buffer,u,h).slice();return a._free(u),{array:d,itemSize:1}}function n(a,o,l,h,c,u){let d=u.num_components(),p=l.num_points()*d,m=p*c.BYTES_PER_ELEMENT,g=s(a,c),f=a._malloc(m);o.GetAttributeDataArrayForAllPoints(l,u,g,m,f);let v=new c(a.HEAPF32.buffer,f,p).slice();return a._free(f),{name:h,array:v,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var $s;function QJ(){return $s||($s=new YJ,$s.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),$s.decoderPending}async function KJ(e){if($s){let t={attributeIDs:$s.defaultAttributeIDs,attributeTypes:$s.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await $s.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function ZJ(e,t){let[i,r]=l2(Lg.deserialize(new Uint8Array(e)));v8(i);let n=[];i.scene.objects.traverse((s,a)=>{a.type==="Mesh"&&a.geometry.type==="NonParametricGeometry"&&a.geometry.data.draco!==void 0&&n.push(a)}),n.length&&await QJ();for(let s of n){let a=await KJ(Ir(s.geometry.data.draco));if(a){a.index&&(s.geometry.data.index={array:a.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let o={};a.attributes.forEach(({name:l,array:h,itemSize:c})=>{o[l]={array:h,itemSize:c,type:"Float32Array",normalized:!1}}),s.geometry.data.attributes=o,s.geometry.data.draco=void 0}}return t&&t(i),r.result().data}var yS=Object.keys(QM).filter(e=>isNaN(Number(e))),JJ=class{constructor(e,t,i,r,n,s,a,o){this.preventScroll=n,this.requestRender=a,this.isEnable=!1,this.onResetRaycaster=()=>{this.eventContext.raycasterNeedsUpdate=!0},this.onTouchMovePreventScroll=l=>{(l.touches.length>1||this.preventScroll)&&l.preventDefault()},this.onMouseWheelPreventScroll=l=>{this.preventScroll&&l.preventDefault()},this.eventContext=new nZ(e,t,i,s,r,o!=null?o:!1),this.handlers=[new mJ(this.eventContext),new EJ(this.eventContext),new hJ(this.eventContext),new wJ(this.eventContext),new SJ(this.eventContext),new vJ(this.eventContext),new xJ(this.eventContext)]}activate(){let{scene:e,domElement:t}=this.eventContext;this.isEnable=!0,e.traverseEntity(i=>{i.addEventListener("requestRender",this.requestRender)}),this.handlers.forEach(i=>i.connect()),this.resize(),yS.forEach(i=>{this.handlers.some(r=>r.domEventsNeeded.has(i))&&t.addEventListener(i,this.onResetRaycaster)}),t.addEventListener("wheel",this.onMouseWheelPreventScroll),t.addEventListener("touchmove",this.onTouchMovePreventScroll)}deactivate(){let{scene:e,domElement:t}=this.eventContext;this.isEnable=!1,this.handlers.forEach(i=>i.disconnect()),e.traverseEntity(i=>{i.removeEventListener("requestRender",this.requestRender)}),yS.forEach(i=>{t.removeEventListener(i,this.onResetRaycaster)}),t.removeEventListener("touchmove",this.onTouchMovePreventScroll),t.removeEventListener("wheel",this.onMouseWheelPreventScroll)}reset(){this.deactivate(),this.activate()}resize(){this.eventContext.updaterRect()}},$J=class{constructor(e,t,i,r,n){this._aspect=1,this._renderer=e,this._camera=t,this._frameSize=new q().copy(i),this._editorSize=new q().copy(r),this._aspect=t.aspect,this._fov=n!=null?n:t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewportForImageExport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.x,r=this._editorSize.y;this._aspect=e/t,this._camera.zoom*=Math.min(i/e,r/t),this._renderer.setViewport(0,0,e,t)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.x,r=this._editorSize.y,n=0,s=0,a=e,o=t;e<i&&(n=(i-e)*.5,n=-n,a=i),t<r&&(s=(r-t)*.5,s=-s,o=r),this._aspect=a/o,this._renderer.setViewport(n,s,a,o)}updateCamera(){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let e=this._frameSize.y,t=this._editorSize.y,i=this._fov;if(e>t){let r=e$(e,1080,2160,1,15)/100;i*=e/t,i*=1-r}this._camera.aspect=this._aspect,this._camera.fov=i,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t),this._camera.updateProjectionMatrix())}};function e$(e,t,i,r,n){return(e-t)/(i-t)*(n-r)+r}var xC={RED:0,GREEN:1,BLUE:2,ALPHA:3},Hu="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",t$=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Zc=class extends ci{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new ze(null),kernel16:new ze(null),inputBuffer:new ze(null),cocBuffer:new ze(null),texelSize:new ze(new q),scale:new ze(1)},blending:Ei,depthWrite:!1,depthTest:!1,fragmentShader:t$,vertexShader:Hu}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*e,h=Math.sqrt(o)/Math.sqrt(80),c=h*Math.cos(l),u=h*Math.sin(l);o%5===0?(i[n++]=c,i[n++]=u):(t[r++]=c,t[r++]=u)}let s=[],a=[];for(let o=0;o<128;)s.push(new ht(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)a.push(new ht(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function xS(e,t,i){return e*(t-i)-t}function Ev(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var i$=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,r$=class extends ci{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new ze(null),focusDistance:new ze(0),focusRange:new ze(0),cameraNear:new ze(.3),cameraFar:new ze(1e3)},blending:Ei,depthWrite:!1,depthTest:!1,fragmentShader:i$,vertexShader:Hu}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Ss){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-xS(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=Ev(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-xS(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=Ev(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Oi?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},n$=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,s$="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",bS=class extends ci{constructor(e=new q){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new ze(null),texelSize:new ze(new q),halfTexelSize:new ze(new q),kernel:new ze(0),scale:new ze(1)},blending:Ei,depthWrite:!1,depthTest:!1,fragmentShader:n$,vertexShader:s$}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},a$=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,o$=class extends ci{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new ze(null),opacity:new ze(1)},blending:Ei,depthWrite:!1,depthTest:!1,fragmentShader:a$,vertexShader:Hu}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},l$=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=linearToRelativeLuminance(texture2D(inputBuffer,vUv).rgb);float lLeft=linearToRelativeLuminance(texture2D(inputBuffer,vUv0).rgb);float lTop=linearToRelativeLuminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=linearToRelativeLuminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=linearToRelativeLuminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=linearToRelativeLuminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=linearToRelativeLuminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,h$=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,xy={DEPTH:0,LUMA:1,COLOR:2},bC={DISABLED:0,DEPTH:1,CUSTOM:2},u$=class extends ci{constructor(e=new q,t=xy.COLOR){super({name:"EdgeDetectionMaterial",defines:{LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new ze(null),depthBuffer:new ze(null),predicationBuffer:new ze(null),texelSize:new ze(e)},blending:Ei,depthWrite:!1,depthTest:!1,fragmentShader:l$,vertexShader:h$}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Ss){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},c$=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,d$="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",Xr={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},Tv=class extends ci{constructor(e,t,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Su.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new ze(null),depthBuffer:new ze(null),resolution:new ze(new q),texelSize:new ze(new q),cameraNear:new ze(.3),cameraFar:new ze(1e3),aspect:new ze(1),time:new ze(0)},blending:Ei,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=Ss){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=c$.replace(Xr.FRAGMENT_HEAD,e.get(Xr.FRAGMENT_HEAD)).replace(Xr.FRAGMENT_MAIN_UV,e.get(Xr.FRAGMENT_MAIN_UV)).replace(Xr.FRAGMENT_MAIN_IMAGE,e.get(Xr.FRAGMENT_MAIN_IMAGE)),this.vertexShader=d$.replace(Xr.VERTEX_HEAD,e.get(Xr.VERTEX_HEAD)).replace(Xr.VERTEX_MAIN_SUPPORT,e.get(Xr.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Oi?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return Xr}},p$=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=linearToRelativeLuminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,f$=class extends ci{constructor(e=!1,t=null){super({name:"LuminanceMaterial",uniforms:{inputBuffer:new ze(null),threshold:new ze(0),smoothing:new ze(1),range:new ze(null)},blending:Ei,depthWrite:!1,depthTest:!1,fragmentShader:p$,vertexShader:Hu}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},m$=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,wC={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},g$=class extends ci{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new ze(e),inputBuffer:new ze(null),strength:new ze(1)},blending:Ei,depthWrite:!1,depthTest:!1,fragmentShader:m$,vertexShader:Hu}),this.toneMapped=!1,this.setColorChannel(xC.RED),this.setMaskFunction(wC.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==Ii&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},v$=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,y$="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",x$=class extends ci{constructor(e=new q,t=new q){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new ze(null),searchTexture:new ze(null),areaTexture:new ze(null),resolution:new ze(t),texelSize:new ze(e)},blending:Ei,depthWrite:!1,depthTest:!1,fragmentShader:v$,vertexShader:y$}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},b$=new zl,zs=null;function w$(){if(zs===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);zs=new it,zs.setAttribute!==void 0?(zs.setAttribute("position",new at(e,3)),zs.setAttribute("uv",new at(t,2))):(zs.addAttribute("position",new at(e,3)),zs.addAttribute("uv",new at(t,2)))}return zs}var zr=class{constructor(e="Pass",t=new Ka,i=b$){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new Gi(w$(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Ka),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Ss){}render(e,t,i,r,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t.dispose=="function"){if(t instanceof Ka||t===this.renderer)continue;this[e].dispose()}}}},ep=class extends zr{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new o$,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new ri(1,1,{minFilter:Ot,magFilter:Ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==Ii?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===pt&&(this.renderTarget.texture.encoding=pt))}},_$=class extends zr{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,n){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},Hm=new Ze,Np=class extends zr{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,h=a>=0;l?(Hm.copy(e.getClearColor(Hm)),e.setClearColor(s,h?a:o)):h&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(Hm,o):h&&e.setClearAlpha(o)}},Gs=-1,tr=class extends Bi{constructor(e,t=Gs,i=Gs,r=1){super(),this.resizable=e,this.base=new q(1,1),this.preferred=new q(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==Gs?r=t.width:t.height!==Gs?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==Gs?r=t.height:t.width!==Gs?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(Gs),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return Gs}},Vm=!1,wS=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case Lr:i=this.materialsFlatShadedDoubleSide;break;case Ai:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case Lr:i=this.materialsDoubleSide;break;case Ai:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=ys;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Ai,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Lr,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Ai,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Lr,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,Vm){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Vm}static set workaroundEnabled(e){Vm=e}},S$=class extends zr{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new Np,this.overrideMaterialManager=i===null?null:new wS(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new wS(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,h=s.background,c=e.shadowMap.autoUpdate,u=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(u),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=h,e.shadowMap.autoUpdate=c}},_S=class extends zr{constructor(e,t,{resolutionScale:i=1,width:r=tr.AUTO_SIZE,height:n=tr.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new S$(e,t,new KA({depthPacking:kA}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new Ze(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new ri(1,1,{minFilter:Xt,magFilter:Xt,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new tr(this,r,n,i);l.addEventListener("change",h=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},wt={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},A$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",E$="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",T$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",M$="float blend(const in float x,const in float y){return(y==0.0)? y : max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",C$="float blend(const in float x,const in float y){return(y==1.0)? y : min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",D$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",P$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",L$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",O$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",R$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",I$="float blend(const in float x,const in float y){return(y>0.0)? min(x/y,1.0): 1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",B$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",N$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",k$="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",U$="float blend(const in float x,const in float y){return(y==1.0)? y : min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",F$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",z$="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",G$="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",H$=new Map([[wt.SKIP,null],[wt.ADD,A$],[wt.ALPHA,E$],[wt.AVERAGE,T$],[wt.COLOR_BURN,M$],[wt.COLOR_DODGE,C$],[wt.DARKEN,D$],[wt.DIFFERENCE,P$],[wt.EXCLUSION,L$],[wt.LIGHTEN,O$],[wt.MULTIPLY,R$],[wt.DIVIDE,I$],[wt.NEGATION,B$],[wt.NORMAL,N$],[wt.OVERLAY,k$],[wt.REFLECT,U$],[wt.SCREEN,F$],[wt.SOFT_LIGHT,z$],[wt.SUBTRACT,G$]]),V$=class extends Bi{constructor(e,t=1){super(),this.f=e,this.opacity=new ze(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return H$.get(this.blendFunction)}},Gn={NONE:0,DEPTH:1,CONVOLUTION:2},Kn=class extends Bi{constructor(e,t,{attributes:i=Gn.NONE,blendFunction:r=wt.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new V$(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=Ss){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t.dispose=="function"){if(t instanceof Ka||t===this.renderer)continue;this[e].dispose()}}}};function SS(e,t,i){for(let r of t){let n="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function j$(e,t,i,r,n,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),h=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),c=[],u=[],d=!1,p=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(h&&(a&Gn.CONVOLUTION)!==0)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!h)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let m=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,g=Tv.Section;if(h){let v=`	${e}MainUv(UV);
`;i.set(g.FRAGMENT_MAIN_UV,i.get(g.FRAGMENT_MAIN_UV)+v),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let v=`	${e}MainSupport(`;v+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(g.VERTEX_MAIN_SUPPORT,i.get(g.VERTEX_MAIN_SUPPORT)+v),c=c.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),u=u.concat(c).concat([...o.get("vertex").matchAll(m)].map(y=>y[1]))}u=u.concat([...o.get("fragment").matchAll(m)].map(v=>v[1])),u=u.concat([...t.defines.keys()].map(v=>v.replace(/\([\w\s,]*\)/g,""))),u=u.concat([...t.uniforms.keys()]),t.uniforms.forEach((v,y)=>s.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),t.defines.forEach((v,y)=>n.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),SS(e,u,n),SS(e,u,o);let f=t.blendMode;if(r.set(f.blendFunction,f),l){let v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,y=`${e}MainImage(color0, UV, `;(a&Gn.DEPTH)!==0&&v.test(o.get("fragment"))&&(y+="depth, ",p=!0),y+=`color1);
	`;let x=e+"BlendOpacity";s.set(x,f.opacity),y+=`color0 = blend${f.blendFunction}(color0, color1, ${x});

	`,i.set(g.FRAGMENT_MAIN_IMAGE,i.get(g.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${x};

`,i.set(g.FRAGMENT_HEAD,i.get(g.FRAGMENT_HEAD)+y)}i.set(g.FRAGMENT_HEAD,i.get(g.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(g.VERTEX_HEAD,i.get(g.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:c,transformedUv:d,readDepth:p}}var jm=class extends zr{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new Tv(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=Tv.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,h=!1,c=!1;for(let d of this.effects)if(d.blendMode.blendFunction===wt.SKIP)l|=d.getAttributes()&Gn.DEPTH;else if((l&d.getAttributes()&Gn.CONVOLUTION)!==0)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let p="e"+a++,m=j$(p,d,t,i,r,n,l);if(o+=m.varyings.length,h=h||m.transformedUv,c=c||m.readDepth,d.extensions!==null)for(let g of d.extensions)s.add(g)}let u=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(u,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+p+`
`)}if((l&Gn.DEPTH)!==0){if(c){let d=`float depth = readDepth(UV);

	`;t.set(e.FRAGMENT_MAIN_IMAGE,d+t.get(e.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=this.getDepthTexture()===null}else this.needsDepthTexture=!1;if(h){let d=`vec2 transformedUv = vUv;
`;t.set(e.FRAGMENT_MAIN_UV,d+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")}else r.set("UV","vUv");t.forEach((d,p,m)=>m.set(p,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=Ss){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,n){for(let s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==Ii&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},W$=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],_C=class extends zr{constructor({resolutionScale:e=.5,width:t=tr.AUTO_SIZE,height:i=tr.AUTO_SIZE,kernelSize:r=by.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new ri(1,1,{minFilter:Ot,magFilter:Ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new tr(this,t,i,e);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new bS,this.ditheredBlurMaterial=new bS,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,h=W$[this.kernelSize],c=this.blurMaterial,u=t,d,p;for(this.fullscreenMaterial=c,d=0,p=h.length-1;d<p;++d){let m=(d&1)===0?o:l;c.kernel=h[d],c.inputBuffer=u.texture,e.setRenderTarget(m),e.render(s,a),u=m}this.dithering&&(c=this.ditheredBlurMaterial,this.fullscreenMaterial=c),c.kernel=h[d],c.inputBuffer=u.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,a)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Ii?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===pt&&(this.renderTargetA.texture.encoding=pt,this.renderTargetB.texture.encoding=pt))}static get AUTO_SIZE(){return tr.AUTO_SIZE}},q$=class extends zr{constructor({width:e=tr.AUTO_SIZE,height:t=tr.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new f$(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new ri(1,1,{minFilter:Ot,magFilter:Ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new tr(this,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==Ii&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Y$=class extends zr{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new Np(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,n){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,h=this.clearPass,c=this.inverted?0:1,u=1-c;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,c,4294967295),a.stencil.setClear(u),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?h.render(e,null):(h.render(e,t),h.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},js=class extends zr{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,r,n){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==Ii&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Wm=1/1e3,X$=1e3,Q$=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*Wm}getFixedDelta(){return this.fixedDelta*Wm}setFixedDelta(e){return this.fixedDelta=e*X$,this}getElapsed(){return this.elapsed*Wm}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},K$=class{constructor(e=null,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n}={}){this.renderer=null,this.inputBuffer=this.createBuffer(t,i,n,r),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new ep,this.depthTexture=null,this.passes=[],this.timer=new Q$,this.autoRenderToScreen=!0,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,e!==null){let t=e.getSize(new q),i=e.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===Ii&&e.outputEncoding===pt&&(this.inputBuffer.texture.encoding=pt,this.outputBuffer.texture.encoding=pt,this.inputBuffer.dispose(),this.outputBuffer.dispose()),e.autoClear=!1,this.setSize(t.width,t.height);for(let n of this.passes)n.initialize(e,i,r)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new i0;return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=ro,e.type=Ya):e.type=qs,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r){let n=this.renderer,s=n===null?new q:n.getDrawingBufferSize(new q),a={minFilter:Ot,magFilter:Ot,stencilBuffer:t,depthBuffer:e,type:i},o;return r>0?(o=Number(Su.replace(/\D+/g,""))<138?new NU(s.width,s.height,a):new ri(s.width,s.height,a),o.ignoreDepthForMultisampleCopy=!1,o.samples=r):o=new ri(s.width,s.height,a),i===Ii&&n!==null&&n.outputEncoding===pt&&(o.texture.encoding=pt),o.texture.name="EffectComposer.Buffer",o.texture.generateMipmaps=!1,o}addPass(e,t){let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new q),s=r.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(e.setRenderer(r),e.setSize(n.width,n.height),e.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let o=this.createDepthTexture();for(e of i)e.setDepthTexture(o)}else e.setDepthTexture(this.depthTexture)}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;t.reduce(r,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=!1,a,o,l;e===void 0&&(e=this.timer.update().getDelta());for(let h of this.passes)h.enabled&&(h.render(t,r,n,e,s),h.needsSwap&&(s&&(i.renderToScreen=h.renderToScreen,a=t.getContext(),o=t.state.buffers.stencil,o.setFunc(a.NOTEQUAL,1,4294967295),i.render(t,r,n,e,s),o.setFunc(a.EQUAL,1,4294967295)),l=r,r=n,n=l),h instanceof Y$?s=!0:h instanceof _$&&(s=!1))}setSize(e,t,i){let r=this.renderer;if(e===void 0||t===void 0){let s=r.getSize(new q);e=s.width,t=s.height}r.setSize(e,t,i);let n=r.getDrawingBufferSize(new q);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},by={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},Z$=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,J$=class extends Kn{constructor({blendFunction:e=wt.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=tr.AUTO_SIZE,height:a=tr.AUTO_SIZE,kernelSize:o=by.LARGE}={}){super("BloomEffect",Z$,{blendFunction:e,uniforms:new Map([["map",new ze(null)],["intensity",new ze(n)]])}),this.renderTarget=new ri(1,1,{minFilter:Ot,magFilter:Ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new q$({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new _C({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",h=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===pt&&(this.renderTarget.texture.encoding=pt))}},$$="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",eee=class extends Kn{constructor({blendFunction:e=wt.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",$$,{blendFunction:e,uniforms:new Map([["brightness",new ze(t)],["contrast",new ze(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},tee="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",iee=class extends Kn{constructor(e=wt.NORMAL){super("ColorAverageEffect",tee,{blendFunction:e})}},ree="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",nee="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",see=class extends Kn{constructor({blendFunction:e=wt.NORMAL,offset:t=new q(.001,5e-4)}={}){super("ChromaticAberrationEffect",ree,{vertexShader:nee,blendFunction:e,attributes:Gn.CONVOLUTION,uniforms:new Map([["offset",new ze(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},aee=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,oee=class extends Kn{constructor(e,{blendFunction:t=wt.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=tr.AUTO_SIZE,height:h=tr.AUTO_SIZE}={}){super("DepthOfFieldEffect",aee,{blendFunction:t,attributes:Gn.DEPTH,uniforms:new Map([["nearColorBuffer",new ze(null)],["farColorBuffer",new ze(null)],["nearCoCBuffer",new ze(null)],["scale",new ze(1)]])}),this.camera=e,this.renderTarget=new ri(1,1,{minFilter:Ot,magFilter:Ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new js(new r$(e));let c=this.cocMaterial;c.focusDistance=n,c.focusRange=a,i!==void 0&&(c.worldFocusDistance=i),r!==void 0&&(c.worldFocusRange=r),this.blurPass=new _C({kernelSize:by.MEDIUM,width:l,height:h});let u=this.blurPass.getResolution();u.addEventListener("change",p=>this.setSize(u.getBaseWidth(),u.getBaseHeight())),this.maskPass=new js(new g$(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=wC.MULTIPLY,d.colorChannel=xC.GREEN,this.bokehNearBasePass=new js(new Zc(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new js(new Zc(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new js(new Zc(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new js(new Zc(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return Ev(-i,t.near,t.far)}setDepthTexture(e,t=Ss){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,n),this.blurPass.render(e,n,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,Ii),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===pt&&(this.renderTarget.texture.encoding=pt,this.renderTargetNear.texture.encoding=pt,this.renderTargetFar.texture.encoding=pt,this.renderTargetMasked.texture.encoding=pt))}};new M;new Fe;var lee="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",hee=class extends Kn{constructor({blendFunction:e=wt.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",lee,{blendFunction:e,uniforms:new Map([["hue",new ze(new M)],["saturation",new ze(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new Ze;var uee=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,cee=class extends Kn{constructor({blendFunction:e=wt.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",uee,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},dee="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",pee=class extends Kn{constructor(e=30){super("PixelationEffect",dee,{uniforms:new Map([["active",new ze(!1)],["d",new ze(new q)]])}),this.resolution=new q,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new M;new M;var AS="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",ES="data:image/png;base64,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",fee="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",mee="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",Zo={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},gee=class extends Kn{constructor({preset:e=Zo.MEDIUM,edgeDetectionMode:t=xy.COLOR,predicationMode:i=bC.DISABLED}={}){super("SMAAEffect",fee,{vertexShader:mee,blendFunction:wt.NORMAL,attributes:Gn.CONVOLUTION|Gn.DEPTH,uniforms:new Map([["weightMap",new ze(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new ri(1,1,{minFilter:Ot,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new Np(!0,!1,!1),this.clearPass.overrideClearColor=new Ze(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new js(new u$),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new js(new x$);let s=new hE;s.onLoad=()=>{let a=new ji(r);a.name="SMAA.Search",a.magFilter=Xt,a.minFilter=Xt,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new ji(n);o.name="SMAA.Area",o.magFilter=Ot,o.minFilter=Ot,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=AS,n.src=ES),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case Zo.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Zo.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case Zo.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case Zo.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=Ss){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return AS}static get areaImageDataURL(){return ES}},vee=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,Jc={DEFAULT:0,ESKIL:1},yee=class extends Kn{constructor({blendFunction:e=wt.NORMAL,technique:t=Jc.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",vee,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new ze(r)],["darkness",new ze(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Jc.ESKIL}set eskil(e){this.technique=e?Jc.ESKIL:Jc.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},As=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=wt.NORMAL}},xee=class extends As{constructor(){super(J$),this.blendFunction=wt.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},bee=class extends As{constructor(){super(eee)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},wee=class extends As{constructor(){super(see),this.effect.offset=new q(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},_ee=class extends As{constructor(){super(iee)}},See=class extends As{constructor(){super(hee),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},Aee=class extends As{constructor(){super(cee),this.blendFunction=wt.OVERLAY}},Eee=class extends As{constructor(){super(yee)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},Tee=class extends As{constructor(e){super(oee,e)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=e}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}},Mee=class extends As{constructor(){super(pee)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},Cee=class extends zr{constructor(e,t,i){super("TransmissionPass",e,t),this.copyPass=new ep(i.transmissionRenderTarget),this.depthPass=new _S(e,t,{renderTarget:i.transmissionDepthTarget}),this.needsSwap=!1}updatePasses(e){this.copyPass=new ep(e.transmissionRenderTarget),this.depthPass=new _S(this.scene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.scene=e}render(e,t,i){let r=this.camera.layers.mask;this.copyPass.render(e,t,i),this.camera.layers.disable(3),this.depthPass.render(e,t,i),e.shadowMap.needsUpdate=!1,e.shadowMap.autoUpdate=!1;let n=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(n),e.render(this.scene,this.camera),this.camera.layers.mask=r}},TS=new Ka,Dee=new ci({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        void main() {
            gl_FragColor = vec4(0.0);
        }
    `}),qm=class extends zr{constructor(e,t){super("OpaquePass",e!=null?e:TS,t),this.hasTransmissionPass=!1,this.clear=!0,this.needsSwap=!1,this.originalMaterials=new Map}setCamera(e){this.camera=e}setScene(e){this.scene=e!=null?e:TS}getScene(){return this.scene}render(e,t){this.originalMaterials.clear(),this.camera.layers.enable(3),this.hasTransmissionPass&&this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof Qi&&(this.originalMaterials.set(r.id,r.material),r.material=Dee)}),this.camera.layers.enable(8),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0;let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),this.hasTransmissionPass&&this.originalMaterials.forEach((r,n)=>{let s=this.scene.getObjectById(n);s&&(s.material=r)})}};function MS(e,t){return t&&t.enabled&&e.push(t.effect),e}var Pee=class extends Bi{constructor(e){super(),this.postprocessingState=lu.defaultData,this._scene=new Ka,this._camera=new da,this.effects=new Map,this._renderToScreen=!0,this.clock=new CU,this.renderer=e,this.debug=!1,this.effects.set("bloom",new xee),this.effects.set("chromaticAberration",new wee),this.effects.set("vignette",new Eee),this.effects.set("noise",new Aee),this.effects.set("colorAverage",new _ee),this.effects.set("hueSaturation",new See),this.effects.set("brightnessContrast",new bee),this.effects.set("depthOfField",new Tee),this.effects.set("pixelation",new Mee),this.effectComposer=new K$(this.renderer),this.opaquePass=new qm(this.scene,this.camera),this.transmissionPass=new Cee(this.scene,this.camera,this.renderer),this.helperPass=new qm(void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperClearPass=new Np(!1,!0,!1),this.helperPassOnTop=new qm(void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this._initCopyPass(),this._initSmaa(),this._initPasses()}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}get camera(){return this._camera}set camera(e){this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}disableHelpers(){this.helperPass.enabled=!1,this.helperClearPass.enabled=!1,this.helperPassOnTop.enabled=!1}enableHelpers(){this.helperPass.enabled=!0,this.helperClearPass.enabled=!0,this.helperPassOnTop.enabled=!0}_initSmaa(){let e=new gee({preset:Zo.ULTRA,edgeDetectionMode:xy.COLOR}),t=()=>{e.removeEventListener("load",t),this.dispatchEvent({type:"smaaloaded"})};e.addEventListener("load",t),e.edgeDetectionMaterial.predicationMode=bC.DEPTH,e.edgeDetectionMaterial.edgeDetectionThreshold=.05,e.edgeDetectionMaterial.predicationThreshold=.002,e.edgeDetectionMaterial.predicationScale=1,this.smaaPass=new jm(this.camera,e)}_initPasses(){var e,t;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.postprocessingState.enabled){let i=[this.effects.get("pixelation")].reduce(MS,[]);i.length>0&&(this.uvEffectPass=new jm(this.camera,...i),this.effectComposer.addPass(this.uvEffectPass));let r=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(MS,[]);r.length>0&&(this.effectPass=new jm(this.camera,...r),this.effectComposer.addPass(this.effectPass))}this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.helperClearPass),this.effectComposer.addPass(this.helperPassOnTop),this.effectComposer.addPass(this.smaaPass)}_initCopyPass(){if(this._savePass)return;let e=new q;this.renderer.getDrawingBufferSize(e),this._rt=new ri(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:Kh,wrapT:Kh}),this._rt.samples=0,this._savePass=new ep(this._rt,!1),this._savePass.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?(t.removePass(this._savePass),t.passes[t.passes.length-1].renderToScreen=!0,t.autoRenderToScreen=!0):(t.autoRenderToScreen=!1,t.passes[t.passes.length-1].renderToScreen=!1,this._savePass.renderToScreen=!1,this.postprocessingState.enabled||(this._savePass.needsDepthTexture=!0),t.addPass(this._savePass)),this._renderToScreen=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))a[o]=l}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof ht?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof ht?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},CS=new ji,Lee=class extends ZA{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new q,this.pipeline=new Pee(this),this.overrideTransmission=e==null?void 0:e.overrideTransmission,this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.setPixelRatio=r=>{this._pixelRatio=r,t(r)},this.setSize=(r,n,s=!0)=>{var a,o,l;(this.viewportWidth!==r||this.viewportHeight!==n)&&(this.viewportWidth=r,this.viewportHeight=n,i(r,n,s),(a=this.normalRenderTarget)==null||a.setSize(r*this._pixelRatio,n*this._pixelRatio),(o=this.transmissionRenderTarget)==null||o.setSize(r*this._pixelRatio/2,n*this._pixelRatio/2),(l=this.transmissionDepthTarget)==null||l.setSize(r*this._pixelRatio/2,n*this._pixelRatio/2),this.pipeline.resize(r,n,s))}}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new ri(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{generateMipmaps:!0,minFilter:Eu,magFilter:Ot,wrapS:or,wrapT:or,depthBuffer:!1}),this.transmissionDepthTarget=new ri(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Xt,magFilter:Xt,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new ri(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Xt,magFilter:Xt,type:Ys,depthTexture:new i0(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t){this.normalRenderTarget&&(this.setClearColor(0),t.layers.enable(8),t.layers.disable(0),t.layers.disable(3),this.setRenderTarget(this.normalRenderTarget),this.clear(),t instanceof da?um.uniforms.depthContrast.value=(t.far-t.near)/1e4:um.uniforms.depthContrast.value=1,e.overrideMaterial=um,this.render(e,t),this.setClearColor(e.bgColor,e.bgColor.a),this.setRenderTarget(null),e.overrideMaterial=null,t.layers.enable(0),t.layers.enable(3))}renderSplineScene(e,t,i,r,n){this.setClearColor(e.bgColor,e.bgColor.a),i.penumbraSize.forEach((a,o)=>{Vt.penumbraSize.value[o]=a}),Vt.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?Vt.resolution.value.set(this.resolution.x,this.resolution.y):Vt.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),this.overrideNormal!==void 0?(Vt.normalRenderTarget.value=this.overrideNormal,Vt.normalRenderTargetDepth.value=CS):e.needsNormal()&&(this.createNormalRenderTarget(),Vt.normalRenderTarget.value=this.normalRenderTarget.texture,Vt.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(e,t));let s=!1;if(this.overrideTransmission!==void 0)Vt.transmissionRenderTarget.value=this.overrideTransmission,Vt.transmissionRenderTargetDepth.value=CS,this.pipeline.setTransmissionPassEnabled(!1);else{let a=e.needsTransmission();a&&(this.transmissionRenderTarget===void 0&&(s=!0),this.createTransmissionRenderTarget(),Vt.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,Vt.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(a)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=r,this.pipeline.sceneHelpersOnTop=n,this.pipeline.scene=e,this.pipeline.camera=t,s&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==e.postprocessing&&this.pipeline.updatePostprocessing(e.postprocessing),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),this.pipeline.render()}dispose(){var e,t,i,r,n;super.dispose(),this.pipeline.dispose(),(e=this.transmissionRenderTarget)==null||e.dispose(),(t=this.transmissionDepthTarget)==null||t.dispose(),(i=this.normalRenderTarget)==null||i.dispose(),(n=(r=this.normalRenderTarget)==null?void 0:r.depthTexture)==null||n.dispose()}},Oee=class{constructor(e,t={}){this.sharedAssets=new oy(e.shared,t),this.scene=new Lp(e.scene,this.sharedAssets),this.scene.switchActiveCamera(this.scene.activeCamera)}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}dispose(){this.scene.dispose()}},Ree=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function Iee(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function Ym(e){return e==="SubdivObject"||e==="NonParametric"?e:"Mesh"}function Bee(e,t){let i={};return e.traverseEntity(r=>{var l;if(r.type!=="Mesh"||!("material"in r)||!r.visible||!(r instanceof Qi)||Array.isArray(r.material)||Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof Qi&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=t.shared.materials[s];if(a){if(!Br.isMergable(a))return}else{let h=(l=t.scene.objects.get(r.uuid))==null?void 0:l.data;if(h&&"material"in h&&typeof h.material!="string"){if(!Br.isMergable(h.material))return;s=Br.getHash(h.material)}}i[s]||(i[s]={});let o=i[s][Ym(r.objectType)];if(o){if(o.push(r),r.cloner)for(let h of r.cloner.children)o.push(h)}else if(i[s][Ym(r.objectType)]=[r],r.cloner)for(let h of r.cloner.children)i[s][Ym(r.objectType)].push(h)}),i}function Nee(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>t&&(t=n)})}),t}function kee(e,t){let i=Bee(t,e),r=Nee(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),h=0,c=new Array(r),u=0;for(let d of Object.values(i))for(let p of Object.values(d)){if(o=0,h=0,p.forEach(g=>{g instanceof Qi&&(a[o++]=g.geometry.clone(),l[h++]=g)}),h<2)continue;for(let g=0;g<h;g++)l[g].updateWorldMatrix(!0,!1),a[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&Iee(a[g]);let m=il(a.slice(0,o),!1);if(m){let g;switch(p[0].objectType){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),g=new Gi(m,l[0].material);break}default:{g=new Gi(m,l[0].material);break}}g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,t.add(g);let f=v=>{u=0;for(let y of v)y.children&&f(y.children),y instanceof Qi&&(Array.isArray(y.material)||i[y.material.uuid]&&i[y.material.uuid][y.objectType]&&i[y.material.uuid][y.objectType].length>1||(c[u++]=y));for(let y=0;y<u;y++)t.attach(c[y])};for(let v=0;v<h;v++){let y=l[v];f(y.children),n[s++]=y}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var Uee=new q;function Fee(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}function zee(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var SC=class{constructor(e,{renderOnDemand:t=!0}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._lastTime=performance.now(),this.time=performance.now(),this.dt=0,this._skipRender=!1,this.renderOnDemand=!0,this.disposed=!1,this.requestRender=()=>{this._skipRender=!1},this.render=i=>{var r,n,s,a;!this._renderer||(this._rafId=requestAnimationFrame(this.render),this.time=i,this.dt=this.time-this._lastTime,this._lastTime=this.time,(r=this._perfs)==null||r.start(),!(this.renderOnDemand&&this._skipRender)&&(this._skipRender=(s=(n=this._controls)==null?void 0:n.update(this.dt))!=null?s:!0,this._eventManager&&!this._eventManager.isEnable&&this._eventManager.activate(),this._scene&&this._camera&&this._renderer.renderSplineScene(this._scene,this._camera,this._sharedAssetsManager),(a=this._perfs)==null||a.end()))},this._resize=$E(()=>{var i,r,n;!this._renderer||(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=Uee.set(this._viewportWidth,this._viewportHeight)),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._viewportMode!==1&&((i=this._frameView)==null||i.updateViewport()),this._camera&&((r=this._frameView)==null||r.updateCamera(),this._camera.cameraType==="PerspectiveCamera"&&this._viewportMode===1&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()),(n=this._eventManager)==null||n.resize(),this.requestRender())},10),this.canvas=e,this.renderOnDemand=t,window.location.search.includes("perfs")&&(this._perfs=new Ree({x:10,y:10})),Kj(e)}async load(e,t){Fee(e);let i=await(await fetch(e,t)).arrayBuffer();await this.start(i)}async start(e,{interactive:t=!0}={}){var n;if(this.disposed)return;let i=await ZJ(e);Hw(i)&&await n9(),zee(i)&&await t9(),i.scene.environment.usePhysics&&await yj(),this._eventManager&&this._eventManager.deactivate(),this._controls&&this._controls.dispose(),(n=this._scene)==null||n.dispose();let r=new Oee(i);if(this._scene=r.scene,this._sharedAssetsManager=r.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let s=performance.now();kee(i,r.scene);let a=performance.now();console.log("Merged geometries in ",a-s," ms")}if(Hw(i)&&this._scene.traverse(s=>{Xi(s)&&s.recomputeBoolean()}),this._sharedAssetsManager.setOnImageLoad(()=>{this.requestRender()}),this._sharedAssetsManager.setOnFontLoad(()=>{this.requestRender()}),nJ(i.scene,this._scene,this._sharedAssetsManager),this._renderer||(this._renderer=new Lee({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.addEventListener("smaaloaded",this.requestRender),this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=i.scene.environment.ambientLight.softShadows?Xv:LA,s7(i.scene.environment.ambientLight.softShadowQuality)),this._frameView)this._frameView.setCamera(this._camera);else{let s=Object.values(i.frames)[0];if(s.preset==="fullscreen"){this._viewportMode=1;let{width:a,height:o}=window.getComputedStyle(this.canvas);this.canvas.parentElement&&(a==="300px"||a==="auto")?(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"):this._viewportWidth=this.canvas.clientWidth,this.canvas.parentElement&&(o==="150px"||o==="auto")?(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%"):this._viewportHeight=this.canvas.clientHeight}else this._viewportMode=2,this._viewportWidth=s.size[0],this._viewportHeight=s.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`;this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new $J(this._renderer,this._camera,new q(this._viewportWidth,this._viewportHeight),new q(window.innerWidth,window.innerHeight))}if(t&&(this._scene.updateMatrixWorld(!0),this._controls=new CJ(i,this._scene,this._renderer,this.requestRender,this._sharedAssetsManager,!0),this._eventManager=new JJ(this._renderer,this._scene,this._camera,i.scene.publish.stopRaycast,i.scene.publish.preventScroll,this._sharedAssetsManager,this.requestRender,!0)),this._resize(),!this._resizeObserver&&this.canvas.parentElement){let s=!0;this._resizeObserver=new ResizeObserver(()=>{if(s){s=!1;return}this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._resize()}),this._resizeObserver.observe(this.canvas.parentElement)}this._rafId===void 0?this.render(performance.now()):this.requestRender()}findObjectById(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByName(e);return this._createProxyObject(t)}getSplineEvents(){}emitEvent(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEvent(e)}emitEventReverse(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEventReverse(e)}addEventListener(e,t){var i;(i=this._renderer)==null||i.domElement.addEventListener(e,t)}removeEventListener(e,t){var i;(i=this._renderer)==null||i.domElement.removeEventListener(e,t)}setZoom(e){var t,i;((t=this._controls)==null?void 0:t.orbitControls)instanceof yC&&((i=this._controls)==null||i.orbitControls.zoomOut(e))}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}dispose(){var e,t,i,r,n,s;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._rafId&&cancelAnimationFrame(this._rafId),this._proxyObjectCache.forEach(a=>{Fx.unsubscribe(a)}),(r=this._renderer)==null||r.dispose(),(n=this._sharedAssetsManager)==null||n.dispose(),this._resizeObserver&&this._resizeObserver.disconnect(),this.canvas.style.width="",this.canvas.style.height="",(s=this._controls)==null||s.dispose(),Zj(this.canvas)}_createProxyObject(e){if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,emitEvent(r){},emitEventReverse(r){}},i=Fx(t,(r,n)=>{var s;typeof e[r]!="object"&&((s=Object.getOwnPropertyDescriptor(e,r))==null?void 0:s.writable)&&(e[r]=n),this.requestRender(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,i),i}};const Xm=document.getElementById("page-section-home-canvas");if(Xm){const e=new SC(Xm);e.load("/scene.splinecode");const t=()=>{const i=window.innerWidth;Xm.parentElement,i<836?e.canvas.style.display="none":e.canvas.style.display="block"};window.addEventListener("resize",t),window.addEventListener("DOMContentLoaded",()=>{t()})}const Qm=document.getElementById("page-section-about-canvas");if(Qm){new SC(Qm).load("/scene_2.splinecode");const t=()=>{Qm.parentElement};window.addEventListener("resize",t)}window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".loader-wrapper");e&&setTimeout(()=>e.classList.add("hide"),500)});window.addEventListener("beforeunload",async e=>{const t=document.querySelector(".loader-wrapper");t&&(t.classList.remove("hide"),await new Promise(i=>setTimeout(i,500)));try{e.preventDefault(),e.returnValue=""}catch{}});window.addEventListener("scroll",()=>{const e=window.scrollY,t=document.querySelector(".navbar");t&&(e>0?t.classList.add("scrolled"):t.classList.remove("scrolled"))});async function AC(){const e=document.querySelector(".navbar"),t=document.querySelector(".navbar .navbar-collapse");e&&(t.classList.contains("show")?e.classList.add("collapsed"):e.classList.remove("collapsed")),await new Promise(i=>setTimeout(i,1)),setTimeout(AC,1)}setTimeout(AC,1)});export default Gee();
//# sourceMappingURL=main.543938cc.js.map
